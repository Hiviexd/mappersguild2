var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,o=(e,o)=>{for(var r in o||(o={}))s.call(o,r)&&i(e,r,o[r]);if(t)for(var r of t(o))a.call(o,r)&&i(e,r,o[r]);return e};import{d as r,m as l,p as n,a as d,i as c,o as p,b as u,f as m,j as f,t as h,k as g,e as y,n as P,L as U,G as k,D as b,q as w,w as x,g as v,F as M,C as q,l as $,u as C}from"./vendor.cb33bf1d.js";import{_ as B}from"./ModalDialog.0d82a3c5.js";import{a as I}from"./task.5925ddbb.js";import{a as S}from"./beatmap.b8797e7f.js";import{_ as Q}from"./ModesIcons.529dd388.js";import{_ as O}from"./FilterBox.4128cb26.js";import{_ as F}from"./ModeFilters.cedc5b63.js";import{F as j}from"./extras.b9e74742.js";var D=r({name:"UserCard",props:{user:{type:Object,required:!0}},computed:l(["filterMode"]),methods:{selectUser(){this.$store.commit("users/setSelectedUserId",this.user.id)}}});n("data-v-6053846e");const V=["src"],_={class:"mb-2"},A={class:"text-secondary"},T={class:"card-text small"},E={class:"card-text small"},N=m("i",{class:"fas fa-coins"},null,-1),R={key:0,class:"card-text small"},G={key:1,class:"card-text small"},L={key:2,class:"card-text small"},J={key:3,class:"card-text small"};d(),D.render=function(e,t,s,a,i,o){const r=c("user-link");return p(),u("div",{class:"col-sm-6 col-md-4 col-lg-4 col-xl-3 my-2",onClick:t[0]||(t[0]=t=>e.selectUser())},[m("div",{class:P(["card card-hover card-level-2 card-body","border-rank-"+e.user.rank]),"data-bs-toggle":"modal","data-bs-target":"#extendedInfo"},[m("img",{src:"https://a.ppy.sh/"+e.user.osuId,class:"card-avatar-img"},null,8,V),m("div",_,[f(r,{user:e.user},null,8,["user"])]),m("div",A,[m("div",T,[m("b",null,"Total points: "+h(e.user.totalPoints),1)]),m("div",E,[g(" Available points: "+h(e.user.availablePoints)+" ",1),N]),"osu"==e.filterMode?(p(),u("p",R," osu! points: "+h(Math.round(10*e.user.osuPoints)/10),1)):"taiko"==e.filterMode?(p(),u("p",G," osu!taiko points: "+h(Math.round(10*e.user.taikoPoints)/10),1)):"catch"==e.filterMode?(p(),u("p",L," osu!catch points: "+h(Math.round(10*e.user.catchPoints)/10),1)):"mania"==e.filterMode?(p(),u("p",J," osu!mania points: "+h(Math.round(10*e.user.maniaPoints)/10),1)):y("",!0)])],2)])},D.__scopeId="data-v-6053846e";var H=r({name:"UserPointsRow",props:{points:{type:Number,required:!0},display:{type:String,required:!0},tooltipTitle:{type:String,required:!0}}});const W={class:"text-white-50"},z={scope:"row"},K={scope:"row"};H.render=function(e,t,s,a,i,o){const r=U("bs-tooltip");return p(),u("tr",W,[k(m("td",z,[g(h(e.display),1)],512),[[r,e.tooltipTitle,"left"]]),m("td",K,h(Math.round(10*e.points)/10),1)])};var X=r({name:"UserInfo",components:{UserPointsRow:H,ModalDialog:B,ModesIcons:Q},data:()=>({currentQuests:[],createdQuestNames:[],spentPoints:[],userBeatmaps:[],sortOrder:Object.values(I)}),computed:o(o({},l(["loggedInUser"])),b("users",["selectedUser"])),watch:{async selectedUser(){if(!this.selectedUser||this.selectedUser.id===this.$route.query.id)return;this.$router.push(`/users?id=${this.selectedUser.id}`),this.currentQuests=[],this.createdQuestNames=[],this.spentPoints=[],this.userBeatmaps=[];const[e,t,s,a]=await Promise.all([this.$http.executeGet(`/users/${this.selectedUser.id}/quests`),this.$http.executeGet(`/users/findCreatedQuests/${this.selectedUser.id}`),this.$http.executeGet(`/users/findSpentPoints/${this.selectedUser.id}`),this.$http.executeGet(`/users/findUserBeatmaps/${this.selectedUser.id}`)]);if(this.$http.isError(e)||(this.currentQuests=e),this.$http.isError(t)||(this.createdQuestNames=t),this.$http.isError(s)||(this.spentPoints=s),!this.$http.isError(a)){const e=["WIP","Done","Qualified","Ranked"];this.userBeatmaps=a.sort((function(t,s){return e.indexOf(t.status)-e.indexOf(s.status)}))}}},methods:{findIcon:e=>e==S.WIP?"fa-ellipsis-h":e==S.Done?"fa-check":e==S.Qualified||e==S.Ranked?"fa-check-circle":"",userTasks(e){[...e.tasks].sort(((e,t)=>this.sortOrder.indexOf(e.name)-this.sortOrder.indexOf(t.name)));let t="";return e.tasks.forEach((e=>{e.mappers.forEach((s=>{s.id==this.selectedUser.id&&(t+=e.name+", ")}))})),t.slice(0,-2)},calculatePoints(e){let t=25;return e.art||(t+=10),e.requiredMapsets<1?t=727:1==e.requiredMapsets?t+=100:e.requiredMapsets<10&&(t+=7.5*(10-e.requiredMapsets)),t},findSpentPointsAction(e){switch(e){case"acceptQuest":return"Accepted quest:";case"reopenQuest":return"Reopened quest:";case"extendDeadline":return"Extended quest deadline:";case"createQuest":return"Created quest:";default:return"undefined action"}},findSpentPointsValue(e,t){switch(e){case"acceptQuest":return t.price;case"reopenQuest":return t.reopenPrice;case"extendDeadline":return 10;case"createQuest":return this.calculatePoints(t);default:return 0}}}});const Y={class:"row"},Z={class:"col-md-6"},ee={class:"table table-sm"},te=m("thead",null,[m("tr",null,[m("th",{scope:"col"}," Task "),m("th",{scope:"col"}," Points ")])],-1),se=m("td",{scope:"row"}," Total points earned ",-1),ae={scope:"row"},ie=m("td",{scope:"row"}," Available points ",-1),oe={scope:"row"},re=m("i",{class:"fas fa-coins"},null,-1),le={class:"col-md-6"},ne={class:"small"},de=g(" Rank: "),ce={key:1,class:"text-white-50"},pe={key:0,class:"small"},ue={class:"p-0 mb-2 ms-4"},me=["href"],fe={key:1,class:"small"},he={class:"p-0 mb-2 ms-4"},ge={key:2,class:"small"},ye={class:"p-0 mb-2 ms-4"},Pe=["href"],Ue=m("div",{class:"radial-divisor"},null,-1),ke={class:"row"},be={class:"col-sm"},we=m("p",null,"Mappers' Guild beatmaps:",-1),xe={class:"table table-sm"},ve=m("thead",null,[m("tr",null,[m("th",{scope:"col"}," Mapset "),m("th",{scope:"col"}," Host "),m("th",{scope:"col"}," Tasks "),m("th",{scope:"col"})])],-1),Me={key:0},qe=[m("td",{scope:"row"}," ... ",-1),m("td",{scope:"row"}," ... ",-1),m("td",{scope:"row"}," ... ",-1),m("td",{scope:"row"},null,-1)],$e={scope:"row"},Ce=["href"],Be={scope:"row"},Ie={scope:"row",class:"text-white-50"},Se={scope:"row",class:"text-white-50"},Qe=["href"],Oe=[m("i",{class:"fas fa-link"},null,-1)],Fe=m("div",{class:"radial-divisor"},null,-1),je={class:"row"},De={class:"col-sm"},Ve=m("p",null,"Spent points logs:",-1),_e={class:"table table-sm"},Ae=m("thead",null,[m("tr",null,[m("th",{scope:"col"}," Action "),m("th",{scope:"col"}," Spent points ")])],-1),Te={key:0},Ee=[m("td",{scope:"row"}," ... ",-1),m("td",{scope:"row"}," ... ",-1)],Ne={scope:"row",class:"text-white-50"},Re=["href"],Ge={scope:"row",class:"text-white-50"},Le=m("i",{class:"fas fa-coins"},null,-1),Je=m("div",{class:"radial-divisor"},null,-1),He={class:"float-end"};X.render=function(e,t,s,a,i,o){const r=c("user-link"),l=c("user-points-row"),n=c("modes-icons"),d=c("modal-dialog"),b=U("bs-tooltip");return p(),w(d,{id:"extendedInfo",loaded:Boolean(e.selectedUser),"header-class":e.selectedUser?"bg-rank-"+e.selectedUser.rank:""},{header:x((()=>[f(r,{class:"text-dark",user:e.selectedUser},null,8,["user"])])),default:x((()=>[m("div",Y,[m("div",Z,[m("table",ee,[te,m("tbody",null,[e.selectedUser.easyPoints?(p(),w(l,{key:0,points:e.selectedUser.easyPoints,display:"mapping Easy difficulties","tooltip-title":"~5 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):y("",!0),e.selectedUser.normalPoints?(p(),w(l,{key:1,points:e.selectedUser.normalPoints,display:"mapping Normal difficulties","tooltip-title":"~6 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):y("",!0),e.selectedUser.hardPoints?(p(),w(l,{key:2,points:e.selectedUser.hardPoints,display:"mapping Hard difficulties","tooltip-title":"~7 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):y("",!0),e.selectedUser.insanePoints?(p(),w(l,{key:3,points:e.selectedUser.insanePoints,display:"mapping Insane difficulties","tooltip-title":"~8 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):y("",!0),e.selectedUser.expertPoints?(p(),w(l,{key:4,points:e.selectedUser.expertPoints,display:"mapping Expert difficulties","tooltip-title":"~8 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):y("",!0),e.selectedUser.storyboardPoints?(p(),w(l,{key:5,points:e.selectedUser.storyboardPoints,display:"creating storyboards","tooltip-title":"2, 7.5, or 10 points per storyboard"},null,8,["points","tooltip-title"])):y("",!0),e.selectedUser.questPoints?(p(),w(l,{key:6,points:e.selectedUser.questPoints,display:"completing quests","tooltip-title":"5 bonus points for completing quests on time"},null,8,["points"])):y("",!0),e.selectedUser.modPoints?(p(),w(l,{key:7,points:e.selectedUser.modPoints,display:"modding mapsets","tooltip-title":"1 point per mod"},null,8,["points"])):y("",!0),e.selectedUser.hostPoints?(p(),w(l,{key:8,points:e.selectedUser.hostPoints,display:"hosting mapsets","tooltip-title":"5 points per mapset hosted"},null,8,["points"])):y("",!0),e.selectedUser.contestParticipantPoints?(p(),w(l,{key:9,points:e.selectedUser.contestParticipantPoints,display:"MBC participation","tooltip-title":"participation in Monthly Beatmapping Contests"},null,8,["points"])):y("",!0),e.selectedUser.contestScreenerPoints?(p(),w(l,{key:10,points:e.selectedUser.contestScreenerPoints,display:"MBC screening","tooltip-title":"screening entries for Monthly Beatmapping Contests"},null,8,["points"])):y("",!0),e.selectedUser.contestJudgePoints?(p(),w(l,{key:11,points:e.selectedUser.contestJudgePoints,display:"MBC judging","tooltip-title":"judging entries for Monthly Beatmapping Contests"},null,8,["points"])):y("",!0),e.selectedUser.legacyPoints?(p(),w(l,{key:12,points:e.selectedUser.legacyPoints,display:"legacy","tooltip-title":"points for things that are no longer applicable to Mappers' Guild"},null,8,["points"])):y("",!0),e.selectedUser.osuPoints?(p(),w(l,{key:13,points:e.selectedUser.osuPoints,display:"Total osu! points","tooltip-title":"mapping osu! game mode"},null,8,["points"])):y("",!0),e.selectedUser.taikoPoints?(p(),w(l,{key:14,points:e.selectedUser.taikoPoints,display:"Total osu!taiko points","tooltip-title":"mapping osu!taiko game mode"},null,8,["points"])):y("",!0),e.selectedUser.catchPoints?(p(),w(l,{key:15,points:e.selectedUser.catchPoints,display:"Total osu!catch points","tooltip-title":"mapping osu!catch game mode"},null,8,["points"])):y("",!0),e.selectedUser.maniaPoints?(p(),w(l,{key:16,points:e.selectedUser.maniaPoints,display:"Total osu!mania points","tooltip-title":"mapping osu!mania game mode"},null,8,["points"])):y("",!0),m("tr",null,[se,m("td",ae,h(e.selectedUser.totalPoints),1)]),m("tr",null,[ie,m("td",oe,[g(h(e.selectedUser.availablePoints)+" ",1),re])])])])]),m("div",le,[m("p",ne,[de,e.selectedUser.rank>0?k((p(),u("i",{key:0,class:P(["fas fa-crown","text-rank-"+e.selectedUser.rank])},null,2)),[[b,`rank ${e.selectedUser.rank} user`]]):(p(),u("span",ce," None "))]),e.currentQuests.length?(p(),u("div",pe," Current quests: ")):y("",!0),m("ul",ue,[(p(!0),u(M,null,v(e.currentQuests,(e=>(p(),u("li",{key:e.id,class:"small text-white-50"},[m("a",{href:"/quests?id="+e.id,target:"_blank"},h(e.name.length>40?e.name.slice(0,40)+"...":e.name),9,me)])))),128))]),e.currentQuests.length?(p(),u("div",fe," Created quests: ")):y("",!0),m("ul",he,[(p(!0),u(M,null,v(e.createdQuestNames,(e=>(p(),u("li",{key:e,class:"small text-white-50"},h(e.length>40?e.slice(0,40)+"...":e),1)))),128))]),e.selectedUser.completedQuests.length?(p(),u("div",ge," Completed quests: ")):y("",!0),m("ul",ye,[(p(!0),u(M,null,v(e.selectedUser.completedQuests,(e=>(p(),u("li",{key:e.id,class:"small text-white-50"},[m("a",{href:"/quests?id="+e.id,target:"_blank"},h(e.name.length>40?e.name.slice(0,40)+"...":e.name),9,Pe)])))),128))])])]),Ue,m("div",ke,[m("div",be,[we,m("table",xe,[ve,m("tbody",null,[e.userBeatmaps.length?y("",!0):(p(),u("tr",Me,qe)),(p(!0),u(M,null,v(e.userBeatmaps,(t=>(p(),u("tr",{key:t.id},[m("td",$e,[k(m("i",{class:P(["fas me-1",["text-"+t.status.toLowerCase(),e.findIcon(t.status)]])},null,2),[[b,t.status]]),m("a",{href:"/beatmaps?id="+t.id,target:"_blank",class:"me-1"},h(t.song.artist)+" - "+h(t.song.title),9,Ce),"osu"!==t.mode?(p(),w(n,{key:0,modes:[t.mode]},null,8,["modes"])):y("",!0)]),m("td",Be,[f(r,{user:t.host},null,8,["user"])]),m("td",Ie,h(e.userTasks(t)),1),m("td",Se,[t.url?(p(),u("a",{key:0,href:t.url,target:"_blank"},Oe,8,Qe)):y("",!0)])])))),128))])])])]),Fe,m("div",je,[m("div",De,[Ve,m("table",_e,[Ae,m("tbody",null,[e.spentPoints.length?y("",!0):(p(),u("tr",Te,Ee)),(p(!0),u(M,null,v(e.spentPoints,(t=>(p(),u("tr",{key:t.id},[m("td",Ne,[g(h(e.findSpentPointsAction(t.category))+" ",1),m("a",{href:"/quests/?id="+t.quest.id,target:"_blank"},h(t.quest.name),9,Re)]),m("td",Ge,[g(h(e.findSpentPointsValue(t.category,t.quest))+" ",1),Le])])))),128))])])])]),Je,m("p",He," Joined: "+h(e.selectedUser.createdAt.slice(0,10)),1)])),_:1},8,["loaded","header-class"])};var We=r({name:"UserPageFilters",components:{FilterBox:O,ModeFilters:F},data:()=>({sorted:!1,sortOptions:{username:"Name",rank:"Rank",createdAt:"Joined"}}),computed:l("users",["sortBy","filterMode","filterValue"]),methods:o({},q("users",["updateSorting","updateFilterValue","updateFilterMode"]))});const ze={class:"card card-body mb-2"},Ke={class:"container"},Xe={class:"row small mt-3"},Ye=m("div",{class:"col-auto filter-title"}," Sort ",-1),Ze={class:"col"},et=["onClick"];We.render=function(e,t,s,a,i,o){const r=c("mode-filters"),l=c("filter-box");return p(),u("div",ze,[m("div",Ke,[f(l,{placeholder:"enter to search for username...","filter-value":e.filterValue,"onUpdate:filterValue":t[1]||(t[1]=t=>e.updateFilterValue(t))},{filters:x((()=>[f(r,{"filter-mode":e.filterMode,"onUpdate:filterMode":t[0]||(t[0]=t=>e.updateFilterMode(t))},null,8,["filter-mode"])])),_:1},8,["filter-value"]),m("div",Xe,[Ye,m("div",Ze,[(p(!0),u(M,null,v(e.sortOptions,((t,s)=>(p(),u("a",{key:s,class:P(e.sortBy===s?"sorted":"unsorted"),href:"#",onClick:$((t=>e.updateSorting(s)),["prevent"])},h(t),11,et)))),128))])])])])};var tt={namespaced:!0,state:{users:[],selectedUserId:null,filterValue:"",filterMode:j.any,sortBy:"createdAt",sortDesc:!1,pagination:{page:1,limit:16,maxPages:1}},mutations:{setUsers(e,t){e.users=t},setFilterValue(e,t){e.filterValue=t},setFilterMode(e,t){e.filterMode=t},setSelectedUserId(e,t){e.selectedUserId=t},updateUser(e,t){const s=e.users.findIndex((e=>e.id===t.id));-1!==s&&(e.users[s]=t)},setSortBy(e,t){e.sortBy=t},setSortDesc(e,t){e.sortDesc=t},increasePaginationPage(e){e.pagination.page+=1},decreasePaginationPage(e){e.pagination.page-=1},resetPaginationPage(e){e.pagination.page=1},updatePaginationMaxPages(e,t){e.pagination.maxPages=t}},getters:{filteredUsers:e=>{let t=[...e.users];if(e.filterMode!==j.any){const s=e.filterMode;t=t.filter((e=>!("osu"!=s||!e.osuPoints)||(!("taiko"!=s||!e.taikoPoints)||(!("catch"!=s||!e.catchPoints)||!("mania"!=s||!e.maniaPoints)))))}return e.filterValue.length>2&&(t=t.filter((t=>t.username.toLowerCase().includes(e.filterValue.toLowerCase())))),"createdAt"===e.sortBy?t.sort(((e,t)=>+e.createdAt-+t.createdAt)):"username"===e.sortBy?t.sort(((e,t)=>t.username.toLowerCase().localeCompare(e.username.toLowerCase()))):"rank"===e.sortBy&&("osu"===e.filterMode?t.sort(((e,t)=>e.osuPoints-t.osuPoints)):"taiko"===e.filterMode?t.sort(((e,t)=>e.taikoPoints-t.taikoPoints)):"catch"===e.filterMode?t.sort(((e,t)=>e.catchPoints-t.catchPoints)):"mania"===e.filterMode?t.sort(((e,t)=>e.maniaPoints-t.maniaPoints)):t.sort(((e,t)=>e.totalPoints-t.totalPoints))),e.sortDesc&&t.reverse(),t},paginatedUsers:(e,t)=>t.filteredUsers.slice(e.pagination.limit*(e.pagination.page-1),e.pagination.limit*e.pagination.page),selectedUser:e=>e.users.find((t=>t.id===e.selectedUserId)),allUsers:e=>e.users},actions:{updateFilterMode({commit:e},t){e("resetPaginationPage"),e("setFilterMode",t)},updateFilterValue({commit:e},t){e("resetPaginationPage"),e("setFilterValue",t)},updatePaginationMaxPages({commit:e,getters:t,state:s}){e("updatePaginationMaxPages",Math.ceil(t.filteredUsers.length/s.pagination.limit))},updateSorting({commit:e,state:t},s){t.sortBy!==s||!1===t.sortDesc?e("setSortDesc",!0):e("setSortDesc",!1),e("setSortBy",s)}}},st=r({name:"UserPage",components:{UserCard:D,UserInfo:X,UserPageFilters:We},computed:o(o({},l("users",["pagination"])),b("users",["paginatedUsers","allUsers"])),watch:{paginatedUsers(){this.$store.dispatch("users/updatePaginationMaxPages")}},beforeCreate(){this.$store.hasModule("users")||this.$store.registerModule("users",tt)},async created(){const e=await this.$http.initialRequest("/users/query");if(!this.$http.isError(e)){this.$store.commit("users/setUsers",e.users);const t=this.$route.query.id;if(t){this.allUsers.findIndex((e=>e.id==t))>=0&&(this.$store.commit("users/setSelectedUserId",t),this.$bs.showModal("extendedInfo"))}}},methods:{showOlder(){this.$store.commit("users/increasePaginationPage")},showNewer(){this.$store.commit("users/decreasePaginationPage")}}});const at={class:"container card card-body py-3"},it=["disabled"],ot=[m("i",{class:"fas fa-angle-up me-1"},null,-1),g(" show newer "),m("i",{class:"fas fa-angle-up ms-1"},null,-1)],rt={class:"small text-center mx-auto"},lt=["disabled"],nt=[m("i",{class:"fas fa-angle-down me-1"},null,-1),g(" show older "),m("i",{class:"fas fa-angle-down ms-1"},null,-1)];st.render=function(e,t,s,a,i,o){const r=c("user-page-filters"),l=c("user-card"),n=c("user-info");return p(),u("div",null,[f(r),m("div",at,[m("button",{disabled:1==e.pagination.page,class:"btn btn-sm btn-primary mx-auto my-2 d-block",type:"button",onClick:t[0]||(t[0]=(...t)=>e.showNewer&&e.showNewer(...t))},ot,8,it),m("div",null,[f(C,{name:"list",tag:"div",class:"row px-3"},{default:x((()=>[(p(!0),u(M,null,v(e.paginatedUsers,(e=>(p(),w(l,{key:e.id,user:e},null,8,["user"])))),128))])),_:1}),m("div",rt,h(0===e.paginatedUsers.length?"0":e.pagination.page)+" of "+h(e.pagination.maxPages),1),m("button",{disabled:e.pagination.page>=e.pagination.maxPages,class:"btn btn-sm btn-primary mx-auto my-2 d-block",type:"button",onClick:t[1]||(t[1]=(...t)=>e.showOlder&&e.showOlder(...t))},nt,8,lt)])]),f(n)])};export{st as default};
