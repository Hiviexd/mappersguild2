import{d as y,m as S,_ as k,o,e as n,a as e,j as d,t as c,i as j,y as V,k as l,F as m,r as g,b as f,p as $,q as R,n as C,A as N,c as w}from"./index-8a13ac61.js";const T={state:{contest:null,submissions:[],submission:null},mutations:{setContest(s,t){s.contest=t},setSubmissions(s,t){s.submissions=t},setSubmission(s,t){s.submission=t}}},z=T,U=y({name:"SubmissionResult",computed:{...S({submission:s=>s.contestResults.submission,loggedInUser:s=>s.loggedInUser}),voteCount(){let s=0;return this.submission.screenings.forEach(t=>{isNaN(t.vote)||(s+=t.vote)}),s},emptyScreeningCount(){return this.submission.contest.screeners.length-this.submission.screenings.length},randomizedJudging(){let s=[...this.submission.judgings];return s=s.sort(()=>Math.random()-.5),s},randomizedScreening(){let s=[...this.submission.screenings];return s=s.sort(()=>Math.random()-.5),s}},methods:{findTotalJudgingPoints(s){let t=0;return s.forEach(i=>{t+=i.score}),t},findTotalCriteriaPoints(s){let t=0;return s.forEach(i=>{t+=i.criteria.maxScore}),t},findJudgeComment(s){let t="";return s.forEach(i=>{i.criteria.name=="comments"&&(t=i.comment)}),t},filteredAndSortedJudgingScores(s){s=s.filter(i=>i.criteria.name!="comments");const t=["musical representation","creativity","limitation","gameplay"];return[...s].sort(function(i,a){return t.indexOf(i.criteria.name)-t.indexOf(a.criteria.name)})}}}),F={key:0,class:"container p-3"},E=["href"],J=e("i",{class:"fa fa-arrow-left"},null,-1),M={key:0},A={key:1,class:"mt-2"},I=["href"],P=e("hr",null,null,-1),q={class:"mx-2"},D=e("h5",null," Screening results ",-1),B={key:0},O=e("p",{class:"ms-3"}," Comments are usually each screener's initial thoughts. They're not intended to be constructive feedback and many screeners use comments as notes for determining their top picks. ",-1),X={class:"ms-3"},G={key:0,class:"fas fa-check text-done"},L={class:"ms-4 mb-2 small text-secondary",style:{"word-break":"break-word"}},Y={class:"ms-3"},H=e("div",{class:"ms-4 mb-2 small text-secondary",style:{"word-break":"break-word"}}," [no comment] ",-1),K={key:1,class:"ms-3"},Q=e("hr",null,null,-1),W={class:"mx-2"},Z=e("h5",null," Judging results ",-1),x={key:0},ss={class:"ms-3"},es={class:"row ms-3"},ts={class:"col-sm-5"},os={class:"table table-sm table-responsive-sm"},ns=e("thead",null,[e("tr",null,[e("th",{class:"text-start"}," Category "),e("th",{class:"text-start"}," Score ")])],-1),is={class:"text-start text-capitalize"},rs={class:"text-start"},cs=e("td",{class:"text-start"}," TOTAL ",-1),as={class:"text-start"},ls={class:"col-sm-7 small"},us={class:"text-secondary",style:{"white-space":"pre-line"}},ds={key:1,class:"ms-3"};function hs(s,t,i,a,u,v){const _=$("user-link"),h=R("bs-tooltip");return o(),n("div",null,[s.submission?(o(),n("div",F,[e("div",null,[e("h3",null,[e("a",{href:"/contests/results?contest="+s.submission.contest.id},[J,d(" "+c(s.submission.contest.name),1)],8,E)]),e("h4",null,[d(" Submission by "),j(_,{user:s.submission.creator},null,8,["user"])]),e("h5",null,' Anonymized as "'+c(s.submission.name)+'" ',1),s.loggedInUser&&s.loggedInUser.id==s.submission.creator.id?(o(),n("div",M,[e("a",{href:"#",onClick:t[0]||(t[0]=V(r=>s.$store.commit("setSubmission",null),["prevent"]))}," Your other contest submissions ")])):l("",!0),s.submission.contest.download?(o(),n("div",A,[e("div",null,[e("a",{href:s.submission.contest.download,target:"_blank"}," Download all submissions ",8,I)])])):l("",!0)]),P,e("div",q,[D,s.submission.screenings&&s.submission.screenings.length?(o(),n("div",B,[O,(o(!0),n(m,null,g(s.randomizedScreening,(r,p)=>(o(),n("div",{key:r.id},[e("div",null,[e("div",X,[d(" User "+c(p+1)+" ",1),r.vote?f((o(),n("i",G,null,512)),[[h,"user placed in top picks"]]):l("",!0)]),e("div",L,c(r.comment?r.comment:"[no comment]"),1)])]))),128)),(o(!0),n(m,null,g(s.emptyScreeningCount,r=>(o(),n("div",{key:r},[e("div",null,[e("div",Y," User "+c(s.submission.screenings.length+r),1),H])]))),128))])):(o(),n("div",K," This contest skipped screening. "))]),Q,e("div",W,[Z,s.submission.judgings&&s.submission.judgings.length?(o(),n("div",x,[(o(!0),n(m,null,g(s.randomizedJudging,(r,p)=>(o(),n("div",{key:r.id},[e("div",null,[e("p",ss," User "+c(p+1),1),e("div",es,[e("div",ts,[e("table",os,[ns,e("tbody",null,[(o(!0),n(m,null,g(s.filteredAndSortedJudgingScores(r.judgingScores),b=>(o(),n("tr",{key:b.id},[e("td",is,c(b.criteria.name),1),e("td",rs,c(b.score)+"/"+c(b.criteria.maxScore),1)]))),128)),e("tr",null,[cs,e("td",as,c(s.findTotalJudgingPoints(r.judgingScores))+"/"+c(s.findTotalCriteriaPoints(r.judgingScores)),1)])])])]),e("div",ls,[d(" Comment: "),e("span",us,c(s.findJudgeComment(r.judgingScores)),1)])])])]))),128))])):(o(),n("div",ds," This entry did not receive enough screening votes to reach the judging stage. :( "))])])):l("",!0)])}const ms=k(U,[["render",hs]]),gs=y({name:"ContestResults",data(){return{usersScores:[]}},computed:{...S({contest:s=>s.contestResults.contest}),maxScore(){let s=0;for(const t of this.contest.criterias)s+=t.maxScore;return s*this.contest.judges.length},sortedSubmissions(){return this.contest.useRawScoring?[...this.contest.submissions].sort((s,t)=>{const i=this.judgeScore(s.judgings);return this.judgeScore(t.judgings)-i}):[...this.contest.submissions.filter(i=>i.judgings&&i.judgings.length)].sort((i,a)=>{const u=this.getFinalScore(i.id);return this.getFinalScore(a.id)-u}).concat([...this.contest.submissions.filter(i=>!i.judgings||i.judgings&&!i.judgings.length)])}},async created(){const s=await this.$http.executeGet(`/contests/listing/${this.contest.id}/getUsersScores`);this.$http.isError(s)||(this.usersScores=s.usersScores)},methods:{voteCount(s,t){let i=0;for(const a of s)a.vote&&!isNaN(a.vote)&&(t?i+=a.vote:i++);return i},judgeScore(s){let t=0;for(const i of s)for(const a of i.judgingScores)t+=a.score;return t},getFinalScore(s){const t=this.usersScores.find(i=>i.submissionId==s);return t?isNaN(t.standardizedFinalScore)?0:parseFloat(t.standardizedFinalScore.toFixed(4)):0}}}),_s={key:0,class:"container p-3"},ps=["href"],bs={key:1},fs=["href"],$s={class:"table table-sm"},vs={scope:"col"},ys=e("th",{scope:"col"}," Creator ",-1),Ss={key:0,scope:"col"},ks={scope:"col"},Cs={key:1,scope:"col"},ws={scope:"row"},js=["href"],Rs=e("i",{class:"fa fa-arrow-right"},null,-1),Vs={scope:"row"},Ns={key:0},Ts=e("i",{class:"fas fa-check text-done me-1"},null,-1),zs=[Ts],Us={key:0},Fs={key:1},Es={key:0},Js={key:1};function Ms(s,t,i,a,u,v){const _=$("user-link"),h=R("bs-tooltip");return o(),n("div",null,[s.contest?(o(),n("div",_s,[e("h4",null,[s.contest.url||s.contest.resultsUrl?(o(),n("a",{key:0,href:s.contest.resultsUrl?s.contest.resultsUrl:s.contest.url,target:"_blank"},c(s.contest.name)+" results ",9,ps)):(o(),n("span",bs,c(s.contest.name)+" results",1))]),e("div",null,[e("a",{href:s.contest.download,target:"_blank"}," Download all submissions ",8,fs)]),e("table",$s,[e("thead",null,[e("tr",null,[f((o(),n("th",vs,[d(" Submission ")])),[[h,"anonymized name seen by screeners/judges"]]),ys,s.contest.judgingThreshold?f((o(),n("th",Ss,[d(" Screener votes ("+c(s.contest.screeners.length*s.contest.screeningVoteCount)+") ",1)])),[[h,`screeners sort entries in their ordered top ${s.contest.screeningVoteCount}. #1 adds ${s.contest.screeningVoteCount} points, #2 adds ${s.contest.screeningVoteCount-1} points, #3 adds ${s.contest.screeningVoteCount-2}, etc.`]]):l("",!0),e("th",ks," Raw scores ("+c(s.maxScore)+") ",1),s.contest.useRawScoring?l("",!0):f((o(),n("th",Cs,[d(" Standardized scores ")])),[[h,"judge X's final score = (judge X's raw score - judge X's average raw score) / judge X's standard deviation"]])])]),e("tbody",null,[(o(!0),n(m,null,g(s.sortedSubmissions,r=>(o(),n("tr",{key:r.id+"screen"},[e("td",ws,[e("a",{href:"/contests/results?submission="+r.id},[d(c(r.name)+" ",1),Rs],8,js)]),e("td",Vs,[j(_,{user:r.creator},null,8,["user"])]),s.contest.judgingThreshold?(o(),n("td",Ns,[(o(!0),n(m,null,g(s.voteCount(r.screenings),p=>(o(),n("span",{key:p},zs))),128)),s.voteCount(r.screenings,!0)>0?(o(),n("span",Us," ("+c(s.voteCount(r.screenings,!0))+") ",1)):l("",!0)])):l("",!0),e("td",null,[e("span",{class:C(s.contest.useRawScoring&&s.judgeScore(r.judgings)>0?"text-done":"")},c(s.judgeScore(r.judgings)||"N/A"),3)]),s.contest.useRawScoring?l("",!0):(o(),n("td",Fs,[e("span",{class:C(s.judgeScore(r.judgings)>0?"text-done":"")},[s.usersScores.length?(o(),n("div",Js,c(s.getFinalScore(r.id)||"N/A"),1)):(o(),n("div",Es,"calculating..."))],2)]))]))),128))])])])):l("",!0)])}const As=k(gs,[["render",Ms]]),Is=y({name:"ContestResultsPage",components:{SubmissionResult:ms,ContestResults:As},computed:{...S({contest:s=>s.contestResults.contest,submissions:s=>s.contestResults.submissions,submission:s=>s.contestResults.submission})},beforeCreate(){this.$store.hasModule("contestResults")||this.$store.registerModule("contestResults",z)},unmounted(){this.$store.hasModule("contestResults")&&this.$store.unregisterModule("contestResults")},async created(){const s=this.$route.query.contest,t=this.$route.query.submission;let i,a,u;s?(i=await this.$http.initialRequest("/contests/results/searchContest/"+s),this.$http.isError(i)||this.setContest(i)):t?([u,a]=await Promise.all([this.$http.initialRequest("/contests/results/searchSubmission/"+t),this.$http.executeGet("/contests/results/participated")]),!u||this.$http.isError(u)?this.$router.replace("/contests/results"):this.setSubmission(u)):a=await this.$http.initialRequest("/contests/results/participated"),this.$http.isError(a)||this.setSubmissions(a)},methods:{...N(["setContest","setSubmissions","setSubmission"])}}),Ps={class:"container card card-body"},qs={key:2,class:"row"},Ds={class:"card card-level-2 card-body"},Bs=["href"],Os=["href"],Xs={key:3,class:"text-center"};function Gs(s,t,i,a,u,v){const _=$("contest-results"),h=$("submission-result");return o(),n("div",Ps,[s.contest?(o(),w(_,{key:0})):s.submission?(o(),w(h,{key:1})):s.submissions.length?(o(),n("div",qs,[(o(!0),n(m,null,g(s.submissions,r=>(o(),n("div",{key:r.id,class:"col-sm-4 my-2"},[e("div",Ds,[e("p",null,[e("a",{href:`/contests/results?contest=${r.contest.id}`},c(r.contest.name),9,Bs)]),e("a",{href:`/contests/results?submission=${r.id}`,class:"small text-end"}," view submission details ",8,Os)])]))),128))])):(o(),n("div",Xs," Contests you participated in will show up here! "))])}const Ys=k(Is,[["render",Gs]]);export{Ys as default};
