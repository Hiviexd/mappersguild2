import{d as A,B as _,_ as w,o as t,e as a,a as o,b as u,v as $,F as b,r as y,t as B,k as l,f as L,g as S,j as I,y as p,q as O,M as D,m as H,i as C,w as N,n as P,c as V,T as j,p as v,s as Q,u as R}from"./index-0d4d7327.js";import{a as g}from"./task-0811ab65.js";const W=A({name:"NewTask",props:{isHost:Boolean,taskToAddCollaborator:{type:Object,default:null},beatmap:{type:Object,required:!0},isAdmin:Boolean},emits:["update:taskToAddCollaborator"],data(){return{selectedTask:g.Easy,selectedMode:_.Osu,addTaskUsername:""}},computed:{remainingTasks(){let s=Object.values(g);return this.beatmap.tasksLocked&&this.beatmap.tasksLocked.length&&!this.isHost&&(s=s.filter(e=>!this.beatmap.tasksLocked.includes(e))),this.selectedTask=s[0]||"",s}},methods:{async addTask(s){let e;this.beatmap.mode==_.Hybrid?e=this.selectedMode:e=this.beatmap.mode;const d=await this.$http.executePost("/beatmaps/addTask/"+this.beatmap.id,{user:this.addTaskUsername,taskName:this.selectedTask,username:this.addTaskUsername,mode:e},s);this.isAdmin?this.$store.commit("updateBeatmap",d):this.$store.dispatch("beatmaps/updateBeatmap",d)},async addCollab(s){let e;this.beatmap.mode==_.Hybrid?e=this.taskToAddCollaborator.mode:e=this.beatmap.mode;const d=await this.$http.executePost("/beatmaps/addCollab/"+this.beatmap.id,{user:this.addTaskUsername,task:this.taskToAddCollaborator,mode:e},s);this.$http.isError(d)||(this.isAdmin?this.$store.commit("updateBeatmap",d):(this.$store.dispatch("beatmaps/updateBeatmap",d),this.$store.dispatch("updateToastMessages",{message:"Added",type:"success"})))}}}),q={key:0,class:"row mt-2 mb-3"},F={class:"col-sm-12"},K={class:"input-group input-group-sm mx-auto"},z=["value"],G=o("option",{value:"osu"}," osu! ",-1),J=o("option",{value:"taiko"}," osu!taiko ",-1),X=o("option",{value:"catch"}," osu!catch ",-1),Y=o("option",{value:"mania"}," osu!mania ",-1),Z=[G,J,X,Y],x=o("i",{class:"fas fa-plus"},null,-1),ss=[x],es={key:0,class:"col-sm-12 mt-1 text-center"},ts=o("i",{class:"fas fa-times-circle"},null,-1),as=[ts];function os(s,e,d,r,k,U){const f=O("bs-tooltip");return s.beatmap.status=="WIP"&&s.remainingTasks.length||s.isAdmin?(t(),a("div",q,[o("div",F,[o("div",K,[s.taskToAddCollaborator?l("",!0):u((t(),a("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=n=>s.selectedTask=n),class:"form-select"},[(t(!0),a(b,null,y(s.remainingTasks,n=>(t(),a("option",{key:n,value:n},B(n),9,z))),128))],512)),[[$,s.selectedTask]]),s.beatmap.mode=="hybrid"&&!s.taskToAddCollaborator?u((t(),a("select",{key:1,"onUpdate:modelValue":e[1]||(e[1]=n=>s.selectedMode=n),class:"form-select"},Z,512)),[[$,s.selectedMode]]):l("",!0),s.isHost||s.taskToAddCollaborator?u((t(),a("input",{key:2,"onUpdate:modelValue":e[2]||(e[2]=n=>s.addTaskUsername=n),class:"form-control",type:"text",placeholder:"add user to task...",maxlength:"18",onKeyup:e[3]||(e[3]=S(n=>s.taskToAddCollaborator?s.addCollab(n):s.addTask(n),["enter"]))},null,544)),[[L,s.addTaskUsername]]):l("",!0),u((t(),a("button",{class:"btn btn-outline-info",onClick:e[4]||(e[4]=n=>s.taskToAddCollaborator?s.addCollab(n):s.addTask(n))},ss)),[[f,"add difficulty"]])])]),s.taskToAddCollaborator?(t(),a("div",es,[o("small",null,[I(" Adding collaborator for the selected difficulty "),o("a",{class:"text-danger",href:"#",onClick:e[5]||(e[5]=p(n=>s.$emit("update:taskToAddCollaborator",null),["prevent"]))},as)])])):l("",!0)])):l("",!0)}const is=w(W,[["render",os]]),ds=A({name:"TasksChoice",components:{NewTask:is,ModesIcons:D},props:{beatmap:{type:Object,required:!0},isHost:Boolean,isRanked:Boolean,isQualified:Boolean,isAdmin:Boolean},data(){return{taskToAddCollaborator:void 0}},computed:{...H(["loggedInUser"]),sortedTasks(){const s=["Easy","Normal","Hard","Insane","Expert","Storyboard"],e=["osu","taiko","catch","mania","sb"];return[...this.beatmap.tasks].sort(function(r,k){return s.indexOf(r.name)-s.indexOf(k.name)}).sort(function(r,k){return e.indexOf(r.mode)-e.indexOf(k.mode)})}},methods:{isOwner(s){return s.some(e=>e.osuId==this.loggedInUser.osuId)},canEditTask(s){return this.isOwner(s.mappers)||this.isHost},async setTaskStatus(s,e,d){d.target.classList.add("fake-button-disable");const r=await this.$http.executePost("/beatmaps/setTaskStatus/"+s,{status:e});this.$http.isError(r)||(this.isAdmin?this.$store.commit("updateBeatmap",r):this.$store.dispatch("beatmaps/updateBeatmap",r)),d.target.classList.remove("fake-button-disable")},async removeTask(s,e){e.target.classList.add("fake-button-disable");const d=await this.$http.executePost("/beatmaps/removeTask/"+s,{beatmapId:this.beatmap.id});this.isAdmin?this.$store.commit("updateBeatmap",d):this.$store.dispatch("beatmaps/updateBeatmap",d),e.target.classList.remove("fake-button-disable")},canEditTaskCollaborators(s){return s.status!="Done"&&!this.isQualified&&this.beatmap.status!="Done"&&this.canEditTask(s)},async removeCollab(s,e,d){d.target.classList.add("fake-button-disable");const r=await this.$http.executePost("/beatmaps/task/"+s+"/removeCollab",{user:e});this.isAdmin?this.$store.commit("updateBeatmap",r):this.$store.dispatch("beatmaps/updateBeatmap",r),d.target.classList.remove("fake-button-disable")},isAddingCollaborator(s){var e;return((e=this.taskToAddCollaborator)==null?void 0:e.id)==s.id}}});const c=s=>(Q("data-v-689172f6"),s=s(),R(),s),ns={class:"row"},ls={class:"col-sm-12"},rs={class:"table table-sm"},ms=c(()=>o("th",null,"Difficulty",-1)),us=c(()=>o("th",null,"Mapper(s)",-1)),cs={key:0},ps=["id"],hs=c(()=>o("i",{class:"fas fa-times"},null,-1)),ks=[hs],bs=["onClick"],fs=c(()=>o("i",{class:"fas fa-plus"},null,-1)),Ts=[fs],_s=["onClick"],Cs=c(()=>o("i",{class:"fas fa-minus"},null,-1)),vs=[Cs],ys={key:0},$s=["onClick"],gs=c(()=>o("i",{class:"fas fa-minus"},null,-1)),As=[gs],ws=["onClick"],Bs=c(()=>o("i",{class:"fas fa-check"},null,-1)),Is=[Bs],Os=["onClick"],Us=c(()=>o("i",{class:"fas fa-ellipsis-h"},null,-1)),Es=[Us],Ms={key:0,class:"col-sm-12 mt-2"};function Ls(s,e,d,r,k,U){const f=v("modes-icons"),n=v("user-link"),E=v("new-task"),h=O("bs-tooltip");return t(),a("div",ns,[o("div",ls,[o("table",rs,[o("thead",null,[o("tr",null,[ms,us,!s.isRanked&&!s.isQualified?(t(),a("th",cs)):l("",!0)])]),C(j,{tag:"tbody",name:"list"},{default:N(()=>[(t(!0),a(b,null,y(s.sortedTasks,i=>(t(),a("tr",{id:i.id+"Row",key:i.id},[o("td",{class:P(["text-secondary",`card-status-${i.status.toLowerCase()}`])},[I(B(i.name)+" ",1),s.beatmap.mode=="hybrid"?(t(),V(f,{key:0,modes:[i.mode]},null,8,["modes"])):l("",!0)],2),o("td",null,[(t(!0),a(b,null,y(i.mappers,(m,M)=>(t(),a("div",{key:m.id},[M==0&&s.canEditTaskCollaborators(i)?(t(),a(b,{key:0},[s.isAddingCollaborator(i)?u((t(),a("a",{key:0,href:"#",class:"text-danger",onClick:e[0]||(e[0]=p(T=>s.taskToAddCollaborator=void 0,["prevent"]))},ks)),[[h,"cancel"]]):u((t(),a("a",{key:1,href:"#",class:"text-success",onClick:p(T=>s.taskToAddCollaborator=i,["prevent"])},Ts,8,bs)),[[h,"add new collaborator"]])],64)):l("",!0),C(n,{class:"mx-1",user:m},null,8,["user"]),i.mappers.length>1&&s.canEditTaskCollaborators(i)&&m.osuId!=s.loggedInUser.osuId?u((t(),a("a",{key:1,href:"#",class:"text-danger",onClick:p(T=>s.removeCollab(i.id,m.id,T),["prevent"])},vs,8,_s)),[[h,"remove collaborator"]]):l("",!0)]))),128))]),!s.isRanked&&!s.isQualified?(t(),a("td",ys,[s.canEditTask(i)?(t(),a(b,{key:0},[u((t(),a("a",{href:"#",class:"text-danger me-1",onClick:p(m=>s.removeTask(i.id,m),["prevent"])},As,8,$s)),[[h,"delete"]]),i.status=="WIP"?u((t(),a("a",{key:0,href:"#",class:"text-success me-1",onClick:p(m=>s.setTaskStatus(i.id,"Done",m),["prevent"])},Is,8,ws)),[[h,"mark as done"]]):l("",!0),i.status=="Done"&&s.beatmap.status!="Done"?u((t(),a("a",{key:1,href:"#",class:"text-wip me-1",onClick:p(m=>s.setTaskStatus(i.id,"WIP",m),["prevent"])},Es,8,Os)),[[h,"mark as WIP"]]):l("",!0)],64)):l("",!0)])):l("",!0)],8,ps))),128))]),_:1})])]),!s.isRanked&&!s.isQualified?(t(),a("div",Ms,[C(E,{"task-to-add-collaborator":s.taskToAddCollaborator,"onUpdate:taskToAddCollaborator":e[1]||(e[1]=i=>s.taskToAddCollaborator=i),beatmap:s.beatmap,"is-host":s.isHost,"is-admin":s.isAdmin},null,8,["task-to-add-collaborator","beatmap","is-host","is-admin"])])):l("",!0)])}const Hs=w(ds,[["render",Ls],["__scopeId","data-v-689172f6"]]);export{Hs as T};
