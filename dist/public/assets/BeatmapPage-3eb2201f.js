import{d as I,_ as $,o as d,c as y,w as b,a as o,b as M,f as A,e as i,k as B,r as _,j as C,t as r,F as k,p as l,i as u,M as P,m as S}from"./index-1dce2399.js";import{C as v}from"./CopyPaste-6689f5ae.js";import{M as D}from"./ModalDialog-ad61f3a5.js";import{B as L}from"./BeatmapInfoAdmin-d97c1eb9.js";import{D as N}from"./DataTable-cde901aa.js";import"./task-21eeb954.js";import"./TasksChoice-3929cfae.js";const T=I({name:"NewsPost",components:{CopyPaste:v,ModalDialog:D},data(){return{date:"2022-07-24",externalBeatmaps:[],users:[]}},methods:{async loadNewsInfo(t){const e=await this.$http.executeGet("/admin/beatmaps/loadNewsInfo/"+this.date,t);e&&(this.users=e.users)},separateCommas(t,e){return t<e-1?", ":""}}}),E={key:0},G=o("div",null," | User | Modes | Ranked beatmaps | Ranked difficulties | ",-1),R=o("div",null," | :-- | :-- | :-- | :-- | ",-1);function V(t,e,s,a,f,g){const c=l("copy-paste"),n=l("modal-dialog");return d(),y(n,{id:"newsPost",title:"Generate news post"},{default:b(()=>[o("p",null,[o("button",{class:"btn btn-sm btn-outline-info",onClick:e[0]||(e[0]=p=>t.loadNewsInfo(p))}," Load user info "),M(o("input",{"onUpdate:modelValue":e[1]||(e[1]=p=>t.date=p),class:"form-control form-control-sm mx-2 w-25",type:"text",autocomplete:"off",placeholder:"YYYY-MM-DD"},null,512),[[A,t.date]])]),t.users?(d(),i("p",E," Users with ranked maps/tasks: ")):B("",!0),t.users?(d(),y(c,{key:1,distinct:"users"},{default:b(()=>[G,R,(d(!0),i(k,null,_(t.users,p=>(d(),i("div",{key:p.id},[C(" | "+r(p.flag)+" ["+r(p.username)+"]("+r("https://osu.ppy.sh/users/"+p.osuId)+") | ",1),(d(!0),i(k,null,_(p.modes,(h,w)=>(d(),i("span",{key:h},r(h=="osu"?"osu!":h=="sb"?"Storyboarder":h=="hs"?"Hitsounder":"osu!"+h)+r(t.separateCommas(w,p.modes.length)),1))),128)),C(" | "+r(p.hostCount)+" | "+r(p.taskCount)+" | ",1)]))),128))]),_:1})):B("",!0)]),_:1})}const Y=$(T,[["render",V]]),x=I({name:"BundledBeatmapsList",components:{CopyPaste:v},data(){return{bundledBeatmaps:[]}},computed:{osuBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="osu")},taikoBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="taiko")},catchBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="catch")},maniaBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="mania")}},methods:{async findBundledBeatmaps(t){const e=await this.$http.executeGet("/admin/beatmaps/findBundledBeatmaps",t);e&&!e.error&&(this.bundledBeatmaps=e)},findOsuId(t){const e=t.indexOf("beatmapsets/")+12,s=t.indexOf("#");let a="";return s!==-1?a=t.slice(e,s):a=t.slice(e),parseInt(a,10)}}}),F={class:"container card card-body py-1 mb-4"},W={key:0},j=o("p",null,"osu",-1),q=["href"],H=o("p",null,"taiko",-1),K=["href"],Q=o("p",null,"catch",-1),z=["href"],J=o("p",null,"mania",-1),X=["href"];function Z(t,e,s,a,f,g){const c=l("copy-paste");return d(),i("div",F,[o("button",{class:"btn btn-sm w-100 btn-outline-info",onClick:e[0]||(e[0]=n=>t.findBundledBeatmaps(n))}," Load bundled beatmaps "),t.bundledBeatmaps.length?(d(),i("div",W,[j,u(c,{distinct:"osu"},{default:b(()=>[(d(!0),i(k,null,_(t.osuBeatmaps,n=>(d(),i("div",{key:n.id},[o("a",{href:n.url,target:"_blank"},r(t.findOsuId(n.url)),9,q)]))),128))]),_:1}),H,u(c,{distinct:"taiko"},{default:b(()=>[(d(!0),i(k,null,_(t.taikoBeatmaps,n=>(d(),i("div",{key:n.id},[o("a",{href:n.url,target:"_blank"},r(t.findOsuId(n.url)),9,K)]))),128))]),_:1}),Q,u(c,{distinct:"catch"},{default:b(()=>[(d(!0),i(k,null,_(t.catchBeatmaps,n=>(d(),i("div",{key:n.id},[o("a",{href:n.url,target:"_blank"},r(t.findOsuId(n.url)),9,z)]))),128))]),_:1}),J,u(c,{distinct:"mania"},{default:b(()=>[(d(!0),i(k,null,_(t.maniaBeatmaps,n=>(d(),i("div",{key:n.id},[o("a",{href:n.url,target:"_blank"},r(t.findOsuId(n.url)),9,X)]))),128))]),_:1})])):B("",!0)])}const tt=$(x,[["render",Z]]),et=I({name:"BeatmapPackIdListGenerator",components:{CopyPaste:v},data(){return{inputUrls:"",output:""}},methods:{findOsuId(t){const e=t.indexOf("beatmapsets/")+12,s=t.indexOf("#");let a="";return s!==-1?a=t.slice(e,s):a=t.slice(e),parseInt(a,10)},generateBeatmapPackIdList(){let t="";const e=this.inputUrls.split(`
`);for(const s of e){const a=this.findOsuId(s);isNaN(a)?t+=`FAILED (${s})`:t+=a,t+=","}this.output=t.substring(0,t.length-1)}}}),st={class:"container card card-body py-1 mb-4"},at={key:0};function nt(t,e,s,a,f,g){const c=l("copy-paste");return d(),i("div",st,[M(o("textarea",{"onUpdate:modelValue":e[0]||(e[0]=n=>t.inputUrls=n),class:"form-control form-control-sm mx-2 mt-2 w-100",type:"text",autocomplete:"off",placeholder:"map URLs separated by newlines..."},null,512),[[A,t.inputUrls]]),o("button",{class:"btn btn-sm w-100 btn-outline-info",onClick:e[1]||(e[1]=n=>t.generateBeatmapPackIdList())}," Generate beatmap pack ID list "),t.output.length?(d(),i("div",at,[u(c,null,{default:b(()=>[C(r(t.output),1)]),_:1})])):B("",!0)])}const ot=$(et,[["render",nt]]),dt={state:{beatmaps:[]},mutations:{setBeatmaps(t,e){t.beatmaps=e},updateBeatmap(t,e){const s=t.beatmaps.findIndex(a=>a.id===e.id);s!==-1&&(t.beatmaps[s]=e),console.log(e)},updateBeatmapStatus(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);s&&(s.status=e.status)},deleteTask(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);if(s){const a=s.tasks.findIndex(f=>f.id==e.taskId);a!==-1&&s.tasks.splice(a,1)}},deleteModder(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);if(s){const a=s.modders.findIndex(f=>f.id==e.modderId);a!==-1&&s.modders.splice(a,1)}},updateUrl(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);s&&(s.url=e.url)},updateStoryboardQuality(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);if(s){const a=s.tasks.findIndex(f=>f.id==e.taskId);a!==-1&&(s.tasks[a]=e.task)}},updatePackId(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);s&&(s.packId=e.packId)},updateIsShowcase(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);s&&(s.isShowcase=e.isShowcase)},updateIsWorldCup(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);s&&(s.isWorldCup=e.isWorldCup)}}},it=dt,rt=I({components:{NewsPost:Y,DataTable:N,BeatmapInfoAdmin:L,BundledBeatmapsList:tt,BeatmapPackIdListGenerator:ot,ModesIcons:P},data(){return{selectedBeatmapId:""}},computed:{...S({beatmaps:t=>t.beatmapsAdmin.beatmaps}),selectedBeatmap(){return this.beatmaps.find(t=>t.id===this.selectedBeatmapId)}},beforeCreate(){this.$store.hasModule("beatmapsAdmin")||this.$store.registerModule("beatmapsAdmin",it)},unmounted(){this.$store.hasModule("beatmapsAdmin")&&this.$store.unregisterModule("beatmapsAdmin")},async created(){const t=await this.$http.initialRequest("/admin/beatmaps/load");this.$http.isError(t)||this.$store.commit("setBeatmaps",t)},methods:{updateBeatmap(t){const e=this.beatmaps.findIndex(s=>s.id==t.id);e!==-1&&(this.beatmaps[e]=t)},formatMetadata(t){if(!t)return"";let e=t.artist+" - ";return t.title.length>40?e+=t.title.slice(0,40)+"...":e+=t.title,e}}}),pt={class:"container card card-body py-1"},mt={class:"row"},lt={class:"col-sm"},ut=o("button",{class:"btn btn-sm btn-info w-100","data-bs-toggle":"modal","data-bs-target":"#newsPost"}," Create news post ",-1),ct={class:"text-truncate"},ft=["href"],bt={key:1,class:"ms-1"};function ht(t,e,s,a,f,g){const c=l("modes-icons"),n=l("user-link"),p=l("data-table"),h=l("beatmap-info-admin"),w=l("news-post"),U=l("bundled-beatmaps-list"),O=l("beatmap-pack-id-list-generator");return d(),i("div",null,[o("div",pt,[o("div",mt,[o("div",lt,[ut,u(p,{data:t.beatmaps,headers:["METADATA","PACK ID","CREATOR","STATUS"],"custom-data-target":"#editBeatmap","onUpdate:selectedId":e[0]||(e[0]=m=>t.selectedBeatmapId=m)},{default:b(({obj:m})=>[o("td",ct,[u(c,{modes:[m.mode]},null,8,["modes"]),m.url?(d(),i("a",{key:0,href:m.url,class:"ms-1"},r(t.formatMetadata(m.song)),9,ft)):(d(),i("span",bt,r(t.formatMetadata(m.song)),1))]),o("td",null,r(m.packId),1),o("td",null,[u(n,{user:m.host},null,8,["user"])]),o("td",null,r(m.status),1)]),_:1},8,["data"])])])]),t.selectedBeatmap?(d(),y(h,{key:0,beatmap:t.selectedBeatmap,onUpdateBeatmap:e[1]||(e[1]=m=>t.updateBeatmap(m))},null,8,["beatmap"])):B("",!0),u(w),u(U),u(O)])}const yt=$(rt,[["render",ht]]);export{yt as default};
