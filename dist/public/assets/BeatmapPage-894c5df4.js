import{d as v,_ as C,o,e as l,a as n,b as O,f as F,i as c,w as f,F as B,r as _,j as h,t as d,k as $,p as k,y as g,n as I,M as S,m as U,c as M}from"./index-8a13ac61.js";import{C as w}from"./CopyPaste-8875cfec.js";import{B as D}from"./BeatmapInfoAdmin-1000f820.js";import{D as E}from"./DataTable-6a5f6706.js";import"./ModalDialog-8b1d3cdc.js";import"./task-21eeb954.js";import"./TasksChoice-7dfb9dd8.js";const G=v({name:"ContributorStats",components:{CopyPaste:w},data(){return{date:"2022-07-24",externalBeatmaps:[],users:[]}},methods:{async loadNewsInfo(t){const s=await this.$http.executeGet("/admin/beatmaps/loadNewsInfo/"+this.date,t);s&&(this.users=s.users)},separateCommas(t,s){return t<s-1?", ":""}}}),T={class:"container card card-body py-2 mt-2"},V=n("h5",null,"Mappers' Guild contributor stats",-1),P={class:"form-inline"},R={class:"form-group"},Y={key:0},W=n("p",null," Users with ranked maps/tasks: ",-1),j=n("div",null," | User | Modes | Ranked beatmaps | Ranked difficulties | ",-1),H=n("div",null," | :-- | :-- | :-- | :-- | ",-1);function z(t,s,a,i,p,b){const m=k("copy-paste");return o(),l("div",T,[V,n("div",P,[n("div",R,[n("button",{class:"btn btn-sm btn-info",onClick:s[0]||(s[0]=e=>t.loadNewsInfo(e))}," Generate Mappers' Guild contributors stats "),O(n("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>t.date=e),class:"form-control form-control-sm d-inline mx-2 w-25",type:"text",autocomplete:"off",placeholder:"YYYY-MM-DD"},null,512),[[F,t.date]])])]),t.users&&t.users.length?(o(),l("div",Y,[W,c(m,{distinct:"users"},{default:f(()=>[j,H,(o(!0),l(B,null,_(t.users,e=>(o(),l("div",{key:e.id},[h(" | "+d(e.flag)+" ["+d(e.username)+"]("+d("https://osu.ppy.sh/users/"+e.osuId)+") | ",1),(o(!0),l(B,null,_(e.modes,(r,y)=>(o(),l("span",{key:r},d(r=="osu"?"osu!":r=="sb"?"Storyboarder":r=="hs"?"Hitsounder":"osu!"+r)+d(t.separateCommas(y,e.modes.length)),1))),128)),h(" | "+d(e.hostCount)+" | "+d(e.taskCount)+" | ",1)]))),128))]),_:1})])):$("",!0)])}const K=C(G,[["render",z]]),Q=v({name:"BundledBeatmapsList",components:{CopyPaste:w},data(){return{bundledBeatmaps:[]}},computed:{osuBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="osu")},taikoBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="taiko")},catchBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="catch")},maniaBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="mania")},osuFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="osu"&&t.isBundled)},taikoFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="taiko"&&t.isBundled)},catchFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="catch"&&t.isBundled)},maniaFinalBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="mania"&&t.isBundled)}},methods:{async findBundledBeatmaps(t){const s=await this.$http.executeGet("/admin/beatmaps/findBundledBeatmaps",t);s&&!s.error&&(this.bundledBeatmaps=s)},async toggleIsBundled(t,s){const a=await this.$http.executePost("/admin/beatmaps/"+t+"/toggleIsBundled",{isBundled:s});if(!this.$http.isError(a)){const i=[...this.bundledBeatmaps],p=i.findIndex(b=>b.id==t);i[p]=a,this.bundledBeatmaps=i}},findOsuId(t){const s=t.indexOf("beatmapsets/")+12,a=t.indexOf("#");let i="";return a!==-1?i=t.slice(s,a):i=t.slice(s),parseInt(i,10)}}}),q={class:"container card card-body py-2 mt-2"},J=n("h5",null,"Bundled beatmap list generator",-1),X={key:0,class:"row mt-3 small"},Z={class:"col-sm-6"},x=["onClick"],tt=["href"],et={class:"col-sm-6"},st=["onClick"],nt=["href"],at={class:"col-sm-6"},it=["onClick"],dt=["href"],ot={class:"col-sm-6"},lt=["onClick"],rt=["href"],ut=n("p",null,"final lists",-1),ct={class:"row"},mt={class:"col-sm-3"},pt=["href"],ft=["onClick"],ht={class:"col-sm-3"},Bt=["href"],_t=["onClick"],kt={class:"col-sm-3"},gt=["href"],It=["onClick"],bt={class:"col-sm-3"},$t=["href"],vt=["onClick"];function Ct(t,s,a,i,p,b){const m=k("copy-paste");return o(),l("div",q,[J,n("button",{class:"btn btn-sm w-100 btn-info",onClick:s[0]||(s[0]=e=>t.findBundledBeatmaps(e))}," Load beatmaps with ENHI+ spreads "),t.bundledBeatmaps.length?(o(),l("div",X,[n("div",Z,[h(" osu ("+d(t.osuBeatmaps.length)+") ",1),c(m,{distinct:"osu"},{default:f(()=>[(o(!0),l(B,null,_(t.osuBeatmaps,e=>(o(),l("div",{key:e.id},[n("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[n("i",{class:I(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,x),n("a",{href:e.url,target:"_blank"},d(e.song.artist+" - "+e.song.title)+" ("+d(t.findOsuId(e.url))+")",9,tt)]))),128))]),_:1})]),n("div",et,[h(" taiko ("+d(t.taikoBeatmaps.length)+") ",1),c(m,{distinct:"taiko"},{default:f(()=>[(o(!0),l(B,null,_(t.taikoBeatmaps,e=>(o(),l("div",{key:e.id},[n("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[n("i",{class:I(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,st),n("a",{href:e.url,target:"_blank"},d(e.song.artist+" - "+e.song.title)+" ("+d(t.findOsuId(e.url))+")",9,nt)]))),128))]),_:1})]),n("div",at,[h(" catch ("+d(t.catchBeatmaps.length)+") ",1),c(m,{distinct:"catch"},{default:f(()=>[(o(!0),l(B,null,_(t.catchBeatmaps,e=>(o(),l("div",{key:e.id},[n("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[n("i",{class:I(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,it),n("a",{href:e.url,target:"_blank"},d(e.song.artist+" - "+e.song.title)+" ("+d(t.findOsuId(e.url))+")",9,dt)]))),128))]),_:1})]),n("div",ot,[h(" mania ("+d(t.maniaBeatmaps.length)+") ",1),c(m,{distinct:"mania"},{default:f(()=>[(o(!0),l(B,null,_(t.maniaBeatmaps,e=>(o(),l("div",{key:e.id},[n("a",{href:"#",class:"me-1",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[n("i",{class:I(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,lt),n("a",{href:e.url,target:"_blank"},d(e.song.artist+" - "+e.song.title)+" ("+d(t.findOsuId(e.url))+")",9,rt)]))),128))]),_:1})]),ut,n("div",ct,[n("div",mt,[h(" osu ("+d(t.osuFinalBeatmaps.length)+") ",1),c(m,{distinct:"osufinal"},{default:f(()=>[(o(!0),l(B,null,_(t.osuFinalBeatmaps,e=>(o(),l("div",{key:e.id},[n("a",{href:e.url,target:"_blank",class:"me-1"},d(t.findOsuId(e.url)),9,pt),n("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[n("i",{class:I(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,ft)]))),128))]),_:1})]),n("div",ht,[h(" taiko ("+d(t.taikoFinalBeatmaps.length)+") ",1),c(m,{distinct:"taiko"},{default:f(()=>[(o(!0),l(B,null,_(t.taikoFinalBeatmaps,e=>(o(),l("div",{key:e.id},[n("a",{href:e.url,target:"_blank",class:"me-1"},d(t.findOsuId(e.url)),9,Bt),n("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[n("i",{class:I(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,_t)]))),128))]),_:1})]),n("div",kt,[h(" catch ("+d(t.catchFinalBeatmaps.length)+") ",1),c(m,{distinct:"catch"},{default:f(()=>[(o(!0),l(B,null,_(t.catchFinalBeatmaps,e=>(o(),l("div",{key:e.id},[n("a",{href:e.url,target:"_blank",class:"me-1"},d(t.findOsuId(e.url)),9,gt),n("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[n("i",{class:I(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,It)]))),128))]),_:1})]),n("div",bt,[h(" mania ("+d(t.maniaFinalBeatmaps.length)+") ",1),c(m,{distinct:"mania"},{default:f(()=>[(o(!0),l(B,null,_(t.maniaFinalBeatmaps,e=>(o(),l("div",{key:e.id},[n("a",{href:e.url,target:"_blank",class:"me-1"},d(t.findOsuId(e.url)),9,$t),n("a",{href:"#",onClick:g(r=>t.toggleIsBundled(e.id,e.isBundled),["stop","prevent"])},[n("i",{class:I(["fas",e.isBundled?"text-done fa-check":"text-danger fa-times"])},null,2)],8,vt)]))),128))]),_:1})])])])):$("",!0)])}const yt=C(Q,[["render",Ct]]),wt=v({name:"BeatmapIdListGenerator",components:{CopyPaste:w},data(){return{inputUrls:"",output:""}},methods:{findOsuId(t){const s=t.indexOf("beatmapsets/")+12,a=t.indexOf("#");let i="";return a!==-1?i=t.slice(s,a):i=t.slice(s),parseInt(i,10)},generateBeatmapCommaIdList(){let t="";const s=this.inputUrls.split(`
`);for(const a of s){const i=this.findOsuId(a);isNaN(i)?t+=`FAILED (${a})`:t+=i,t+=","}this.output=t.substring(0,t.length-1)},generateBeatmapNewLineIdList(){let t="";const s=this.inputUrls.split(`
`);for(const a of s){const i=this.findOsuId(a);isNaN(i)?t+=`FAILED (${a})`:t+=i,t+=`
`}this.output=t.substring(0,t.length-1)}}}),Mt={class:"container card card-body py-2 mt-2"},Ot=n("h5",null,"Beatmap pack ID list generator",-1),Ft={class:"form-inline"},Lt={class:"form-group"},At={key:0};function Nt(t,s,a,i,p,b){const m=k("copy-paste");return o(),l("div",Mt,[Ot,O(n("textarea",{"onUpdate:modelValue":s[0]||(s[0]=e=>t.inputUrls=e),class:"form-control form-control-sm mx-2 mb-2 w-100",type:"text",autocomplete:"off",placeholder:"map URLs separated by newlines..."},null,512),[[F,t.inputUrls]]),n("div",Ft,[n("div",Lt,[n("button",{class:"btn btn-sm btn-info me-2",onClick:s[1]||(s[1]=e=>t.generateBeatmapCommaIdList())}," Generate (comma separated) "),n("button",{class:"btn btn-sm btn-info",onClick:s[2]||(s[2]=e=>t.generateBeatmapNewLineIdList())}," Generate (newlines) ")])]),t.output.length?(o(),l("div",At,[c(m,null,{default:f(()=>[h(d(t.output),1)]),_:1})])):$("",!0)])}const St=C(wt,[["render",Nt]]),Ut={state:{beatmaps:[]},mutations:{setBeatmaps(t,s){t.beatmaps=s},updateBeatmap(t,s){const a=t.beatmaps.findIndex(i=>i.id===s.id);a!==-1&&(t.beatmaps[a]=s),console.log(s)},updateBeatmapStatus(t,s){const a=t.beatmaps.find(i=>i.id==s.beatmapId);a&&(a.status=s.status)},deleteTask(t,s){const a=t.beatmaps.find(i=>i.id==s.beatmapId);if(a){const i=a.tasks.findIndex(p=>p.id==s.taskId);i!==-1&&a.tasks.splice(i,1)}},deleteModder(t,s){const a=t.beatmaps.find(i=>i.id==s.beatmapId);if(a){const i=a.modders.findIndex(p=>p.id==s.modderId);i!==-1&&a.modders.splice(i,1)}},updateUrl(t,s){const a=t.beatmaps.find(i=>i.id==s.beatmapId);a&&(a.url=s.url)},updateStoryboardQuality(t,s){const a=t.beatmaps.find(i=>i.id==s.beatmapId);if(a){const i=a.tasks.findIndex(p=>p.id==s.taskId);i!==-1&&(a.tasks[i]=s.task)}},updatePackId(t,s){const a=t.beatmaps.find(i=>i.id==s.beatmapId);a&&(a.packId=s.packId)},updateIsShowcase(t,s){const a=t.beatmaps.find(i=>i.id==s.beatmapId);a&&(a.isShowcase=s.isShowcase)},updateIsWorldCup(t,s){const a=t.beatmaps.find(i=>i.id==s.beatmapId);a&&(a.isWorldCup=s.isWorldCup)}}},Dt=Ut,Et=v({components:{ContributorStats:K,DataTable:E,BeatmapInfoAdmin:D,BundledBeatmapsList:yt,BeatmapIdListGenerator:St,ModesIcons:S},data(){return{selectedBeatmapId:""}},computed:{...U({beatmaps:t=>t.beatmapsAdmin.beatmaps}),selectedBeatmap(){return this.beatmaps.find(t=>t.id===this.selectedBeatmapId)}},beforeCreate(){this.$store.hasModule("beatmapsAdmin")||this.$store.registerModule("beatmapsAdmin",Dt)},unmounted(){this.$store.hasModule("beatmapsAdmin")&&this.$store.unregisterModule("beatmapsAdmin")},methods:{async loadBeatmaps(t){const s=await this.$http.executeGet("/admin/beatmaps/load",t);this.$http.isError(s)||this.$store.commit("setBeatmaps",s)},updateBeatmap(t){const s=this.beatmaps.findIndex(a=>a.id==t.id);s!==-1&&(this.beatmaps[s]=t)},formatMetadata(t){if(!t)return"";let s=t.artist+" - ";return t.title.length>40?s+=t.title.slice(0,40)+"...":s+=t.title,s}}}),Gt={class:"container card card-body py-2"},Tt=n("h5",null,"Beatmaps list",-1),Vt={class:"text-truncate"},Pt=["href"],Rt={key:1,class:"ms-1"};function Yt(t,s,a,i,p,b){const m=k("modes-icons"),e=k("user-link"),r=k("data-table"),y=k("beatmap-info-admin"),L=k("contributor-stats"),A=k("bundled-beatmaps-list"),N=k("beatmap-id-list-generator");return o(),l("div",null,[n("div",Gt,[Tt,n("button",{class:"btn btn-sm btn-info w-100",onClick:s[0]||(s[0]=u=>t.loadBeatmaps(u))}," Load all beatmaps "),c(r,{data:t.beatmaps,headers:["METADATA","PACK ID","CREATOR","STATUS"],"custom-data-target":"#editBeatmap","onUpdate:selectedId":s[1]||(s[1]=u=>t.selectedBeatmapId=u)},{default:f(({obj:u})=>[n("td",Vt,[c(m,{modes:[u.mode]},null,8,["modes"]),u.url?(o(),l("a",{key:0,href:u.url,class:"ms-1"},d(t.formatMetadata(u.song)),9,Pt)):(o(),l("span",Rt,d(t.formatMetadata(u.song)),1))]),n("td",null,d(u.packId),1),n("td",null,[u.host?(o(),M(e,{key:0,user:u.host},null,8,["user"])):$("",!0)]),n("td",null,d(u.status),1)]),_:1},8,["data"])]),t.selectedBeatmap?(o(),M(y,{key:0,beatmap:t.selectedBeatmap,onUpdateBeatmap:s[2]||(s[2]=u=>t.updateBeatmap(u))},null,8,["beatmap"])):$("",!0),c(L),c(A),c(N)])}const Jt=C(Et,[["render",Yt]]);export{Jt as default};
