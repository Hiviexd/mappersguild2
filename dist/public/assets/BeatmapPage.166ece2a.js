var t=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s;import{d as i,h as l,o as r,s as m,w as p,f as u,l as c,H as b,b as f,e as h,g as I,k,t as B,F as y,j as w,m as g}from"./vendor.b9ef672a.js";import{_ as v}from"./CopyPaste.4b23b3fb.js";import{_ as O}from"./ModalDialog.4a9168b4.js";import{_ as x}from"./BeatmapInfoAdmin.4b2ba478.js";import{_ as P}from"./DataTable.01cd035d.js";import{_ as C}from"./index.85c79094.js";var M=i({name:"NewsPost",components:{CopyPaste:v,ModalDialog:O},data:()=>({date:"2022-07-24",externalBeatmaps:[],users:[]}),methods:{async loadNewsInfo(t){const e=await this.$http.executeGet("/admin/beatmaps/loadNewsInfo/"+this.date,t);e&&(this.users=e.users)},separateCommas:(t,e)=>t<e-1?", ":""}});const j={key:0},A=u("div",null," | User | Modes | Beatmaps Ranked | Difficulties Ranked | ",-1),U=u("div",null," | :-- | :-- | :-- | :-- | ",-1);M.render=function(t,e,a,s,d,n){const o=l("copy-paste"),i=l("modal-dialog");return r(),m(i,{id:"newsPost",title:"Generate news post"},{default:p((()=>[u("p",null,[u("button",{class:"btn btn-sm btn-outline-info",onClick:e[0]||(e[0]=e=>t.loadNewsInfo(e))}," Load beatmap and quest data "),c(u("input",{"onUpdate:modelValue":e[1]||(e[1]=e=>t.date=e),class:"form-control form-control-sm mx-2 w-25",type:"text",autocomplete:"off",placeholder:"YYYY-MM-DD"},null,512),[[b,t.date]])]),t.users?(r(),f("p",j," Users with ranked maps/tasks: ")):h("",!0),t.users?(r(),m(o,{key:1,distinct:"users"},{default:p((()=>[A,U,(r(!0),f(y,null,I(t.users,(e=>(r(),f("div",{key:e.id},[k(" | ["+B(e.username)+"]("+B("https://osu.ppy.sh/users/"+e.osuId)+") | ",1),(r(!0),f(y,null,I(e.modes,((a,s)=>(r(),f("span",{key:a},B("osu"==a?"osu!":"sb"==a?"Storyboarder":"osu!"+a)+B(t.separateCommas(s,e.modes.length)),1)))),128)),k(" | "+B(e.hostCount)+" | "+B(e.taskCount)+" | ",1)])))),128))])),_:1})):h("",!0)])),_:1})};var _=i({name:"BundledBeatmapsList",components:{CopyPaste:v},data:()=>({bundledBeatmaps:[]}),computed:{osuBeatmaps(){return this.bundledBeatmaps.filter((t=>"osu"==t.mode))},taikoBeatmaps(){return this.bundledBeatmaps.filter((t=>"taiko"==t.mode))},catchBeatmaps(){return this.bundledBeatmaps.filter((t=>"catch"==t.mode))},maniaBeatmaps(){return this.bundledBeatmaps.filter((t=>"mania"==t.mode))}},methods:{async findBundledBeatmaps(t){const e=await this.$http.executeGet("/admin/beatmaps/findBundledBeatmaps",t);e&&!e.error&&(this.bundledBeatmaps=e)},findOsuId(t){const e=t.indexOf("beatmapsets/")+"beatmapsets/".length,a=t.indexOf("#");let s="";return s=-1!==a?t.slice(e,a):t.slice(e),parseInt(s,10)}}});const D={class:"container card card-body py-1 mb-4"},L={key:0},$=u("p",null,"osu",-1),S=u("p",null,"taiko",-1),T=u("p",null,"catch",-1),N=u("p",null,"mania",-1);_.render=function(t,e,a,s,d,n){const o=l("copy-paste");return r(),f("div",D,[u("button",{class:"btn btn-sm w-100 btn-outline-info",onClick:e[0]||(e[0]=e=>t.findBundledBeatmaps(e))}," Load bundled beatmaps "),t.bundledBeatmaps.length?(r(),f("div",L,[$,w(o,{distinct:"osu"},{default:p((()=>[(r(!0),f(y,null,I(t.osuBeatmaps,(e=>(r(),f("div",{key:e.id},B(t.findOsuId(e.url)),1)))),128))])),_:1}),S,w(o,{distinct:"taiko"},{default:p((()=>[(r(!0),f(y,null,I(t.taikoBeatmaps,(e=>(r(),f("div",{key:e.id},B(t.findOsuId(e.url)),1)))),128))])),_:1}),T,w(o,{distinct:"catch"},{default:p((()=>[(r(!0),f(y,null,I(t.catchBeatmaps,(e=>(r(),f("div",{key:e.id},B(t.findOsuId(e.url)),1)))),128))])),_:1}),N,w(o,{distinct:"mania"},{default:p((()=>[(r(!0),f(y,null,I(t.maniaBeatmaps,(e=>(r(),f("div",{key:e.id},B(t.findOsuId(e.url)),1)))),128))])),_:1})])):h("",!0)])};var G=i({name:"BeatmapPackIdListGenerator",components:{CopyPaste:v},data:()=>({inputUrls:"",output:""}),methods:{findOsuId(t){const e=t.indexOf("beatmapsets/")+"beatmapsets/".length,a=t.indexOf("#");let s="";return s=-1!==a?t.slice(e,a):t.slice(e),parseInt(s,10)},generateBeatmapPackIdList(){let t="";const e=this.inputUrls.split("\n");for(const a of e){const e=this.findOsuId(a);isNaN(e)?t+=`FAILED (${a})`:t+=e,t+=","}this.output=t.substring(0,t.length-1)}}});const R={class:"container card card-body py-1 mb-4"},E={key:0};G.render=function(t,e,a,s,d,n){const o=l("copy-paste");return r(),f("div",R,[c(u("textarea",{"onUpdate:modelValue":e[0]||(e[0]=e=>t.inputUrls=e),class:"form-control form-control-sm mx-2 mt-2 w-100",type:"text",autocomplete:"off",placeholder:"map URLs separated by newlines..."},null,512),[[b,t.inputUrls]]),u("button",{class:"btn btn-sm w-100 btn-outline-info",onClick:e[1]||(e[1]=e=>t.generateBeatmapPackIdList())}," Generate beatmap pack ID list "),t.output.length?(r(),f("div",E,[w(o,null,{default:p((()=>[k(B(t.output),1)])),_:1})])):h("",!0)])};var Y,q,F={state:{beatmaps:[]},mutations:{setBeatmaps(t,e){t.beatmaps=e},updateBeatmapStatus(t,e){const a=t.beatmaps.find((t=>t.id==e.beatmapId));a&&(a.status=e.status)},deleteTask(t,e){const a=t.beatmaps.find((t=>t.id==e.beatmapId));if(a){const t=a.tasks.findIndex((t=>t.id==e.taskId));-1!==t&&a.tasks.splice(t,1)}},deleteModder(t,e){const a=t.beatmaps.find((t=>t.id==e.beatmapId));if(a){const t=a.modders.findIndex((t=>t.id==e.modderId));-1!==t&&a.modders.splice(t,1)}},updateUrl(t,e){const a=t.beatmaps.find((t=>t.id==e.beatmapId));a&&(a.url=e.url)},updateStoryboardQuality(t,e){const a=t.beatmaps.find((t=>t.id==e.beatmapId));if(a){const t=a.tasks.findIndex((t=>t.id==e.taskId));-1!==t&&(a.tasks[t]=e.task)}},updatePackId(t,e){const a=t.beatmaps.find((t=>t.id==e.beatmapId));a&&(a.packId=e.packId)},updateIsShowcase(t,e){const a=t.beatmaps.find((t=>t.id==e.beatmapId));a&&(a.isShowcase=e.isShowcase)}}},V=i({components:{NewsPost:M,DataTable:P,BeatmapInfoAdmin:x,BundledBeatmapsList:_,BeatmapPackIdListGenerator:G,ModesIcons:C},data:()=>({selectedBeatmapId:""}),computed:(Y=((t,e)=>{for(var a in e||(e={}))d.call(e,a)&&o(t,a,e[a]);if(s)for(var a of s(e))n.call(e,a)&&o(t,a,e[a]);return t})({},g({beatmaps:t=>t.beatmapsAdmin.beatmaps})),q={selectedBeatmap(){return this.beatmaps.find((t=>t.id===this.selectedBeatmapId))}},e(Y,a(q))),beforeCreate(){this.$store.hasModule("beatmapsAdmin")||this.$store.registerModule("beatmapsAdmin",F)},unmounted(){this.$store.hasModule("beatmapsAdmin")&&this.$store.unregisterModule("beatmapsAdmin")},async created(){const t=await this.$http.initialRequest("/admin/beatmaps/load");this.$http.isError(t)||this.$store.commit("setBeatmaps",t)},methods:{updateBeatmap(t){const e=this.beatmaps.findIndex((e=>e.id==t.id));-1!==e&&(this.beatmaps[e]=t)},formatMetadata(t){if(!t)return"";let e=t.artist+" - ";return t.title.length>40?e+=t.title.slice(0,40)+"...":e+=t.title,e}}});const H={class:"container card card-body py-1"},K={class:"row"},Q={class:"col-sm"},z=u("button",{class:"btn btn-sm btn-info w-100","data-bs-toggle":"modal","data-bs-target":"#newsPost"}," Create news post ",-1),J={class:"text-truncate"},W=["href"],X={key:1,class:"ms-1"};V.render=function(t,e,a,s,d,n){const o=l("modes-icons"),i=l("user-link"),c=l("data-table"),b=l("beatmap-info-admin"),I=l("news-post"),k=l("bundled-beatmaps-list"),y=l("beatmap-pack-id-list-generator");return r(),f("div",null,[u("div",H,[u("div",K,[u("div",Q,[z,w(c,{data:t.beatmaps,headers:["METADATA","PACK ID","CREATOR","STATUS"],"custom-data-target":"#editBeatmap","onUpdate:selectedId":e[0]||(e[0]=e=>t.selectedBeatmapId=e)},{default:p((({obj:e})=>[u("td",J,[w(o,{modes:[e.mode]},null,8,["modes"]),e.url?(r(),f("a",{key:0,href:e.url,class:"ms-1"},B(t.formatMetadata(e.song)),9,W)):(r(),f("span",X,B(t.formatMetadata(e.song)),1))]),u("td",null,B(e.packId),1),u("td",null,[w(i,{user:e.host},null,8,["user"])]),u("td",null,B(e.status),1)])),_:1},8,["data"])])])]),t.selectedBeatmap?(r(),m(b,{key:0,beatmap:t.selectedBeatmap,onUpdateBeatmap:e[1]||(e[1]=e=>t.updateBeatmap(e))},null,8,["beatmap"])):h("",!0),w(I),w(k),w(y)])};export{V as default};
