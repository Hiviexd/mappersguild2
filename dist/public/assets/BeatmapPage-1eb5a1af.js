import{d as v,M as Q,m as A,_ as w,o as a,c as I,w as P,a as t,b as f,v as S,e as i,r as B,t as b,F as y,f as V,g as F,h as ne,i as _,j as $,k as u,n as M,T as j,l as le,p as h,q as L,s as R,u as W,x as de,y as C,B as E,z as G,A as Z,C as x,D as X,E as re}from"./index-5428ae15.js";import{M as ee}from"./ModalDialog-cfbb1fc7.js";import{U as K}from"./UserLinkList-d0f14763.js";import{F as ue}from"./FilterBox-75306965.js";import{M as pe,F as J}from"./extras-0262e0c7.js";import{T as q,a as N}from"./task-0811ab65.js";const ce=v({name:"CreateBeatmapModal",components:{ModalDialog:ee,UserLinkList:K,ModesIcons:Q},data(){return{featuredArtists:[],featuredSongs:[],selectedArtist:"",artistInput:"",selectedSong:"",selectedMode:"osu",selectedTaskStatus:"",previousSelectedMode:"",selectedTaskMode:"osu",checkedLocks:[],modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}],tasks:["Easy","Normal","Hard","Insane","Expert","Storyboard"],newTaskName:"",newTaskMapper:"",tempTasks:[]}},computed:{...A(["loggedInUser"]),sortedTasks(){const e=["Easy","Normal","Hard","Insane","Expert","Storyboard"],s=["osu","taiko","catch","mania","sb"];return[...this.tempTasks].sort(function(d,p){return e.indexOf(d.name)-e.indexOf(p.name)}).sort(function(d,p){return s.indexOf(d.mode)-s.indexOf(p.mode)})}},watch:{selectedMode(){this.selectedMode=="hybrid"&&(this.tempTasks=[]),this.previousSelectedMode=="hybrid"&&(this.tempTasks=[]),this.previousSelectedMode=this.selectedMode}},async created(){const e=await this.$http.executeGet("/featuredArtists");e&&(this.featuredArtists=e.sort((s,o)=>s.label.toLowerCase()>o.label.toLowerCase()?1:o.label.toLowerCase()>s.label.toLowerCase()?-1:0))},methods:{async setArtist(e){if(!this.selectedArtist&&!this.artistInput){this.$store.dispatch("updateToastMessages",{message:"Select or type an artist!",type:"danger"});return}if(this.artistInput){const o=this.featuredArtists.find(d=>d.label.toLowerCase().includes(this.artistInput.toLowerCase()));o&&(this.selectedArtist=o.id)}if(!this.selectedArtist){this.$store.dispatch("updateToastMessages",{message:"Couldn't find artist! Check your typing or select one from the list.",type:"danger"});return}e.target.disabled=!0;const s=await this.$http.executeGet(`/featuredArtists/${this.selectedArtist}/songs`);s&&(this.featuredSongs=s.sort((o,d)=>o.title.toLowerCase()>d.title.toLowerCase()?1:d.title.toLowerCase()>o.title.toLowerCase()?-1:0)),e.target.disabled=!1},async addTempTask(e){if(!this.newTaskName.length||!this.selectedTaskStatus.length){this.$store.dispatch("updateToastMessages",{message:"Missing task or status",type:"danger"});return}const s=await this.$http.executeGet(`/beatmaps/validateUsers/${this.newTaskMapper.length?this.newTaskMapper:this.loggedInUser.username}`,e);s&&s.length&&this.tempTasks.push({name:this.newTaskName,mappers:s,mode:this.selectedTaskMode,status:this.selectedTaskStatus,random:Math.random().toString()})},removeTempTask(e){const s=this.tempTasks.findIndex(o=>o.random==e);this.tempTasks.splice(s,1)},async saveNewMap(e){if(!this.selectedSong){this.$store.dispatch("updateToastMessages",{message:"Select a song!",type:"info"});return}const s=await this.$http.executePost("/beatmaps/create/",{song:this.selectedSong,tasks:this.tempTasks,tasksLocked:this.checkedLocks,mode:this.selectedMode},e);this.$http.isError(s)||(this.$bs.hideModal("addBeatmap"),this.$store.commit("beatmaps/addBeatmap",s))}}});const g=e=>(R("data-v-143a232c"),e=e(),W(),e),me={class:"container"},he={class:"mb-3 row"},be=g(()=>t("div",{class:"col-lg-1"},[t("p",{style:{"margin-top":"3px"}}," Artist: ")],-1)),fe={class:"col-lg-11"},_e={id:"artistForm",class:"input-group input-group-sm mb-3"},ke=g(()=>t("option",{value:""}," Select an artist ",-1)),$e=g(()=>t("option",{value:"-",disabled:""}," --- ",-1)),ge=["value"],ye=g(()=>t("div",{class:"col-lg-1"},[t("p",{style:{"margin-top":"3px"}}," Song: ")],-1)),ve={class:"col-lg-11"},Be=["disabled"],we=g(()=>t("option",{value:"",disabled:""}," Select an artist to view songs ",-1)),Te=g(()=>t("option",{value:"-",disabled:""}," --- ",-1)),Me=["value"],Ce=g(()=>t("hr",null,null,-1)),Ie=g(()=>t("p",null," Game-mode: ",-1)),Le={class:"mb-3 row"},Se={class:"col-sm-10"},Pe=["id","value"],Ae=["for"],Oe=g(()=>t("br",null,null,-1)),qe=g(()=>t("hr",null,null,-1)),Ue=g(()=>t("div",{class:"mb-2"},[$(" Set your mapset's difficulties "),t("div",{class:"small text-secondary"}," These can be changed later. ")],-1)),Ee={key:0,class:"table table-sm"},Qe=g(()=>t("thead",null,[t("tr",null,[t("th",null,"Difficulty"),t("th",null,"Mapper(s)"),t("th",null,"Status"),t("th")])],-1)),De={class:"text-secondary"},Ve=["onClick"],Fe=g(()=>t("i",{class:"fas fa-times"},null,-1)),Ne=[Fe],je={class:"col-sm-12"},He={class:"input-group input-group-sm mx-auto"},Ge=g(()=>t("option",{value:"",disabled:"",selected:""}," Select a task ",-1)),Re=["value"],We=g(()=>t("option",{value:"osu"}," osu! ",-1)),Ke=g(()=>t("option",{value:"taiko"}," osu!taiko ",-1)),ze=g(()=>t("option",{value:"catch"}," osu!catch ",-1)),Ye=g(()=>t("option",{value:"mania"}," osu!mania ",-1)),Xe=[We,Ke,ze,Ye],Je=g(()=>t("option",{value:"",disabled:"",selected:""}," Select a status ",-1)),Ze=g(()=>t("option",{value:"WIP"}," Work-in-progress ",-1)),xe=g(()=>t("option",{value:"Done"}," Done ",-1)),es=[Je,Ze,xe],ss=g(()=>t("i",{class:"fas fa-plus"},null,-1)),ts=[ss],as=g(()=>t("div",{class:"text-secondary small mt-1"},[t("ul",{class:"small"},[t("li",null,'You can leave the "mapper" field empty for your own difficulties.'),t("li",null,'Use comma separation for collabs, like "mapper1, mapper2"')])],-1)),os=g(()=>t("hr",null,null,-1)),is=g(()=>t("div",{class:"mb-2"},[$(" Set any difficulties that nobody else is allowed to claim. "),t("div",{class:"small text-secondary"}," For example, if you don't want any guest difficulties, you should select all. These can be changed later. ")],-1)),ns={class:"mb-3 row"},ls={class:"col-sm-10"},ds=["id","value"],rs=["for"],us=g(()=>t("div",{class:"radial-divisor"},null,-1)),ps={class:"small text-secondary mt-2"},cs={class:"small"},ms=g(()=>t("i",null,"after",-1)),hs=g(()=>t("li",null,[$("Your beatmap was ranked "),t("i",null,"after"),$(" the Featured Artist was announced, excluding maps created for the announcement")],-1)),bs=g(()=>t("li",null,"Difficulties match between Mappers' Guild and osu! website (including difficulty levels and mappers)",-1)),fs=g(()=>t("li",null,"Background does not contain content from other media franchises (like Mikasa from Attack on Titan), excluding creative commons content (like Hatsune Miku) or content permitted by franchise owners (like Touhou)",-1));function _s(e,s,o,d,p,m){const r=h("modes-icons"),n=h("user-link-list"),c=h("modal-dialog"),k=L("bs-tooltip");return a(),I(c,{id:"addBeatmap",title:"Add beatmap"},{default:P(()=>[t("div",me,[t("div",he,[be,t("div",fe,[t("div",_e,[f(t("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>e.selectedArtist=l),class:"form-select"},[ke,$e,(a(!0),i(y,null,B(e.featuredArtists,l=>(a(),i("option",{key:l.id,value:l.id},b(l.label),9,ge))),128))],512),[[S,e.selectedArtist]]),f(t("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>e.artistInput=l),type:"text",class:"form-control",placeholder:"or input the artist's name...",onKeyup:s[2]||(s[2]=F(l=>e.setArtist(l),["enter"]))},null,544),[[V,e.artistInput]]),t("button",{id:"artistButton",class:"btn btn-outline-info",onClick:s[3]||(s[3]=l=>e.setArtist(l))}," Load songs ")])]),ye,t("div",ve,[f(t("select",{"onUpdate:modelValue":s[4]||(s[4]=l=>e.selectedSong=l),class:"form-select form-select-sm",disabled:!e.featuredSongs.length},[we,Te,(a(!0),i(y,null,B(e.featuredSongs,l=>(a(),i("option",{key:l.id,value:l.id},b(l.title)+" --- ("+b(l.artist)+") ",9,Me))),128))],8,Be),[[S,e.selectedSong]])])]),Ce,Ie,t("div",Le,[t("div",Se,[(a(!0),i(y,null,B(e.modes,l=>(a(),i("div",{key:l.value,class:"form-check form-check-inline"},[f(t("input",{id:l.value,"onUpdate:modelValue":s[5]||(s[5]=T=>e.selectedMode=T),class:"form-check-input",type:"radio",value:l.value},null,8,Pe),[[ne,e.selectedMode]]),t("label",{class:"form-check-label",for:l.value},b(l.name),9,Ae)]))),128)),Oe])]),qe,Ue,e.tempTasks.length?(a(),i("table",Ee,[Qe,_(j,{tag:"tbody",name:"list"},{default:P(()=>[(a(!0),i(y,null,B(e.tempTasks,l=>(a(),i("tr",{key:l.random},[t("td",De,[$(b(l.name)+" ",1),e.selectedMode=="hybrid"?(a(),I(r,{key:0,modes:[l.mode]},null,8,["modes"])):u("",!0)]),t("td",null,[_(n,{users:l.mappers},null,8,["users"])]),t("td",{class:M(l.status=="WIP"?"text-wip":"text-success")},b(l.status),3),t("td",null,[f((a(),i("a",{href:"#",class:"text-danger",onClick:T=>e.removeTempTask(l.random)},Ne,8,Ve)),[[k,"delete"]])])]))),128))]),_:1})])):u("",!0),t("div",je,[t("div",He,[f(t("select",{"onUpdate:modelValue":s[6]||(s[6]=l=>e.newTaskName=l),class:"form-select"},[Ge,(a(!0),i(y,null,B(e.tasks,l=>(a(),i("option",{key:l,value:l},b(l),9,Re))),128))],512),[[S,e.newTaskName]]),e.selectedMode=="hybrid"?f((a(),i("select",{key:0,"onUpdate:modelValue":s[7]||(s[7]=l=>e.selectedTaskMode=l),class:"form-select"},Xe,512)),[[S,e.selectedTaskMode]]):u("",!0),f(t("select",{"onUpdate:modelValue":s[8]||(s[8]=l=>e.selectedTaskStatus=l),class:"form-select"},es,512),[[S,e.selectedTaskStatus]]),f(t("input",{"onUpdate:modelValue":s[9]||(s[9]=l=>e.newTaskMapper=l),class:"form-control",type:"text",placeholder:"mapper name or osu! ID...",onKeyup:s[10]||(s[10]=F(l=>e.addTempTask(l),["enter"]))},null,544),[[V,e.newTaskMapper]]),f((a(),i("button",{class:"btn btn-outline-info",onClick:s[11]||(s[11]=l=>e.addTempTask(l))},ts)),[[k,"add difficulty"]])]),as]),os,is,t("div",ns,[t("div",ls,[(a(!0),i(y,null,B(e.tasks,l=>(a(),i("div",{key:l,class:"form-check"},[f(t("input",{id:`lock-${l}`,"onUpdate:modelValue":s[12]||(s[12]=T=>e.checkedLocks=T),class:"form-check-input",type:"checkbox",value:l},null,8,ds),[[le,e.checkedLocks]]),t("label",{class:"form-check-label",for:`lock-${l}`},b(l),9,rs)]))),128))])])]),t("button",{type:"submit",class:"btn btn-outline-success w-100",onClick:s[13]||(s[13]=l=>e.saveNewMap(l))}," Create beatmap "),us,t("div",ps,[t("div",cs,[$(" Note that you can only earn points for beatmaps that fit these requirements: "),t("ul",null,[t("li",null,[$("Your beatmap was ranked "),ms,$(" you joined the Mappers' Guild ("),t("code",null,b(e.loggedInUser.createdAt),1),$(")")]),hs,bs,fs])])])]),_:1})}const ks=w(ce,[["render",_s],["__scopeId","data-v-143a232c"]]),$s=v({name:"BeatmapPageFilters",components:{FilterBox:ue,ModeFilters:pe},data(){return{statuses:{any:"Any",WIP:"WIP",Done:"Done",Qualified:"Qualified",Ranked:"Ranked"},quests:{any:"Any",none:"None"}}},computed:A("beatmaps",["filterMode","filterValue","filterStatus","filterQuest"]),methods:{...de("beatmaps",["updateFilterValue","updateFilterMode","updateFilterStatus","updateFilterQuest"]),getStatusSortClass(e){return this.filterStatus===e?"sorted":"unsorted"},getQuestSortClass(e){return this.filterQuest===e?"sorted":"unsorted"}}}),gs={class:"container card card-body py-3 mb-2"},ys=t("button",{class:"btn btn-primary",href:"#","data-bs-toggle":"modal","data-bs-target":"#addBeatmap"},[$(" Add beatmap "),t("i",{class:"fas fa-plus fa-xs"})],-1),vs={class:"row mt-3"},Bs=t("div",{class:"col-auto filter-title"}," Status ",-1),ws={class:"col"},Ts=["onClick"],Ms={class:"row mt-3"},Cs=t("div",{class:"col-auto filter-title"}," Quest ",-1),Is={class:"col"},Ls=["onClick"];function Ss(e,s,o,d,p,m){const r=h("mode-filters"),n=h("filter-box");return a(),i("div",gs,[_(n,{placeholder:"enter to search for song/username...","filter-value":e.filterValue,"onUpdate:filterValue":s[1]||(s[1]=c=>e.updateFilterValue(c))},{filters:P(()=>[_(r,{"filter-mode":e.filterMode,"onUpdate:filterMode":s[0]||(s[0]=c=>e.updateFilterMode(c))},null,8,["filter-mode"]),t("div",vs,[Bs,t("div",ws,[(a(!0),i(y,null,B(e.statuses,(c,k)=>(a(),i("a",{key:k,href:"#",class:M(["status",e.getStatusSortClass(k)]),onClick:C(l=>e.updateFilterStatus(k),["prevent"])},b(c),11,Ts))),128))])]),t("div",Ms,[Cs,t("div",Is,[(a(!0),i(y,null,B(e.quests,(c,k)=>(a(),i("a",{key:k,href:"#",class:M(["quest",e.getQuestSortClass(k)]),onClick:C(l=>e.updateFilterQuest(k),["prevent"])},b(c),11,Ls))),128))])])]),default:P(()=>[ys]),_:1},8,["filter-value"])])}const Ps=w($s,[["render",Ss]]);function D(e,s,o){const d={class:["px-1","text-"+s.toLowerCase()]};return o&&(d["data-bs-toggle"]="tooltip",d["data-bs-placement"]="top",d.title=o),G("span",d,e)}const se=v({props:{tasks:{type:Array,required:!0},tasksLocked:{type:Array,required:!0},mode:{type:String,required:!0}},render(){const e=[{name:"Storyboard",short:"SB",locked:!1,status:[]},{name:"Easy",short:"E",locked:!1,status:[]},{name:"Normal",short:"N",locked:!1,status:[]},{name:"Hard",short:"H",locked:!1,status:[]},{name:"Insane",short:"I",locked:!1,status:[]},{name:"Expert",short:"X",locked:!1,status:[]}],s=[{name:"osu",short:"circle",count:0,status:q.Done},{name:"taiko",short:"drum",count:0,status:q.Done},{name:"catch",short:"apple-alt",count:0,status:q.Done},{name:"mania",short:"stream",count:0,status:q.Done}],o=[],d=this.tasks.length>=10,p=this.mode===E.Hybrid;for(const m of e){let r=!1;const n=this.tasksLocked.includes(m.name);for(const c of this.tasks)if(m.name===c.name){m.status.push(c.status),r=!0;const k=s.findIndex(l=>l.name===c.mode);k!==-1&&(s[k].count++,c.status===q.WIP&&(s[k].status=q.WIP))}if(!p){if(d&&m.status.length>1)o.push(D(m.short+"+","secondary",m.status.length.toString()));else for(const c of m.status)o.push(D(m.short,c));r||o.push(D(m.short,n?"blocked":"open"))}}if(p)for(const m of s)o.push(D([G("i",{class:["fas","fa-"+m.short]})],m.count?m.status:"blocked",m.count.toString()));return G("span",{class:"fw-bold"},o)}}),As=v({props:{beatmap:{type:Object,required:!0}},computed:{url(){var e;if(this.beatmap.mission)switch(this.beatmap.mission.tier){case 1:return"/images/dark-bronze.png";case 2:return"/images/dark-silver.png";case 3:return"/images/dark-gold.png";case 4:return"/images/dark-platinum.png";default:return"/images/dark-bronze.png"}return this.beatmap.isShowcase||!((e=this.beatmap.quest)!=null&&e.art)?"/images/no-art-icon.png":this.beatmap.quest.isMbc?"/images/mbc-icon.png":`https://assets.ppy.sh/artists/${this.beatmap.quest.art}/cover.jpg`}}});const Os=["src"];function qs(e,s,o,d,p,m){const r=L("bs-tooltip");return e.beatmap.quest||e.beatmap.mission||e.beatmap.isShowcase?f((a(),i("img",{key:0,class:"rounded-circle me-1 quest-icon",src:e.url},null,8,Os)),[[r,e.beatmap.quest&&e.beatmap.quest.name||e.beatmap.mission&&e.beatmap.mission.name||"FA showcase"]]):u("",!0)}const z=w(As,[["render",qs],["__scopeId","data-v-b923d27f"]]),Us=v({name:"BeatmapCard",components:{ProcessTasks:se,QuestImg:z,ModesIcons:Q},props:{beatmap:{type:Object,required:!0}},emits:["update:selectedBeatmap"],data(){return{defaultUrl:"https://osu.ppy.sh/images/layout/beatmaps/default-bg.png"}},computed:{statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}},methods:{fallbackImage(e){e.target.src=this.defaultUrl},formatMetadata(e,s){const o=e+" - "+s;return o.length>34?o.slice(0,34)+"...":o},processUrl(e){if(e&&e.indexOf("osu.ppy.sh/beatmapsets/")!==-1){const s=e.indexOf("beatmapsets/")+12,o=e.indexOf("#");let d;return o!==-1?d=e.slice(s,o):d=e.slice(s),`https://assets.ppy.sh/beatmaps/${d}/covers/card.jpg`}else return this.defaultUrl}}});const Es=["src"],Qs={class:"card-img-overlay",style:{padding:"0.50rem 0.50rem 0 0.50rem"}},Ds={class:"card-title mb-1"},Vs={class:"card-text"};function Fs(e,s,o,d,p,m){const r=h("quest-img"),n=h("user-link"),c=h("modes-icons"),k=h("process-tasks");return a(),i("div",{class:"my-2 col-sm-12 col-md-6 col-lg-4",onClick:s[1]||(s[1]=l=>e.$emit("update:selectedBeatmap",e.beatmap))},[t("div",{class:M(["card card-hover map-card bg-dark",e.statusBorder]),"data-bs-toggle":"modal","data-bs-target":"#editBeatmap"},[t("img",{class:"card-img",src:e.processUrl(e.beatmap.url),style:{opacity:"0.2"},onError:s[0]||(s[0]=l=>e.fallbackImage(l))},null,40,Es),t("div",Qs,[t("p",Ds,b(e.formatMetadata(e.beatmap.song.artist,e.beatmap.song.title)),1),t("small",Vs,[_(r,{beatmap:e.beatmap},null,8,["beatmap"]),$(" Hosted by "),_(n,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),I(c,{key:0,modes:[e.beatmap.mode]},null,8,["modes"])):u("",!0),_(k,{class:"float-end pt-1",tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])])])],2)])}const te=w(Us,[["render",Fs],["__scopeId","data-v-a765c2fc"]]),Ns=v({components:{BeatmapCard:te},computed:Z("beatmaps",["hostedBeatmaps"]),methods:x("beatmaps",["setSelectedBeatmap"])}),js={class:"container card card-body py-3"},Hs={class:"ms-2"},Gs={href:"#hostedBeatmaps","data-bs-toggle":"collapse"},Rs=t("i",{class:"fas fa-angle-down"},null,-1),Ws={key:0,id:"hostedBeatmaps",class:"show"},Ks={key:0,class:"ms-5 text-secondary"};function zs(e,s,o,d,p,m){const r=h("beatmap-card");return a(),i("div",js,[t("h5",Hs,[t("a",Gs,[$(" My mapsets ("+b(e.hostedBeatmaps?e.hostedBeatmaps.length:"...")+") ",1),Rs])]),e.hostedBeatmaps?(a(),i("div",Ws,[_(j,{name:"list",tag:"div",class:"row"},{default:P(()=>[(a(!0),i(y,null,B(e.hostedBeatmaps,n=>(a(),I(r,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":s[0]||(s[0]=c=>e.setSelectedBeatmap(c))},null,8,["beatmap"]))),128))]),_:1}),e.hostedBeatmaps.length?u("",!0):(a(),i("p",Ks," None... "))])):u("",!0)])}const Ys=w(Ns,[["render",zs]]),Xs=v({components:{BeatmapCard:te},props:{isLoadingGuestBeatmaps:Boolean},computed:Z("beatmaps",["guestDifficultyBeatmaps"]),methods:x("beatmaps",["setSelectedBeatmap"])}),Js={class:"container card card-body py-3"},Zs={class:"ms-2"},xs={href:"#guestDifficultyBeatmaps","data-bs-toggle":"collapse"},et=t("i",{class:"fas fa-angle-down"},null,-1),st={key:0,class:"ms-5 text-secondary"};function tt(e,s,o,d,p,m){const r=h("beatmap-card");return a(),i("div",Js,[t("h5",Zs,[t("a",xs,[$(" My guest difficulties ("+b(e.guestDifficultyBeatmaps&&!e.isLoadingGuestBeatmaps?e.guestDifficultyBeatmaps.length:"...")+") ",1),et])]),e.guestDifficultyBeatmaps?(a(),i("div",{key:0,id:"guestDifficultyBeatmaps",class:M(["collapse",{"loading-data":e.isLoadingGuestBeatmaps}])},[!e.guestDifficultyBeatmaps.length&&!e.isLoadingGuestBeatmaps?(a(),i("p",st," None... ")):u("",!0),_(j,{name:"list",tag:"div",class:"row"},{default:P(()=>[(a(!0),i(y,null,B(e.guestDifficultyBeatmaps,n=>(a(),I(r,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":s[0]||(s[0]=c=>e.setSelectedBeatmap(c))},null,8,["beatmap"]))),128))]),_:1})],2)):u("",!0)])}const at=w(Xs,[["render",tt]]),ot=v({name:"ModeChoice",props:{beatmap:{type:Object,required:!0}},data(){return{selectedMode:this.beatmap.mode,showInput:!1,modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}]}},methods:{async setMode(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setMode`,{mode:this.selectedMode},e);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),this.showInput=!1}}}),it={id:"mode"},nt={class:"row mb-2"},lt={class:"col"},dt=t("i",{class:"fas fa-edit"},null,-1),rt=[dt],ut={class:"small ms-3 text-secondary"},pt={key:0,class:"row mb-2"},ct={class:"col"},mt={class:"input-group input-group-sm"},ht=["value"];function bt(e,s,o,d,p,m){const r=L("bs-tooltip");return a(),i("div",it,[t("div",nt,[t("div",lt,[t("div",null,[$(" Mode "),f((a(),i("a",{id:"editMode",href:"#",class:M([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:s[0]||(s[0]=C(n=>e.showInput=!e.showInput,["prevent"]))},rt,2)),[[r,"edit mode","right"]])]),t("div",ut,b(e.beatmap.mode=="hybrid"?"Multiple modes":e.beatmap.mode=="osu"?"osu!":"osu!"+e.beatmap.mode),1)])]),e.showInput?(a(),i("div",pt,[t("div",ct,[t("div",mt,[f(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.selectedMode=n),class:"form-select"},[(a(!0),i(y,null,B(e.modes,n=>(a(),i("option",{key:n.value,value:n.value},b(n.name),9,ht))),128))],512),[[S,e.selectedMode]]),f((a(),i("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.setMode(n))},[$(" Save ")])),[[r,"link beatmap to quest"]])])])])):u("",!0)])}const ft=w(ot,[["render",bt]]),_t=v({name:"StatusChoice",props:{beatmap:{type:Object,required:!0}},methods:{async setStatus(e,s){const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setStatus`,{status:e},s);this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o)}}}),kt={id:"mapsetStatus"},$t=t("div",{class:"d-inline-block me-2"}," Status ",-1),gt=["disabled"],yt=["disabled"],vt={class:"small text-secondary"},Bt=t("div",{class:"small text-secondary mt-1"},[t("div",{class:"small"},' Maps marked as "Done" will be processed for points when they reach the Ranked category on osu!. ')],-1);function wt(e,s,o,d,p,m){const r=L("bs-tooltip");return a(),i("div",kt,[$t,f((a(),i("button",{class:M(["btn btn-sm me-1",e.beatmap.status=="WIP"?"btn-warning":"btn-outline-warning"]),disabled:e.beatmap.status=="WIP",onClick:s[0]||(s[0]=n=>e.setStatus("WIP",n))},[$(" WIP ")],10,gt)),[[r,"mark mapset as work-in-progress","bottom"]]),f((a(),i("button",{class:M(["btn btn-sm me-1",e.beatmap.status=="Done"?"btn-success":"btn-outline-success"]),disabled:e.beatmap.status=="Done",onClick:s[1]||(s[1]=n=>e.setStatus("Done",n))},[$(" Done ")],10,yt)),[[r,"mark mapset and all diffs as done","bottom"]]),t("span",vt,'(currently "'+b(e.beatmap.status)+'")',1),Bt])}const Tt=w(_t,[["render",wt]]),Mt=v({name:"NewTask",props:{isHost:Boolean,taskToAddCollaborator:{type:Object,default:null},beatmap:{type:Object,required:!0}},emits:["update:taskToAddCollaborator"],data(){return{selectedTask:N.Easy,selectedMode:E.Osu,addTaskUsername:""}},computed:{remainingTasks(){let e=Object.values(N);return this.beatmap.tasksLocked&&this.beatmap.tasksLocked.length&&!this.isHost&&(e=e.filter(s=>!this.beatmap.tasksLocked.includes(s))),this.selectedTask=e[0]||"",e}},methods:{async addTask(e){let s;this.beatmap.mode==E.Hybrid?s=this.selectedMode:s=this.beatmap.mode;const o=await this.$http.executePost("/beatmaps/addTask/"+this.beatmap.id,{user:this.addTaskUsername,taskName:this.selectedTask,username:this.addTaskUsername,mode:s},e);this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o)},async addCollab(e){let s;this.beatmap.mode==E.Hybrid?s=this.taskToAddCollaborator.mode:s=this.beatmap.mode;const o=await this.$http.executePost("/beatmaps/addCollab/"+this.beatmap.id,{user:this.addTaskUsername,task:this.taskToAddCollaborator,mode:s},e);this.$http.isError(o)||(this.$store.dispatch("beatmaps/updateBeatmap",o),this.$store.dispatch("updateToastMessages",{message:"Added",type:"success"}))}}}),Ct={key:0,class:"row mt-2 mb-3"},It={class:"col-sm-12"},Lt={class:"input-group input-group-sm mx-auto"},St=["value"],Pt=t("option",{value:"osu"}," osu! ",-1),At=t("option",{value:"taiko"}," osu!taiko ",-1),Ot=t("option",{value:"catch"}," osu!catch ",-1),qt=t("option",{value:"mania"}," osu!mania ",-1),Ut=[Pt,At,Ot,qt],Et=t("i",{class:"fas fa-plus"},null,-1),Qt=[Et],Dt={key:0,class:"col-sm-12 mt-1 text-center"},Vt=t("i",{class:"fas fa-times-circle"},null,-1),Ft=[Vt];function Nt(e,s,o,d,p,m){const r=L("bs-tooltip");return e.beatmap.status=="WIP"&&e.remainingTasks.length?(a(),i("div",Ct,[t("div",It,[t("div",Lt,[e.taskToAddCollaborator?u("",!0):f((a(),i("select",{key:0,"onUpdate:modelValue":s[0]||(s[0]=n=>e.selectedTask=n),class:"form-select"},[(a(!0),i(y,null,B(e.remainingTasks,n=>(a(),i("option",{key:n,value:n},b(n),9,St))),128))],512)),[[S,e.selectedTask]]),e.beatmap.mode=="hybrid"&&!e.taskToAddCollaborator?f((a(),i("select",{key:1,"onUpdate:modelValue":s[1]||(s[1]=n=>e.selectedMode=n),class:"form-select"},Ut,512)),[[S,e.selectedMode]]):u("",!0),e.isHost||e.taskToAddCollaborator?f((a(),i("input",{key:2,"onUpdate:modelValue":s[2]||(s[2]=n=>e.addTaskUsername=n),class:"form-control",type:"text",placeholder:"add user to task...",maxlength:"18",onKeyup:s[3]||(s[3]=F(n=>e.taskToAddCollaborator?e.addCollab(n):e.addTask(n),["enter"]))},null,544)),[[V,e.addTaskUsername]]):u("",!0),f((a(),i("button",{class:"btn btn-outline-info",onClick:s[4]||(s[4]=n=>e.taskToAddCollaborator?e.addCollab(n):e.addTask(n))},Qt)),[[r,"add difficulty"]])])]),e.taskToAddCollaborator?(a(),i("div",Dt,[t("small",null,[$(" Adding collaborator for the selected difficulty "),t("a",{class:"text-danger",href:"#",onClick:s[5]||(s[5]=C(n=>e.$emit("update:taskToAddCollaborator",null),["prevent"]))},Ft)])])):u("",!0)])):u("",!0)}const jt=w(Mt,[["render",Nt]]),Ht=v({name:"TasksChoice",components:{NewTask:jt,ModesIcons:Q},props:{beatmap:{type:Object,required:!0},isHost:Boolean,isRanked:Boolean,isQualified:Boolean},data(){return{taskToAddCollaborator:void 0}},computed:{...A(["loggedInUser"]),sortedTasks(){const e=["Easy","Normal","Hard","Insane","Expert","Storyboard"],s=["osu","taiko","catch","mania","sb"];return[...this.beatmap.tasks].sort(function(d,p){return e.indexOf(d.name)-e.indexOf(p.name)}).sort(function(d,p){return s.indexOf(d.mode)-s.indexOf(p.mode)})}},methods:{isOwner(e){return e.some(s=>s.osuId==this.loggedInUser.osuId)},canEditTask(e){return this.isOwner(e.mappers)||this.isHost},async setTaskStatus(e,s,o){o.target.classList.add("fake-button-disable");const d=await this.$http.executePost("/beatmaps/setTaskStatus/"+e,{status:s});this.$http.isError(d)||this.$store.dispatch("beatmaps/updateBeatmap",d),o.target.classList.remove("fake-button-disable")},async removeTask(e,s){s.target.classList.add("fake-button-disable");const o=await this.$http.executePost("/beatmaps/removeTask/"+e,{beatmapId:this.beatmap.id});this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o),s.target.classList.remove("fake-button-disable")},canEditTaskCollaborators(e){return e.status!="Done"&&!this.isQualified&&this.beatmap.status!="Done"&&this.canEditTask(e)},async removeCollab(e,s,o){o.target.classList.add("fake-button-disable");const d=await this.$http.executePost("/beatmaps/task/"+e+"/removeCollab",{user:s});this.$http.isError(d)||this.$store.dispatch("beatmaps/updateBeatmap",d),o.target.classList.remove("fake-button-disable")},isAddingCollaborator(e){var s;return((s=this.taskToAddCollaborator)==null?void 0:s.id)==e.id}}});const O=e=>(R("data-v-d0c04112"),e=e(),W(),e),Gt={class:"row"},Rt={class:"col-sm-12"},Wt={class:"table table-sm"},Kt=O(()=>t("th",null,"Difficulty",-1)),zt=O(()=>t("th",null,"Mapper(s)",-1)),Yt={key:0},Xt=["id"],Jt=O(()=>t("i",{class:"fas fa-times"},null,-1)),Zt=[Jt],xt=["onClick"],ea=O(()=>t("i",{class:"fas fa-plus"},null,-1)),sa=[ea],ta=["onClick"],aa=O(()=>t("i",{class:"fas fa-minus"},null,-1)),oa=[aa],ia={key:0},na=["onClick"],la=O(()=>t("i",{class:"fas fa-minus"},null,-1)),da=[la],ra=["onClick"],ua=O(()=>t("i",{class:"fas fa-check"},null,-1)),pa=[ua],ca=["onClick"],ma=O(()=>t("i",{class:"fas fa-ellipsis-h"},null,-1)),ha=[ma],ba={key:0,class:"col-sm-12 mt-2"};function fa(e,s,o,d,p,m){const r=h("modes-icons"),n=h("user-link"),c=h("new-task"),k=L("bs-tooltip");return a(),i("div",Gt,[t("div",Rt,[t("table",Wt,[t("thead",null,[t("tr",null,[Kt,zt,!e.isRanked&&!e.isQualified?(a(),i("th",Yt)):u("",!0)])]),_(j,{tag:"tbody",name:"list"},{default:P(()=>[(a(!0),i(y,null,B(e.sortedTasks,l=>(a(),i("tr",{id:l.id+"Row",key:l.id},[t("td",{class:M(["text-secondary",`card-status-${l.status.toLowerCase()}`])},[$(b(l.name)+" ",1),e.beatmap.mode=="hybrid"?(a(),I(r,{key:0,modes:[l.mode]},null,8,["modes"])):u("",!0)],2),t("td",null,[(a(!0),i(y,null,B(l.mappers,(T,H)=>(a(),i("div",{key:T.id},[H==0&&e.canEditTaskCollaborators(l)?(a(),i(y,{key:0},[e.isAddingCollaborator(l)?f((a(),i("a",{key:0,href:"#",class:"text-danger",onClick:s[0]||(s[0]=C(U=>e.taskToAddCollaborator=void 0,["prevent"]))},Zt)),[[k,"cancel"]]):f((a(),i("a",{key:1,href:"#",class:"text-success",onClick:C(U=>e.taskToAddCollaborator=l,["prevent"])},sa,8,xt)),[[k,"add new collaborator"]])],64)):u("",!0),_(n,{class:"mx-1",user:T},null,8,["user"]),l.mappers.length>1&&e.canEditTaskCollaborators(l)&&T.osuId!=e.loggedInUser.osuId?f((a(),i("a",{key:1,href:"#",class:"text-danger",onClick:C(U=>e.removeCollab(l.id,T.id,U),["prevent"])},oa,8,ta)),[[k,"remove collaborator"]]):u("",!0)]))),128))]),!e.isRanked&&!e.isQualified?(a(),i("td",ia,[e.canEditTask(l)?(a(),i(y,{key:0},[f((a(),i("a",{href:"#",class:"text-danger me-1",onClick:C(T=>e.removeTask(l.id,T),["prevent"])},da,8,na)),[[k,"delete"]]),l.status=="WIP"?f((a(),i("a",{key:0,href:"#",class:"text-success me-1",onClick:C(T=>e.setTaskStatus(l.id,"Done",T),["prevent"])},pa,8,ra)),[[k,"mark as done"]]):u("",!0),l.status=="Done"&&e.beatmap.status!="Done"?f((a(),i("a",{key:1,href:"#",class:"text-wip me-1",onClick:C(T=>e.setTaskStatus(l.id,"WIP",T),["prevent"])},ha,8,ca)),[[k,"mark as WIP"]]):u("",!0)],64)):u("",!0)])):u("",!0)],8,Xt))),128))]),_:1})])]),!e.isRanked&&!e.isQualified?(a(),i("div",ba,[_(c,{"task-to-add-collaborator":e.taskToAddCollaborator,"onUpdate:taskToAddCollaborator":s[1]||(s[1]=l=>e.taskToAddCollaborator=l),beatmap:e.beatmap,"is-host":e.isHost},null,8,["task-to-add-collaborator","beatmap","is-host"])])):u("",!0)])}const _a=w(Ht,[["render",fa],["__scopeId","data-v-d0c04112"]]),ka=v({name:"QuestOrMissionChoice",props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:[],openMissions:[],showInput:!1,dropdownId:""}},computed:A(["loggedInUser"]),watch:{async beatmap(){var s,o;this.showInput=!1,this.dropdownId=((s=this.beatmap.quest)==null?void 0:s.id)||((o=this.beatmap.mission)==null?void 0:o.id)||"";const e=await this.$http.executeGet(`/missions/open/${this.beatmap.mode}/${this.beatmap.id}`);this.$http.isError(e)||(this.openMissions=e)}},async created(){const e=await this.$http.executeGet(`/users/${this.loggedInUser.id}/quests`),s=await this.$http.executeGet(`/missions/open/${this.beatmap.mode}/${this.beatmap.id}`);this.$http.isError(e)||(this.userQuests=e),this.$http.isError(s)||(this.openMissions=s)},methods:{async linkQuestOrMission(e){const s=this.userQuests.find(d=>d.id==this.dropdownId),o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/${s?"linkQuest":"linkMission"}`,{questOrMissionId:this.dropdownId},e);this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o)}}}),$a={class:"row mb-2"},ga={class:"col"},ya=t("i",{class:"fas fa-edit"},null,-1),va=[ya],Ba={class:"small ms-3 text-secondary"},wa=["href"],Ta=["href"],Ma={key:2},Ca={key:0,class:"row mb-2"},Ia={class:"col"},La={class:"input-group input-group-sm"},Sa=t("option",{value:""}," No quest ",-1),Pa={key:0,disabled:""},Aa=["value"],Oa={key:1,disabled:""},qa=["value"];function Ua(e,s,o,d,p,m){const r=L("bs-tooltip");return a(),i("div",null,[t("div",$a,[t("div",ga,[t("div",null,[$(" Quest "),f((a(),i("a",{id:"editLink",href:"#",class:M([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:s[0]||(s[0]=C(n=>e.showInput=!e.showInput,["prevent"]))},va,2)),[[r,"connect mapset with a quest","right"]])]),t("div",Ba,[e.beatmap.quest?(a(),i("a",{key:0,href:`/quests?id=${e.beatmap.quest.id}`},b(e.beatmap.quest.name),9,wa)):e.beatmap.mission?(a(),i("a",{key:1,href:`/missions?id=${e.beatmap.mission.id}`},b(e.beatmap.mission.name),9,Ta)):(a(),i("i",Ma,"none"))])])]),e.showInput?(a(),i("div",Ca,[t("div",Ia,[t("div",La,[f(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.dropdownId=n),class:"form-select"},[Sa,e.userQuests.length?(a(),i("option",Pa," --- claimed quests --- ")):u("",!0),(a(!0),i(y,null,B(e.userQuests,n=>(a(),i("option",{key:n.id,value:n.id},b(n.name),9,Aa))),128)),e.openMissions.length?(a(),i("option",Oa," --- open priority quests --- ")):u("",!0),(a(!0),i(y,null,B(e.openMissions,n=>(a(),i("option",{key:n.id,value:n.id},b(n.name),9,qa))),128))],512),[[S,e.dropdownId]]),f((a(),i("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.linkQuestOrMission(n))},[$(" Save ")])),[[r,"link beatmap to quest"]])])])])):u("",!0)])}const Ea=w(ka,[["render",Ua]]),Qa=v({name:"ModdersList",components:{UserLinkList:K},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...A(["loggedInUser"]),isModder(){return this.beatmap.modders.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateModder(e){e.target.classList.add("fake-button-disable");const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateModder`);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),e.target.classList.remove("fake-button-disable")}}}),Da={id:"modders",class:"row mb-2"},Va={class:"col"},Fa={key:0,class:"ms-1"},Na={class:"small ms-3"},ja={key:0,class:"text-secondary"};function Ha(e,s,o,d,p,m){const r=h("user-link-list"),n=L("bs-tooltip");return a(),i("div",Da,[t("div",Va,[t("div",null,[$(" Modders ("+b(e.beatmap.modders.length)+") ",1),e.canEdit?f((a(),i("small",Fa,[t("a",{href:"#",class:M(e.isModder?"text-danger":"text-success"),onClick:s[0]||(s[0]=C(c=>e.updateModder(c),["prevent"]))},[t("i",{class:M(["fas",e.isModder?"fa-minus":"fa-plus"])},null,2)],2)])),[[n,"add/remove yourself from modder list","right"]]):u("",!0)]),t("div",Na,[e.beatmap.modders.length==0?(a(),i("i",ja," none ")):(a(),I(r,{key:1,users:e.beatmap.modders},null,8,["users"]))])])])}const Ga=w(Qa,[["render",Ha]]),Ra=v({name:"NominatorsList",components:{UserLinkList:K},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...A(["loggedInUser"]),isBn(){return this.beatmap.bns.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateBn(e){e.target.classList.add("fake-button-disable");const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateBn`);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),e.target.classList.remove("fake-button-disable")}}}),Wa={key:0,class:"ms-1"},Ka=t("i",{class:"fas fa-minus"},null,-1),za=[Ka],Ya=t("i",{class:"fas fa-plus"},null,-1),Xa=[Ya],Ja={class:"small ms-3"},Za={key:0,class:"text-secondary"};function xa(e,s,o,d,p,m){const r=h("user-link-list"),n=L("bs-tooltip");return a(),i("div",null,[t("div",null,[$(" Nominators ("+b(e.beatmap.bns.length)+") ",1),e.canEdit?f((a(),i("small",Wa,[e.isBn?(a(),i("a",{key:0,href:"#",class:"text-danger",onClick:s[0]||(s[0]=C(c=>e.updateBn(c),["prevent"]))},za)):u("",!0),!e.isBn&&e.beatmap.bns.length<2?(a(),i("a",{key:1,href:"#",class:"text-success",onClick:s[1]||(s[1]=C(c=>e.updateBn(c),["prevent"]))},Xa)):u("",!0)])),[[n,"add/remove yourself from potential BN list","right"]]):u("",!0)]),t("div",Ja,[e.beatmap.bns.length==0?(a(),i("i",Za,"none")):(a(),I(r,{key:1,users:e.beatmap.bns},null,8,["users"]))])])}const eo=w(Ra,[["render",xa]]),so=v({name:"BeatmapLink",props:{beatmap:{type:Object,required:!0}},data(){return{url:"",showLinkInput:!1}},watch:{beatmap(e){e&&(this.showLinkInput=!1,this.url=e.url)}},created(){this.url=this.beatmap.url},methods:{async saveLink(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setLink`,{url:this.url},e);this.$http.isError(s)||(this.showLinkInput=!1,this.$store.dispatch("beatmaps/updateBeatmap",s))}}}),to={class:"row mb-2"},ao={class:"col"},oo=t("i",{class:"fas fa-edit"},null,-1),io=[oo],no={class:"small ms-3"},lo=["href"],ro={key:1,class:"text-secondary"},uo={key:0,class:"row mb-2"},po={class:"col-sm-12"},co={class:"input-group input-group-sm"};function mo(e,s,o,d,p,m){const r=L("bs-tooltip");return a(),i("div",null,[t("div",to,[t("div",ao,[t("div",null,[$(" Link "),f((a(),i("a",{id:"editLink",href:"#",class:M(["text-success small ms-1",{"text-danger":e.showLinkInput}]),onClick:s[0]||(s[0]=C(n=>e.showLinkInput=!e.showLinkInput,["prevent"]))},io,2)),[[r,"edit link","right"]])]),t("div",no,[e.beatmap.url?(a(),i("a",{key:0,href:e.beatmap.url,target:"_blank",class:"text-truncate",style:{display:"block"}},b(e.beatmap.url),9,lo)):(a(),i("i",ro,"none"))])])]),e.showLinkInput?(a(),i("div",uo,[t("div",po,[t("div",co,[f(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.url=n),class:"form-control form-control-sm",type:"text",placeholder:"URL",onKeyup:s[2]||(s[2]=F(n=>e.saveLink(n),["enter"]))},null,544),[[V,e.url]]),t("button",{id:"addLinkButton",class:"btn btn-outline-info",type:"submit",onClick:s[3]||(s[3]=n=>e.saveLink(n))}," Save ")])])])):u("",!0)])}const ho=w(so,[["render",mo]]),bo=v({name:"LocksChoice",props:{beatmap:{type:Object,required:!0},beatmapId:{type:String,required:!0}},data(){return{lockTaskSelection:"",showLocksInput:!1,phaseEdit:!1}},computed:{remainingTasks(){var s,o;let e=Object.values(N);return(o=(s=this.beatmap)==null?void 0:s.tasksLocked)!=null&&o.length&&(e=e.filter(d=>!this.beatmap.tasksLocked.includes(d))),this.lockTaskSelection=e[0]||"",e}},watch:{beatmapId(){this.showLocksInput=!1},beatmap(){this.beatmap.tasksLocked.length>=6&&(this.showLocksInput=!1)}},methods:{async unlockTask(e,s){s.target.classList.add("fake-button-disable");const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/unlockTask`,{task:e});this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o),s.target.classList.remove("fake-button-disable")},async lockTask(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/lockTask`,{task:this.lockTaskSelection},e);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s)}}}),fo={id:"locks",class:"row mb-1"},_o={class:"col"},ko=t("i",{class:"fas fa-edit"},null,-1),$o=[ko],go={class:"small ms-3"},yo={key:0},vo={key:1},Bo=["onClick"],wo=t("i",{class:"fas fa-minus"},null,-1),To=[wo],Mo={class:"text-secondary mx-1"},Co={key:0,class:"row"},Io={class:"col"},Lo={class:"input-group input-group-sm"},So=["value"],Po=t("i",{class:"fas fa-lock"},null,-1),Ao=[Po];function Oo(e,s,o,d,p,m){const r=L("bs-tooltip");return a(),i("div",null,[t("div",fo,[t("div",_o,[t("div",null,[$(" Locks "),e.beatmap.tasksLocked.length<6?f((a(),i("a",{key:0,class:M(["text-success small ms-1",{"text-danger":e.showLocksInput}]),href:"#",onClick:s[0]||(s[0]=C(n=>e.showLocksInput=!e.showLocksInput,["prevent"]))},$o,2)),[[r,"edit locks","right"]]):u("",!0)]),t("div",go,[e.beatmap.tasksLocked.length==0?(a(),i("i",yo,"none")):u("",!0),e.beatmap.tasksLocked.length>0?(a(),i("div",vo,[(a(!0),i(y,null,B(e.beatmap.tasksLocked,n=>(a(),i("div",{key:n},[f((a(),i("a",{href:"#",class:M(["text-danger",e.phaseEdit?"fake-button-disable":""]),onClick:C(c=>e.unlockTask(n,c),["prevent"])},To,10,Bo)),[[r,"unlock","left"]]),t("span",Mo,b(n),1)]))),128))])):u("",!0)])])]),e.showLocksInput?(a(),i("div",Co,[t("div",Io,[t("div",Lo,[f(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.lockTaskSelection=n),class:"form-select"},[(a(!0),i(y,null,B(e.remainingTasks,n=>(a(),i("option",{key:n,value:n},b(n),9,So))),128))],512),[[S,e.lockTaskSelection]]),f((a(),i("button",{id:"lockTask",class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.lockTask(n))},Ao)),[[r,"prevent other mappers from claiming a difficulty","right"]])])])])):u("",!0)])}const qo=w(bo,[["render",Oo]]),Uo=v({name:"Points",props:{beatmap:{type:Object,required:!0}},data(){return{tasksPointsArray:null,usersPointsArrays:null,pointsInfo:null,totalPoints:null,bnPoints:null,isLoading:!1}},watch:{beatmap(){this.tasksPointsArray=null,this.usersPointsArrays=null,this.pointsInfo=null,this.totalPoints=null,this.bnPoints=null,this.isLoading=!1}},methods:{async findPoints(e){this.isLoading=!0;const s=await this.$http.executeGet(`/beatmaps/${this.beatmap.id}/findPoints`,e);this.$http.isError(s)||(this.tasksPointsArray=s.tasksPointsArray,this.usersPointsArrays=s.usersPointsArrays,this.pointsInfo=s.pointsInfo,this.totalPoints=s.totalPoints,this.bnPoints=s.bnPoints),this.isLoading=!1}}}),Eo={class:"row"},Qo={class:"col-sm-12"},Do={key:1,class:"small text-secondary ms-2"},Vo={key:2,class:"small text-secondary ms-2"},Fo={key:0,class:"col-sm-6"},No={class:"small text-secondary"},jo=t("li",null,"Map host: 5",-1),Ho={class:"col-sm-6"},Go={key:0,class:"small text-secondary"},Ro={key:1,class:"col-sm-12"},Wo={class:"small text-secondary ms-2"};function Ko(e,s,o,d,p,m){const r=L("bs-tooltip");return a(),i("div",null,[t("div",Eo,[t("div",Qo,[e.tasksPointsArray?u("",!0):f((a(),i("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:s[0]||(s[0]=n=>e.findPoints(n))},[$(" Calculate points ")])),[[r,"calculate points for all difficulties"]]),e.isLoading?(a(),i("div",Do," calculating... ")):e.pointsInfo?(a(),i("div",Vo,b(e.pointsInfo),1)):u("",!0)]),e.tasksPointsArray?(a(),i("div",Fo,[t("ul",No,[(a(!0),i(y,null,B(e.tasksPointsArray,(n,c)=>(a(),i("li",{key:c},b(n),1))),128)),t("li",null,"BN mod/nomination: "+b(e.bnPoints),1),jo])])):u("",!0),t("div",Ho,[e.usersPointsArrays?(a(),i("ul",Go,[(a(!0),i(y,null,B(e.usersPointsArrays,(n,c)=>(a(),i("li",{key:c},b(e.usersPointsArrays[c][0])+": "+b(e.usersPointsArrays[c][0]==e.beatmap.host.username?e.usersPointsArrays[c][1]+5:e.usersPointsArrays[c][1]),1))),128))])):u("",!0)]),e.totalPoints?(a(),i("div",Ro,[t("span",Wo," total: "+b(Math.round(e.totalPoints*10)/10+5),1)])):u("",!0)])])}const zo=w(Uo,[["render",Ko]]),Yo=v({name:"BeatmapInfo",components:{ModeChoice:ft,StatusChoice:Tt,TasksChoice:_a,QuestOrMissionChoice:Ea,ModdersList:Ga,NominatorsList:eo,BeatmapLink:ho,LocksChoice:qo,Points:zo},props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:null}},computed:{...A(["loggedInUser"]),isHost(){return this.loggedInUser.id&&this.beatmap?this.loggedInUser.id===this.beatmap.host.id:!1},isRanked(){return this.beatmap.status===X.Ranked},isQualified(){return this.beatmap.status===X.Qualified}},methods:{async deleteMap(e){if(confirm("Are you sure you want to delete?")){e.target.disabled=!0;const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/delete`,{},e);this.$http.isError(o)||(this.$bs.hideModal("editBeatmap"),this.$store.commit("beatmaps/deleteBeatmap",o)),e.target.disabled=!1}}}});const Y=e=>(R("data-v-4727d833"),e=e(),W(),e),Xo={key:0,class:"container"},Jo={class:"row"},Zo={class:"row mb-2"},xo={class:"col-sm-6"},ei={key:0,id:"bns",class:"col-sm-6"},si=Y(()=>t("hr",null,null,-1)),ti={class:"row"},ai={class:"col-sm"},oi={key:0,class:"col-lg-5 bm-col-separator-left"},ii={key:0,class:"row"},ni={class:"col-sm"},li=Y(()=>t("hr",null,null,-1)),di={class:"row"},ri={class:"col-sm"},ui=Y(()=>t("hr",null,null,-1)),pi={class:"row"},ci={class:"col-sm-4 text-end"},mi={class:"small text-secondary"};function hi(e,s,o,d,p,m){const r=h("modders-list"),n=h("nominators-list"),c=h("tasks-choice"),k=h("status-choice"),l=h("mode-choice"),T=h("quest-or-mission-choice"),H=h("beatmap-link"),U=h("locks-choice"),oe=h("points");return e.beatmap?(a(),i("div",Xo,[t("div",Jo,[t("div",{class:M(e.isHost&&!e.isRanked?"col-lg-7":"col-sm-12")},[t("div",Zo,[t("div",xo,[_(r,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])]),!e.isRanked||e.beatmap.bns?(a(),i("div",ei,[_(n,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])])):u("",!0)]),si,t("div",ti,[t("div",ai,[_(c,{beatmap:e.beatmap,"is-host":e.isHost,"is-ranked":e.isRanked,"is-qualified":e.isQualified},null,8,["beatmap","is-host","is-ranked","is-qualified"])])])],2),e.isHost&&!e.isRanked?(a(),i("div",oi,[e.isQualified?u("",!0):(a(),i("div",ii,[t("div",ni,[_(k,{beatmap:e.beatmap},null,8,["beatmap"]),li])])),t("div",di,[t("div",ri,[e.beatmap.status=="WIP"?(a(),I(l,{key:0,class:"mb-2",beatmap:e.beatmap},null,8,["beatmap"])):u("",!0)])]),_(T,{beatmap:e.beatmap},null,8,["beatmap"]),e.isQualified?u("",!0):(a(),I(H,{key:1,beatmap:e.beatmap},null,8,["beatmap"])),e.beatmap.status=="WIP"?(a(),I(U,{key:2,beatmap:e.beatmap,"beatmap-id":e.beatmap.id},null,8,["beatmap","beatmap-id"])):u("",!0)])):u("",!0)]),ui,t("div",pi,[_(oe,{class:"col-sm-8",beatmap:e.beatmap},null,8,["beatmap"]),t("div",ci,[t("span",mi," Created: "+b(e.beatmap.createdAt.toString().slice(0,10)),1),e.isHost&&!e.isRanked?(a(),i("button",{key:0,id:"deleteButton",class:"btn btn-sm btn-outline-danger ms-2",onClick:s[0]||(s[0]=ie=>e.deleteMap(ie))}," Delete ")):u("",!0)])])])):u("",!0)}const ae=w(Yo,[["render",hi],["__scopeId","data-v-4727d833"]]),bi=v({name:"BeatmapTableRow",components:{BeatmapInfo:ae,ProcessTasks:se,QuestImg:z,ModesIcons:Q},props:{beatmap:{type:Object,required:!0}},methods:{selectBeatmap(){this.$route.query.id!==this.beatmap.id&&this.$router.push(`/beatmaps?id=${this.beatmap.id}`)},formatMetadata(){const e=this.beatmap.song.artist+" - "+this.beatmap.song.title;return e.length>70?e.slice(0,70)+"...":e},statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}}}),fi={class:"container"},_i={class:"row"},ki={class:"col-sm-6"},$i=["data-bs-target"],gi=t("i",{class:"fas fa-angle-down"},null,-1),yi={class:"col-sm-2 small d-flex justify-content-end align-items-center"},vi={class:"col-sm-3 small"},Bi=t("span",{class:"text-secondary me-1"},"Hosted by",-1),wi={key:0,class:"text-secondary"},Ti={key:0,class:"col-sm-1 d-flex justify-content-end align-items-center"},Mi=["href"],Ci=t("i",{class:"fas fa-link"},null,-1),Ii=[Ci],Li=["id"];function Si(e,s,o,d,p,m){const r=h("quest-img"),n=h("process-tasks"),c=h("user-link"),k=h("modes-icons"),l=h("beatmap-info");return a(),i("div",null,[t("div",{class:M(["card card-body card-level-2 my-1 p-1",e.statusBorder()])},[t("div",fi,[t("div",_i,[t("div",ki,[_(r,{beatmap:e.beatmap},null,8,["beatmap"]),t("a",{href:"#","data-bs-toggle":"collapse","data-bs-target":"#details"+e.beatmap.id,onClick:s[0]||(s[0]=T=>e.selectBeatmap())},[$(b(e.formatMetadata())+" ",1),gi],8,$i)]),t("div",yi,[_(n,{tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])]),t("div",vi,[Bi,_(c,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),i("span",wi,[_(k,{modes:[e.beatmap.mode]},null,8,["modes"])])):u("",!0)]),e.beatmap.url?(a(),i("div",Ti,[t("a",{href:e.beatmap.url,target:"_blank"},Ii,8,Mi)])):u("",!0)])])],2),t("div",{id:"details"+e.beatmap.id,class:M(["collapse my-2 mx-4 row border-end border-start py-3","border-"+e.beatmap.status.toLowerCase()])},[_(l,{beatmap:e.beatmap},null,8,["beatmap"])],10,Li)])}const Pi=w(bi,[["render",Si]]),Ai=v({components:{BeatmapTableRow:Pi},computed:A("beatmaps",{otherBeatmaps:"allBeatmaps",isLoadingOtherBeatmaps:"isLoadingOtherBeatmaps",filterValue:"filterValue"}),methods:{async showMore(e){e.target.disabled=!0,this.$store.commit("beatmaps/increaseFetchLimit"),await this.$store.dispatch("beatmaps/loadOtherBeatmaps"),e.target.disabled=!1}}}),Oi={class:"container card card-body py-3"},qi={class:"ms-2"},Ui={href:"#otherBeatmaps","data-bs-toggle":"collapse"},Ei=t("i",{class:"fas fa-angle-down"},null,-1),Qi={key:0,id:"otherBeatmaps",class:"collapse"},Di={key:0,class:"ms-5 text-secondary"},Vi={key:1,class:"text-center"},Fi=t("i",{class:"fas fa-angle-down me-1"},null,-1),Ni=t("i",{class:"fas fa-angle-down ms-1"},null,-1);function ji(e,s,o,d,p,m){const r=h("beatmap-table-row");return a(),i("div",Oi,[t("h5",qi,[t("a",Ui,[$(" Other beatmaps ("+b(e.otherBeatmaps&&!e.isLoadingOtherBeatmaps?e.otherBeatmaps.length:"...")+") ",1),Ei])]),e.otherBeatmaps?(a(),i("div",Qi,[t("div",{class:M({"loading-data":e.isLoadingOtherBeatmaps})},[!e.otherBeatmaps.length&&!e.isLoadingOtherBeatmaps?(a(),i("p",Di," None... ")):u("",!0),(a(!0),i(y,null,B(e.otherBeatmaps,n=>(a(),I(r,{key:n.id,beatmap:n},null,8,["beatmap"]))),128)),e.filterValue?u("",!0):(a(),i("div",Vi,[t("button",{class:"btn btn-sm btn-outline-info my-4",onClick:s[0]||(s[0]=C(n=>e.showMore(n),["prevent"]))},[Fi,$(" show more "),Ni])]))],2)])):u("",!0)])}const Hi=w(Ai,[["render",ji]]),Gi=v({components:{BeatmapInfo:ae,ModalDialog:ee,QuestImg:z,ModesIcons:Q},props:{selectedBeatmap:{type:Object,default:()=>({})}},watch:{selectedBeatmap(){this.selectedBeatmap&&this.$route.query.id!==this.selectedBeatmap.id&&this.$router.replace(`/beatmaps?id=${this.selectedBeatmap.id}`)}}}),Ri=["href"],Wi=t("i",{class:"fas fa-link"},null,-1),Ki={key:1};function zi(e,s,o,d,p,m){const r=h("quest-img"),n=h("user-link"),c=h("modes-icons"),k=h("beatmap-info"),l=h("modal-dialog");return a(),I(l,{id:"editBeatmap",loaded:Boolean(e.selectedBeatmap),"header-class":e.selectedBeatmap?"bg-"+e.selectedBeatmap.status.toLowerCase():""},{header:P(()=>[_(r,{beatmap:e.selectedBeatmap},null,8,["beatmap"]),e.selectedBeatmap.url?(a(),i("a",{key:0,href:e.selectedBeatmap.url,target:"_blank"},[Wi,$(" "+b(e.selectedBeatmap.song.artist)+" - "+b(e.selectedBeatmap.song.title),1)],8,Ri)):(a(),i("span",Ki,b(e.selectedBeatmap.song.artist)+" - "+b(e.selectedBeatmap.song.title),1)),$(" |"),_(n,{class:"mx-1",user:e.selectedBeatmap.host},null,8,["user"]),_(c,{modes:[e.selectedBeatmap.mode]},null,8,["modes"])]),default:P(()=>[_(k,{beatmap:e.selectedBeatmap},null,8,["beatmap"])]),_:1},8,["loaded","header-class"])}const Yi=w(Gi,[["render",zi]]),Xi={namespaced:!0,state:{allBeatmaps:[],userBeatmaps:[],filterValue:"",filterMode:J.any,filterStatus:"any",filterQuest:"any",selectedBeatmap:null,selectedBeatmapId:null,fetchLimit:30,isLoadingOtherBeatmaps:!0},mutations:{setAllBeatmaps(e,s){e.allBeatmaps=s},setUserBeatmaps(e,s){e.userBeatmaps=s},setFilterValue(e,s){e.filterValue=s},setFilterMode(e,s){e.filterMode=s},setFilterStatus(e,s){e.filterStatus=s},setFilterQuest(e,s){e.filterQuest=s},setIsLoadingOtherBeatmaps(e,s){e.isLoadingOtherBeatmaps=s},increaseFetchLimit(e){e.fetchLimit+=50},setSelectedBeatmap(e,s){const o=Object.values(N);s.tasks.sort(function(d,p){return o.indexOf(d.name)-o.indexOf(p.name)}),s.tasksLocked.sort(function(d,p){return o.indexOf(d)-o.indexOf(p)}),e.selectedBeatmap=s},addBeatmap(e,s){e.userBeatmaps.unshift(s)},updateBeatmap(e,s){let o=e.allBeatmaps.findIndex(d=>d.id===s.id);o!==-1&&(e.allBeatmaps[o]=s),o=e.userBeatmaps.findIndex(d=>d.id===s.id),o!==-1&&(e.userBeatmaps[o]=s)},deleteBeatmap(e,s){let o=e.allBeatmaps.findIndex(d=>d.id===s.id);o!==-1&&e.allBeatmaps.splice(o,1),o=e.userBeatmaps.findIndex(d=>d.id===s.id),o!==-1&&e.userBeatmaps.splice(o,1)}},getters:{filteredUserBeatmaps:e=>{let s=e.userBeatmaps;if(e.filterMode!==J.any){const o=e.filterMode;s=s.filter(d=>d.mode===o||d.mode===E.Hybrid)}if(e.filterStatus!=="any"&&(s=s.filter(o=>o.status===e.filterStatus)),e.filterQuest!=="any"&&(s=s.filter(o=>!o.quest)),e.filterValue){const o=e.filterValue.toLowerCase().trim().split(" ").filter(d=>d.length);s=s.filter(d=>{let p=d.song.artist+" "+d.song.title+" "+d.host.username;return d.tasks.forEach(m=>{m.mappers.forEach(r=>{p+=" "+r.username})}),p=p.toLowerCase(),o.some(m=>p.includes(m))})}return s},guestDifficultyBeatmaps:(e,s,o)=>s.filteredUserBeatmaps.filter(d=>{var p;return d.host.id!==((p=o.loggedInUser)==null?void 0:p.id)}),hostedBeatmaps:(e,s,o)=>s.filteredUserBeatmaps.filter(d=>{var p;return d.host.id===((p=o.loggedInUser)==null?void 0:p.id)})},actions:{updateBeatmap({commit:e,state:s},o){var d;e("updateBeatmap",o),((d=s.selectedBeatmap)==null?void 0:d.id)===o.id&&e("setSelectedBeatmap",o)},async updateFilterMode({commit:e,dispatch:s},o){e("setFilterMode",o),await s("loadOtherBeatmaps")},async updateFilterStatus({commit:e,dispatch:s},o){e("setFilterStatus",o),await s("loadOtherBeatmaps")},async updateFilterQuest({commit:e,dispatch:s},o){e("setFilterQuest",o),await s("loadOtherBeatmaps")},async updateFilterValue({commit:e,dispatch:s},o){e("setFilterValue",o),await s("loadOtherBeatmaps")},async loadOtherBeatmaps({commit:e,state:s}){var r;e("setIsLoadingOtherBeatmaps",!0);const o=s.filterStatus!=="any"?`&status=${s.filterStatus}`:"",d=s.filterQuest!=="any"?`&quest=${s.filterQuest}`:"",p=s.filterValue?`&search=${s.filterValue}`:"",m=await re.get(`/api/beatmaps/search?mode=${s.filterMode}&limit=${s.fetchLimit+o+d+p}`);(r=m.data)!=null&&r.allBeatmaps&&e("setAllBeatmaps",m.data.allBeatmaps),e("setIsLoadingOtherBeatmaps",!1)}}},Ji=Xi,Zi=v({name:"BeatmapPage",components:{BeatmapPageFilters:Ps,HostedBeatmaps:Ys,GuestDifficulties:at,OtherBeatmaps:Hi,EditBeatmapModal:Yi,CreateBeatmapModal:ks},data(){return{isLoadingGuestBeatmaps:!0}},computed:A("beatmaps",["selectedBeatmap"]),beforeCreate(){this.$store.hasModule("beatmaps")||this.$store.registerModule("beatmaps",Ji)},async created(){const e=this.$route.query.id;let s,o;e?([s,o]=await Promise.all([this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.executeGet("/beatmaps/searchOnLoad/"+e)]),this.$http.isError(o)||(this.$store.commit("beatmaps/setSelectedBeatmap",o),this.$bs.showModal("editBeatmap"))):s=await this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.isError(s)||(this.$store.commit("beatmaps/setUserBeatmaps",s.beatmaps),this.$store.commit("beatmaps/setFilterMode",s.mainMode)),await Promise.all([this.loadGuestBeatmaps(),this.$store.dispatch("beatmaps/loadOtherBeatmaps")]),this.isLoadingGuestBeatmaps=!1},methods:{async loadGuestBeatmaps(){const e=await this.$http.executeGet("/beatmaps/guestBeatmaps");e&&this.$store.commit("beatmaps/setUserBeatmaps",e.userBeatmaps)}}}),xi=t("div",{class:"radial-divisor"},null,-1),en=t("div",{class:"radial-divisor"},null,-1);function sn(e,s,o,d,p,m){const r=h("beatmap-page-filters"),n=h("hosted-beatmaps"),c=h("guest-difficulties"),k=h("other-beatmaps"),l=h("edit-beatmap-modal"),T=h("create-beatmap-modal");return a(),i("div",null,[_(r),_(n),xi,_(c,{"is-loading-guest-beatmaps":e.isLoadingGuestBeatmaps},null,8,["is-loading-guest-beatmaps"]),en,_(k),_(l,{"selected-beatmap":e.selectedBeatmap},null,8,["selected-beatmap"]),_(T)])}const rn=w(Zi,[["render",sn]]);export{rn as default};
