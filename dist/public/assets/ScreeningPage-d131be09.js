import{d as f,m as I,u as S,_ as g,o,e as n,F as b,r as y,n as w,l as $,a as t,q as u,t as _,b as T,A as F,k,i as p,h as l,c as v,w as N,T as L}from"./index-098c3321.js";import{C as M}from"./ContestCard-2db9a940.js";var V=(e=>(e[e.First=5]="First",e[e.Second=4]="Second",e[e.Third=3]="Third",e[e.Fourth=2]="Fourth",e[e.Fifth=1]="Fifth",e[e.None=0]="None",e))(V||{});const q=f({name:"ScreeningVote",props:{submissionId:{type:String,required:!0},savedVote:{type:Number,default:0},screeningVoteCount:{type:Number,default:0}},computed:{...I({voteLoading:e=>e.screening.voteLoading}),...S(["usedVotes"])},methods:{async updateVote(e){this.$store.commit("setVoteLoading",!0),this.savedVote==e&&(e=V.None);const s=await this.$http.executePost("/contests/screening/updateSubmission/"+this.submissionId,{vote:e});this.$http.isError(s)||this.$store.commit("updateSubmission",s),this.$store.commit("setVoteLoading",!1)}}});const B=["disabled","onClick"];function E(e,s,r,a,d,c){return o(),n("div",null,[(o(!0),n(b,null,y(e.screeningVoteCount,i=>(o(),n("a",{key:i,class:w(["mx-1",{"disabled-star":e.usedVotes.includes(i)&&e.savedVote!=i||e.voteLoading}]),disabled:e.voteLoading,href:"#",onClick:$(m=>e.updateVote(i),["prevent"])},[t("i",{class:w(["fa-star fas",{"text-warning":e.usedVotes.includes(i)&&e.savedVote==i}])},null,2)],10,B))),128))])}const U=g(q,[["render",E],["__scopeId","data-v-c0766042"]]),D=f({name:"ScreeningNotes",props:{submissionId:{type:String,required:!0},savedComment:{type:String,default:""}},data(){return{showCommentInput:!1,newComment:this.savedComment}},methods:{cancelUpdate(){this.showCommentInput=!this.showCommentInput,this.newComment=this.savedComment},async updateComment(e){if(this.savedComment!=this.newComment){const s=await this.$http.executePost("/contests/screening/updateSubmission/"+this.submissionId,{comment:this.newComment.trim()},e);this.$http.isError(s)||(this.showCommentInput=!this.showCommentInput,this.$store.commit("updateSubmission",s))}else this.showCommentInput=!this.showCommentInput}}}),O={class:""},j=t("i",{class:"fas fa-edit"},null,-1),G=[j],R={key:1,class:"small text-white-50"},z={class:"text-end"};function A(e,s,r,a,d,c){return o(),n("div",O,[e.showCommentInput?u("",!0):(o(),n("a",{key:0,href:"#",onClick:s[0]||(s[0]=$(i=>e.showCommentInput=!e.showCommentInput,["prevent"]))},G)),e.showCommentInput?(o(),n(b,{key:2},[T(t("textarea",{"onUpdate:modelValue":s[1]||(s[1]=i=>e.newComment=i),class:"form-control form-control-sm",rows:"4",type:"text",placeholder:"map comments...",style:{overflow:"hidden","overflow-wrap":"break-word"},maxlength:"1000"},null,512),[[F,e.newComment,void 0,{trim:!0}]]),t("div",z,[t("button",{type:"button",class:"btn btn-sm btn-outline-info mt-1 mx-1",onClick:s[2]||(s[2]=i=>e.cancelUpdate())}," Cancel "),t("button",{type:"button",class:"btn btn-sm btn-outline-info mt-1 mx-1",onClick:s[3]||(s[3]=i=>e.updateComment(i))}," Save ")])],64)):(o(),n("span",R,_(e.newComment||"..."),1))])}const Y=g(D,[["render",A]]),H=f({name:"SubmissionCard",components:{ScreeningVote:U,ScreeningNotes:Y},props:{submission:{type:Object,required:!0},screeningVoteCount:{type:Number,default:0},isTempFormat:{type:Boolean,default:!1}},computed:{...I(["loggedInUser"]),relatedScreening(){return this.submission.screenings.find(e=>e.screener._id===this.loggedInUser.id)}}});const J={class:"col-sm-12 my-1"},K={class:"card-body p-2"},Q={class:"row"},W={key:0,class:"col-sm-6"},X=["href"],Z={key:1,class:"col-sm-6"},P={class:"col-sm-6 text-end"},x={key:0,class:"row"},ee={class:"col-sm"};function se(e,s,r,a,d,c){const i=p("screening-vote"),m=p("screening-notes");return o(),n("div",J,[t("div",{class:w(["card",e.relatedScreening&&e.relatedScreening.vote?"bg-vote":"bg-dark"])},[t("div",K,[t("div",Q,[e.isTempFormat?(o(),n("div",W,[t("a",{href:e.submission.url,target:"_blank",onClick:s[0]||(s[0]=$(()=>{},["stop"]))},_(e.submission.name),9,X)])):(o(),n("div",Z,_(e.submission.name),1)),t("div",P,[k(i,{"submission-id":e.submission.id,"saved-vote":e.relatedScreening&&e.relatedScreening.vote,"screening-vote-count":e.screeningVoteCount},null,8,["submission-id","saved-vote","screening-vote-count"])])]),e.isTempFormat?u("",!0):(o(),n("div",x,[t("div",ee,[k(m,{"submission-id":e.submission.id,"saved-comment":e.relatedScreening&&e.relatedScreening.comment},null,8,["submission-id","saved-comment"])])]))])],2)])}const te=g(H,[["render",se],["__scopeId","data-v-48fa3a39"]]),oe=f({name:"ScreeningInstructions",props:{isTempFormat:{type:Boolean,default:!1}}}),ne={class:"mb-2"},ie=t("li",null,[l("Mark your personal "),t("b",null,"top 5"),l(" submissions with stars. If the contest has a theme/additional rules, consider those when making your choices.")],-1),re=t("li",null,[l(" Stars "),t("i",{class:"fa-star fas text-warning"}),l(" indicate the order of your top 5. The star on the "),t("b",null,"left is the lowest score"),l(", while the star on the "),t("b",null,"right is the highest score"),l(". ")],-1),ae={key:0},de={key:1},ce={key:2};function le(e,s,r,a,d,c){return o(),n("div",ne,[t("ul",null,[ie,re,e.isTempFormat?u("",!0):(o(),n("li",ae,"Comments will be seen by the map creator. Your name will be anonymous.")),e.isTempFormat?u("",!0):(o(),n("li",de,"DO NOT discuss your choices with other screeners or outsiders until after the contest is concluded.")),e.isTempFormat?u("",!0):(o(),n("li",ce,"The overall highest scoring submissions will be included in the judging phase!"))])])}const ue=g(oe,[["render",le]]),me={state:{contests:[],selectedContestId:null,voteLoading:!1},mutations:{setContests(e,s){e.contests=s},setSelectedContestId(e,s){e.selectedContestId=s},setVoteLoading(e,s){e.voteLoading=s},updateSubmission(e,s){let r=-1;const a=e.contests.findIndex(d=>{if(r=d.submissions.findIndex(c=>c.id===s.id),r!==-1)return!0});a!==-1&&r!==-1&&(e.contests[a].submissions[r]=s)}},getters:{selectedContest:e=>e.contests.find(s=>s.id===e.selectedContestId),usedVotes:(e,s,r)=>{const a=s.selectedContest,d=[];return a.submissions.forEach(c=>{const i=c.screenings.find(m=>{var C;return m.screener.id===((C=r.loggedInUser)==null?void 0:C.id)});i&&d.push(i.vote)}),d}}},he=me,pe=f({name:"ScreeningPage",components:{SubmissionCard:te,ContestCard:M,ScreeningInstructions:ue},data(){return{loadedSpecificContest:!1}},computed:{...I({contests:e=>e.screening.contests}),...S(["selectedContest"])},beforeCreate(){this.$store.hasModule("screening")||this.$store.registerModule("screening",he)},unmounted(){this.$store.hasModule("screening")&&this.$store.unregisterModule("screening")},async created(){await this.loadContests()},methods:{async loadContests(){const e=this.$route.query.contest;if(e&&!this.contests.length){const s=await this.$http.initialRequest(`/contests/screening/searchContest/${e}`);this.$http.isError(s)||(this.$store.commit("setContests",[s]),this.$store.commit("setSelectedContestId",e),this.loadedSpecificContest=!0)}else{this.$router.replace("/contests/screening");const s=await this.$http.initialRequest("/contests/screening/relevantInfo");this.$http.isError(s)||(this.$store.commit("setContests",s||[]),this.$store.commit("setSelectedContestId",null),this.loadedSpecificContest=!1)}},async loadMore(){await this.loadContests()}}}),fe={class:"container card card-body py-1"},ge={key:0,class:"row"},Ce={key:0,class:"col-sm-4 my-2"},be={key:1},_e=t("hr",null,null,-1),$e={class:"my-2"},ve=["href"],ye={class:"mb-2"},we=t("i",{class:"fas fa-angle-down"},null,-1),ke={key:1,class:"ms-4"},Ie={key:1,class:"text-center p-3"};function Se(e,s,r,a,d,c){const i=p("contest-card"),m=p("screening-instructions"),C=p("submission-card");return o(),n("div",fe,[e.contests&&e.contests.length?(o(),n("div",ge,[(o(!0),n(b,null,y(e.contests,h=>(o(),v(i,{key:h.id,class:"col-sm-4 my-2",contest:h,route:"screening"},null,8,["contest"]))),128)),e.loadedSpecificContest?(o(),n("div",Ce,[t("button",{class:"btn w-100 btn-info h-100",type:"button",onClick:s[0]||(s[0]=h=>e.loadMore())}," Load other contests ")])):u("",!0),e.selectedContest?(o(),n("div",be,[_e,t("h4",$e,_(e.selectedContest.name),1),t("h5",null,[t("a",{href:e.selectedContest.download,target:"_blank"}," Download all submissions ",8,ve)]),t("div",ye,[t("a",{href:"#screeningInstructions","data-bs-toggle":"collapse",onClick:s[1]||(s[1]=$(()=>{},["prevent"]))},[l(" See screening instructions "),we])]),k(m,{id:"screeningInstructions",class:"collapse","is-temp-format":e.selectedContest.isTempFormat},null,8,["is-temp-format"]),e.selectedContest.submissions.length?(o(),v(L,{key:0,name:"list",tag:"div",class:"row"},{default:N(()=>[(o(!0),n(b,null,y(e.selectedContest.submissions,h=>(o(),v(C,{key:h.id,submission:h,"screening-vote-count":e.selectedContest.screeningVoteCount,"is-temp-format":e.selectedContest.isTempFormat},null,8,["submission","screening-vote-count","is-temp-format"]))),128))]),_:1})):(o(),n("p",ke," No submissions... "))])):u("",!0)])):(o(),n("div",Ie," No contests available for screening. "))])}const Fe=g(pe,[["render",Se]]);export{Fe as default};
