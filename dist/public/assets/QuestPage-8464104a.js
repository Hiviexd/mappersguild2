import{d as b,_ as g,o as i,e as o,j as p,w as I,r as u,F as k,f as M,t as f,a as t,m as v,x as T,k as m,Q as R,y as q,n as Q,T as B,b as _,c as w,q as A,g as W,h as N,v as G,l as c,M as J,G as z,H,I as K,J as Y,A as E,s as X,u as Z,K as x,L as C,N as D}from"./index-d9875c46.js";import{F as ee}from"./FilterBox-68cf3614.js";import{M as se,F as O}from"./extras-dd93e77d.js";import{F as te}from"./FormTextarea-29b82628.js";import{S as ie}from"./SubmitQuestModal-2ad47198.js";import{A as oe}from"./AssociatedBeatmaps-4f2d662d.js";import{M as re}from"./ModalDialog-34ff4567.js";const ae=b({name:"ArtistFilters",components:{FormSelect:te},props:{isLoading:Boolean,filterArtist:{type:String,default:""}},emits:["update:filterArtist"],data(){return{featuredArtists:[],selectedArtist:""}},watch:{selectedArtist(){}},async created(){const e=await this.$http.executeGet("/featuredArtists");e&&(this.featuredArtists=e.sort((s,a)=>s.label.toLowerCase()>a.label.toLowerCase()?1:a.label.toLowerCase()>s.label.toLowerCase()?-1:0))},methods:{}}),ne={class:"row mt-3"},de=t("option",{value:"-",disabled:""}," --- ",-1),le=t("option",{value:"none"}," No specific artist ",-1),ue=t("option",{value:"user"}," User-submitted quests ",-1),pe=t("option",{value:"-",disabled:""}," --- ",-1),ce=t("option",{value:"-",disabled:""}," Jump to an artist by typing their name! ",-1),me=t("option",{value:"-",disabled:""}," --- ",-1),he=["value"];function fe(e,s,a,d,h,y){const l=u("form-select");return i(),o("div",ne,[p(l,{modelValue:e.selectedArtist,"onUpdate:modelValue":s[0]||(s[0]=r=>e.selectedArtist=r),label:"Artist",placeholder:"Any","auto-columns":!0,onChange:s[1]||(s[1]=r=>e.$emit("update:filterArtist",e.selectedArtist))},{default:I(()=>[de,le,ue,pe,ce,me,(i(!0),o(k,null,M(e.featuredArtists,r=>(i(),o("option",{key:r.id,value:r.osuId},f(r.label),9,he))),128))]),_:1},8,["modelValue"])])}const ye=g(ae,[["render",fe]]),$e=b({components:{FilterBox:ee,ModeFilters:se,ArtistFilters:ye},computed:{...v(["loggedInUser"]),...v("quests",["filterMode","filterArtist"]),validRank(){return this.loggedInUser.rank>=1}},methods:{...T("quests",["updateFilterValue","updateFilterMode","updateFilterArtist","searchQuests"]),filterByMode(e){this.updateFilterMode(e),this.searchQuests()},filterByArtist(e){this.updateFilterArtist(e),this.searchQuests()}}}),be={class:"container card card-body py-3 mb-2"},ge=["disabled","data-bs-toggle","title","data-bs-target"],_e=t("i",{class:"fas fa-plus fa-xs"},null,-1);function qe(e,s,a,d,h,y){const l=u("mode-filters"),r=u("artist-filters"),n=u("filter-box");return i(),o("div",be,[p(n,{placeholder:"enter to search for quest...","onUpdate:filterValue":s[2]||(s[2]=$=>e.updateFilterValue($))},{filters:I(()=>[p(l,{"filter-mode":e.filterMode,"onUpdate:filterMode":s[0]||(s[0]=$=>e.filterByMode($))},null,8,["filter-mode"]),p(r,{"filter-artist":e.filterArtist,"onUpdate:filterArtist":s[1]||(s[1]=$=>e.filterByArtist($))},null,8,["filter-artist"])]),default:I(()=>[t("button",{class:"btn btn-primary",disabled:!e.validRank,"data-bs-toggle":e.validRank?"modal":"tooltip",title:e.validRank?"":"designing custom quests is available to tier 1+ users only","data-bs-target":e.validRank?"#submitQuest":""},[m(" Submit quest for approval "),_e],8,ge)]),_:1})])}const ve=g($e,[["render",qe]]),ke=b({components:{QuestCard:R},props:{status:{type:String,required:!0},quests:{type:Array,required:!0}},data(){return{collapsed:!1}},computed:{...v("quests",["isLoadingQuests","isFirstLoadDone"]),questCount(){return this.openQuests&&!this.isFirstLoadDone||!this.isLoadingQuests?this.quests.length.toString():"..."},openQuests(){return this.status==="Open"}},methods:{...T("quests",["searchQuests"]),showAll(){this.searchQuests(!0)}}}),Qe={class:"container card card-body my-2"},we=["href"],Pe=["id"],Ie={class:"col-sm"},Me={class:"text-center"},Ae=["disabled"],Le=t("i",{class:"fas fa-angle-down me-1"},null,-1),Ue=t("i",{class:"fas fa-angle-down ms-1"},null,-1);function Fe(e,s,a,d,h,y){const l=u("quest-card"),r=A("bs-tooltip");return i(),o("div",Qe,[t("h5",{class:Q(e.collapsed?"mb-0":"mb-2")},[t("a",{href:"#"+e.status,"data-bs-toggle":"collapse",onClick:s[0]||(s[0]=q(n=>e.collapsed=!e.collapsed,["prevent"]))},[m(f(e.status)+" quests ("+f(e.questCount)+") ",1),t("i",{class:Q(["fas",e.collapsed?"fa-angle-up":"fa-angle-down"])},null,2)],8,we)],2),t("div",{id:e.status,class:Q(["row show",{"loading-data":e.isLoadingQuests&&e.isFirstLoadDone}])},[t("div",Ie,[p(B,{name:"list",tag:"div"},{default:I(()=>[(i(!0),o(k,null,M(e.quests,n=>(i(),w(l,{key:n.id,quest:n},null,8,["quest"]))),128))]),_:1})]),t("div",Me,[_((i(),o("button",{class:"btn btn-sm btn-primary",type:"button",disabled:e.isLoadingQuests,onClick:s[1]||(s[1]=n=>e.showAll())},[Le,m(" show all quests "),Ue],8,Ae)),[[r,"this can take a few seconds. searching for a specific artist is probably better"]])])],10,Pe)])}const Ce=g(ke,[["render",Fe]]),De=b({name:"LeaderActions",props:{party:{type:Object,required:!0},status:{type:String,required:!0},quest:{type:Object,required:!0},price:{type:Number,required:!0}},data(){return{addUsername:"",dropdownUserId:""}},computed:{...v(["loggedInUser"]),enoughPoints(){let e=0;return this.party.members.forEach(s=>{s.availablePoints<this.price&&e++}),!(e&&this.loggedInUser.availablePoints<this.price*e)}},methods:{async togglePartyLock(e){const s=await this.$http.executePost(`/parties/${this.party.id}/toggleLock`,{},e);this.$http.isError(s)||this.$store.dispatch("quests/updateParty",s)},async addToParty(e){const s=await this.$http.executePost(`/parties/${this.party.id}/add`,{user:this.addUsername},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateParty",s),this.$store.dispatch("updateToastMessages",{message:"Added",type:"success"}))},async transferPartyLeader(e){if(!this.dropdownUserId){this.$store.dispatch("updateToastMessages",{message:"Select a member to transfer leadership!",type:"info"});return}const s=await this.$http.executePost(`/parties/${this.party.id}/transferLeadership`,{userId:this.dropdownUserId},e);this.$http.isError(s)||this.$store.dispatch("quests/updateParty",s)},async kickPartyMember(e){if(!this.dropdownUserId){this.$store.dispatch("updateToastMessages",{message:"Select a member to kick :(",type:"info"});return}if(confirm(`Are you sure? ${this.party.members.length==this.quest.minParty&&this.quest.status=="wip"?"This party has the minimum required members to run the quest, so kicking will cause the quest to be dropped.":""}`)){const s=await this.$http.executePost(`/parties/${this.party.id}/kick`,{userId:this.dropdownUserId},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateParty",s),this.quest.status=="wip"&&(s.members.length<this.quest.minParty||s.rank<this.quest.minRank)&&this.dropQuest(e))}},async extendDeadline(e){if(confirm(`Are you sure?

All members of your party will spend 10 points.

You have ${this.loggedInUser.availablePoints} points available.`)){const s=await this.$http.executePost(`/quests/${this.quest.id}/extendDeadline`,{},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateQuest",s.quest),this.$store.commit("setAvailablePoints",s.availablePoints))}},async dropQuest(e){if(confirm("Are you sure?")){const s=await this.$http.executePost(`/quests/${this.quest.id}/drop`,{},e);this.$http.isError(s)||(this.$bs.hideModal("editQuest"),this.$store.dispatch("quests/setQuests",s))}},async acceptQuest(e){const s=this.party.modes;let a="";for(let d=0;d<s.length;d++)a+=s[d],d<s.length-1&&(a+=", ");if(confirm(`Are you sure?

This quest will only allow beatmaps of these modes: ${a}

All members of your party will spend ${this.price} points. If any members of your party don't have enough points, your available points will be subtracted instead.

You have ${this.loggedInUser.availablePoints} points available.`)){const d=await this.$http.executePost(`/quests/${this.quest.id}/accept`,{},e);this.$http.isError(d)||(this.$store.dispatch("quests/setQuests",d.quests),this.$store.commit("setAvailablePoints",d.availablePoints),this.$bs.hideModal("editQuest"))}},async deleteParty(e){if(confirm("Are you sure?")){const s=await this.$http.executePost(`/parties/${this.party.id}/delete`,{},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateQuest",s),this.$bs.hideModal("editQuest"))}}}}),Oe={class:"row row-cols-md-auto g-2 align-items-center mb-3"},Te={class:"col-12"},Ee={class:"input-group input-group-sm"},Se={class:"col-12"},je={class:"input-group input-group-sm"},Ve=t("option",{value:"",disabled:""}," Select a member ",-1),Re=["value"],Be={class:"col-12"},We={class:"col-12"},Ne=t("i",{class:"fas fa-minus fa-xs"},null,-1),Ge={key:1,class:"col-12"},Je=t("i",{class:"fas fa-times fa-xs"},null,-1),ze={key:2,class:"col-12"},He=["disabled"];function Ke(e,s,a,d,h,y){const l=A("bs-tooltip");return i(),o("div",Oe,[t("div",Te,[t("div",Ee,[_(t("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>e.addUsername=r),class:"form-control",type:"text",placeholder:"username...",maxlength:"18",onKeyup:s[1]||(s[1]=N(r=>e.addToParty(r),["enter"]))},null,544),[[W,e.addUsername]]),_((i(),o("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=r=>e.addToParty(r))},[m(" Add ")])),[[l,"add user to party"]])])]),t("div",Se,[t("div",je,[_(t("select",{"onUpdate:modelValue":s[3]||(s[3]=r=>e.dropdownUserId=r),class:"form-select"},[Ve,(i(!0),o(k,null,M(e.party.members,r=>(i(),o(k,{key:r.id},[r.id!==e.loggedInUser.id?(i(),o("option",{key:0,value:r.id},f(r.username),9,Re)):c("",!0)],64))),128))],512),[[G,e.dropdownUserId]]),_((i(),o("button",{class:"btn btn-outline-info",onClick:s[4]||(s[4]=r=>e.transferPartyLeader(r))},[m(" Lead ")])),[[l,"change party leader"]]),_((i(),o("button",{class:"btn btn-outline-info",onClick:s[5]||(s[5]=r=>e.kickPartyMember(r))},[m(" Kick ")])),[[l,"kick party member"]])])]),e.status==="open"?(i(),o(k,{key:0},[t("div",Be,[t("button",{class:"btn btn-sm btn-outline-info w-100",onClick:s[6]||(s[6]=q(r=>e.togglePartyLock(r),["prevent"]))},[m(f(e.party.lock?"Unlock":"Lock")+" ",1),t("i",{class:Q(["fas",e.party.lock?"fa-unlock":"fa-lock"])},null,2)])]),t("div",We,[t("button",{class:"btn btn-sm btn-outline-danger w-100",onClick:s[7]||(s[7]=q(r=>e.deleteParty(r),["prevent"]))},[m(" Delete "),Ne])])],64)):c("",!0),e.status==="wip"?(i(),o("div",Ge,[t("button",{class:"btn btn-sm btn-outline-danger w-100",onClick:s[8]||(s[8]=q(r=>e.dropQuest(r),["prevent"]))},[m(" Drop quest "),Je])])):e.quest.status==="open"&&e.party.rank>=e.quest.minRank&&e.party.members.length>=e.quest.minParty&&e.party.members.length<=e.quest.maxParty?(i(),o("div",ze,[t("button",{class:"btn btn-sm btn-outline-success w-100",disabled:!e.enoughPoints,onClick:s[9]||(s[9]=q(r=>e.acceptQuest(r),["prevent"]))},[m(f(e.price?`Accept quest for ${e.price} ${e.price==1?"point":"points"} from each party member`:"Accept Quest")+" ",1),t("i",{class:Q(["fas small",e.price?"fa-coins":"fa-check"])},null,2)],8,He)])):c("",!0)])}const Ye=g(De,[["render",Ke]]);var P=(e=>(e.Open="open",e.WIP="wip",e.Done="done",e.Pending="pending",e.Rejected="rejected",e.Hidden="hidden",e.Scheduled="scheduled",e))(P||{});const U=b({props:{party:{type:Object,default:null},quest:{type:Object,default:null}},computed:{...v(["loggedInUser"]),isWip(){var e;return((e=this.quest)==null?void 0:e.status)==P.WIP},isOpen(){var e;return((e=this.quest)==null?void 0:e.status)==P.Open},isDone(){var e;return((e=this.quest)==null?void 0:e.status)==P.Done},isLeader(){var e;return((e=this.party)==null?void 0:e.leader.id)==this.loggedInUser.id}}}),Xe=b({mixins:[U],props:{party:{type:Object,required:!0}}}),Ze={class:"mx-1"},xe={key:0,class:"fas fa-lock fa-sm"},es={key:1,class:"fas fa-unlock fa-sm"};function ss(e,s,a,d,h,y){const l=A("bs-tooltip");return i(),o("span",Ze,[e.party.lock?_((i(),o("i",xe,null,512)),[[l,"party is locked"]]):_((i(),o("i",es,null,512)),[[l,"party is open"]])])}const ts=g(Xe,[["render",ss]]),is=b({name:"PartyTitle",components:{LockDetail:ts},mixins:[U],props:{party:{type:Object,required:!0},quest:{type:Object,required:!0},memberOfAnyParty:Boolean},computed:{...v(["loggedInUser"]),inCurrentParty(){return this.party.members.some(e=>e.id===this.loggedInUser.id)}},methods:{async joinParty(e){const s=await this.$http.executePost(`/parties/${this.party.id}/add`,{},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateParty",s),this.$store.dispatch("updateToastMessages",{message:"Joined party",type:"success"}))},async leaveParty(e){if(confirm(`Are you sure? ${this.party.members.length==this.quest.minParty&&this.isWip?"This party has the minimum required members to run the quest, so leaving will cause the quest to be dropped.":""}`)){const s=await this.$http.executePost(`/parties/${this.party.id}/leave`,{},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateParty",s),this.isWip&&(s.members.length<this.quest.minParty||s.rank<this.quest.minRank)&&this.dropQuest(e))}},async dropQuest(e){const s=await this.$http.executePost(`/quests/${this.quest.id}/drop`,{},e);this.$http.isError(s)||(this.$store.dispatch("quests/setQuests",s),this.$bs.hideModal("editQuest"))}}}),os={class:"row"},rs={class:"col-sm"},as={class:"d-inline-block"},ns=t("i",{class:"fas fa-user-plus fa-xs"},null,-1),ds=t("i",{class:"fas fa-user-minus fa-xs"},null,-1);function ls(e,s,a,d,h,y){const l=u("user-link"),r=u("lock-detail"),n=A("bs-tooltip");return i(),o("div",os,[t("div",rs,[t("h5",as,[p(l,{user:e.party.leader},null,8,["user"]),m("'s party ")]),e.party.rank>0?_((i(),o("i",{key:0,class:Q(["fas fa-crown fa-sm mx-1","text-rank-"+e.party.rank])},null,2)),[[n,`rank ${e.party.rank} party`]]):c("",!0),e.isOpen?(i(),w(r,{key:1,party:e.party},null,8,["party"])):c("",!0),e.loggedInUser.id!=e.party.leader.id?(i(),o(k,{key:2},[!e.memberOfAnyParty&&!e.party.lock&&e.isOpen?(i(),o("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:s[0]||(s[0]=q($=>e.joinParty($),["prevent"]))},[m(" Join "),ns])):c("",!0),e.inCurrentParty&&(e.isOpen||e.isWip)?(i(),o("button",{key:1,class:"btn btn-sm btn-outline-danger ms-1",onClick:s[1]||(s[1]=q($=>e.leaveParty($),["prevent"]))},[m(" Leave "),ds])):c("",!0)],64)):c("",!0)])])}const us=g(is,[["render",ls]]),ps=b({props:{quest:{type:Object,required:!0}},computed:{timeRemaining(){if(!this.quest.deadline)return 0;const e=new Date().getTime(),s=new Date(this.quest.deadline).getTime()-e;return Math.floor(s/(1e3*60*60*24))}}}),cs={class:"row"},ms={class:"col-sm"},hs={key:0,class:"ms-3"},fs={class:"text-secondary"},ys={key:1},$s={class:"ms-3"},bs={class:"text-secondary"},gs={class:"ms-3"};function _s(e,s,a,d,h,y){return i(),o("div",cs,[t("div",ms,[e.quest.status==="done"?(i(),o("div",hs,[m(" Completed: "),t("span",fs,f(e.quest.completed.toString().slice(0,10)),1)])):c("",!0),e.quest.status==="wip"?(i(),o("div",ys,[t("div",$s,[m(" Deadline: "),t("span",bs,f(e.quest.deadline.toString().slice(0,10)),1)]),t("div",gs,[m(" Time remaining: "),t("span",{class:Q(e.timeRemaining>0?"text-secondary":"text-danger")},f(e.timeRemaining)+" days",3)])])):c("",!0)])])}const qs=g(ps,[["render",_s]]),vs=b({props:{members:{type:Array,required:!0},price:{type:Number,required:!0},status:{type:String,required:!0}}}),ks={class:"ms-3 mt-1"},Qs={class:"mb-0"},ws={key:1,class:"text-danger"};function Ps(e,s,a,d,h,y){const l=u("user-link"),r=A("bs-tooltip");return i(),o("div",ks,[t("b",null," Members: ("+f(e.members.length)+") ",1),t("ul",Qs,[(i(!0),o(k,null,M(e.members,n=>(i(),o("li",{key:n.id},[p(l,{class:"me-1",user:n},null,8,["user"]),n.rank>0?_((i(),o("i",{key:0,class:Q(["fas fa-crown","text-rank-"+n.rank])},null,2)),[[r,`rank ${n.rank} user`]]):c("",!0),e.status=="open"&&n.availablePoints<e.price?(i(),o("span",ws,f(`(${n.availablePoints} points available)`),1)):c("",!0)]))),128))])])}const Is=g(vs,[["render",Ps]]),Ms=b({props:{members:{type:Array,required:!0},price:{type:Number,required:!0},partyId:{type:String,required:!0},leaderId:{type:String,required:!0}},computed:{...v(["loggedInUser"])},methods:{async addToParty(e){const s=await this.$http.executePost(`/parties/${this.partyId}/add`,{user:null},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateParty",s),this.$store.dispatch("updateToastMessages",{message:"Joined party",type:"success"}))},async removeFromPendingMembers(e,s){s.target.classList.add("fake-button-disable");const a=await this.$http.executePost(`/parties/${this.partyId}/removeFromPendingMembers`,{userId:e},s);this.$http.isError(a)||(this.$store.dispatch("quests/updateParty",a),this.$store.dispatch("updateToastMessages",{message:"Removed user from pending members",type:"success"})),s.target.classList.remove("fake-button-disable")}}}),As={class:"ms-3 mt-1"},Ls={class:"small text-secondary"},Us={class:"mb-0"},Fs=["onClick"],Cs=t("i",{class:"fas text-danger fa-times"},null,-1),Ds=[Cs],Os={key:2,class:"text-danger small"};function Ts(e,s,a,d,h,y){const l=u("user-link"),r=A("bs-tooltip");return i(),o("div",As,[t("b",null," Pending members: ("+f(e.members.length)+") ",1),t("div",Ls,f(e.members.length==1?"This user needs ":"These users need")+" to confirm before they're able to join the party. If you're the party leader, link this page to the "+f(e.members.length==1?"user ":"users")+" below! ",1),t("ul",Us,[(i(!0),o(k,null,M(e.members,n=>(i(),o("li",{key:n.id},[e.leaderId==e.loggedInUser.id?_((i(),o("a",{key:0,class:"me-1",href:"#",onClick:q($=>e.removeFromPendingMembers(n.id,$),["stop","prevent"])},Ds,8,Fs)),[[r,"remove user from pending members"]]):c("",!0),p(l,{class:"me-1",user:n},null,8,["user"]),n.rank>0?_((i(),o("i",{key:1,class:Q(["fas fa-crown","text-rank-"+n.rank])},null,2)),[[r,`rank ${n.rank} user`]]):c("",!0),n.availablePoints<e.price?(i(),o("span",Os,f(`${n.availablePoints} points available. If this user joins, available points will be taken from other party members`),1)):c("",!0),e.loggedInUser.id==n.id?(i(),o("button",{key:3,class:"btn btn-sm btn-outline-success ms-1",onClick:s[0]||(s[0]=$=>e.addToParty($))},[m(" Join quest "),t("i",{class:Q(["fas small",e.price?"fa-coins":"fa-check"])},null,2)])):c("",!0)]))),128))])])}const Es=g(Ms,[["render",Ts]]),Ss=b({components:{ModesIcons:J},props:{party:{type:Object,required:!0},questId:{type:String,required:!0}},methods:{async togglePartyMode(e){const s=await this.$http.executePost(`/parties/${this.party.id}/toggleMode`,{mode:e});this.$http.isError(s)||this.$store.dispatch("quests/updateParty",s)}}}),js={class:"ms-3 mt-1"},Vs=t("b",{class:"me-1"},"Modes:",-1);function Rs(e,s,a,d,h,y){var r;const l=u("modes-icons");return i(),o("div",js,[Vs,p(l,{modes:e.party.modes,toggler:e.party.leader.id==((r=e.$store.state.loggedInUser)==null?void 0:r.id),onToggle:s[0]||(s[0]=n=>e.togglePartyMode(n))},null,8,["modes","toggler"])])}const Bs=g(Ss,[["render",Rs]]),Ws=b({name:"PartyDetail",components:{LeaderActions:Ye,PartyTitle:us,QuestTiming:qs,MembersDetail:Is,PendingMembersDetail:Es,ModeDetail:Bs},mixins:[U],props:{party:{type:Object,default:null},quest:{type:Object,required:!0},memberOfAnyParty:Boolean},computed:{...v(["loggedInUser"])}}),Ns={class:"container card card-body mt-1"};function Gs(e,s,a,d,h,y){const l=u("leader-actions"),r=u("party-title"),n=u("quest-timing"),$=u("mode-detail"),L=u("members-detail"),F=u("pending-members-detail");return i(),o("div",Ns,[e.isOpen||e.isWip?(i(),o(k,{key:0},[e.party.leader.id==e.loggedInUser.id||e.loggedInUser.osuId==3178418?(i(),w(l,{key:0,party:e.party,status:e.quest.status,quest:e.quest,price:e.quest.price},null,8,["party","status","quest","price"])):c("",!0),p(r,{party:e.party,quest:e.quest,"member-of-any-party":e.memberOfAnyParty},null,8,["party","quest","member-of-any-party"])],64)):c("",!0),e.isDone||e.isWip?(i(),w(n,{key:1,quest:e.quest},null,8,["quest"])):c("",!0),e.isOpen?(i(),w($,{key:2,party:e.party,"quest-id":e.quest.id},null,8,["party","quest-id"])):c("",!0),p(L,{members:e.party.members,price:e.quest.price,status:e.quest.status},null,8,["members","price","status"]),e.party.pendingMembers&&e.party.pendingMembers.length&&!e.isDone?(i(),w(F,{key:3,members:e.party.pendingMembers,price:e.quest.price,"party-id":e.party.id,"leader-id":e.party.leader.id},null,8,["members","price","party-id","leader-id"])):c("",!0)])}const Js=g(Ws,[["render",Gs]]),zs=b({components:{PartyDetail:Js,AssociatedBeatmaps:oe},mixins:[U],props:{quest:{type:Object,required:!0},memberOfAnyParty:Boolean,collapse:Boolean},methods:{async createParty(e){const s=await this.$http.executePost("/parties/create",{questId:this.quest.id},e);this.$http.isError(s)||this.$store.dispatch("quests/updateQuest",s)}}}),Hs={class:"container"},Ks={key:0,class:"row"},Ys={class:"col"},Xs=t("i",{class:"fas fa-plus fa-xs"},null,-1),Zs={class:"col-sm-12"},xs={key:0,class:"col-sm-12 mt-2"};function et(e,s,a,d,h,y){const l=u("party-detail"),r=u("associated-beatmaps");return i(),o("div",Hs,[e.isOpen&&!e.memberOfAnyParty?(i(),o("div",Ks,[t("div",Ys,[t("button",{class:"btn btn-sm w-100 btn-outline-info mb-2",onClick:s[0]||(s[0]=q(n=>e.createParty(n),["prevent"]))},[m(" Add party "),Xs])])])):c("",!0),(i(!0),o(k,null,M(e.quest.parties,n=>(i(),o("div",{key:n.id,class:"row"},[t("div",Zs,[p(l,{party:n,quest:e.quest,"member-of-any-party":e.memberOfAnyParty},null,8,["party","quest","member-of-any-party"])]),e.isDone||e.isWip?(i(),o("div",xs,[p(r,{"associated-maps":e.quest.associatedMaps},null,8,["associated-maps"])])):c("",!0)]))),128))])}const st=g(zs,[["render",et]]),tt=b({name:"ExpirationDate",props:{isExpired:{type:Boolean,required:!0},expiration:{type:Date,required:!0}}}),it={class:"small"},ot={class:"text-secondary"};function rt(e,s,a,d,h,y){return i(),o("div",it,[m(" Quest "+f(e.isExpired?"expired":"expires")+": ",1),t("span",ot,f(e.expiration.toLocaleDateString()),1)])}const at=g(tt,[["render",rt]]),nt=b({name:"ReopenQuest",props:{questId:{type:String,required:!0},status:{type:String,required:!0},price:{type:Number,required:!0}},computed:{...v(["loggedInUser"]),enoughPoints(){return this.loggedInUser.availablePoints-this.price>0}},methods:{async reopenQuest(e){if(confirm(`Are you sure?

You are about to spend ${this.price} Mappers' Guild points to re-open this quest.

You have ${this.loggedInUser.availablePoints} points available.`)){const s=await this.$http.executePost(`/quests/${this.questId}/reopen`,{status:this.status},e);this.$http.isError(s)||(this.$store.dispatch("quests/setQuests",s.quests),this.$store.commit("setAvailablePoints",s.availablePoints),this.$bs.hideModal("editQuest"))}}}}),dt={class:"row"},lt={class:"col-sm-12"},ut=["disabled"],pt=t("i",{class:"fas fa-coins fa-xs"},null,-1);function ct(e,s,a,d,h,y){return i(),o("div",dt,[t("div",lt,[t("button",{class:"btn btn-sm w-100 btn-outline-success mb-2",disabled:!e.enoughPoints,onClick:s[0]||(s[0]=q(l=>e.reopenQuest(l),["prevent"]))},[m(" Re-open quest for "+f(e.price)+" points ",1),pt],8,ut)])])}const mt=g(nt,[["render",ct]]),ht=b({name:"QuestInfoModal",components:{QuestSize:z,QuestPrice:H,QuestTime:K,QuestModes:Y,PartyInfo:st,ModalDialog:re,ExpirationDate:at,ReopenQuest:mt},computed:{...v(["loggedInUser"]),...E("quests",["selectedQuest"]),memberOfAnyParty(){return this.selectedQuest.parties.some(e=>e.members.some(s=>s.id===this.loggedInUser.id))},headerClass(){var e;return(e=this.selectedQuest)!=null&&e.creator?this.selectedQuest.creator.username=="pishifat"?"bg-warning":"bg-primary":""}}});const ft=e=>(X("data-v-401d6d51"),e=e(),Z(),e),yt=["href"],$t={key:0},bt={key:1,class:"small"},gt=["href"],_t={class:"container"},qt={class:"row"},vt={class:"col-sm-12 text-center"},kt={key:0},Qt=["href"],wt=["src"],Pt={key:1},It=["src"],Mt={class:"row mb-3 text-center"},At={class:"col-sm-12"},Lt={class:"col-sm-12 text-secondary"},Ut={class:"row justify-content-center text-center"},Ft={class:"col-sm-12"},Ct={class:"col-sm-6 col-lg-2"},Dt={class:"col-sm-6 col-lg-2"},Ot={class:"col-sm-6 col-lg-4"},Tt={key:0,class:"col-sm-6 col-lg-3"},Et=ft(()=>t("div",{class:"radial-divisor"},null,-1));function St(e,s,a,d,h,y){const l=u("user-link"),r=u("quest-size"),n=u("quest-price"),$=u("quest-time"),L=u("quest-modes"),F=u("expiration-date"),S=u("reopen-quest"),j=u("party-info"),V=u("modal-dialog");return i(),w(V,{id:"editQuest","header-class":e.headerClass,loaded:Boolean(e.selectedQuest)},{header:I(()=>[t("a",{href:`/quests?id=${e.selectedQuest.id}`,target:"_blank",class:"text-dark"},f(e.selectedQuest.name),9,yt),e.selectedQuest.creator.username!="pishifat"?(i(),o("span",$t,[m(" created by "),p(l,{class:"text-dark",user:e.selectedQuest.creator},null,8,["user"])])):c("",!0),e.selectedQuest.art?(i(),o("div",bt,[t("a",{href:"https://osu.ppy.sh/beatmaps/artists/"+e.selectedQuest.art,target:"_blank"}," View featured artist listing ",8,gt)])):c("",!0)]),default:I(()=>[t("div",_t,[t("div",qt,[t("div",vt,[e.selectedQuest.art?(i(),o("span",kt,[t("a",{href:"https://osu.ppy.sh/beatmaps/artists/"+e.selectedQuest.art,target:"_blank"},[t("img",{src:"https://assets.ppy.sh/artists/"+e.selectedQuest.art+"/cover.jpg",class:"card-avatar-img-modal"},null,8,wt)],8,Qt)])):(i(),o("span",Pt,[t("img",{src:e.selectedQuest.isMbc?"/images/mbc-icon.png":"/images/no-art-icon.png",class:"card-avatar-img-modal"},null,8,It)]))])]),t("div",Mt,[t("div",At,[t("h5",null,f(e.selectedQuest.name),1)]),t("div",Lt,f(e.selectedQuest.descriptionMain),1)]),t("div",Ut,[t("div",Ft,[p(r,{quest:e.selectedQuest},null,8,["quest"])]),t("div",Ct,[p(n,{price:e.selectedQuest.price},null,8,["price"])]),t("div",Dt,[p($,{timeframe:e.selectedQuest.timeframe},null,8,["timeframe"])]),t("div",Ot,[p(L,{status:e.selectedQuest.status,modes:e.selectedQuest.modes},null,8,["status","modes"])]),e.selectedQuest.expiration?(i(),o("div",Tt,[p(F,{"is-expired":e.selectedQuest.isExpired,expiration:new Date(e.selectedQuest.expiration)},null,8,["is-expired","expiration"])])):c("",!0)]),Et,e.selectedQuest.isExpired?(i(),w(S,{key:0,"quest-id":e.selectedQuest.id,status:e.selectedQuest.status,price:e.selectedQuest.reopenPrice},null,8,["quest-id","status","price"])):(i(),w(j,{key:1,quest:e.selectedQuest,"member-of-any-party":e.memberOfAnyParty},null,8,["quest","member-of-any-party"]))])]),_:1},8,["header-class","loaded"])}const jt=g(ht,[["render",St],["__scopeId","data-v-401d6d51"]]),Vt=b({name:"QuestInformation",components:{ExampleQuest:x},computed:{...v("quests",["exampleQuest"])}}),Rt={class:"container card card-body py-3 mb-2"},Bt=t("i",{class:"fas fa-angle-down"},null,-1),Wt={id:"questInformation",class:"collapse ms-4"},Nt=t("div",{class:"small text-secondary"}," Quests reward mappers for following certain requirements when creating their Featured Artist maps. Most quests involve creating and ranking a certain number of beatmaps for a specific Featured Artist, and new quests are added weekly. ",-1),Gt=t("hr",null,null,-1),Jt=t("div",{class:"small text-secondary mt-2"}," To begin a quest, a party must claim it. Only one party can run a quest per mode. ",-1),zt=t("div",{class:"small text-secondary mt-2"}," If a quest is not claimed within 90 days, it expires. To re-open an expired quest, a user must spend some of their available points. ",-1),Ht=t("div",{class:"small text-secondary mt-2"}," Here's a breakdown of this example quest: ",-1),Kt=t("i",{class:"fas fa-angle-down"},null,-1),Yt=t("div",{id:"questRewards",class:"collapse ms-4 small text-secondary"},[t("ul",null,[t("li",null,[t("b",null,"7 points"),m(" if a quest is completed on time.")]),t("li",null,[t("b",null,"+2 bonus points per difficulty on a ranked beatmap."),m(" This scales with length, so longer maps earn more points.")]),t("li",null,"If a beatmap is ranked after the quest's deadline, bonus points are adjusted as follows:"),t("ul",null,[t("li",null,"1.5 points for 0-20 days late"),t("li",null,"1 point for 21-40 days late"),t("li",null,"0.5 points for 40+ days late")])])],-1);function Xt(e,s,a,d,h,y){const l=u("example-quest");return i(),o("div",Rt,[t("a",{href:"#questInformation","data-bs-toggle":"collapse",onClick:s[0]||(s[0]=q(()=>{},["prevent"]))},[m(" How do quests work? "),Bt]),t("div",Wt,[Nt,Gt,Jt,zt,Ht,p(l,{quest:e.exampleQuest},null,8,["quest"])]),t("a",{href:"#questRewards","data-bs-toggle":"collapse",onClick:s[1]||(s[1]=q(()=>{},["prevent"]))},[m(" What are the rewards for completing a quest? "),Kt]),Yt])}const Zt=g(Vt,[["render",Xt]]),xt={updateQuest({commit:e},s){e("updateQuest",s)},updateParty({commit:e},s){e("updateParty",s)},setQuests({commit:e},s){e("setQuests",s)},updateFilterValue({commit:e},s){e("setFilterValue",s)},updateFilterMode({commit:e},s){e("setFilterMode",s)},updateFilterArtist({commit:e},s){e("setFilterArtist",s)},async loadQuests({commit:e,rootState:s},a){var l;const d=(l=s.loggedInUser)==null?void 0:l.mainMode;let h=`/quests/search?mode=${d}&limit=${100}`;a&&(h+=`&id=${a}`);const y=await C.initialRequest(h);D(y)||(e("setQuests",y),e("setFilterMode",d),e("setIsLoadingQuests",!1),a&&e("setSelectedQuestId",a))},async searchQuests({commit:e,state:s},a){e("setIsLoadingQuests",!0);let d=100;a&&(d=1e4,e("setFilterArtist",""));const h=await C.executeGet(`/quests/search?mode=${s.filterMode}&artist=${s.filterArtist}&limit=${d}`);D(h)||e("setQuests",h),e("setIsLoadingQuests",!1)}},ei={namespaced:!0,state:{quests:[],exampleQuest:null,filterValue:"",filterMode:O.any,filterArtist:"",isLoadingQuests:!0,selectedQuestId:null,isFirstLoadDone:!1},mutations:{setFirstLoadDone(e){e.isFirstLoadDone=!0},setQuests(e,s){e.quests=s},setFilterValue(e,s){e.filterValue=s},setFilterMode(e,s){e.filterMode=s},setFilterArtist(e,s){e.filterArtist=s},setExampleQuest(e,s){e.exampleQuest=s},setIsLoadingQuests(e,s){e.isLoadingQuests=s},setSelectedQuestId(e,s){e.selectedQuestId=s},updateQuest(e,s){const a=e.quests.findIndex(d=>d.id===s.id);a!==-1&&(e.quests[a]=s)},updateParty(e,s){const a=e.quests.findIndex(d=>d.id===e.selectedQuestId);if(a!==-1){const d=e.quests[a].parties.findIndex(h=>h.id===s.id);d!==-1&&(e.quests[a].parties[d]=s)}}},getters:{selectedQuest:e=>{if(e.selectedQuestId)return e.quests.find(s=>s.id===e.selectedQuestId)},filteredQuests:e=>{let s=e.quests;if(e.filterMode!==O.any){const a=e.filterMode;s=s.filter(d=>d.modes.includes(a))}return e.filterValue.length>2&&(s=s.filter(a=>a.name.toLowerCase().includes(e.filterValue.toLowerCase()))),s},openQuests:(e,s)=>s.filteredQuests.filter(a=>a.status==P.Open),wipQuests:(e,s)=>s.filteredQuests.filter(a=>a.status==P.WIP),completeQuests:(e,s)=>s.filteredQuests.filter(a=>a.status==P.Done)},actions:xt},si=ei,ti=b({name:"QuestPage",components:{QuestPageFilters:ve,StatusQuests:Ce,SubmitQuestModal:ie,QuestInfoModal:jt,QuestInformation:Zt},computed:{...v("quests",["isFirstLoadDone","isLoadingQuests","exampleQuest"]),...E("quests",["openQuests","wipQuests","completeQuests","expiredQuests"])},beforeCreate(){this.$store.hasModule("quests")||this.$store.registerModule("quests",si)},async created(){const e=this.$route.query.id;await this.$store.dispatch("quests/loadQuests",e),e&&this.$bs.showModal("editQuest"),this.$store.commit("quests/setFirstLoadDone");const s=await this.$http.executeGet("/exampleQuest");this.$http.isError(s)||this.$store.commit("quests/setExampleQuest",s)}}),ii=t("div",{class:"radial-divisor"},null,-1),oi=t("div",{class:"radial-divisor"},null,-1);function ri(e,s,a,d,h,y){const l=u("quest-page-filters"),r=u("quest-information"),n=u("status-quests"),$=u("submit-quest-modal"),L=u("quest-info-modal");return i(),o("div",null,[p(l),p(r),p(n,{status:"Open",quests:e.openQuests},null,8,["quests"]),ii,p(n,{status:"Work-in-progress",quests:e.wipQuests},null,8,["quests"]),oi,p(n,{status:"Complete",quests:e.completeQuests},null,8,["quests"]),p($),p(L)])}const mi=g(ti,[["render",ri]]);export{mi as default};
