import{d as w,B as f,_ as B,o as t,e as a,a as o,b as u,v as g,F as b,r as y,t as I,k as l,f as E,g as D,j as U,y as p,q as M,M as H,m as P,i as C,w as N,n as V,c as Q,T as R,p as v,s as j,u as W}from"./index-8b67c3af.js";import{T as A,S as $}from"./task-21eeb954.js";const q=w({name:"NewTask",props:{isHost:Boolean,taskToAddCollaborator:{type:Object,default:null},beatmap:{type:Object,required:!0},isAdmin:Boolean},emits:["update:taskToAddCollaborator"],data(){return{selectedTask:A.Easy,selectedMode:f.Osu,addTaskUsername:""}},computed:{remainingTasks(){let s=$;return this.beatmap.tasksLocked&&this.beatmap.tasksLocked.length&&!this.isHost&&(s=$.filter(e=>!this.beatmap.tasksLocked.includes(e))),this.beatmap.mode==f.Taiko&&(s=s.filter(e=>e!==A.Hitsounds)),s}},methods:{async addTask(s){let e;this.beatmap.mode==f.Hybrid?e=this.selectedMode:e=this.beatmap.mode;const d=await this.$http.executePost("/beatmaps/addTask/"+this.beatmap.id,{user:this.addTaskUsername,taskName:this.selectedTask,username:this.addTaskUsername,mode:e},s);this.isAdmin?this.$store.commit("updateBeatmap",d):this.$store.dispatch("beatmaps/updateBeatmap",d)},async addCollab(s){let e;this.beatmap.mode==f.Hybrid?e=this.taskToAddCollaborator.mode:e=this.beatmap.mode;const d=await this.$http.executePost("/beatmaps/addCollab/"+this.beatmap.id,{user:this.addTaskUsername,task:this.taskToAddCollaborator,mode:e},s);this.$http.isError(d)||(this.isAdmin?this.$store.commit("updateBeatmap",d):(this.$store.dispatch("beatmaps/updateBeatmap",d),this.$store.dispatch("updateToastMessages",{message:"Added",type:"success"})))}}}),F={key:0,class:"row mt-2 mb-3"},K={class:"col-sm-12"},z={class:"input-group input-group-sm mx-auto"},G=["value"],J=o("option",{value:"osu"}," osu! ",-1),X=o("option",{value:"taiko"}," osu!taiko ",-1),Y=o("option",{value:"catch"}," osu!catch ",-1),Z=o("option",{value:"mania"}," osu!mania ",-1),x=[J,X,Y,Z],ss=o("i",{class:"fas fa-plus"},null,-1),es=[ss],ts={key:0,class:"col-sm-12 mt-1 text-center"},as=o("i",{class:"fas fa-times-circle"},null,-1),os=[as];function is(s,e,d,r,k,O){const T=M("bs-tooltip");return s.beatmap.status=="WIP"&&s.remainingTasks.length||s.isAdmin?(t(),a("div",F,[o("div",K,[o("div",z,[s.taskToAddCollaborator?l("",!0):u((t(),a("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=n=>s.selectedTask=n),class:"form-select"},[(t(!0),a(b,null,y(s.remainingTasks,n=>(t(),a("option",{key:n,value:n},I(n),9,G))),128))],512)),[[g,s.selectedTask]]),s.beatmap.mode=="hybrid"&&!s.taskToAddCollaborator?u((t(),a("select",{key:1,"onUpdate:modelValue":e[1]||(e[1]=n=>s.selectedMode=n),class:"form-select"},x,512)),[[g,s.selectedMode]]):l("",!0),s.isHost||s.taskToAddCollaborator?u((t(),a("input",{key:2,"onUpdate:modelValue":e[2]||(e[2]=n=>s.addTaskUsername=n),class:"form-control",type:"text",placeholder:"add user to task...",maxlength:"18",onKeyup:e[3]||(e[3]=D(n=>s.taskToAddCollaborator?s.addCollab(n):s.addTask(n),["enter"]))},null,544)),[[E,s.addTaskUsername]]):l("",!0),u((t(),a("button",{class:"btn btn-outline-info",onClick:e[4]||(e[4]=n=>s.taskToAddCollaborator?s.addCollab(n):s.addTask(n))},es)),[[T,"add difficulty"]])])]),s.taskToAddCollaborator?(t(),a("div",ts,[o("small",null,[U(" Adding collaborator for the selected difficulty "),o("a",{class:"text-danger",href:"#",onClick:e[5]||(e[5]=p(n=>s.$emit("update:taskToAddCollaborator",null),["prevent"]))},os)])])):l("",!0)])):l("",!0)}const ds=B(q,[["render",is]]),ns=w({name:"TasksChoice",components:{NewTask:ds,ModesIcons:H},props:{beatmap:{type:Object,required:!0},isHost:Boolean,isRanked:Boolean,isQualified:Boolean,isAdmin:Boolean},data(){return{taskToAddCollaborator:void 0}},computed:{...P(["loggedInUser"]),sortedTasks(){const s=$,e=["osu","taiko","catch","mania","hs","sb"];return[...this.beatmap.tasks].sort(function(r,k){return s.indexOf(r.name)-s.indexOf(k.name)}).sort(function(r,k){return e.indexOf(r.mode)-e.indexOf(k.mode)})}},methods:{isOwner(s){return s.some(e=>e.osuId==this.loggedInUser.osuId)},canEditTask(s){return this.isOwner(s.mappers)||this.isHost},async setTaskStatus(s,e,d){d.target.classList.add("fake-button-disable");const r=await this.$http.executePost("/beatmaps/setTaskStatus/"+s,{status:e});this.$http.isError(r)||(this.isAdmin?this.$store.commit("updateBeatmap",r):this.$store.dispatch("beatmaps/updateBeatmap",r)),d.target.classList.remove("fake-button-disable")},async removeTask(s,e){e.target.classList.add("fake-button-disable");const d=await this.$http.executePost(`/beatmaps/removeTask/${s}/${this.beatmap.id}`);this.isAdmin?this.$store.commit("updateBeatmap",d):this.$store.dispatch("beatmaps/updateBeatmap",d),e.target.classList.remove("fake-button-disable")},canEditTaskCollaborators(s){return s.status!="Done"&&!this.isQualified&&this.beatmap.status!="Done"&&this.canEditTask(s)},async removeCollab(s,e,d){d.target.classList.add("fake-button-disable");const r=await this.$http.executePost("/beatmaps/task/"+s+"/removeCollab",{user:e});this.isAdmin?this.$store.commit("updateBeatmap",r):this.$store.dispatch("beatmaps/updateBeatmap",r),d.target.classList.remove("fake-button-disable")},isAddingCollaborator(s){var e;return((e=this.taskToAddCollaborator)==null?void 0:e.id)==s.id}}});const c=s=>(j("data-v-e6451ffd"),s=s(),W(),s),ls={class:"row"},rs={class:"col-sm-12"},ms={class:"table table-sm"},us=c(()=>o("th",null,"Difficulty",-1)),cs=c(()=>o("th",null,"Mapper(s)",-1)),ps={key:0},hs=["id"],ks=c(()=>o("i",{class:"fas fa-times"},null,-1)),bs=[ks],fs=["onClick"],Ts=c(()=>o("i",{class:"fas fa-plus"},null,-1)),_s=[Ts],Cs=["onClick"],vs=c(()=>o("i",{class:"fas fa-minus"},null,-1)),ys=[vs],$s={key:0},gs=["onClick"],As=c(()=>o("i",{class:"fas fa-minus"},null,-1)),ws=[As],Bs=["onClick"],Is=c(()=>o("i",{class:"fas fa-check"},null,-1)),Us=[Is],Ms=["onClick"],Os=c(()=>o("i",{class:"fas fa-ellipsis-h"},null,-1)),Ss=[Os],Ls={key:0,class:"col-sm-12 mt-2"};function Es(s,e,d,r,k,O){const T=v("modes-icons"),n=v("user-link"),S=v("new-task"),h=M("bs-tooltip");return t(),a("div",ls,[o("div",rs,[o("table",ms,[o("thead",null,[o("tr",null,[us,cs,!s.isRanked&&!s.isQualified?(t(),a("th",ps)):l("",!0)])]),C(R,{tag:"tbody",name:"list"},{default:N(()=>[(t(!0),a(b,null,y(s.sortedTasks,i=>(t(),a("tr",{id:i.id+"Row",key:i.id},[o("td",{class:V(["text-secondary",`card-status-${i.status.toLowerCase()}`])},[U(I(i.name)+" ",1),s.beatmap.mode=="hybrid"?(t(),Q(T,{key:0,modes:[i.mode],color:"secondary"},null,8,["modes"])):l("",!0)],2),o("td",null,[(t(!0),a(b,null,y(i.mappers,(m,L)=>(t(),a("div",{key:m.id},[L==0&&s.canEditTaskCollaborators(i)?(t(),a(b,{key:0},[s.isAddingCollaborator(i)?u((t(),a("a",{key:0,href:"#",class:"text-danger",onClick:e[0]||(e[0]=p(_=>s.taskToAddCollaborator=void 0,["prevent"]))},bs)),[[h,"cancel"]]):u((t(),a("a",{key:1,href:"#",class:"text-success",onClick:p(_=>s.taskToAddCollaborator=i,["prevent"])},_s,8,fs)),[[h,"add new collaborator"]])],64)):l("",!0),C(n,{class:"mx-1",user:m},null,8,["user"]),i.mappers.length>1&&s.canEditTaskCollaborators(i)&&m.osuId!=s.loggedInUser.osuId?u((t(),a("a",{key:1,href:"#",class:"text-danger",onClick:p(_=>s.removeCollab(i.id,m.id,_),["prevent"])},ys,8,Cs)),[[h,"remove collaborator"]]):l("",!0)]))),128))]),!s.isRanked&&!s.isQualified?(t(),a("td",$s,[s.canEditTask(i)?(t(),a(b,{key:0},[u((t(),a("a",{href:"#",class:"text-danger me-1",onClick:p(m=>s.removeTask(i.id,m),["prevent"])},ws,8,gs)),[[h,"delete"]]),i.status=="WIP"?u((t(),a("a",{key:0,href:"#",class:"text-success me-1",onClick:p(m=>s.setTaskStatus(i.id,"Done",m),["prevent"])},Us,8,Bs)),[[h,"mark as done"]]):l("",!0),i.status=="Done"&&s.beatmap.status!="Done"?u((t(),a("a",{key:1,href:"#",class:"text-wip me-1",onClick:p(m=>s.setTaskStatus(i.id,"WIP",m),["prevent"])},Ss,8,Ms)),[[h,"mark as WIP"]]):l("",!0)],64)):l("",!0)])):l("",!0)],8,hs))),128))]),_:1})])]),!s.isRanked&&!s.isQualified?(t(),a("div",Ls,[C(S,{"task-to-add-collaborator":s.taskToAddCollaborator,"onUpdate:taskToAddCollaborator":e[1]||(e[1]=i=>s.taskToAddCollaborator=i),beatmap:s.beatmap,"is-host":s.isHost,"is-admin":s.isAdmin},null,8,["task-to-add-collaborator","beatmap","is-host","is-admin"])])):l("",!0)])}const Ps=B(ns,[["render",Es],["__scopeId","data-v-e6451ffd"]]);export{Ps as T};
