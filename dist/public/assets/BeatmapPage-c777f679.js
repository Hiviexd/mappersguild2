import{d as v,M as Q,m as A,_ as w,o as a,c as M,w as P,r as h,a as t,b as f,v as S,e as o,f as B,t as b,F as y,g as V,h as F,i as ne,j as _,k as $,l as u,n as C,T as j,p as le,q as L,s as R,u as W,x as de,y as I,B as E,z as G,A as Z,C as x,D as X,E as re}from"./index-819a2491.js";import{M as ee}from"./ModalDialog-e3afe390.js";import{U as K}from"./UserLinkList-871fe7c7.js";import{F as ue}from"./FilterBox-7881f415.js";import{M as pe,F as J}from"./extras-7d9ec9bb.js";import{T as q,a as N}from"./task-0811ab65.js";const ce=v({name:"CreateBeatmapModal",components:{ModalDialog:ee,UserLinkList:K,ModesIcons:Q},data(){return{featuredArtists:[],featuredSongs:[],selectedArtist:"",artistInput:"",selectedSong:"",selectedMode:"osu",selectedTaskStatus:"",previousSelectedMode:"",selectedTaskMode:"osu",checkedLocks:[],modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}],tasks:["Easy","Normal","Hard","Insane","Expert","Storyboard"],newTaskName:"",newTaskMapper:"",tempTasks:[]}},computed:{...A(["loggedInUser"]),sortedTasks(){const e=["Easy","Normal","Hard","Insane","Expert","Storyboard"],s=["osu","taiko","catch","mania","sb"];return[...this.tempTasks].sort(function(d,p){return e.indexOf(d.name)-e.indexOf(p.name)}).sort(function(d,p){return s.indexOf(d.mode)-s.indexOf(p.mode)})}},watch:{selectedMode(){this.selectedMode=="hybrid"&&(this.tempTasks=[]),this.previousSelectedMode=="hybrid"&&(this.tempTasks=[]),this.previousSelectedMode=this.selectedMode}},async created(){const e=await this.$http.executeGet("/featuredArtists");e&&(this.featuredArtists=e.sort((s,i)=>s.label.toLowerCase()>i.label.toLowerCase()?1:i.label.toLowerCase()>s.label.toLowerCase()?-1:0))},methods:{async setArtist(e){if(!this.selectedArtist&&!this.artistInput){this.$store.dispatch("updateToastMessages",{message:"Select or type an artist!",type:"danger"});return}if(this.artistInput){const i=this.featuredArtists.find(d=>d.label.toLowerCase().includes(this.artistInput.toLowerCase()));i&&(this.selectedArtist=i.id)}if(!this.selectedArtist){this.$store.dispatch("updateToastMessages",{message:"Couldn't find artist! Check your typing or select one from the list.",type:"danger"});return}e.target.disabled=!0;const s=await this.$http.executeGet(`/featuredArtists/${this.selectedArtist}/songs`);s&&(this.featuredSongs=s.sort((i,d)=>i.title.toLowerCase()>d.title.toLowerCase()?1:d.title.toLowerCase()>i.title.toLowerCase()?-1:0)),e.target.disabled=!1},async addTempTask(e){if(!this.newTaskName.length||!this.selectedTaskStatus.length){this.$store.dispatch("updateToastMessages",{message:"Missing task or status",type:"danger"});return}const s=await this.$http.executeGet(`/beatmaps/validateUsers/${this.newTaskMapper.length?this.newTaskMapper:this.loggedInUser.username}`,e);s&&s.length&&this.tempTasks.push({name:this.newTaskName,mappers:s,mode:this.selectedTaskMode,status:this.selectedTaskStatus,random:Math.random().toString()})},removeTempTask(e){const s=this.tempTasks.findIndex(i=>i.random==e);this.tempTasks.splice(s,1)},async saveNewMap(e){if(!this.selectedSong){this.$store.dispatch("updateToastMessages",{message:"Select a song!",type:"info"});return}const s=await this.$http.executePost("/beatmaps/create/",{song:this.selectedSong,tasks:this.tempTasks,tasksLocked:this.checkedLocks,mode:this.selectedMode},e);this.$http.isError(s)||(this.$bs.hideModal("addBeatmap"),this.$store.commit("beatmaps/addBeatmap",s))}}});const g=e=>(R("data-v-7905d199"),e=e(),W(),e),me={class:"container"},he={class:"mb-3 row"},be=g(()=>t("div",{class:"col-lg-1"},[t("p",{style:{"margin-top":"3px"}}," Artist: ")],-1)),fe={class:"col-lg-11"},_e={id:"artistForm",class:"input-group input-group-sm mb-3"},ke=g(()=>t("option",{value:""}," Select an artist ",-1)),$e=g(()=>t("option",{value:"-",disabled:""}," --- ",-1)),ge=["value"],ye=g(()=>t("div",{class:"col-lg-1"},[t("p",{style:{"margin-top":"3px"}}," Song: ")],-1)),ve={class:"col-lg-11"},Be=["disabled"],we=g(()=>t("option",{value:"",disabled:""}," Select an artist to view songs ",-1)),Te=g(()=>t("option",{value:"-",disabled:""}," --- ",-1)),Ce=["value"],Ie=g(()=>t("hr",null,null,-1)),Me=g(()=>t("p",null," Game-mode: ",-1)),Le={class:"mb-3 row"},Se={class:"col-sm-10"},Pe=["id","value"],Ae=["for"],Oe=g(()=>t("br",null,null,-1)),qe=g(()=>t("hr",null,null,-1)),Ue=g(()=>t("div",{class:"mb-2"},[$(" Set your mapset's difficulties "),t("div",{class:"small text-secondary"}," These can be changed later. ")],-1)),Ee={key:0,class:"table table-sm"},Qe=g(()=>t("thead",null,[t("tr",null,[t("th",null,"Difficulty"),t("th",null,"Mapper(s)"),t("th",null,"Status"),t("th")])],-1)),De={class:"text-secondary"},Ve=["onClick"],Fe=g(()=>t("i",{class:"fas fa-times"},null,-1)),Ne=[Fe],je={class:"col-sm-12"},He={class:"input-group input-group-sm mx-auto"},Ge=g(()=>t("option",{value:"",disabled:"",selected:""}," Select a task ",-1)),Re=["value"],We=g(()=>t("option",{value:"osu"}," osu! ",-1)),Ke=g(()=>t("option",{value:"taiko"}," osu!taiko ",-1)),ze=g(()=>t("option",{value:"catch"}," osu!catch ",-1)),Ye=g(()=>t("option",{value:"mania"}," osu!mania ",-1)),Xe=[We,Ke,ze,Ye],Je=g(()=>t("option",{value:"",disabled:"",selected:""}," Select a status ",-1)),Ze=g(()=>t("option",{value:"WIP"}," Work-in-progress ",-1)),xe=g(()=>t("option",{value:"Done"}," Done ",-1)),es=[Je,Ze,xe],ss=g(()=>t("i",{class:"fas fa-plus"},null,-1)),ts=[ss],as=g(()=>t("div",{class:"text-secondary small mt-1"},[t("ul",{class:"small"},[t("li",null,'You can leave the "mapper" field empty for your own difficulties.'),t("li",null,'Use comma separation for collabs, like "mapper1, mapper2"')])],-1)),os=g(()=>t("hr",null,null,-1)),is=g(()=>t("div",{class:"mb-2"},[$(" Set any difficulties that nobody else is allowed to claim. "),t("div",{class:"small text-secondary"}," For example, if you don't want any guest difficulties, you should select all. These can be changed later. ")],-1)),ns={class:"mb-3 row"},ls={class:"col-sm-10"},ds=["id","value"],rs=["for"],us=g(()=>t("div",{class:"radial-divisor"},null,-1)),ps={class:"small text-secondary mt-2"},cs={class:"small"},ms=g(()=>t("i",null,"after",-1)),hs=g(()=>t("li",null,[$("Your beatmap was ranked "),t("i",null,"after"),$(" the Featured Artist was announced, excluding maps created for the announcement")],-1)),bs=g(()=>t("li",null,"Difficulties match between Mappers' Guild and osu! website (including difficulty levels and mappers)",-1));function fs(e,s,i,d,p,m){const r=h("modes-icons"),n=h("user-link-list"),c=h("modal-dialog"),k=L("bs-tooltip");return a(),M(c,{id:"addBeatmap",title:"Add beatmap"},{default:P(()=>[t("div",me,[t("div",he,[be,t("div",fe,[t("div",_e,[f(t("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>e.selectedArtist=l),class:"form-select"},[ke,$e,(a(!0),o(y,null,B(e.featuredArtists,l=>(a(),o("option",{key:l.id,value:l.id},b(l.label),9,ge))),128))],512),[[S,e.selectedArtist]]),f(t("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>e.artistInput=l),type:"text",class:"form-control",placeholder:"or input the artist's name...",onKeyup:s[2]||(s[2]=F(l=>e.setArtist(l),["enter"]))},null,544),[[V,e.artistInput]]),t("button",{id:"artistButton",class:"btn btn-outline-info",onClick:s[3]||(s[3]=l=>e.setArtist(l))}," Load songs ")])]),ye,t("div",ve,[f(t("select",{"onUpdate:modelValue":s[4]||(s[4]=l=>e.selectedSong=l),class:"form-select form-select-sm",disabled:!e.featuredSongs.length},[we,Te,(a(!0),o(y,null,B(e.featuredSongs,l=>(a(),o("option",{key:l.id,value:l.id},b(l.title)+" --- ("+b(l.artist)+") ",9,Ce))),128))],8,Be),[[S,e.selectedSong]])])]),Ie,Me,t("div",Le,[t("div",Se,[(a(!0),o(y,null,B(e.modes,l=>(a(),o("div",{key:l.value,class:"form-check form-check-inline"},[f(t("input",{id:l.value,"onUpdate:modelValue":s[5]||(s[5]=T=>e.selectedMode=T),class:"form-check-input",type:"radio",value:l.value},null,8,Pe),[[ne,e.selectedMode]]),t("label",{class:"form-check-label",for:l.value},b(l.name),9,Ae)]))),128)),Oe])]),qe,Ue,e.tempTasks.length?(a(),o("table",Ee,[Qe,_(j,{tag:"tbody",name:"list"},{default:P(()=>[(a(!0),o(y,null,B(e.tempTasks,l=>(a(),o("tr",{key:l.random},[t("td",De,[$(b(l.name)+" ",1),e.selectedMode=="hybrid"?(a(),M(r,{key:0,modes:[l.mode]},null,8,["modes"])):u("",!0)]),t("td",null,[_(n,{users:l.mappers},null,8,["users"])]),t("td",{class:C(l.status=="WIP"?"text-wip":"text-success")},b(l.status),3),t("td",null,[f((a(),o("a",{href:"#",class:"text-danger",onClick:T=>e.removeTempTask(l.random)},Ne,8,Ve)),[[k,"delete"]])])]))),128))]),_:1})])):u("",!0),t("div",je,[t("div",He,[f(t("select",{"onUpdate:modelValue":s[6]||(s[6]=l=>e.newTaskName=l),class:"form-select"},[Ge,(a(!0),o(y,null,B(e.tasks,l=>(a(),o("option",{key:l,value:l},b(l),9,Re))),128))],512),[[S,e.newTaskName]]),e.selectedMode=="hybrid"?f((a(),o("select",{key:0,"onUpdate:modelValue":s[7]||(s[7]=l=>e.selectedTaskMode=l),class:"form-select"},Xe,512)),[[S,e.selectedTaskMode]]):u("",!0),f(t("select",{"onUpdate:modelValue":s[8]||(s[8]=l=>e.selectedTaskStatus=l),class:"form-select"},es,512),[[S,e.selectedTaskStatus]]),f(t("input",{"onUpdate:modelValue":s[9]||(s[9]=l=>e.newTaskMapper=l),class:"form-control",type:"text",placeholder:"mapper name or osu! ID...",onKeyup:s[10]||(s[10]=F(l=>e.addTempTask(l),["enter"]))},null,544),[[V,e.newTaskMapper]]),f((a(),o("button",{class:"btn btn-outline-info",onClick:s[11]||(s[11]=l=>e.addTempTask(l))},ts)),[[k,"add difficulty"]])]),as]),os,is,t("div",ns,[t("div",ls,[(a(!0),o(y,null,B(e.tasks,l=>(a(),o("div",{key:l,class:"form-check"},[f(t("input",{id:`lock-${l}`,"onUpdate:modelValue":s[12]||(s[12]=T=>e.checkedLocks=T),class:"form-check-input",type:"checkbox",value:l},null,8,ds),[[le,e.checkedLocks]]),t("label",{class:"form-check-label",for:`lock-${l}`},b(l),9,rs)]))),128))])])]),t("button",{type:"submit",class:"btn btn-outline-success w-100",onClick:s[13]||(s[13]=l=>e.saveNewMap(l))}," Create beatmap "),us,t("div",ps,[t("div",cs,[$(" Note that you can only earn points for beatmaps that fit these requirements: "),t("ul",null,[t("li",null,[$("Your beatmap was ranked "),ms,$(" you joined the Mappers' Guild ("),t("code",null,b(e.loggedInUser.createdAt),1),$(")")]),hs,bs])])])]),_:1})}const _s=w(ce,[["render",fs],["__scopeId","data-v-7905d199"]]),ks=v({name:"BeatmapPageFilters",components:{FilterBox:ue,ModeFilters:pe},data(){return{statuses:{any:"Any",WIP:"WIP",Done:"Done",Qualified:"Qualified",Ranked:"Ranked"},quests:{any:"Any",none:"None"}}},computed:A("beatmaps",["filterMode","filterValue","filterStatus","filterQuest"]),methods:{...de("beatmaps",["updateFilterValue","updateFilterMode","updateFilterStatus","updateFilterQuest"]),getStatusSortClass(e){return this.filterStatus===e?"sorted":"unsorted"},getQuestSortClass(e){return this.filterQuest===e?"sorted":"unsorted"}}}),$s={class:"container card card-body py-3 mb-2"},gs=t("button",{class:"btn btn-primary",href:"#","data-bs-toggle":"modal","data-bs-target":"#addBeatmap"},[$(" Add beatmap "),t("i",{class:"fas fa-plus fa-xs"})],-1),ys={class:"row mt-3"},vs=t("div",{class:"col-auto filter-title"}," Status ",-1),Bs={class:"col"},ws=["onClick"],Ts={class:"row mt-3"},Cs=t("div",{class:"col-auto filter-title"}," Quest ",-1),Is={class:"col"},Ms=["onClick"];function Ls(e,s,i,d,p,m){const r=h("mode-filters"),n=h("filter-box");return a(),o("div",$s,[_(n,{placeholder:"enter to search for song/username...","filter-value":e.filterValue,"onUpdate:filterValue":s[1]||(s[1]=c=>e.updateFilterValue(c))},{filters:P(()=>[_(r,{"filter-mode":e.filterMode,"onUpdate:filterMode":s[0]||(s[0]=c=>e.updateFilterMode(c))},null,8,["filter-mode"]),t("div",ys,[vs,t("div",Bs,[(a(!0),o(y,null,B(e.statuses,(c,k)=>(a(),o("a",{key:k,href:"#",class:C(["status",e.getStatusSortClass(k)]),onClick:I(l=>e.updateFilterStatus(k),["prevent"])},b(c),11,ws))),128))])]),t("div",Ts,[Cs,t("div",Is,[(a(!0),o(y,null,B(e.quests,(c,k)=>(a(),o("a",{key:k,href:"#",class:C(["quest",e.getQuestSortClass(k)]),onClick:I(l=>e.updateFilterQuest(k),["prevent"])},b(c),11,Ms))),128))])])]),default:P(()=>[gs]),_:1},8,["filter-value"])])}const Ss=w(ks,[["render",Ls]]);function D(e,s,i){const d={class:["px-1","text-"+s.toLowerCase()]};return i&&(d["data-bs-toggle"]="tooltip",d["data-bs-placement"]="top",d.title=i),G("span",d,e)}const se=v({props:{tasks:{type:Array,required:!0},tasksLocked:{type:Array,required:!0},mode:{type:String,required:!0}},render(){const e=[{name:"Storyboard",short:"SB",locked:!1,status:[]},{name:"Easy",short:"E",locked:!1,status:[]},{name:"Normal",short:"N",locked:!1,status:[]},{name:"Hard",short:"H",locked:!1,status:[]},{name:"Insane",short:"I",locked:!1,status:[]},{name:"Expert",short:"X",locked:!1,status:[]}],s=[{name:"osu",short:"circle",count:0,status:q.Done},{name:"taiko",short:"drum",count:0,status:q.Done},{name:"catch",short:"apple-alt",count:0,status:q.Done},{name:"mania",short:"stream",count:0,status:q.Done}],i=[],d=this.tasks.length>=10,p=this.mode===E.Hybrid;for(const m of e){let r=!1;const n=this.tasksLocked.includes(m.name);for(const c of this.tasks)if(m.name===c.name){m.status.push(c.status),r=!0;const k=s.findIndex(l=>l.name===c.mode);k!==-1&&(s[k].count++,c.status===q.WIP&&(s[k].status=q.WIP))}if(!p){if(d&&m.status.length>1)i.push(D(m.short+"+","secondary",m.status.length.toString()));else for(const c of m.status)i.push(D(m.short,c));r||i.push(D(m.short,n?"blocked":"open"))}}if(p)for(const m of s)i.push(D([G("i",{class:["fas","fa-"+m.short]})],m.count?m.status:"blocked",m.count.toString()));return G("span",{class:"fw-bold"},i)}}),Ps=v({props:{beatmap:{type:Object,required:!0}},computed:{url(){var e;if(this.beatmap.mission)switch(this.beatmap.mission.tier){case 1:return"/images/dark-bronze.png";case 2:return"/images/dark-silver.png";case 3:return"/images/dark-gold.png";case 4:return"/images/dark-platinum.png";default:return"/images/dark-bronze.png"}return this.beatmap.isShowcase||!((e=this.beatmap.quest)!=null&&e.art)?"/images/no-art-icon.png":this.beatmap.quest.isMbc?"/images/mbc-icon.png":`https://assets.ppy.sh/artists/${this.beatmap.quest.art}/cover.jpg`}}});const As=["src"];function Os(e,s,i,d,p,m){const r=L("bs-tooltip");return e.beatmap.quest||e.beatmap.mission||e.beatmap.isShowcase?f((a(),o("img",{key:0,class:"rounded-circle me-1 quest-icon",src:e.url},null,8,As)),[[r,e.beatmap.quest&&e.beatmap.quest.name||e.beatmap.mission&&e.beatmap.mission.name||"FA showcase"]]):u("",!0)}const z=w(Ps,[["render",Os],["__scopeId","data-v-b923d27f"]]),qs=v({name:"BeatmapCard",components:{ProcessTasks:se,QuestImg:z,ModesIcons:Q},props:{beatmap:{type:Object,required:!0}},emits:["update:selectedBeatmap"],data(){return{defaultUrl:"https://osu.ppy.sh/images/layout/beatmaps/default-bg.png"}},computed:{statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}},methods:{fallbackImage(e){e.target.src=this.defaultUrl},formatMetadata(e,s){const i=e+" - "+s;return i.length>34?i.slice(0,34)+"...":i},processUrl(e){if(e&&e.indexOf("osu.ppy.sh/beatmapsets/")!==-1){const s=e.indexOf("beatmapsets/")+12,i=e.indexOf("#");let d;return i!==-1?d=e.slice(s,i):d=e.slice(s),`https://assets.ppy.sh/beatmaps/${d}/covers/card.jpg`}else return this.defaultUrl}}});const Us=["src"],Es={class:"card-img-overlay",style:{padding:"0.50rem 0.50rem 0 0.50rem"}},Qs={class:"card-title mb-1"},Ds={class:"card-text"};function Vs(e,s,i,d,p,m){const r=h("quest-img"),n=h("user-link"),c=h("modes-icons"),k=h("process-tasks");return a(),o("div",{class:"my-2 col-sm-12 col-md-6 col-lg-4",onClick:s[1]||(s[1]=l=>e.$emit("update:selectedBeatmap",e.beatmap))},[t("div",{class:C(["card card-hover map-card bg-dark",e.statusBorder]),"data-bs-toggle":"modal","data-bs-target":"#editBeatmap"},[t("img",{class:"card-img",src:e.processUrl(e.beatmap.url),style:{opacity:"0.2"},onError:s[0]||(s[0]=l=>e.fallbackImage(l))},null,40,Us),t("div",Es,[t("p",Qs,b(e.formatMetadata(e.beatmap.song.artist,e.beatmap.song.title)),1),t("small",Ds,[_(r,{beatmap:e.beatmap},null,8,["beatmap"]),$(" Hosted by "),_(n,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),M(c,{key:0,modes:[e.beatmap.mode]},null,8,["modes"])):u("",!0),_(k,{class:"float-end pt-1",tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])])])],2)])}const te=w(qs,[["render",Vs],["__scopeId","data-v-a765c2fc"]]),Fs=v({components:{BeatmapCard:te},computed:Z("beatmaps",["hostedBeatmaps"]),methods:x("beatmaps",["setSelectedBeatmap"])}),Ns={class:"container card card-body py-3"},js={class:"ms-2"},Hs={href:"#hostedBeatmaps","data-bs-toggle":"collapse"},Gs=t("i",{class:"fas fa-angle-down"},null,-1),Rs={key:0,id:"hostedBeatmaps",class:"show"},Ws={key:0,class:"ms-5 text-secondary"};function Ks(e,s,i,d,p,m){const r=h("beatmap-card");return a(),o("div",Ns,[t("h5",js,[t("a",Hs,[$(" My mapsets ("+b(e.hostedBeatmaps?e.hostedBeatmaps.length:"...")+") ",1),Gs])]),e.hostedBeatmaps?(a(),o("div",Rs,[_(j,{name:"list",tag:"div",class:"row"},{default:P(()=>[(a(!0),o(y,null,B(e.hostedBeatmaps,n=>(a(),M(r,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":s[0]||(s[0]=c=>e.setSelectedBeatmap(c))},null,8,["beatmap"]))),128))]),_:1}),e.hostedBeatmaps.length?u("",!0):(a(),o("p",Ws," None... "))])):u("",!0)])}const zs=w(Fs,[["render",Ks]]),Ys=v({components:{BeatmapCard:te},props:{isLoadingGuestBeatmaps:Boolean},computed:Z("beatmaps",["guestDifficultyBeatmaps"]),methods:x("beatmaps",["setSelectedBeatmap"])}),Xs={class:"container card card-body py-3"},Js={class:"ms-2"},Zs={href:"#guestDifficultyBeatmaps","data-bs-toggle":"collapse"},xs=t("i",{class:"fas fa-angle-down"},null,-1),et={key:0,class:"ms-5 text-secondary"};function st(e,s,i,d,p,m){const r=h("beatmap-card");return a(),o("div",Xs,[t("h5",Js,[t("a",Zs,[$(" My guest difficulties ("+b(e.guestDifficultyBeatmaps&&!e.isLoadingGuestBeatmaps?e.guestDifficultyBeatmaps.length:"...")+") ",1),xs])]),e.guestDifficultyBeatmaps?(a(),o("div",{key:0,id:"guestDifficultyBeatmaps",class:C(["collapse",{"loading-data":e.isLoadingGuestBeatmaps}])},[!e.guestDifficultyBeatmaps.length&&!e.isLoadingGuestBeatmaps?(a(),o("p",et," None... ")):u("",!0),_(j,{name:"list",tag:"div",class:"row"},{default:P(()=>[(a(!0),o(y,null,B(e.guestDifficultyBeatmaps,n=>(a(),M(r,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":s[0]||(s[0]=c=>e.setSelectedBeatmap(c))},null,8,["beatmap"]))),128))]),_:1})],2)):u("",!0)])}const tt=w(Ys,[["render",st]]),at=v({name:"ModeChoice",props:{beatmap:{type:Object,required:!0}},data(){return{selectedMode:this.beatmap.mode,showInput:!1,modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}]}},methods:{async setMode(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setMode`,{mode:this.selectedMode},e);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),this.showInput=!1}}}),ot={id:"mode"},it={class:"row mb-2"},nt={class:"col"},lt=t("i",{class:"fas fa-edit"},null,-1),dt=[lt],rt={class:"small ms-3 text-secondary"},ut={key:0,class:"row mb-2"},pt={class:"col"},ct={class:"input-group input-group-sm"},mt=["value"];function ht(e,s,i,d,p,m){const r=L("bs-tooltip");return a(),o("div",ot,[t("div",it,[t("div",nt,[t("div",null,[$(" Mode "),f((a(),o("a",{id:"editMode",href:"#",class:C([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:s[0]||(s[0]=I(n=>e.showInput=!e.showInput,["prevent"]))},dt,2)),[[r,"edit mode","right"]])]),t("div",rt,b(e.beatmap.mode=="hybrid"?"Multiple modes":e.beatmap.mode=="osu"?"osu!":"osu!"+e.beatmap.mode),1)])]),e.showInput?(a(),o("div",ut,[t("div",pt,[t("div",ct,[f(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.selectedMode=n),class:"form-select"},[(a(!0),o(y,null,B(e.modes,n=>(a(),o("option",{key:n.value,value:n.value},b(n.name),9,mt))),128))],512),[[S,e.selectedMode]]),f((a(),o("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.setMode(n))},[$(" Save ")])),[[r,"link beatmap to quest"]])])])])):u("",!0)])}const bt=w(at,[["render",ht]]),ft=v({name:"StatusChoice",props:{beatmap:{type:Object,required:!0}},methods:{async setStatus(e,s){const i=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setStatus`,{status:e},s);this.$http.isError(i)||this.$store.dispatch("beatmaps/updateBeatmap",i)}}}),_t={id:"mapsetStatus"},kt=t("div",{class:"d-inline-block me-2"}," Status ",-1),$t=["disabled"],gt=["disabled"],yt={class:"small text-secondary"},vt=t("div",{class:"small text-secondary mt-1"},[t("div",{class:"small"},' Maps marked as "Done" will be processed for points when they reach the Ranked category on osu!. ')],-1);function Bt(e,s,i,d,p,m){const r=L("bs-tooltip");return a(),o("div",_t,[kt,f((a(),o("button",{class:C(["btn btn-sm me-1",e.beatmap.status=="WIP"?"btn-warning":"btn-outline-warning"]),disabled:e.beatmap.status=="WIP",onClick:s[0]||(s[0]=n=>e.setStatus("WIP",n))},[$(" WIP ")],10,$t)),[[r,"mark mapset as work-in-progress","bottom"]]),f((a(),o("button",{class:C(["btn btn-sm me-1",e.beatmap.status=="Done"?"btn-success":"btn-outline-success"]),disabled:e.beatmap.status=="Done",onClick:s[1]||(s[1]=n=>e.setStatus("Done",n))},[$(" Done ")],10,gt)),[[r,"mark mapset and all diffs as done","bottom"]]),t("span",yt,'(currently "'+b(e.beatmap.status)+'")',1),vt])}const wt=w(ft,[["render",Bt]]),Tt=v({name:"NewTask",props:{isHost:Boolean,taskToAddCollaborator:{type:Object,default:null},beatmap:{type:Object,required:!0}},emits:["update:taskToAddCollaborator"],data(){return{selectedTask:N.Easy,selectedMode:E.Osu,addTaskUsername:""}},computed:{remainingTasks(){let e=Object.values(N);return this.beatmap.tasksLocked&&this.beatmap.tasksLocked.length&&!this.isHost&&(e=e.filter(s=>!this.beatmap.tasksLocked.includes(s))),this.selectedTask=e[0]||"",e}},methods:{async addTask(e){let s;this.beatmap.mode==E.Hybrid?s=this.selectedMode:s=this.beatmap.mode;const i=await this.$http.executePost("/beatmaps/addTask/"+this.beatmap.id,{user:this.addTaskUsername,taskName:this.selectedTask,username:this.addTaskUsername,mode:s},e);this.$http.isError(i)||this.$store.dispatch("beatmaps/updateBeatmap",i)},async addCollab(e){let s;this.beatmap.mode==E.Hybrid?s=this.taskToAddCollaborator.mode:s=this.beatmap.mode;const i=await this.$http.executePost("/beatmaps/addCollab/"+this.beatmap.id,{user:this.addTaskUsername,task:this.taskToAddCollaborator,mode:s},e);this.$http.isError(i)||(this.$store.dispatch("beatmaps/updateBeatmap",i),this.$store.dispatch("updateToastMessages",{message:"Added",type:"success"}))}}}),Ct={key:0,class:"row mt-2 mb-3"},It={class:"col-sm-12"},Mt={class:"input-group input-group-sm mx-auto"},Lt=["value"],St=t("option",{value:"osu"}," osu! ",-1),Pt=t("option",{value:"taiko"}," osu!taiko ",-1),At=t("option",{value:"catch"}," osu!catch ",-1),Ot=t("option",{value:"mania"}," osu!mania ",-1),qt=[St,Pt,At,Ot],Ut=t("i",{class:"fas fa-plus"},null,-1),Et=[Ut],Qt={key:0,class:"col-sm-12 mt-1 text-center"},Dt=t("i",{class:"fas fa-times-circle"},null,-1),Vt=[Dt];function Ft(e,s,i,d,p,m){const r=L("bs-tooltip");return e.beatmap.status=="WIP"&&e.remainingTasks.length?(a(),o("div",Ct,[t("div",It,[t("div",Mt,[e.taskToAddCollaborator?u("",!0):f((a(),o("select",{key:0,"onUpdate:modelValue":s[0]||(s[0]=n=>e.selectedTask=n),class:"form-select"},[(a(!0),o(y,null,B(e.remainingTasks,n=>(a(),o("option",{key:n,value:n},b(n),9,Lt))),128))],512)),[[S,e.selectedTask]]),e.beatmap.mode=="hybrid"&&!e.taskToAddCollaborator?f((a(),o("select",{key:1,"onUpdate:modelValue":s[1]||(s[1]=n=>e.selectedMode=n),class:"form-select"},qt,512)),[[S,e.selectedMode]]):u("",!0),e.isHost||e.taskToAddCollaborator?f((a(),o("input",{key:2,"onUpdate:modelValue":s[2]||(s[2]=n=>e.addTaskUsername=n),class:"form-control",type:"text",placeholder:"add user to task...",maxlength:"18",onKeyup:s[3]||(s[3]=F(n=>e.taskToAddCollaborator?e.addCollab(n):e.addTask(n),["enter"]))},null,544)),[[V,e.addTaskUsername]]):u("",!0),f((a(),o("button",{class:"btn btn-outline-info",onClick:s[4]||(s[4]=n=>e.taskToAddCollaborator?e.addCollab(n):e.addTask(n))},Et)),[[r,"add difficulty"]])])]),e.taskToAddCollaborator?(a(),o("div",Qt,[t("small",null,[$(" Adding collaborator for the selected difficulty "),t("a",{class:"text-danger",href:"#",onClick:s[5]||(s[5]=I(n=>e.$emit("update:taskToAddCollaborator",null),["prevent"]))},Vt)])])):u("",!0)])):u("",!0)}const Nt=w(Tt,[["render",Ft]]),jt=v({name:"TasksChoice",components:{NewTask:Nt,ModesIcons:Q},props:{beatmap:{type:Object,required:!0},isHost:Boolean,isRanked:Boolean,isQualified:Boolean},data(){return{taskToAddCollaborator:void 0}},computed:{...A(["loggedInUser"]),sortedTasks(){const e=["Easy","Normal","Hard","Insane","Expert","Storyboard"],s=["osu","taiko","catch","mania","sb"];return[...this.beatmap.tasks].sort(function(d,p){return e.indexOf(d.name)-e.indexOf(p.name)}).sort(function(d,p){return s.indexOf(d.mode)-s.indexOf(p.mode)})}},methods:{isOwner(e){return e.some(s=>s.osuId==this.loggedInUser.osuId)},canEditTask(e){return this.isOwner(e.mappers)||this.isHost},async setTaskStatus(e,s,i){i.target.classList.add("fake-button-disable");const d=await this.$http.executePost("/beatmaps/setTaskStatus/"+e,{status:s});this.$http.isError(d)||this.$store.dispatch("beatmaps/updateBeatmap",d),i.target.classList.remove("fake-button-disable")},async removeTask(e,s){s.target.classList.add("fake-button-disable");const i=await this.$http.executePost("/beatmaps/removeTask/"+e,{beatmapId:this.beatmap.id});this.$http.isError(i)||this.$store.dispatch("beatmaps/updateBeatmap",i),s.target.classList.remove("fake-button-disable")},canEditTaskCollaborators(e){return e.status!="Done"&&!this.isQualified&&this.beatmap.status!="Done"&&this.canEditTask(e)},async removeCollab(e,s,i){i.target.classList.add("fake-button-disable");const d=await this.$http.executePost("/beatmaps/task/"+e+"/removeCollab",{user:s});this.$http.isError(d)||this.$store.dispatch("beatmaps/updateBeatmap",d),i.target.classList.remove("fake-button-disable")},isAddingCollaborator(e){var s;return((s=this.taskToAddCollaborator)==null?void 0:s.id)==e.id}}});const O=e=>(R("data-v-d0c04112"),e=e(),W(),e),Ht={class:"row"},Gt={class:"col-sm-12"},Rt={class:"table table-sm"},Wt=O(()=>t("th",null,"Difficulty",-1)),Kt=O(()=>t("th",null,"Mapper(s)",-1)),zt={key:0},Yt=["id"],Xt=O(()=>t("i",{class:"fas fa-times"},null,-1)),Jt=[Xt],Zt=["onClick"],xt=O(()=>t("i",{class:"fas fa-plus"},null,-1)),ea=[xt],sa=["onClick"],ta=O(()=>t("i",{class:"fas fa-minus"},null,-1)),aa=[ta],oa={key:0},ia=["onClick"],na=O(()=>t("i",{class:"fas fa-minus"},null,-1)),la=[na],da=["onClick"],ra=O(()=>t("i",{class:"fas fa-check"},null,-1)),ua=[ra],pa=["onClick"],ca=O(()=>t("i",{class:"fas fa-ellipsis-h"},null,-1)),ma=[ca],ha={key:0,class:"col-sm-12 mt-2"};function ba(e,s,i,d,p,m){const r=h("modes-icons"),n=h("user-link"),c=h("new-task"),k=L("bs-tooltip");return a(),o("div",Ht,[t("div",Gt,[t("table",Rt,[t("thead",null,[t("tr",null,[Wt,Kt,!e.isRanked&&!e.isQualified?(a(),o("th",zt)):u("",!0)])]),_(j,{tag:"tbody",name:"list"},{default:P(()=>[(a(!0),o(y,null,B(e.sortedTasks,l=>(a(),o("tr",{id:l.id+"Row",key:l.id},[t("td",{class:C(["text-secondary",`card-status-${l.status.toLowerCase()}`])},[$(b(l.name)+" ",1),e.beatmap.mode=="hybrid"?(a(),M(r,{key:0,modes:[l.mode]},null,8,["modes"])):u("",!0)],2),t("td",null,[(a(!0),o(y,null,B(l.mappers,(T,H)=>(a(),o("div",{key:T.id},[H==0&&e.canEditTaskCollaborators(l)?(a(),o(y,{key:0},[e.isAddingCollaborator(l)?f((a(),o("a",{key:0,href:"#",class:"text-danger",onClick:s[0]||(s[0]=I(U=>e.taskToAddCollaborator=void 0,["prevent"]))},Jt)),[[k,"cancel"]]):f((a(),o("a",{key:1,href:"#",class:"text-success",onClick:I(U=>e.taskToAddCollaborator=l,["prevent"])},ea,8,Zt)),[[k,"add new collaborator"]])],64)):u("",!0),_(n,{class:"mx-1",user:T},null,8,["user"]),l.mappers.length>1&&e.canEditTaskCollaborators(l)&&T.osuId!=e.loggedInUser.osuId?f((a(),o("a",{key:1,href:"#",class:"text-danger",onClick:I(U=>e.removeCollab(l.id,T.id,U),["prevent"])},aa,8,sa)),[[k,"remove collaborator"]]):u("",!0)]))),128))]),!e.isRanked&&!e.isQualified?(a(),o("td",oa,[e.canEditTask(l)?(a(),o(y,{key:0},[f((a(),o("a",{href:"#",class:"text-danger me-1",onClick:I(T=>e.removeTask(l.id,T),["prevent"])},la,8,ia)),[[k,"delete"]]),l.status=="WIP"?f((a(),o("a",{key:0,href:"#",class:"text-success me-1",onClick:I(T=>e.setTaskStatus(l.id,"Done",T),["prevent"])},ua,8,da)),[[k,"mark as done"]]):u("",!0),l.status=="Done"&&e.beatmap.status!="Done"?f((a(),o("a",{key:1,href:"#",class:"text-wip me-1",onClick:I(T=>e.setTaskStatus(l.id,"WIP",T),["prevent"])},ma,8,pa)),[[k,"mark as WIP"]]):u("",!0)],64)):u("",!0)])):u("",!0)],8,Yt))),128))]),_:1})])]),!e.isRanked&&!e.isQualified?(a(),o("div",ha,[_(c,{"task-to-add-collaborator":e.taskToAddCollaborator,"onUpdate:taskToAddCollaborator":s[1]||(s[1]=l=>e.taskToAddCollaborator=l),beatmap:e.beatmap,"is-host":e.isHost},null,8,["task-to-add-collaborator","beatmap","is-host"])])):u("",!0)])}const fa=w(jt,[["render",ba],["__scopeId","data-v-d0c04112"]]),_a=v({name:"QuestOrMissionChoice",props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:[],openMissions:[],showInput:!1,dropdownId:""}},computed:A(["loggedInUser"]),watch:{beatmap(){var e,s;this.showInput=!1,this.dropdownId=((e=this.beatmap.quest)==null?void 0:e.id)||((s=this.beatmap.mission)==null?void 0:s.id)||""}},async created(){const e=await this.$http.executeGet(`/users/${this.loggedInUser.id}/quests`),s=await this.$http.executeGet(`/missions/open/${this.beatmap.mode}`);this.$http.isError(e)||(this.userQuests=e),this.$http.isError(s)||(this.openMissions=s)},methods:{async linkQuestOrMission(e){const s=this.userQuests.find(d=>d.id==this.dropdownId),i=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/${s?"linkQuest":"linkMission"}`,{questOrMissionId:this.dropdownId},e);this.$http.isError(i)||this.$store.dispatch("beatmaps/updateBeatmap",i)}}}),ka={class:"row mb-2"},$a={class:"col"},ga=t("i",{class:"fas fa-edit"},null,-1),ya=[ga],va={class:"small ms-3 text-secondary"},Ba=["href"],wa=["href"],Ta={key:2},Ca={key:0,class:"row mb-2"},Ia={class:"col"},Ma={class:"input-group input-group-sm"},La=t("option",{value:""}," No quest ",-1),Sa={key:0,disabled:""},Pa=["value"],Aa={key:1,disabled:""},Oa=["value"];function qa(e,s,i,d,p,m){const r=L("bs-tooltip");return a(),o("div",null,[t("div",ka,[t("div",$a,[t("div",null,[$(" Quest "),f((a(),o("a",{id:"editLink",href:"#",class:C([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:s[0]||(s[0]=I(n=>e.showInput=!e.showInput,["prevent"]))},ya,2)),[[r,"connect mapset with a quest","right"]])]),t("div",va,[e.beatmap.quest?(a(),o("a",{key:0,href:`/quests?id=${e.beatmap.quest.id}`},b(e.beatmap.quest.name),9,Ba)):e.beatmap.mission?(a(),o("a",{key:1,href:`/missions?id=${e.beatmap.mission.id}`},b(e.beatmap.mission.name),9,wa)):(a(),o("i",Ta,"none"))])])]),e.showInput?(a(),o("div",Ca,[t("div",Ia,[t("div",Ma,[f(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.dropdownId=n),class:"form-select"},[La,e.userQuests.length?(a(),o("option",Sa," --- claimed quests --- ")):u("",!0),(a(!0),o(y,null,B(e.userQuests,n=>(a(),o("option",{key:n.id,value:n.id},b(n.name),9,Pa))),128)),e.openMissions.length?(a(),o("option",Aa," --- open priority quests --- ")):u("",!0),(a(!0),o(y,null,B(e.openMissions,n=>(a(),o("option",{key:n.id,value:n.id},b(n.name),9,Oa))),128))],512),[[S,e.dropdownId]]),f((a(),o("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.linkQuestOrMission(n))},[$(" Save ")])),[[r,"link beatmap to quest"]])])])])):u("",!0)])}const Ua=w(_a,[["render",qa]]),Ea=v({name:"ModdersList",components:{UserLinkList:K},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...A(["loggedInUser"]),isModder(){return this.beatmap.modders.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateModder(e){e.target.classList.add("fake-button-disable");const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateModder`);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),e.target.classList.remove("fake-button-disable")}}}),Qa={id:"modders",class:"row mb-2"},Da={class:"col"},Va={key:0,class:"ms-1"},Fa={class:"small ms-3"},Na={key:0,class:"text-secondary"};function ja(e,s,i,d,p,m){const r=h("user-link-list"),n=L("bs-tooltip");return a(),o("div",Qa,[t("div",Da,[t("div",null,[$(" Modders ("+b(e.beatmap.modders.length)+") ",1),e.canEdit?f((a(),o("small",Va,[t("a",{href:"#",class:C(e.isModder?"text-danger":"text-success"),onClick:s[0]||(s[0]=I(c=>e.updateModder(c),["prevent"]))},[t("i",{class:C(["fas",e.isModder?"fa-minus":"fa-plus"])},null,2)],2)])),[[n,"add/remove yourself from modder list","right"]]):u("",!0)]),t("div",Fa,[e.beatmap.modders.length==0?(a(),o("i",Na," none ")):(a(),M(r,{key:1,users:e.beatmap.modders},null,8,["users"]))])])])}const Ha=w(Ea,[["render",ja]]),Ga=v({name:"NominatorsList",components:{UserLinkList:K},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...A(["loggedInUser"]),isBn(){return this.beatmap.bns.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateBn(e){e.target.classList.add("fake-button-disable");const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateBn`);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),e.target.classList.remove("fake-button-disable")}}}),Ra={key:0,class:"ms-1"},Wa=t("i",{class:"fas fa-minus"},null,-1),Ka=[Wa],za=t("i",{class:"fas fa-plus"},null,-1),Ya=[za],Xa={class:"small ms-3"},Ja={key:0,class:"text-secondary"};function Za(e,s,i,d,p,m){const r=h("user-link-list"),n=L("bs-tooltip");return a(),o("div",null,[t("div",null,[$(" Nominators ("+b(e.beatmap.bns.length)+") ",1),e.canEdit?f((a(),o("small",Ra,[e.isBn?(a(),o("a",{key:0,href:"#",class:"text-danger",onClick:s[0]||(s[0]=I(c=>e.updateBn(c),["prevent"]))},Ka)):u("",!0),!e.isBn&&e.beatmap.bns.length<2?(a(),o("a",{key:1,href:"#",class:"text-success",onClick:s[1]||(s[1]=I(c=>e.updateBn(c),["prevent"]))},Ya)):u("",!0)])),[[n,"add/remove yourself from potential BN list","right"]]):u("",!0)]),t("div",Xa,[e.beatmap.bns.length==0?(a(),o("i",Ja,"none")):(a(),M(r,{key:1,users:e.beatmap.bns},null,8,["users"]))])])}const xa=w(Ga,[["render",Za]]),eo=v({name:"BeatmapLink",props:{beatmap:{type:Object,required:!0}},data(){return{url:"",showLinkInput:!1}},watch:{beatmap(e){e&&(this.showLinkInput=!1,this.url=e.url)}},created(){this.url=this.beatmap.url},methods:{async saveLink(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setLink`,{url:this.url},e);this.$http.isError(s)||(this.showLinkInput=!1,this.$store.dispatch("beatmaps/updateBeatmap",s))}}}),so={class:"row mb-2"},to={class:"col"},ao=t("i",{class:"fas fa-edit"},null,-1),oo=[ao],io={class:"small ms-3"},no=["href"],lo={key:1,class:"text-secondary"},ro={key:0,class:"row mb-2"},uo={class:"col-sm-12"},po={class:"input-group input-group-sm"};function co(e,s,i,d,p,m){const r=L("bs-tooltip");return a(),o("div",null,[t("div",so,[t("div",to,[t("div",null,[$(" Link "),f((a(),o("a",{id:"editLink",href:"#",class:C(["text-success small ms-1",{"text-danger":e.showLinkInput}]),onClick:s[0]||(s[0]=I(n=>e.showLinkInput=!e.showLinkInput,["prevent"]))},oo,2)),[[r,"edit link","right"]])]),t("div",io,[e.beatmap.url?(a(),o("a",{key:0,href:e.beatmap.url,target:"_blank",class:"text-truncate",style:{display:"block"}},b(e.beatmap.url),9,no)):(a(),o("i",lo,"none"))])])]),e.showLinkInput?(a(),o("div",ro,[t("div",uo,[t("div",po,[f(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.url=n),class:"form-control form-control-sm",type:"text",placeholder:"URL",onKeyup:s[2]||(s[2]=F(n=>e.saveLink(n),["enter"]))},null,544),[[V,e.url]]),t("button",{id:"addLinkButton",class:"btn btn-outline-info",type:"submit",onClick:s[3]||(s[3]=n=>e.saveLink(n))}," Save ")])])])):u("",!0)])}const mo=w(eo,[["render",co]]),ho=v({name:"LocksChoice",props:{beatmap:{type:Object,required:!0},beatmapId:{type:String,required:!0}},data(){return{lockTaskSelection:"",showLocksInput:!1,phaseEdit:!1}},computed:{remainingTasks(){var s,i;let e=Object.values(N);return(i=(s=this.beatmap)==null?void 0:s.tasksLocked)!=null&&i.length&&(e=e.filter(d=>!this.beatmap.tasksLocked.includes(d))),this.lockTaskSelection=e[0]||"",e}},watch:{beatmapId(){this.showLocksInput=!1},beatmap(){this.beatmap.tasksLocked.length>=6&&(this.showLocksInput=!1)}},methods:{async unlockTask(e,s){s.target.classList.add("fake-button-disable");const i=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/unlockTask`,{task:e});this.$http.isError(i)||this.$store.dispatch("beatmaps/updateBeatmap",i),s.target.classList.remove("fake-button-disable")},async lockTask(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/lockTask`,{task:this.lockTaskSelection},e);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s)}}}),bo={id:"locks",class:"row mb-1"},fo={class:"col"},_o=t("i",{class:"fas fa-edit"},null,-1),ko=[_o],$o={class:"small ms-3"},go={key:0},yo={key:1},vo=["onClick"],Bo=t("i",{class:"fas fa-minus"},null,-1),wo=[Bo],To={class:"text-secondary mx-1"},Co={key:0,class:"row"},Io={class:"col"},Mo={class:"input-group input-group-sm"},Lo=["value"],So=t("i",{class:"fas fa-lock"},null,-1),Po=[So];function Ao(e,s,i,d,p,m){const r=L("bs-tooltip");return a(),o("div",null,[t("div",bo,[t("div",fo,[t("div",null,[$(" Locks "),e.beatmap.tasksLocked.length<6?f((a(),o("a",{key:0,class:C(["text-success small ms-1",{"text-danger":e.showLocksInput}]),href:"#",onClick:s[0]||(s[0]=I(n=>e.showLocksInput=!e.showLocksInput,["prevent"]))},ko,2)),[[r,"edit locks","right"]]):u("",!0)]),t("div",$o,[e.beatmap.tasksLocked.length==0?(a(),o("i",go,"none")):u("",!0),e.beatmap.tasksLocked.length>0?(a(),o("div",yo,[(a(!0),o(y,null,B(e.beatmap.tasksLocked,n=>(a(),o("div",{key:n},[f((a(),o("a",{href:"#",class:C(["text-danger",e.phaseEdit?"fake-button-disable":""]),onClick:I(c=>e.unlockTask(n,c),["prevent"])},wo,10,vo)),[[r,"unlock","left"]]),t("span",To,b(n),1)]))),128))])):u("",!0)])])]),e.showLocksInput?(a(),o("div",Co,[t("div",Io,[t("div",Mo,[f(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.lockTaskSelection=n),class:"form-select"},[(a(!0),o(y,null,B(e.remainingTasks,n=>(a(),o("option",{key:n,value:n},b(n),9,Lo))),128))],512),[[S,e.lockTaskSelection]]),f((a(),o("button",{id:"lockTask",class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.lockTask(n))},Po)),[[r,"prevent other mappers from claiming a difficulty","right"]])])])])):u("",!0)])}const Oo=w(ho,[["render",Ao]]),qo=v({name:"Points",props:{beatmap:{type:Object,required:!0}},data(){return{tasksPointsArray:null,usersPointsArrays:null,pointsInfo:null,totalPoints:null,bnPoints:null,isLoading:!1}},watch:{beatmap(){this.tasksPointsArray=null,this.usersPointsArrays=null,this.pointsInfo=null,this.totalPoints=null,this.bnPoints=null,this.isLoading=!1}},methods:{async findPoints(e){this.isLoading=!0;const s=await this.$http.executeGet(`/beatmaps/${this.beatmap.id}/findPoints`,e);this.$http.isError(s)||(this.tasksPointsArray=s.tasksPointsArray,this.usersPointsArrays=s.usersPointsArrays,this.pointsInfo=s.pointsInfo,this.totalPoints=s.totalPoints,this.bnPoints=s.bnPoints),this.isLoading=!1}}}),Uo={class:"row"},Eo={class:"col-sm-12"},Qo={key:1,class:"small text-secondary ms-2"},Do={key:2,class:"small text-secondary ms-2"},Vo={key:0,class:"col-sm-6"},Fo={class:"small text-secondary"},No={class:"col-sm-6"},jo={key:0,class:"small text-secondary"},Ho={key:1,class:"col-sm-12"},Go={class:"small text-secondary ms-2"};function Ro(e,s,i,d,p,m){const r=L("bs-tooltip");return a(),o("div",null,[t("div",Uo,[t("div",Eo,[e.tasksPointsArray?u("",!0):f((a(),o("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:s[0]||(s[0]=n=>e.findPoints(n))},[$(" Calculate points ")])),[[r,"calculate points for all difficulties"]]),e.isLoading?(a(),o("span",Qo," calculating... ")):e.pointsInfo?(a(),o("span",Do,b(e.pointsInfo),1)):u("",!0)]),e.tasksPointsArray?(a(),o("div",Vo,[t("ul",Fo,[(a(!0),o(y,null,B(e.tasksPointsArray,(n,c)=>(a(),o("li",{key:c},b(n),1))),128)),t("li",null,"BN mod/nomination: "+b(e.bnPoints),1)])])):u("",!0),t("div",No,[e.usersPointsArrays?(a(),o("ul",jo,[(a(!0),o(y,null,B(e.usersPointsArrays,(n,c)=>(a(),o("li",{key:c},b(e.usersPointsArrays[c][0])+": "+b(e.usersPointsArrays[c][1]),1))),128))])):u("",!0)]),e.totalPoints?(a(),o("div",Ho,[t("span",Go," total: "+b(Math.round(e.totalPoints*10)/10),1)])):u("",!0)])])}const Wo=w(qo,[["render",Ro]]),Ko=v({name:"BeatmapInfo",components:{ModeChoice:bt,StatusChoice:wt,TasksChoice:fa,QuestOrMissionChoice:Ua,ModdersList:Ha,NominatorsList:xa,BeatmapLink:mo,LocksChoice:Oo,Points:Wo},props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:null}},computed:{...A(["loggedInUser"]),isHost(){return this.loggedInUser.id&&this.beatmap?this.loggedInUser.id===this.beatmap.host.id:!1},isRanked(){return this.beatmap.status===X.Ranked},isQualified(){return this.beatmap.status===X.Qualified}},methods:{async deleteMap(e){if(confirm("Are you sure you want to delete?")){e.target.disabled=!0;const i=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/delete`,{},e);this.$http.isError(i)||(this.$bs.hideModal("editBeatmap"),this.$store.commit("beatmaps/deleteBeatmap",i)),e.target.disabled=!1}}}});const Y=e=>(R("data-v-4727d833"),e=e(),W(),e),zo={key:0,class:"container"},Yo={class:"row"},Xo={class:"row mb-2"},Jo={class:"col-sm-6"},Zo={key:0,id:"bns",class:"col-sm-6"},xo=Y(()=>t("hr",null,null,-1)),ei={class:"row"},si={class:"col-sm"},ti={key:0,class:"col-lg-5 bm-col-separator-left"},ai={key:0,class:"row"},oi={class:"col-sm"},ii=Y(()=>t("hr",null,null,-1)),ni={class:"row"},li={class:"col-sm"},di=Y(()=>t("hr",null,null,-1)),ri={class:"row"},ui={class:"col-sm-4 text-end"},pi={class:"small text-secondary"};function ci(e,s,i,d,p,m){const r=h("modders-list"),n=h("nominators-list"),c=h("tasks-choice"),k=h("status-choice"),l=h("mode-choice"),T=h("quest-or-mission-choice"),H=h("beatmap-link"),U=h("locks-choice"),oe=h("points");return e.beatmap?(a(),o("div",zo,[t("div",Yo,[t("div",{class:C(e.isHost&&!e.isRanked?"col-lg-7":"col-sm-12")},[t("div",Xo,[t("div",Jo,[_(r,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])]),!e.isRanked||e.beatmap.bns?(a(),o("div",Zo,[_(n,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])])):u("",!0)]),xo,t("div",ei,[t("div",si,[_(c,{beatmap:e.beatmap,"is-host":e.isHost,"is-ranked":e.isRanked,"is-qualified":e.isQualified},null,8,["beatmap","is-host","is-ranked","is-qualified"])])])],2),e.isHost&&!e.isRanked?(a(),o("div",ti,[e.isQualified?u("",!0):(a(),o("div",ai,[t("div",oi,[_(k,{beatmap:e.beatmap},null,8,["beatmap"]),ii])])),t("div",ni,[t("div",li,[e.beatmap.status=="WIP"?(a(),M(l,{key:0,class:"mb-2",beatmap:e.beatmap},null,8,["beatmap"])):u("",!0)])]),_(T,{beatmap:e.beatmap},null,8,["beatmap"]),e.isQualified?u("",!0):(a(),M(H,{key:1,beatmap:e.beatmap},null,8,["beatmap"])),e.beatmap.status=="WIP"?(a(),M(U,{key:2,beatmap:e.beatmap,"beatmap-id":e.beatmap.id},null,8,["beatmap","beatmap-id"])):u("",!0)])):u("",!0)]),di,t("div",ri,[_(oe,{class:"col-sm-8",beatmap:e.beatmap},null,8,["beatmap"]),t("div",ui,[t("span",pi," Created: "+b(e.beatmap.createdAt.toString().slice(0,10)),1),e.isHost&&!e.isRanked?(a(),o("button",{key:0,id:"deleteButton",class:"btn btn-sm btn-outline-danger ms-2",onClick:s[0]||(s[0]=ie=>e.deleteMap(ie))}," Delete ")):u("",!0)])])])):u("",!0)}const ae=w(Ko,[["render",ci],["__scopeId","data-v-4727d833"]]),mi=v({name:"BeatmapTableRow",components:{BeatmapInfo:ae,ProcessTasks:se,QuestImg:z,ModesIcons:Q},props:{beatmap:{type:Object,required:!0}},methods:{selectBeatmap(){this.$route.query.id!==this.beatmap.id&&this.$router.push(`/beatmaps?id=${this.beatmap.id}`)},formatMetadata(){const e=this.beatmap.song.artist+" - "+this.beatmap.song.title;return e.length>70?e.slice(0,70)+"...":e},statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}}}),hi={class:"container"},bi={class:"row"},fi={class:"col-sm-6"},_i=["data-bs-target"],ki=t("i",{class:"fas fa-angle-down"},null,-1),$i={class:"col-sm-2 small d-flex justify-content-end align-items-center"},gi={class:"col-sm-3 small"},yi=t("span",{class:"text-secondary me-1"},"Hosted by",-1),vi={key:0,class:"text-secondary"},Bi={key:0,class:"col-sm-1 d-flex justify-content-end align-items-center"},wi=["href"],Ti=t("i",{class:"fas fa-link"},null,-1),Ci=[Ti],Ii=["id"];function Mi(e,s,i,d,p,m){const r=h("quest-img"),n=h("process-tasks"),c=h("user-link"),k=h("modes-icons"),l=h("beatmap-info");return a(),o("div",null,[t("div",{class:C(["card card-body card-level-2 my-1 p-1",e.statusBorder()])},[t("div",hi,[t("div",bi,[t("div",fi,[_(r,{beatmap:e.beatmap},null,8,["beatmap"]),t("a",{href:"#","data-bs-toggle":"collapse","data-bs-target":"#details"+e.beatmap.id,onClick:s[0]||(s[0]=T=>e.selectBeatmap())},[$(b(e.formatMetadata())+" ",1),ki],8,_i)]),t("div",$i,[_(n,{tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])]),t("div",gi,[yi,_(c,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),o("span",vi,[_(k,{modes:[e.beatmap.mode]},null,8,["modes"])])):u("",!0)]),e.beatmap.url?(a(),o("div",Bi,[t("a",{href:e.beatmap.url,target:"_blank"},Ci,8,wi)])):u("",!0)])])],2),t("div",{id:"details"+e.beatmap.id,class:C(["collapse my-2 mx-4 row border-end border-start py-3","border-"+e.beatmap.status.toLowerCase()])},[_(l,{beatmap:e.beatmap},null,8,["beatmap"])],10,Ii)])}const Li=w(mi,[["render",Mi]]),Si=v({components:{BeatmapTableRow:Li},computed:A("beatmaps",{otherBeatmaps:"allBeatmaps",isLoadingOtherBeatmaps:"isLoadingOtherBeatmaps",filterValue:"filterValue"}),methods:{async showMore(e){e.target.disabled=!0,this.$store.commit("beatmaps/increaseFetchLimit"),await this.$store.dispatch("beatmaps/loadOtherBeatmaps"),e.target.disabled=!1}}}),Pi={class:"container card card-body py-3"},Ai={class:"ms-2"},Oi={href:"#otherBeatmaps","data-bs-toggle":"collapse"},qi=t("i",{class:"fas fa-angle-down"},null,-1),Ui={key:0,id:"otherBeatmaps",class:"collapse"},Ei={key:0,class:"ms-5 text-secondary"},Qi={key:1,class:"text-center"},Di=t("i",{class:"fas fa-angle-down me-1"},null,-1),Vi=t("i",{class:"fas fa-angle-down ms-1"},null,-1);function Fi(e,s,i,d,p,m){const r=h("beatmap-table-row");return a(),o("div",Pi,[t("h5",Ai,[t("a",Oi,[$(" Other beatmaps ("+b(e.otherBeatmaps&&!e.isLoadingOtherBeatmaps?e.otherBeatmaps.length:"...")+") ",1),qi])]),e.otherBeatmaps?(a(),o("div",Ui,[t("div",{class:C({"loading-data":e.isLoadingOtherBeatmaps})},[!e.otherBeatmaps.length&&!e.isLoadingOtherBeatmaps?(a(),o("p",Ei," None... ")):u("",!0),(a(!0),o(y,null,B(e.otherBeatmaps,n=>(a(),M(r,{key:n.id,beatmap:n},null,8,["beatmap"]))),128)),e.filterValue?u("",!0):(a(),o("div",Qi,[t("button",{class:"btn btn-sm btn-outline-info my-4",onClick:s[0]||(s[0]=I(n=>e.showMore(n),["prevent"]))},[Di,$(" show more "),Vi])]))],2)])):u("",!0)])}const Ni=w(Si,[["render",Fi]]),ji=v({components:{BeatmapInfo:ae,ModalDialog:ee,QuestImg:z,ModesIcons:Q},props:{selectedBeatmap:{type:Object,default:()=>({})}},watch:{selectedBeatmap(){this.selectedBeatmap&&this.$route.query.id!==this.selectedBeatmap.id&&this.$router.replace(`/beatmaps?id=${this.selectedBeatmap.id}`)}}}),Hi=["href"],Gi=t("i",{class:"fas fa-link"},null,-1),Ri={key:1};function Wi(e,s,i,d,p,m){const r=h("quest-img"),n=h("user-link"),c=h("modes-icons"),k=h("beatmap-info"),l=h("modal-dialog");return a(),M(l,{id:"editBeatmap",loaded:Boolean(e.selectedBeatmap),"header-class":e.selectedBeatmap?"bg-"+e.selectedBeatmap.status.toLowerCase():""},{header:P(()=>[_(r,{beatmap:e.selectedBeatmap},null,8,["beatmap"]),e.selectedBeatmap.url?(a(),o("a",{key:0,href:e.selectedBeatmap.url,target:"_blank"},[Gi,$(" "+b(e.selectedBeatmap.song.artist)+" - "+b(e.selectedBeatmap.song.title),1)],8,Hi)):(a(),o("span",Ri,b(e.selectedBeatmap.song.artist)+" - "+b(e.selectedBeatmap.song.title),1)),$(" |"),_(n,{class:"mx-1",user:e.selectedBeatmap.host},null,8,["user"]),_(c,{modes:[e.selectedBeatmap.mode]},null,8,["modes"])]),default:P(()=>[_(k,{beatmap:e.selectedBeatmap},null,8,["beatmap"])]),_:1},8,["loaded","header-class"])}const Ki=w(ji,[["render",Wi]]),zi={namespaced:!0,state:{allBeatmaps:[],userBeatmaps:[],filterValue:"",filterMode:J.any,filterStatus:"any",filterQuest:"any",selectedBeatmap:null,selectedBeatmapId:null,fetchLimit:30,isLoadingOtherBeatmaps:!0},mutations:{setAllBeatmaps(e,s){e.allBeatmaps=s},setUserBeatmaps(e,s){e.userBeatmaps=s},setFilterValue(e,s){e.filterValue=s},setFilterMode(e,s){e.filterMode=s},setFilterStatus(e,s){e.filterStatus=s},setFilterQuest(e,s){e.filterQuest=s},setIsLoadingOtherBeatmaps(e,s){e.isLoadingOtherBeatmaps=s},increaseFetchLimit(e){e.fetchLimit+=50},setSelectedBeatmap(e,s){const i=Object.values(N);s.tasks.sort(function(d,p){return i.indexOf(d.name)-i.indexOf(p.name)}),s.tasksLocked.sort(function(d,p){return i.indexOf(d)-i.indexOf(p)}),e.selectedBeatmap=s},addBeatmap(e,s){e.userBeatmaps.unshift(s)},updateBeatmap(e,s){let i=e.allBeatmaps.findIndex(d=>d.id===s.id);i!==-1&&(e.allBeatmaps[i]=s),i=e.userBeatmaps.findIndex(d=>d.id===s.id),i!==-1&&(e.userBeatmaps[i]=s)},deleteBeatmap(e,s){let i=e.allBeatmaps.findIndex(d=>d.id===s.id);i!==-1&&e.allBeatmaps.splice(i,1),i=e.userBeatmaps.findIndex(d=>d.id===s.id),i!==-1&&e.userBeatmaps.splice(i,1)}},getters:{filteredUserBeatmaps:e=>{let s=e.userBeatmaps;if(e.filterMode!==J.any){const i=e.filterMode;s=s.filter(d=>d.mode===i||d.mode===E.Hybrid)}if(e.filterStatus!=="any"&&(s=s.filter(i=>i.status===e.filterStatus)),e.filterQuest!=="any"&&(s=s.filter(i=>!i.quest)),e.filterValue){const i=e.filterValue.toLowerCase().trim().split(" ").filter(d=>d.length);s=s.filter(d=>{let p=d.song.artist+" "+d.song.title+" "+d.host.username;return d.tasks.forEach(m=>{m.mappers.forEach(r=>{p+=" "+r.username})}),p=p.toLowerCase(),i.some(m=>p.includes(m))})}return s},guestDifficultyBeatmaps:(e,s,i)=>s.filteredUserBeatmaps.filter(d=>{var p;return d.host.id!==((p=i.loggedInUser)==null?void 0:p.id)}),hostedBeatmaps:(e,s,i)=>s.filteredUserBeatmaps.filter(d=>{var p;return d.host.id===((p=i.loggedInUser)==null?void 0:p.id)})},actions:{updateBeatmap({commit:e,state:s},i){var d;e("updateBeatmap",i),((d=s.selectedBeatmap)==null?void 0:d.id)===i.id&&e("setSelectedBeatmap",i)},async updateFilterMode({commit:e,dispatch:s},i){e("setFilterMode",i),await s("loadOtherBeatmaps")},async updateFilterStatus({commit:e,dispatch:s},i){e("setFilterStatus",i),await s("loadOtherBeatmaps")},async updateFilterQuest({commit:e,dispatch:s},i){e("setFilterQuest",i),await s("loadOtherBeatmaps")},async updateFilterValue({commit:e,dispatch:s},i){e("setFilterValue",i),await s("loadOtherBeatmaps")},async loadOtherBeatmaps({commit:e,state:s}){var r;e("setIsLoadingOtherBeatmaps",!0);const i=s.filterStatus!=="any"?`&status=${s.filterStatus}`:"",d=s.filterQuest!=="any"?`&quest=${s.filterQuest}`:"",p=s.filterValue?`&search=${s.filterValue}`:"",m=await re.get(`/api/beatmaps/search?mode=${s.filterMode}&limit=${s.fetchLimit+i+d+p}`);(r=m.data)!=null&&r.allBeatmaps&&e("setAllBeatmaps",m.data.allBeatmaps),e("setIsLoadingOtherBeatmaps",!1)}}},Yi=zi,Xi=v({name:"BeatmapPage",components:{BeatmapPageFilters:Ss,HostedBeatmaps:zs,GuestDifficulties:tt,OtherBeatmaps:Ni,EditBeatmapModal:Ki,CreateBeatmapModal:_s},data(){return{isLoadingGuestBeatmaps:!0}},computed:A("beatmaps",["selectedBeatmap"]),beforeCreate(){this.$store.hasModule("beatmaps")||this.$store.registerModule("beatmaps",Yi)},async created(){const e=this.$route.query.id;let s,i;e?([s,i]=await Promise.all([this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.executeGet("/beatmaps/searchOnLoad/"+e)]),this.$http.isError(i)||(this.$store.commit("beatmaps/setSelectedBeatmap",i),this.$bs.showModal("editBeatmap"))):s=await this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.isError(s)||(this.$store.commit("beatmaps/setUserBeatmaps",s.beatmaps),this.$store.commit("beatmaps/setFilterMode",s.mainMode)),await Promise.all([this.loadGuestBeatmaps(),this.$store.dispatch("beatmaps/loadOtherBeatmaps")]),this.isLoadingGuestBeatmaps=!1},methods:{async loadGuestBeatmaps(){const e=await this.$http.executeGet("/beatmaps/guestBeatmaps");e&&this.$store.commit("beatmaps/setUserBeatmaps",e.userBeatmaps)}}}),Ji=t("div",{class:"radial-divisor"},null,-1),Zi=t("div",{class:"radial-divisor"},null,-1);function xi(e,s,i,d,p,m){const r=h("beatmap-page-filters"),n=h("hosted-beatmaps"),c=h("guest-difficulties"),k=h("other-beatmaps"),l=h("edit-beatmap-modal"),T=h("create-beatmap-modal");return a(),o("div",null,[_(r),_(n),Ji,_(c,{"is-loading-guest-beatmaps":e.isLoadingGuestBeatmaps},null,8,["is-loading-guest-beatmaps"]),Zi,_(k),_(l,{"selected-beatmap":e.selectedBeatmap},null,8,["selected-beatmap"]),_(T)])}const ln=w(Xi,[["render",xi]]);export{ln as default};
