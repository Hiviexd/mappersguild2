var t=Object.defineProperty,e=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s,a=(t,e)=>{for(var i in e||(e={}))n.call(e,i)&&r(t,i,e[i]);if(s)for(var i of s(e))o.call(e,i)&&r(t,i,e[i]);return t};import{d,m as c,D as l,i as u,o as g,q as m,w as h,k as b,t as p,f,b as C,G as S,N as y,l as v,F as j,g as D,e as k,n as x,j as I}from"./vendor.7edd7468.js";import{_ as B}from"./ModalDialog.2baf64cc.js";var $=d({name:"EditingCriteriaModal",components:{ModalDialog:B},data:()=>({editingScore:0,editingComment:""}),computed:a(a({},c({judgingDone:t=>t.judging.judgingDone})),l(["editingSubmission","editingCriteria"])),watch:{editingSubmission(){this.getUserInput()},editingCriteria(){this.getUserInput()}},methods:{getUserInput(){const t=this.getJudgingToCriterias(this.editingSubmission.id,this.editingCriteria.id);t?(this.editingScore=t.score,this.editingComment=t.comment):(this.editingScore=0,this.editingComment="")},getJudgingToCriterias(t,e){const i=this.judgingDone.find((e=>e.submission.id===t));if(!i)return null;const s=i.judgingScores.find((t=>t.criteria.id===e));return s||null},async save(t){var e,i;const s=await this.$http.executePost("/judging/save",{submissionId:null==(e=this.editingSubmission)?void 0:e.id,criteriaId:null==(i=this.editingCriteria)?void 0:i.id,score:this.editingScore,comment:this.editingComment},t);this.$http.isError(s)||(this.$store.commit("setJudgingDone",s.judgingDone),this.$store.dispatch("updateToastMessages",{message:s.success,type:"info"}))},closeModal(){var t;null==(t=document.getElementById("close-button"))||t.click()}}});const E={class:"text-capitalize"},w={key:0,class:"mb-3"},M=f("label",{class:"form-label",for:"score"},"Score",-1),T=["max"],O={key:1,class:"mb-3"},P=f("label",{class:"form-label",for:"comment"}," Comment ",-1),J=f("div",{id:"close-button","data-bs-dismiss":"modal"},null,-1);$.render=function(t,e,i,s,n,o){const r=u("modal-dialog");return g(),m(r,{id:"editing-judging-modal","data-bs-backdrop":"static","data-bs-keyboard":"false",loaded:Boolean(t.editingSubmission)},{header:h((()=>[b(p(t.editingSubmission.name)+": ",1),f("span",E,p(t.editingCriteria.name),1)])),default:h((()=>["comments"!=t.editingCriteria.name?(g(),C("div",w,[M,S(f("input",{id:"score","onUpdate:modelValue":e[0]||(e[0]=e=>t.editingScore=e),type:"number",step:"1",min:"0",max:t.editingCriteria.maxScore,class:"form-control"},null,8,T),[[y,t.editingScore]])])):(g(),C("div",O,[P,S(f("textarea",{id:"comment","onUpdate:modelValue":e[1]||(e[1]=e=>t.editingComment=e),maxlength:"3000",rows:"4",class:"form-control"},null,512),[[y,t.editingComment]])]))])),footer:h((()=>[f("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:e[2]||(e[2]=v((e=>t.closeModal()),["prevent"]))}," Close "),f("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:e[3]||(e[3]=v((e=>t.save(e)),["prevent"]))}," Save changes "),J])),_:1},8,["loaded"])};var U,F,_={state:{contest:null,judgingDone:[],editingSubmissionId:null,editingCriteriaId:null},mutations:{setContest(t,e){t.contest=e},setJudgingDone(t,e){t.judgingDone=e},setEditingSubmissionId(t,e){t.editingSubmissionId=e},setEditingCriteriaId(t,e){t.editingCriteriaId=e}},getters:{editingSubmission:t=>{var e;return null==(e=t.contest)?void 0:e.submissions.find((e=>e.id===t.editingSubmissionId))},editingCriteria:t=>{var e;return null==(e=t.contest)?void 0:e.criterias.find((e=>e.id===t.editingCriteriaId))}}},q=d({name:"JudgingPage",components:{EditingCriteriaModal:$},data:()=>({sortBy:"name",sortByCriteria:"",sortDesc:!1}),computed:(U=a({},c({contest:t=>t.judging.contest,judgingDone:t=>t.judging.judgingDone})),F={filteredSubmissions(){const t=[];for(let i=0;i<this.contest.submissions.length;i++)this.contest.submissions[i].evaluations.reduce(((t,e)=>e.vote?t+e.vote:t),0)>=this.contest.judgingThreshold&&t.push(i);const e=[];for(const i of t)e.push(this.contest.submissions[i]);return e},sortedSubmissions(){const t=this.filteredSubmissions;return t?("name"===this.sortBy?t.sort(((t,e)=>{var i,s;const n=null==(i=t.name)?void 0:i.toUpperCase(),o=null==(s=e.name)?void 0:s.toUpperCase();return n<o?this.sortDesc?-1:1:n>o?this.sortDesc?1:-1:0})):"total"===this.sortBy?t.sort(((t,e)=>{const i=this.getTotalScore(t.id),s=this.getTotalScore(e.id);return this.sortDesc?i-s:s-i})):"criteria"===this.sortBy?t.sort(((t,e)=>{const i=this.getScore(t.id,this.sortByCriteria),s=this.getScore(e.id,this.sortByCriteria);return this.sortDesc?i-s:s-i})):"completed"===this.sortBy&&t.sort(((t,e)=>{const i=this.isCompleted(t.id);return i===this.isCompleted(e.id)?0:this.sortDesc?i?1:-1:i?-1:1})),t):[]},maxPossibleScore(){return this.contest.criterias.reduce(((t,e)=>e.maxScore+t),0)}},e(U,i(F))),beforeCreate(){this.$store.hasModule("judging")||this.$store.registerModule("judging",_)},unmounted(){this.$store.hasModule("judging")&&this.$store.unregisterModule("judging")},async created(){const t=await this.$http.initialRequest("/judging/relevantInfo");this.$http.isError(t)||(this.$store.commit("setContest",t.contest),this.$store.commit("setJudgingDone",t.judgingDone))},methods:{selectForEditing(t,e){this.$store.commit("setEditingSubmissionId",t),this.$store.commit("setEditingCriteriaId",e)},getJudgingToCriterias(t,e){const i=this.judgingDone.find((e=>e.submission.id===t));if(!i)return null;const s=i.judgingScores.find((t=>t.criteria.id===e));return s||null},getScore(t,e){const i=this.getJudgingToCriterias(t,e);return i?i.score:0},getTotalScore(t){const e=this.judgingDone.find((e=>e.submission.id===t));return e?e.judgingScores.reduce(((t,e)=>e.score+t),0):0},isCompleted(t){const e=this.judgingDone.find((e=>e.submission.id===t));return!!e&&e.judgingScores.length===this.contest.criterias.length},sortSubmissionsBy(t,e){this.sortBy=t,this.sortDesc=!this.sortDesc,"criteria"===t&&e&&(this.sortByCriteria=e)}}});const z={key:0,class:"row mb-2"},N={class:"col-sm"},V={class:"card"},G={class:"card-header"},R={class:"my-2"},A=["href"],H={class:"card-body p-0"},K={class:"table table-responsive-sm mb-0"},L={class:"text-start"},Q=["onClick"],W={class:"text-start"},X=["onClick"],Y=f("i",{class:"me-1 fas fa-edit"},null,-1),Z={key:0},tt={class:"text-center"};q.render=function(t,e,i,s,n,o){const r=u("editing-criteria-modal");return g(),C("div",null,[t.contest?(g(),C("div",z,[f("div",N,[f("div",V,[f("div",G,[f("h4",R,p(t.contest.name),1),f("h5",null,[f("a",{href:t.contest.download,target:"_blank"},p(t.contest.download),9,A)])]),f("div",H,[f("table",K,[f("thead",null,[f("tr",null,[f("th",L,[f("a",{href:"#",onClick:e[0]||(e[0]=v((e=>t.sortSubmissionsBy("name")),["prevent"]))}," Entry's Name ")]),(g(!0),C(j,null,D(t.contest.criterias,(e=>(g(),C("th",{key:e.id},[f("a",{href:"#",class:"text-capitalize",onClick:v((i=>t.sortSubmissionsBy("criteria",e.id)),["prevent"])},p(e.name),9,Q)])))),128)),f("th",null,[f("a",{href:"#",onClick:e[1]||(e[1]=v((e=>t.sortSubmissionsBy("total")),["prevent"]))}," Total ")]),f("th",null,[f("a",{href:"#",onClick:e[2]||(e[2]=v((e=>t.sortSubmissionsBy("completed")),["prevent"]))}," Completed ")])])]),f("tbody",null,[(g(!0),C(j,null,D(t.sortedSubmissions,(e=>(g(),C("tr",{key:e.id},[f("td",W,p(e.name),1),(g(!0),C(j,null,D(t.contest.criterias,(i=>(g(),C("td",{key:i.id,class:"text-start"},[f("a",{href:"#","data-bs-toggle":"modal","data-bs-target":"#editing-judging-modal",onClick:v((s=>t.selectForEditing(e.id,i.id)),["prevent"])},[Y,"comments"!=i.name?(g(),C("span",Z,p(t.getScore(e.id,i.id)+`/${i.maxScore}`),1)):k("",!0)],8,X)])))),128)),f("td",null,p(t.getTotalScore(e.id))+"/"+p(t.maxPossibleScore),1),f("td",tt,[f("i",{class:x(["fa",t.isCompleted(e.id)?"fa-check text-success":"fa-times text-danger"])},null,2)])])))),128))])])])])])])):k("",!0),I(r)])};export{q as default};
