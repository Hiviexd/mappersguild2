import{d as I,_ as $,o as n,c as g,w as b,a as i,b as C,f as A,e as d,k as B,r as _,j as v,t as r,F as k,p as l,i as u,M as P,m as S}from"./index-96ae160e.js";import{C as M}from"./CopyPaste-6b52401b.js";import{M as D}from"./ModalDialog-2793dd9c.js";import{B as L}from"./BeatmapInfoAdmin-7009614d.js";import{D as N}from"./DataTable-7c0437e4.js";const T=I({name:"NewsPost",components:{CopyPaste:M,ModalDialog:D},data(){return{date:"2022-07-24",externalBeatmaps:[],users:[]}},methods:{async loadNewsInfo(t){const e=await this.$http.executeGet("/admin/beatmaps/loadNewsInfo/"+this.date,t);e&&(this.users=e.users)},separateCommas(t,e){return t<e-1?", ":""}}}),E={key:0},G=i("div",null," | User | Modes | Ranked beatmaps | Ranked difficulties | ",-1),R=i("div",null," | :-- | :-- | :-- | :-- | ",-1);function V(t,e,s,a,f,y){const c=l("copy-paste"),o=l("modal-dialog");return n(),g(o,{id:"newsPost",title:"Generate news post"},{default:b(()=>[i("p",null,[i("button",{class:"btn btn-sm btn-outline-info",onClick:e[0]||(e[0]=m=>t.loadNewsInfo(m))}," Load user info "),C(i("input",{"onUpdate:modelValue":e[1]||(e[1]=m=>t.date=m),class:"form-control form-control-sm mx-2 w-25",type:"text",autocomplete:"off",placeholder:"YYYY-MM-DD"},null,512),[[A,t.date]])]),t.users?(n(),d("p",E," Users with ranked maps/tasks: ")):B("",!0),t.users?(n(),g(c,{key:1,distinct:"users"},{default:b(()=>[G,R,(n(!0),d(k,null,_(t.users,m=>(n(),d("div",{key:m.id},[v(" | "+r(m.flag)+" ["+r(m.username)+"]("+r("https://osu.ppy.sh/users/"+m.osuId)+") | ",1),(n(!0),d(k,null,_(m.modes,(h,w)=>(n(),d("span",{key:h},r(h=="osu"?"osu!":h=="sb"?"Storyboarder":"osu!"+h)+r(t.separateCommas(w,m.modes.length)),1))),128)),v(" | "+r(m.hostCount)+" | "+r(m.taskCount)+" | ",1)]))),128))]),_:1})):B("",!0)]),_:1})}const Y=$(T,[["render",V]]),F=I({name:"BundledBeatmapsList",components:{CopyPaste:M},data(){return{bundledBeatmaps:[]}},computed:{osuBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="osu")},taikoBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="taiko")},catchBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="catch")},maniaBeatmaps(){return this.bundledBeatmaps.filter(t=>t.mode=="mania")}},methods:{async findBundledBeatmaps(t){const e=await this.$http.executeGet("/admin/beatmaps/findBundledBeatmaps",t);e&&!e.error&&(this.bundledBeatmaps=e)},findOsuId(t){const e=t.indexOf("beatmapsets/")+12,s=t.indexOf("#");let a="";return s!==-1?a=t.slice(e,s):a=t.slice(e),parseInt(a,10)}}}),j={class:"container card card-body py-1 mb-4"},x={key:0},q=i("p",null,"osu",-1),K=i("p",null,"taiko",-1),Q=i("p",null,"catch",-1),z=i("p",null,"mania",-1);function H(t,e,s,a,f,y){const c=l("copy-paste");return n(),d("div",j,[i("button",{class:"btn btn-sm w-100 btn-outline-info",onClick:e[0]||(e[0]=o=>t.findBundledBeatmaps(o))}," Load bundled beatmaps "),t.bundledBeatmaps.length?(n(),d("div",x,[q,u(c,{distinct:"osu"},{default:b(()=>[(n(!0),d(k,null,_(t.osuBeatmaps,o=>(n(),d("div",{key:o.id},r(t.findOsuId(o.url)),1))),128))]),_:1}),K,u(c,{distinct:"taiko"},{default:b(()=>[(n(!0),d(k,null,_(t.taikoBeatmaps,o=>(n(),d("div",{key:o.id},r(t.findOsuId(o.url)),1))),128))]),_:1}),Q,u(c,{distinct:"catch"},{default:b(()=>[(n(!0),d(k,null,_(t.catchBeatmaps,o=>(n(),d("div",{key:o.id},r(t.findOsuId(o.url)),1))),128))]),_:1}),z,u(c,{distinct:"mania"},{default:b(()=>[(n(!0),d(k,null,_(t.maniaBeatmaps,o=>(n(),d("div",{key:o.id},r(t.findOsuId(o.url)),1))),128))]),_:1})])):B("",!0)])}const J=$(F,[["render",H]]),W=I({name:"BeatmapPackIdListGenerator",components:{CopyPaste:M},data(){return{inputUrls:"",output:""}},methods:{findOsuId(t){const e=t.indexOf("beatmapsets/")+12,s=t.indexOf("#");let a="";return s!==-1?a=t.slice(e,s):a=t.slice(e),parseInt(a,10)},generateBeatmapPackIdList(){let t="";const e=this.inputUrls.split(`
`);for(const s of e){const a=this.findOsuId(s);isNaN(a)?t+=`FAILED (${s})`:t+=a,t+=","}this.output=t.substring(0,t.length-1)}}}),X={class:"container card card-body py-1 mb-4"},Z={key:0};function tt(t,e,s,a,f,y){const c=l("copy-paste");return n(),d("div",X,[C(i("textarea",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.inputUrls=o),class:"form-control form-control-sm mx-2 mt-2 w-100",type:"text",autocomplete:"off",placeholder:"map URLs separated by newlines..."},null,512),[[A,t.inputUrls]]),i("button",{class:"btn btn-sm w-100 btn-outline-info",onClick:e[1]||(e[1]=o=>t.generateBeatmapPackIdList())}," Generate beatmap pack ID list "),t.output.length?(n(),d("div",Z,[u(c,null,{default:b(()=>[v(r(t.output),1)]),_:1})])):B("",!0)])}const et=$(W,[["render",tt]]),st={state:{beatmaps:[]},mutations:{setBeatmaps(t,e){t.beatmaps=e},updateBeatmapStatus(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);s&&(s.status=e.status)},deleteTask(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);if(s){const a=s.tasks.findIndex(f=>f.id==e.taskId);a!==-1&&s.tasks.splice(a,1)}},deleteModder(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);if(s){const a=s.modders.findIndex(f=>f.id==e.modderId);a!==-1&&s.modders.splice(a,1)}},updateUrl(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);s&&(s.url=e.url)},updateStoryboardQuality(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);if(s){const a=s.tasks.findIndex(f=>f.id==e.taskId);a!==-1&&(s.tasks[a]=e.task)}},updatePackId(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);s&&(s.packId=e.packId)},updateIsShowcase(t,e){const s=t.beatmaps.find(a=>a.id==e.beatmapId);s&&(s.isShowcase=e.isShowcase)}}},at=st,nt=I({components:{NewsPost:Y,DataTable:N,BeatmapInfoAdmin:L,BundledBeatmapsList:J,BeatmapPackIdListGenerator:et,ModesIcons:P},data(){return{selectedBeatmapId:""}},computed:{...S({beatmaps:t=>t.beatmapsAdmin.beatmaps}),selectedBeatmap(){return this.beatmaps.find(t=>t.id===this.selectedBeatmapId)}},beforeCreate(){this.$store.hasModule("beatmapsAdmin")||this.$store.registerModule("beatmapsAdmin",at)},unmounted(){this.$store.hasModule("beatmapsAdmin")&&this.$store.unregisterModule("beatmapsAdmin")},async created(){const t=await this.$http.initialRequest("/admin/beatmaps/load");this.$http.isError(t)||this.$store.commit("setBeatmaps",t)},methods:{updateBeatmap(t){const e=this.beatmaps.findIndex(s=>s.id==t.id);e!==-1&&(this.beatmaps[e]=t)},formatMetadata(t){if(!t)return"";let e=t.artist+" - ";return t.title.length>40?e+=t.title.slice(0,40)+"...":e+=t.title,e}}}),ot={class:"container card card-body py-1"},dt={class:"row"},it={class:"col-sm"},rt=i("button",{class:"btn btn-sm btn-info w-100","data-bs-toggle":"modal","data-bs-target":"#newsPost"}," Create news post ",-1),mt={class:"text-truncate"},pt=["href"],lt={key:1,class:"ms-1"};function ut(t,e,s,a,f,y){const c=l("modes-icons"),o=l("user-link"),m=l("data-table"),h=l("beatmap-info-admin"),w=l("news-post"),U=l("bundled-beatmaps-list"),O=l("beatmap-pack-id-list-generator");return n(),d("div",null,[i("div",ot,[i("div",dt,[i("div",it,[rt,u(m,{data:t.beatmaps,headers:["METADATA","PACK ID","CREATOR","STATUS"],"custom-data-target":"#editBeatmap","onUpdate:selectedId":e[0]||(e[0]=p=>t.selectedBeatmapId=p)},{default:b(({obj:p})=>[i("td",mt,[u(c,{modes:[p.mode]},null,8,["modes"]),p.url?(n(),d("a",{key:0,href:p.url,class:"ms-1"},r(t.formatMetadata(p.song)),9,pt)):(n(),d("span",lt,r(t.formatMetadata(p.song)),1))]),i("td",null,r(p.packId),1),i("td",null,[u(o,{user:p.host},null,8,["user"])]),i("td",null,r(p.status),1)]),_:1},8,["data"])])])]),t.selectedBeatmap?(n(),g(h,{key:0,beatmap:t.selectedBeatmap,onUpdateBeatmap:e[1]||(e[1]=p=>t.updateBeatmap(p))},null,8,["beatmap"])):B("",!0),u(w),u(U),u(O)])}const kt=$(nt,[["render",ut]]);export{kt as default};
