import{d as $,m as g,j as V,_ as q,o as i,e as r,k as p,w as I,a as t,h as m,i as u,Q as R,l as _,t as f,n as k,F as Q,r as M,c as P,T as B,b,A as W,B as N,v as z,q as c,s as D,M as G,D as Y,E as K,G as H,H as J,u as E,y as X,z as Z,I as L,J as A}from"./index-9dfcaa88.js";import{F as x}from"./FilterBox-02ade9c0.js";import{M as ee,F as C}from"./extras-9e89c40e.js";import{S as se}from"./SubmitQuestModal-6ce0a032.js";import{A as te}from"./AssociatedBeatmaps-1d20dd9e.js";import{M as ie}from"./ModalDialog-73183670.js";import"./beatmap-c2b9f550.js";const oe=$({components:{FilterBox:x,ModeFilters:ee},computed:{...g(["loggedInUser"]),...g("quests",["filterMode"]),validRank(){return this.loggedInUser.rank>=1}},methods:V("quests",["updateFilterValue","searchQuests"])}),re={class:"container card card-body py-3 mb-2"},ne=["disabled","data-bs-toggle","title","data-bs-target"],ae=t("i",{class:"fas fa-plus fa-xs"},null,-1);function de(e,s,n,a,h,y){const d=u("mode-filters"),o=u("filter-box");return i(),r("div",re,[p(o,{placeholder:"enter to search for quest...","onUpdate:filterValue":s[1]||(s[1]=l=>e.updateFilterValue(l))},{filters:I(()=>[p(d,{"filter-mode":e.filterMode,"onUpdate:filterMode":s[0]||(s[0]=l=>e.searchQuests(l))},null,8,["filter-mode"])]),default:I(()=>[t("button",{class:"btn btn-primary",disabled:!e.validRank,"data-bs-toggle":e.validRank?"modal":"tooltip",title:e.validRank?"":"designing custom quests is available to tier 1+ users only","data-bs-target":e.validRank?"#submitQuest":""},[m(" Submit quest for approval "),ae],8,ne)]),_:1})])}const ue=q(oe,[["render",de]]),le=$({components:{QuestCard:R},props:{status:{type:String,required:!0},quests:{type:Array,required:!0}},data(){return{collapsed:this.status==="Open"}},computed:{...g("quests",["isLoadingQuests","isFirstLoadDone"]),questCount(){return this.openQuests&&!this.isFirstLoadDone||!this.isLoadingQuests?this.quests.length.toString():"..."},openQuests(){return this.status==="Open"}}}),pe={class:"container card card-body my-2"},ce=["href"],me=["id"],he={class:"col-sm"};function ye(e,s,n,a,h,y){const d=u("quest-card");return i(),r("div",pe,[t("h5",{class:k(e.collapsed?"mb-2":"mb-0")},[t("a",{href:"#"+e.status,"data-bs-toggle":"collapse",onClick:s[0]||(s[0]=_(o=>e.collapsed=!e.collapsed,["prevent"]))},[m(f(e.status)+" quests ("+f(e.questCount)+") ",1),t("i",{class:k(["fas",e.collapsed?"fa-angle-up":"fa-angle-down"])},null,2)],8,ce)],2),t("div",{id:e.status,class:k(["row",{"loading-data":e.isLoadingQuests&&e.isFirstLoadDone,show:e.openQuests,collapse:!e.openQuests}])},[t("div",he,[p(B,{name:"list",tag:"div"},{default:I(()=>[(i(!0),r(Q,null,M(e.quests,o=>(i(),P(d,{key:o.id,quest:o},null,8,["quest"]))),128))]),_:1})])],10,me)])}const fe=q(le,[["render",ye]]),$e=$({name:"LeaderActions",props:{party:{type:Object,required:!0},status:{type:String,required:!0},quest:{type:Object,required:!0},price:{type:Number,required:!0}},data(){return{inviteUsername:"",dropdownUserId:""}},computed:{...g(["loggedInUser"]),enoughPoints(){let e=!0;return this.party.members.forEach(s=>{s.availablePoints<this.price&&(e=!1)}),e}},methods:{async togglePartyLock(e){const s=await this.$http.executePost(`/parties/${this.party.id}/toggleLock`,{},e);this.$http.isError(s)||this.$store.dispatch("quests/updateParty",s)},async inviteToParty(e){const s=await this.$http.executePost(`/parties/${this.party.id}/invite`,{username:this.inviteUsername},e);this.$http.isError(s)||this.$store.dispatch("updateToastMessages",{message:s.success,type:"success"})},async transferPartyLeader(e){if(!this.dropdownUserId){this.$store.dispatch("updateToastMessages",{message:"Select a member to transfer leadership!",type:"info"});return}const s=await this.$http.executePost(`/parties/${this.party.id}/transferLeadership`,{userId:this.dropdownUserId},e);this.$http.isError(s)||this.$store.dispatch("quests/updateParty",s)},async kickPartyMember(e){if(!this.dropdownUserId){this.$store.dispatch("updateToastMessages",{message:"Select a member to kick :(",type:"info"});return}if(confirm(`Are you sure? ${this.party.members.length==this.quest.minParty&&this.quest.status=="wip"?"This party has the minimum required members to run the quest, so kicking will cause the quest to be dropped.":""}`)){const s=await this.$http.executePost(`/parties/${this.party.id}/kick`,{userId:this.dropdownUserId},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateParty",s),this.quest.status=="wip"&&(s.members.length<this.quest.minParty||s.rank<this.quest.minRank)&&this.dropQuest(e))}},async extendDeadline(e){if(confirm(`Are you sure?

All members of your party will spend 10 points.

You have ${this.loggedInUser.availablePoints} points available.`)){const s=await this.$http.executePost(`/quests/${this.quest.id}/extendDeadline`,{},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateQuest",s.quest),this.$store.commit("setAvailablePoints",s.availablePoints))}},async dropQuest(e){if(confirm("Are you sure?")){const s=await this.$http.executePost(`/quests/${this.quest.id}/drop`,{},e);this.$http.isError(s)||(this.$bs.hideModal("editQuest"),this.$store.dispatch("quests/setQuests",s))}},async acceptQuest(e){const s=this.party.modes;let n="";for(let a=0;a<s.length;a++)n+=s[a],a<s.length-1&&(n+=", ");if(confirm(`Are you sure?

This quest will only allow beatmaps of these modes: ${n}

All members of your party will spend ${this.price} points.

You have ${this.loggedInUser.availablePoints} points available.`)){const a=await this.$http.executePost(`/quests/${this.quest.id}/accept`,{},e);this.$http.isError(a)||(this.$store.dispatch("quests/setQuests",a.quests),this.$store.commit("setAvailablePoints",a.availablePoints),this.$bs.hideModal("editQuest"))}},async deleteParty(e){if(confirm("Are you sure?")){const s=await this.$http.executePost(`/parties/${this.party.id}/delete`,{},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateQuest",s),this.$bs.hideModal("editQuest"))}}}}),qe={class:"row row-cols-md-auto g-2 align-items-center mb-3"},be={class:"col-12"},_e={class:"input-group input-group-sm"},ge={class:"col-12"},ve={class:"input-group input-group-sm"},Qe=t("option",{value:"",disabled:""}," Select a member ",-1),ke=["value"],Pe={class:"col-12"},we={class:"col-12"},Ie=t("i",{class:"fas fa-minus fa-xs"},null,-1),Me={class:"col-12"},De=t("i",{class:"fas fa-coins fa-xs"},null,-1),Ue={class:"col-12"},Oe=t("i",{class:"fas fa-times fa-xs"},null,-1),Le={key:2,class:"col-12"},Ae=["disabled"];function Ce(e,s,n,a,h,y){const d=D("bs-tooltip");return i(),r("div",qe,[t("div",be,[t("div",_e,[b(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>e.inviteUsername=o),class:"form-control",type:"text",placeholder:"username...",maxlength:"18",onKeyup:s[1]||(s[1]=N(o=>e.inviteToParty(o),["enter"]))},null,544),[[W,e.inviteUsername]]),b((i(),r("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=o=>e.inviteToParty(o))},[m(" Invite ")])),[[d,"invite user to party"]])])]),t("div",ge,[t("div",ve,[b(t("select",{"onUpdate:modelValue":s[3]||(s[3]=o=>e.dropdownUserId=o),class:"form-select"},[Qe,(i(!0),r(Q,null,M(e.party.members,o=>(i(),r(Q,{key:o.id},[o.id!==e.loggedInUser.id?(i(),r("option",{key:0,value:o.id},f(o.username),9,ke)):c("",!0)],64))),128))],512),[[z,e.dropdownUserId]]),b((i(),r("button",{class:"btn btn-outline-info",onClick:s[4]||(s[4]=o=>e.transferPartyLeader(o))},[m(" Lead ")])),[[d,"change party leader"]]),b((i(),r("button",{class:"btn btn-outline-info",onClick:s[5]||(s[5]=o=>e.kickPartyMember(o))},[m(" Kick ")])),[[d,"kick party member"]])])]),e.status==="open"?(i(),r(Q,{key:0},[t("div",Pe,[t("button",{class:"btn btn-sm btn-outline-info w-100",onClick:s[6]||(s[6]=_(o=>e.togglePartyLock(o),["prevent"]))},[m(f(e.party.lock?"Unlock":"Lock")+" ",1),t("i",{class:k(["fas",e.party.lock?"fa-unlock":"fa-lock"])},null,2)])]),t("div",we,[t("button",{class:"btn btn-sm btn-outline-danger w-100",onClick:s[7]||(s[7]=_(o=>e.deleteParty(o),["prevent"]))},[m(" Delete "),Ie])])],64)):c("",!0),e.status==="wip"?(i(),r(Q,{key:1},[t("div",Me,[b((i(),r("button",{class:"btn btn-sm btn-outline-danger w-100",onClick:s[8]||(s[8]=_(o=>e.extendDeadline(o),["prevent"]))},[m(" Extend deadline for 10 points "),De])),[[d,"each party member spends 10 points to extend quest deadline"]])]),t("div",Ue,[t("button",{class:"btn btn-sm btn-outline-danger w-100",onClick:s[9]||(s[9]=_(o=>e.dropQuest(o),["prevent"]))},[m(" Drop quest "),Oe])])],64)):e.quest.status==="open"&&e.party.rank>=e.quest.minRank&&e.party.members.length>=e.quest.minParty&&e.party.members.length<=e.quest.maxParty?(i(),r("div",Le,[t("button",{class:"btn btn-sm btn-outline-success w-100",disabled:!e.enoughPoints,onClick:s[10]||(s[10]=_(o=>e.acceptQuest(o),["prevent"]))},[m(f(e.price?`Accept quest for ${e.price} ${e.price==1?"point":"points"} from each party member`:"Accept Quest")+" ",1),t("i",{class:k(["fas small",e.price?"fa-coins":"fa-check"])},null,2)],8,Ae)])):c("",!0)])}const Ee=q($e,[["render",Ce]]);var w=(e=>(e.Open="open",e.WIP="wip",e.Done="done",e.Pending="pending",e.Rejected="rejected",e.Hidden="hidden",e.Scheduled="scheduled",e))(w||{});const U=$({props:{party:{type:Object,default:null},quest:{type:Object,default:null}},computed:{...g(["loggedInUser"]),isWip(){var e;return((e=this.quest)==null?void 0:e.status)==w.WIP},isOpen(){var e;return((e=this.quest)==null?void 0:e.status)==w.Open},isDone(){var e;return((e=this.quest)==null?void 0:e.status)==w.Done},isLeader(){var e;return((e=this.party)==null?void 0:e.leader.id)==this.loggedInUser.id}}}),Fe=$({mixins:[U],props:{party:{type:Object,required:!0}}}),Te={key:0,class:"fas fa-lock fa-sm"},Se={key:1,class:"fas fa-unlock fa-sm"};function je(e,s,n,a,h,y){const d=D("bs-tooltip");return i(),r("span",null,[e.party.lock?b((i(),r("i",Te,null,512)),[[d,"party is invite-only"]]):b((i(),r("i",Se,null,512)),[[d,"party is open"]])])}const Ve=q(Fe,[["render",je]]),Re=$({name:"PartyTitle",components:{LockDetail:Ve},mixins:[U],props:{party:{type:Object,required:!0},quest:{type:Object,required:!0},memberOfAnyParty:Boolean},computed:{...g(["loggedInUser"]),inCurrentParty(){return this.party.members.some(e=>e.id===this.loggedInUser.id)}},methods:{async joinParty(e){const s=await this.$http.executePost(`/parties/${this.party.id}/join`,{},e);this.$http.isError(s)||this.$store.dispatch("quests/updateParty",s)},async leaveParty(e){if(confirm(`Are you sure? ${this.party.members.length==this.quest.minParty&&this.isWip?"This party has the minimum required members to run the quest, so leaving will cause the quest to be dropped.":""}`)){const s=await this.$http.executePost(`/parties/${this.party.id}/leave`,{},e);this.$http.isError(s)||(this.$store.dispatch("quests/updateParty",s),this.isWip&&(s.members.length<this.quest.minParty||s.rank<this.quest.minRank)&&this.dropQuest(e))}},async dropQuest(e){const s=await this.$http.executePost(`/quests/${this.quest.id}/drop`,{},e);this.$http.isError(s)||(this.$store.dispatch("quests/setQuests",s),this.$bs.hideModal("editQuest"))}}}),Be={class:"row"},We={class:"col-sm"},Ne={class:"d-inline-block"},ze=t("i",{class:"fas fa-user-plus fa-xs"},null,-1),Ge=t("i",{class:"fas fa-user-minus fa-xs"},null,-1);function Ye(e,s,n,a,h,y){const d=u("user-link"),o=u("lock-detail"),l=D("bs-tooltip");return i(),r("div",Be,[t("div",We,[t("h5",Ne,[p(d,{user:e.party.leader},null,8,["user"]),m("'s party ")]),e.party.rank>0?b((i(),r("i",{key:0,class:k(["fas fa-crown fa-sm mx-1","text-rank-"+e.party.rank])},null,2)),[[l,`rank ${e.party.rank} party`]]):c("",!0),e.isOpen?(i(),P(o,{key:1,party:e.party},null,8,["party"])):c("",!0),e.loggedInUser.id!=e.party.leader.id?(i(),r(Q,{key:2},[!e.memberOfAnyParty&&!e.party.lock&&e.isOpen?(i(),r("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:s[0]||(s[0]=_(v=>e.joinParty(v),["prevent"]))},[m(" Join "),ze])):c("",!0),e.inCurrentParty&&(e.isOpen||e.isWip)?(i(),r("button",{key:1,class:"btn btn-sm btn-outline-danger ms-1",onClick:s[1]||(s[1]=_(v=>e.leaveParty(v),["prevent"]))},[m(" Leave "),Ge])):c("",!0)],64)):c("",!0)])])}const Ke=q(Re,[["render",Ye]]),He=$({props:{quest:{type:Object,required:!0}},computed:{timeRemaining(){if(!this.quest.deadline)return 0;const e=new Date().getTime(),s=new Date(this.quest.deadline).getTime()-e;return Math.floor(s/(1e3*60*60*24))}}}),Je={class:"row"},Xe={class:"col-sm"},Ze={key:0,class:"ms-3"},xe={class:"text-secondary"},es={key:1},ss={class:"ms-3"},ts={class:"text-secondary"},is={class:"ms-3"};function os(e,s,n,a,h,y){return i(),r("div",Je,[t("div",Xe,[e.quest.status==="done"?(i(),r("div",Ze,[m(" Completed: "),t("span",xe,f(e.quest.completed.toString().slice(0,10)),1)])):c("",!0),e.quest.status==="wip"?(i(),r("div",es,[t("div",ss,[m(" Deadline: "),t("span",ts,f(e.quest.deadline.toString().slice(0,10)),1)]),t("div",is,[m(" Time remaining: "),t("span",{class:k(e.timeRemaining>0?"text-secondary":"text-danger")},f(e.timeRemaining)+" days",3)])])):c("",!0)])])}const rs=q(He,[["render",os]]),ns=$({props:{members:{type:Array,required:!0},price:{type:Number,required:!0},status:{type:String,required:!0}}}),as={class:"ms-3 mt-1"},ds={class:"mb-0"},us={key:1,class:"text-danger"};function ls(e,s,n,a,h,y){const d=u("user-link"),o=D("bs-tooltip");return i(),r("div",as,[t("b",null," Members: ("+f(e.members.length)+") ",1),t("ul",ds,[(i(!0),r(Q,null,M(e.members,l=>(i(),r("li",{key:l.id},[p(d,{class:"me-1",user:l},null,8,["user"]),l.rank>0?b((i(),r("i",{key:0,class:k(["fas fa-crown","text-rank-"+l.rank])},null,2)),[[o,`rank ${l.rank} user`]]):c("",!0),e.status=="open"&&l.availablePoints<e.price?(i(),r("span",us,f(`(${l.availablePoints} points available)`),1)):c("",!0)]))),128))])])}const ps=q(ns,[["render",ls]]),cs=$({components:{ModesIcons:G},props:{party:{type:Object,required:!0},questId:{type:String,required:!0}},methods:{async togglePartyMode(e){const s=await this.$http.executePost(`/parties/${this.party.id}/toggleMode`,{mode:e});this.$http.isError(s)||this.$store.dispatch("quests/updateParty",s)}}}),ms={class:"ms-3 mt-1"},hs=t("b",{class:"me-1"},"Modes:",-1);function ys(e,s,n,a,h,y){var o;const d=u("modes-icons");return i(),r("div",ms,[hs,p(d,{modes:e.party.modes,toggler:e.party.leader.id==((o=e.$store.state.loggedInUser)==null?void 0:o.id),onToggle:s[0]||(s[0]=l=>e.togglePartyMode(l))},null,8,["modes","toggler"])])}const fs=q(cs,[["render",ys]]),$s=$({name:"PartyDetail",components:{LeaderActions:Ee,PartyTitle:Ke,QuestTiming:rs,MembersDetail:ps,ModeDetail:fs},mixins:[U],props:{party:{type:Object,default:null},quest:{type:Object,required:!0},memberOfAnyParty:Boolean},computed:{...g(["loggedInUser"])}}),qs={class:"container card card-body mt-1"};function bs(e,s,n,a,h,y){const d=u("leader-actions"),o=u("party-title"),l=u("quest-timing"),v=u("mode-detail"),O=u("members-detail");return i(),r("div",qs,[e.isOpen||e.isWip?(i(),r(Q,{key:0},[e.party.leader.id==e.loggedInUser.id?(i(),P(d,{key:0,party:e.party,status:e.quest.status,quest:e.quest,price:e.quest.price},null,8,["party","status","quest","price"])):c("",!0),p(o,{party:e.party,quest:e.quest,"member-of-any-party":e.memberOfAnyParty},null,8,["party","quest","member-of-any-party"])],64)):c("",!0),e.isDone||e.isWip?(i(),P(l,{key:1,quest:e.quest},null,8,["quest"])):c("",!0),e.isOpen?(i(),P(v,{key:2,party:e.party,"quest-id":e.quest.id},null,8,["party","quest-id"])):c("",!0),p(O,{members:e.party.members,price:e.quest.price,status:e.quest.status},null,8,["members","price","status"])])}const _s=q($s,[["render",bs]]),gs=$({components:{PartyDetail:_s,AssociatedBeatmaps:te},mixins:[U],props:{quest:{type:Object,required:!0},memberOfAnyParty:Boolean,collapse:Boolean},methods:{async createParty(e){const s=await this.$http.executePost("/parties/create",{questId:this.quest.id},e);this.$http.isError(s)||this.$store.dispatch("quests/updateQuest",s)}}}),vs={class:"container"},Qs={key:0,class:"row"},ks={class:"col"},Ps=t("i",{class:"fas fa-plus fa-xs"},null,-1),ws={class:"col-sm-12"},Is={key:0,class:"col-sm-12 mt-2"};function Ms(e,s,n,a,h,y){const d=u("party-detail"),o=u("associated-beatmaps");return i(),r("div",vs,[e.isOpen&&!e.memberOfAnyParty?(i(),r("div",Qs,[t("div",ks,[t("button",{class:"btn btn-sm w-100 btn-outline-info mb-2",onClick:s[0]||(s[0]=_(l=>e.createParty(l),["prevent"]))},[m(" Add party "),Ps])])])):c("",!0),(i(!0),r(Q,null,M(e.quest.parties,l=>(i(),r("div",{key:l.id,class:"row"},[t("div",ws,[p(d,{party:l,quest:e.quest,"member-of-any-party":e.memberOfAnyParty},null,8,["party","quest","member-of-any-party"])]),e.isDone||e.isWip?(i(),r("div",Is,[p(o,{"associated-maps":e.quest.associatedMaps},null,8,["associated-maps"])])):c("",!0)]))),128))])}const Ds=q(gs,[["render",Ms]]),Us=$({name:"ExpirationDate",props:{isExpired:{type:Boolean,required:!0},expiration:{type:Date,required:!0}}}),Os={class:"small"},Ls={class:"text-white-50"};function As(e,s,n,a,h,y){return i(),r("div",Os,[m(" Quest "+f(e.isExpired?"expired":"expires")+": ",1),t("span",Ls,f(e.expiration.toLocaleDateString()),1)])}const Cs=q(Us,[["render",As]]),Es=$({name:"ReopenQuest",props:{questId:{type:String,required:!0},status:{type:String,required:!0},price:{type:Number,required:!0}},computed:{...g(["loggedInUser"]),enoughPoints(){return this.loggedInUser.availablePoints-this.price>0}},methods:{async reopenQuest(e){if(confirm(`Are you sure?

You are about to spend ${this.price} Mappers' Guild points to re-open this quest.

You have ${this.loggedInUser.availablePoints} points available.`)){const s=await this.$http.executePost(`/quests/${this.questId}/reopen`,{status:this.status},e);this.$http.isError(s)||(this.$store.dispatch("quests/setQuests",s.quests),this.$store.commit("setAvailablePoints",s.availablePoints),this.$bs.hideModal("editQuest"))}}}}),Fs={class:"row"},Ts={class:"col-sm-12"},Ss=["disabled"],js=t("i",{class:"fas fa-coins fa-xs"},null,-1);function Vs(e,s,n,a,h,y){return i(),r("div",Fs,[t("div",Ts,[t("button",{class:"btn btn-sm w-100 btn-outline-success mb-2",disabled:!e.enoughPoints,onClick:s[0]||(s[0]=_(d=>e.reopenQuest(d),["prevent"]))},[m(" Re-open quest for "+f(e.price)+" points ",1),js],8,Ss)])])}const Rs=q(Es,[["render",Vs]]),Bs=$({name:"QuestInfoModal",components:{QuestSize:Y,QuestPrice:K,QuestTime:H,QuestModes:J,PartyInfo:Ds,ModalDialog:ie,ExpirationDate:Cs,ReopenQuest:Rs},computed:{...g(["loggedInUser"]),...E("quests",["selectedQuest"]),memberOfAnyParty(){return this.selectedQuest.parties.some(e=>e.members.some(s=>s.id===this.loggedInUser.id))},headerClass(){var e;return(e=this.selectedQuest)!=null&&e.creator?this.selectedQuest.creator.username=="pishifat"?"bg-warning":"bg-primary":""}}});const Ws=e=>(X("data-v-51936c76"),e=e(),Z(),e),Ns=["href"],zs={key:0},Gs={key:1,class:"small"},Ys=["href"],Ks={class:"container"},Hs={class:"row"},Js={class:"col-sm-12 text-center"},Xs={key:0},Zs=["href"],xs=["src"],et={key:1},st=["src"],tt={class:"row mb-3 text-center"},it={class:"col-sm-12"},ot={class:"col-sm-12 text-white-50"},rt={class:"row justify-content-center text-center"},nt={class:"col-sm-12"},at={class:"col-sm-6 col-lg-2"},dt={class:"col-sm-6 col-lg-2"},ut={class:"col-sm-6 col-lg-4"},lt={key:0,class:"col-sm-6 col-lg-3"},pt=Ws(()=>t("div",{class:"radial-divisor"},null,-1));function ct(e,s,n,a,h,y){const d=u("user-link"),o=u("quest-size"),l=u("quest-price"),v=u("quest-time"),O=u("quest-modes"),F=u("expiration-date"),T=u("reopen-quest"),S=u("party-info"),j=u("modal-dialog");return i(),P(j,{id:"editQuest","header-class":e.headerClass,loaded:Boolean(e.selectedQuest)},{header:I(()=>[t("a",{href:`/quests?id=${e.selectedQuest.id}`,target:"_blank",class:"text-dark"},f(e.selectedQuest.name),9,Ns),e.selectedQuest.creator.username!="pishifat"?(i(),r("span",zs,[m(" created by "),p(d,{class:"text-dark",user:e.selectedQuest.creator},null,8,["user"])])):c("",!0),e.selectedQuest.art?(i(),r("div",Gs,[t("a",{href:"https://osu.ppy.sh/beatmaps/artists/"+e.selectedQuest.art,target:"_blank"}," View featured artist listing ",8,Ys)])):c("",!0)]),default:I(()=>[t("div",Ks,[t("div",Hs,[t("div",Js,[e.selectedQuest.art?(i(),r("span",Xs,[t("a",{href:"https://osu.ppy.sh/beatmaps/artists/"+e.selectedQuest.art,target:"_blank"},[t("img",{src:"https://assets.ppy.sh/artists/"+e.selectedQuest.art+"/cover.jpg",class:"card-avatar-img-modal"},null,8,xs)],8,Zs)])):(i(),r("span",et,[t("img",{src:e.selectedQuest.isMbc?"/images/mbc-icon.png":"/images/no-art-icon.png",class:"card-avatar-img-modal"},null,8,st)]))])]),t("div",tt,[t("div",it,[t("h5",null,f(e.selectedQuest.name),1)]),t("div",ot,f(e.selectedQuest.descriptionMain),1)]),t("div",rt,[t("div",nt,[p(o,{quest:e.selectedQuest},null,8,["quest"])]),t("div",at,[p(l,{price:e.selectedQuest.price},null,8,["price"])]),t("div",dt,[p(v,{timeframe:e.selectedQuest.timeframe},null,8,["timeframe"])]),t("div",ut,[p(O,{status:e.selectedQuest.status,modes:e.selectedQuest.modes},null,8,["status","modes"])]),e.selectedQuest.expiration?(i(),r("div",lt,[p(F,{"is-expired":e.selectedQuest.isExpired,expiration:new Date(e.selectedQuest.expiration)},null,8,["is-expired","expiration"])])):c("",!0)]),pt,e.selectedQuest.isExpired?(i(),P(T,{key:0,"quest-id":e.selectedQuest.id,status:e.selectedQuest.status,price:e.selectedQuest.reopenPrice},null,8,["quest-id","status","price"])):(i(),P(S,{key:1,quest:e.selectedQuest,"member-of-any-party":e.memberOfAnyParty},null,8,["quest","member-of-any-party"]))])]),_:1},8,["header-class","loaded"])}const mt=q(Bs,[["render",ct],["__scopeId","data-v-51936c76"]]),ht={updateQuest({commit:e},s){e("updateQuest",s)},updateParty({commit:e},s){e("updateParty",s)},setQuests({commit:e},s){e("setQuests",s)},updateFilterValue({commit:e},s){e("setFilterValue",s)},async loadQuests({commit:e,rootState:s},n){var d;const a=(d=s.loggedInUser)==null?void 0:d.mainMode;let h=`/quests/search?mode=${a}&status=${w.Open}`;n&&(h+=`&id=${n}`);const y=await L.initialRequest(h);A(y)||(e("setQuests",y),e("setFilterMode",a),n&&e("setSelectedQuestId",n))},async searchQuests({commit:e,state:s},n){n&&e("setFilterMode",n),e("setIsLoadingQuests",!0);const a=await L.executeGet(`/quests/search?mode=${s.filterMode}`);A(a)||e("setQuests",a),e("setIsLoadingQuests",!1)}},yt={namespaced:!0,state:{quests:[],filterValue:"",filterMode:C.any,isLoadingQuests:!0,selectedQuestId:null,isFirstLoadDone:!1},mutations:{setFirstLoadDone(e){e.isFirstLoadDone=!0},setQuests(e,s){e.quests=s},setFilterValue(e,s){e.filterValue=s},setFilterMode(e,s){e.filterMode=s},setIsLoadingQuests(e,s){e.isLoadingQuests=s},setSelectedQuestId(e,s){e.selectedQuestId=s},updateQuest(e,s){const n=e.quests.findIndex(a=>a.id===s.id);n!==-1&&(e.quests[n]=s)},updateParty(e,s){const n=e.quests.findIndex(a=>a.id===e.selectedQuestId);if(n!==-1){const a=e.quests[n].parties.findIndex(h=>h.id===s.id);a!==-1&&(e.quests[n].parties[a]=s)}}},getters:{selectedQuest:e=>{if(e.selectedQuestId)return e.quests.find(s=>s.id===e.selectedQuestId)},filteredQuests:e=>{let s=e.quests;if(e.filterMode!==C.any){const n=e.filterMode;s=s.filter(a=>a.modes.includes(n))}return e.filterValue.length>2&&(s=s.filter(n=>n.name.toLowerCase().includes(e.filterValue.toLowerCase()))),s},openQuests:(e,s)=>s.filteredQuests.filter(n=>n.status==w.Open&&!n.isExpired),wipQuests:(e,s)=>s.filteredQuests.filter(n=>n.status==w.WIP),completeQuests:(e,s)=>s.filteredQuests.filter(n=>n.status==w.Done),expiredQuests:(e,s)=>s.filteredQuests.filter(n=>n.isExpired)},actions:ht},ft=yt,$t=$({name:"QuestPage",components:{QuestPageFilters:ue,StatusQuests:fe,SubmitQuestModal:se,QuestInfoModal:mt},computed:{...g("quests",["isFirstLoadDone"]),...E("quests",["openQuests","wipQuests","completeQuests","expiredQuests"])},beforeCreate(){this.$store.hasModule("quests")||this.$store.registerModule("quests",ft)},async created(){const e=this.$route.query.id;await this.$store.dispatch("quests/loadQuests",e),e&&this.$bs.showModal("editQuest"),await this.$store.dispatch("quests/searchQuests"),this.$store.commit("quests/setFirstLoadDone")}}),qt=t("div",{class:"radial-divisor"},null,-1),bt=t("div",{class:"radial-divisor"},null,-1);function _t(e,s,n,a,h,y){const d=u("quest-page-filters"),o=u("status-quests"),l=u("submit-quest-modal"),v=u("quest-info-modal");return i(),r("div",null,[p(d),p(o,{status:"Open",quests:e.openQuests},null,8,["quests"]),qt,p(o,{status:"Work-in-progress",quests:e.wipQuests},null,8,["quests"]),bt,p(o,{status:"Complete",quests:e.completeQuests},null,8,["quests"]),p(o,{status:"Expired",quests:e.expiredQuests},null,8,["quests"]),p(l),p(v)])}const Mt=q($t,[["render",_t]]);export{Mt as default};
