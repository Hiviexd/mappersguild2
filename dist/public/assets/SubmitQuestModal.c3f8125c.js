var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;import{d as o,o as n,b as u,f as d,t as m,r as c,e as p,i as h,q as b,w as f,g as y,F as g,m as v,j as q,k as V,l as k}from"./vendor.7edd7468.js";import{_ as C}from"./ModalDialog.2baf64cc.js";var w=o({name:"FormFieldBase",props:{label:{type:String,required:!0},description:{type:String,default:""}}});const P={class:"mb-3 row"},x={class:"col-sm-3 col-form-label"},A={class:"col-sm-9"},M={key:0,class:"text-secondary small"};w.render=function(e,t,s,a,i,l){return n(),u("div",P,[d("div",x,[d("b",null,m(e.label),1)]),d("div",A,[c(e.$slots,"default"),e.description?(n(),u("p",M,m(e.description),1)):p("",!0)])])};var j=o({name:"FormField",components:{FormFieldBase:w},props:{label:{type:String,required:!0},placeholder:{type:String,default:""},modelValue:{type:[String,Number],required:!0},type:{type:String,default:"text"},description:{type:String,default:""}},emits:["update:modelValue"]});const S=["value","type","placeholder"];j.render=function(e,t,s,a,i,l){const r=h("form-field-base");return n(),b(r,{label:e.label,description:e.description},{default:f((()=>[d("input",{value:e.modelValue,type:e.type,placeholder:e.placeholder,class:"form-control form-control-sm",autocomplete:"off",onInput:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.value))},null,40,S)])),_:1},8,["label","description"])};var F=o({name:"FormField",components:{FormFieldBase:w},props:{label:{type:String,required:!0},placeholder:{type:String,default:""},modelValue:{type:String,required:!0},rows:{type:Number,default:3}},emits:["update:modelValue"]});const Q=["value","rows","placeholder"];F.render=function(e,t,s,a,i,l){const r=h("form-field-base");return n(),b(r,{label:e.label},{default:f((()=>[d("textarea",{value:e.modelValue,class:"form-control form-control-sm",rows:e.rows,placeholder:e.placeholder,onInput:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.value))},null,40,Q)])),_:1},8,["label"])};var $=o({name:"FormField",components:{FormFieldBase:w},props:{label:{type:String,required:!0},placeholder:{type:String,default:"..."},modelValue:{type:String,required:!0},type:{type:String,default:"text"},options:{type:Array,default:()=>[]}},emits:["update:modelValue"]});const O={value:"",selected:""},I=["value","selected"];$.render=function(e,t,s,a,i,l){const r=h("form-field-base");return n(),b(r,{label:e.label},{default:f((()=>[d("select",{class:"form-select form-select-sm",onInput:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.value))},[d("option",O,m(e.placeholder),1),c(e.$slots,"default",{},(()=>[(n(!0),u(g,null,y(e.options,((t,s)=>(n(),u("option",{key:s,value:t,selected:t===e.modelValue},m(t),9,I)))),128))]))],32)])),_:3},8,["label"])};var N=o({name:"FormCheckbox",components:{FormFieldBase:w},props:{id:{type:String,required:!0},label:{type:String,required:!0},info:{type:String,default:""},modelValue:Boolean},emits:["update:modelValue"]});const T={class:"form-check"},U=["id","checked"],B=["for"];N.render=function(e,t,s,a,i,l){const r=h("form-field-base");return n(),b(r,{label:e.label},{default:f((()=>[d("div",T,[d("input",{id:e.id,class:"form-check-input",type:"checkbox",checked:e.modelValue,onChange:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.checked))},null,40,U),d("label",{class:"form-check-label",for:e.id},m(e.info),9,B)])])),_:1},8,["label"])};var _,R,D=o({name:"SubmitQuestModal",components:{ModalDialog:C,FormInput:j,FormTextarea:F,FormSelect:$,FormCheckbox:N},props:{isAdmin:Boolean},data:()=>({featuredArtists:[],selectedArtist:"",mapsetCount:6,name:"",price:0,objective:"",timeframe:0,minParty:0,maxParty:0,minRank:0,isMbc:!1,queuedQuests:[]}),computed:(_=((e,t)=>{for(var s in t||(t={}))i.call(t,s)&&r(e,s,t[s]);if(a)for(var s of a(t))l.call(t,s)&&r(e,s,t[s]);return e})({},v(["loggedInUser"])),R={packType(){return 1==this.mapsetCount?"single":2==this.mapsetCount?"double":this.mapsetCount<=4?"mini-pack":this.mapsetCount<=9?"pack":this.mapsetCount>=10?"mega-pack":"invalid-pack"},selectedArtistOsuId(){return this.selectedArtist.length?this.selectedArtist.split("|")[0]:""},selectedArtistName(){return this.selectedArtist.length?this.selectedArtist.split("|")[1]:""},points(){let e=25;return this.selectedArtist||(e+=10),this.mapsetCount<1?e=727:1==this.mapsetCount?e+=100:this.mapsetCount<10&&(e+=7.5*(10-this.mapsetCount)),e},enoughPoints(){return this.loggedInUser.availablePoints-this.points>0}},t(_,s(R))),watch:{selectedArtist(){this.selectedArtistName.length&&this.mapsetCount>0&&(this.name=this.findName(),this.objective=this.findObjective(),this.price=this.findPrice(),this.timeframe=this.findTimeframe(),this.minParty=this.mapsetCount,this.maxParty=3*this.mapsetCount)},mapsetCount(){this.selectedArtistName.length&&this.mapsetCount>0&&(this.name=this.findName(),this.objective=this.findObjective(),this.price=this.findPrice(),this.timeframe=this.findTimeframe(),this.minParty=this.mapsetCount,this.maxParty=3*this.mapsetCount)}},async created(){const e=await this.$http.executeGet("/featuredArtists");e&&(this.featuredArtists=e.sort(((e,t)=>e.label.toLowerCase()>t.label.toLowerCase()?1:t.label.toLowerCase()>e.label.toLowerCase()?-1:0)))},methods:{findName(){return this.selectedArtistName+" "+this.packType},findObjective(){return 1==this.mapsetCount?`Create and rank ${this.mapsetCount} mapset of any song by ${this.selectedArtistName}.`:`Create and rank at least ${this.mapsetCount} mapsets of songs by ${this.selectedArtistName}, each hosted by a different user.`},findPrice(){switch(this.mapsetCount){case 1:return 20;case 2:return 10;case 3:return 5;default:return 0}},findTimeframe(){return 10*this.mapsetCount+70},resetQuestDetails(){this.selectedArtist="",this.mapsetCount=6,this.name="",this.price=0,this.objective="",this.timeframe=0,this.minParty=0,this.maxParty=0,this.minRank=0,this.isMbc=!1},addToQueue(){this.queuedQuests.push({name:this.name,price:this.price,descriptionMain:this.objective,timeframe:864e5*this.timeframe,minParty:this.minParty,maxParty:this.maxParty,minRank:this.minRank,isMbc:this.isMbc,art:parseInt(this.selectedArtistOsuId),requiredMapsets:this.mapsetCount}),this.resetQuestDetails()},removeFromQueue(e){this.queuedQuests=this.queuedQuests.filter((t=>t.name!=e))},async submitQuest(e){const t={name:this.name,price:this.price,descriptionMain:this.objective,timeframe:864e5*this.timeframe,minParty:this.minParty,maxParty:this.maxParty,art:this.selectedArtistOsuId,requiredMapsets:this.mapsetCount},s=await this.$http.executePost("/quests/submit",t,e);this.$http.isError(s)||(this.$bs.hideModal("submitQuest"),this.resetQuestDetails())},async scheduleQuests(e){const t={quests:this.queuedQuests},s=await this.$http.executePost("/admin/quests/create",t,e);this.$http.isError(s)||(this.$bs.hideModal("submitQuest"),this.queuedQuests=[])}}});const z={class:"container"},L=d("option",{value:"-",disabled:""}," --- ",-1),E=["value"],G={key:0,class:"row col ms-4"},K=[d("ul",{class:"small text-secondary"},[d("li",null,"This artist's logo will be used as the quest's icon."),d("li",null,"If your quest allows songs from a few artists, choose whichever best expresses its theme."),d("li",null,'If your quest allows songs from many artists, choose "No specific artist".'),d("li",null,'Selecting an artist pre-fills the "Name" and "Objective" fields, though these can still be customized.')],-1)],Y={key:1,class:"row col ms-4"},H=[d("ul",{class:"small text-secondary"},[d("li",null,"Submitting quest for approval requires you to spend points correlating to how many mapsets are required. The fewer required mapsets, the more points you'll have to spend (and vice versa)."),d("li",null,"Choosing a number pre-fills various fields, though these can still be customized.")],-1)],J=d("div",{class:"radial-divisor"},null,-1),W={key:3,class:"row col-sm small text-secondary"},X=d("p",null," Keep in mind that your quest may need revision before it is approved and published on the Mappers' Guild quest listing! ",-1),Z=d("p",null," If your quest is rejected, your spent points will be returned and pishifat will send you a message explaining why it was rejected. You may re-submit the quest with changes according to that message. Minor wording changes will be modified by pishifat without rejection. ",-1),ee=["disabled"],te=d("i",{class:"fas fa-coins"},null,-1),se={key:4,class:"row col-sm"},ae=[V(" Add quest to queue "),d("i",{class:"fas fa-coins"},null,-1)],ie={key:0,class:"mt-2"},le=V(" Pending quests "),re={class:"small text-secondary"},oe=["onClick"],ne=[d("i",{class:"fas fa-minus"},null,-1)];D.render=function(e,t,s,a,i,l){const r=h("form-select"),o=h("form-input"),c=h("form-textarea"),v=h("form-checkbox"),C=h("modal-dialog");return n(),b(C,{id:"submitQuest",title:e.isAdmin?"Add quest":"Submit quest"},{default:f((()=>[d("div",z,[q(r,{modelValue:e.selectedArtist,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedArtist=t),label:"Artist",placeholder:"No specific artist"},{default:f((()=>[L,(n(!0),u(g,null,y(e.featuredArtists,(e=>(n(),u("option",{key:e.id,value:e.osuId+"|"+e.label},m(e.label),9,E)))),128))])),_:1},8,["modelValue"]),e.isAdmin?p("",!0):(n(),u("div",G,K)),q(o,{modelValue:e.mapsetCount,"onUpdate:modelValue":t[1]||(t[1]=t=>e.mapsetCount=t),modelModifiers:{number:!0},label:"Required mapsets",type:"number"},null,8,["modelValue"]),e.isAdmin?p("",!0):(n(),u("div",Y,H)),q(o,{modelValue:e.name,"onUpdate:modelValue":t[2]||(t[2]=t=>e.name=t),label:"Name"},null,8,["modelValue"]),q(c,{modelValue:e.objective,"onUpdate:modelValue":t[3]||(t[3]=t=>e.objective=t),label:"Objective"},null,8,["modelValue"]),q(o,{modelValue:e.price,"onUpdate:modelValue":t[4]||(t[4]=t=>e.price=t),modelModifiers:{number:!0},label:"Price",type:"number",placeholder:"price per party member...",description:"...points required per party member"},null,8,["modelValue"]),q(o,{modelValue:e.timeframe,"onUpdate:modelValue":t[5]||(t[5]=t=>e.timeframe=t),modelModifiers:{number:!0},label:"Timeframe",type:"number",description:"...days to complete quest"},null,8,["modelValue"]),q(o,{modelValue:e.minParty,"onUpdate:modelValue":t[6]||(t[6]=t=>e.minParty=t),modelModifiers:{number:!0},label:"Party size (min)",type:"number"},null,8,["modelValue"]),q(o,{modelValue:e.maxParty,"onUpdate:modelValue":t[7]||(t[7]=t=>e.maxParty=t),modelModifiers:{number:!0},label:"Party size (max)",type:"number",description:"...members required to accept quest (min/max)"},null,8,["modelValue"]),e.isAdmin?(n(),u(g,{key:2},[q(o,{modelValue:e.minRank,"onUpdate:modelValue":t[8]||(t[8]=t=>e.minRank=t),modelModifiers:{number:!0},label:"Party rank (min)",type:"number",description:"...rank required to accept quest"},null,8,["modelValue"]),q(v,{id:"isMbcCheckbox",modelValue:e.isMbc,"onUpdate:modelValue":t[9]||(t[9]=t=>e.isMbc=t),label:"is MBC",info:"Toggle isMbc"},null,8,["modelValue"])],64)):p("",!0),J,e.isAdmin?(n(),u("div",se,[d("button",{class:"btn btn-outline-secondary w-100",onClick:t[11]||(t[11]=t=>e.addToQueue())},ae),e.queuedQuests.length?(n(),u("div",ie,[le,d("ul",re,[(n(!0),u(g,null,y(e.queuedQuests,(t=>(n(),u("li",{key:t.name},[V(m(t.name)+" ",1),d("a",{href:"#",class:"text-danger",onClick:k((s=>e.removeFromQueue(t.name)),["prevent"])},ne,8,oe)])))),128))])])):p("",!0),e.queuedQuests.length?(n(),u("button",{key:1,class:"btn btn-outline-success w-100",onClick:t[12]||(t[12]=t=>e.scheduleQuests(t))}," Schedule quests ")):p("",!0)])):(n(),u("div",W,[X,Z,d("button",{class:"btn btn-outline-success w-100",disabled:!e.enoughPoints,onClick:t[10]||(t[10]=t=>e.submitQuest(t))},[V(m(`Submit quest for approval: ${e.points} pts`)+" ",1),te],8,ee)]))])])),_:1},8,["title"])};export{D as _};
