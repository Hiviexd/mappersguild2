import{d as e,p as t,a as s,o as n,b as o,f as i,t as r,G as a,N as d,l,H as c,i as u,O as m,F as p,g as h,j as g,k as y,e as b,n as f,q as I,w as S,m as C}from"./vendor.cb33bf1d.js";import{B as v}from"./BotChatMessage.54b0b959.js";import{_ as w}from"./ModalDialog.0d82a3c5.js";import{C as k}from"./CopyPaste.6c37002b.js";var j=e({name:"DateInfo",props:{contestId:{type:String,required:!0},contestStart:{type:String,default:null}},data(){return{newContestStart:this.contestStart,showContestStartDateInput:!1}},methods:{async updateContestStart(e){const t=await this.$http.executePost(`/admin/contests/${this.contestId}/updateContestStart`,{date:this.newContestStart},e);this.$http.isError(t)||(this.showContestStartDateInput=!1,this.$store.dispatch("updateToastMessages",{message:"updated contest start date",type:"info"}),this.$store.commit("updateContestStart",{contestId:this.contestId,contestStart:t}))}}});t("data-v-e94aabac");const $={class:"text-white-50"},x={key:0},D=[i("i",{class:"fas fa-edit"},null,-1)];s(),j.render=function(e,t,s,c,u,m){return n(),o("div",null,[i("p",$,[e.showContestStartDateInput?a((n(),o("input",{key:1,"onUpdate:modelValue":t[0]||(t[0]=t=>e.newContestStart=t),class:"form-control form-control-sm date-input d-inline",type:"text",autocomplete:"off",placeholder:"yyyy-mm-dd",onChange:t[1]||(t[1]=t=>e.updateContestStart(t))},null,544)),[[d,e.newContestStart]]):(n(),o("span",x,r(e.contestStart?"Started: "+e.contestStart:"No start date set"),1)),i("a",{href:"#",class:"ms-1 d-inline",onClick:t[2]||(t[2]=l((t=>e.showContestStartDateInput=!e.showContestStartDateInput),["prevent"]))},D)])])},j.__scopeId="data-v-e94aabac";var J=e({name:"StatusInfo",props:{contestId:{type:String,required:!0},status:{type:String,default:null}},data(){return{newStatus:this.status,showStatusInput:!1}},methods:{async updateStatus(e){const t=await this.$http.executePost(`/admin/contests/${this.contestId}/updateStatus`,{status:this.newStatus},e);this.$http.isError(t)||(this.showStatusInput=!1,this.$store.dispatch("updateToastMessages",{message:"updated contest status",type:"info"}),this.$store.commit("updateStatus",{contestId:this.contestId,status:t}))}}});t("data-v-d351faa8");const M={class:"text-white-50"},T={key:0,class:"text-capitalize"},V=[i("option",{value:"beatmapping"}," Beatmapping ",-1),i("option",{value:"screening"}," Screening ",-1),i("option",{value:"judging"}," Judging ",-1),i("option",{value:"complete"}," Complete ",-1)],A=[i("i",{class:"fas fa-edit"},null,-1)];s(),J.render=function(e,t,s,d,u,m){return n(),o("div",null,[i("p",M,[e.showStatusInput?a((n(),o("select",{key:1,"onUpdate:modelValue":t[0]||(t[0]=t=>e.newStatus=t),class:"form-select form-select-sm w-25 d-inline",onChange:t[1]||(t[1]=t=>e.updateStatus(t))},V,544)),[[c,e.newStatus]]):(n(),o("span",T," status: "+r(e.status),1)),i("a",{href:"#",class:"ms-1 d-inline",onClick:t[2]||(t[2]=l((t=>e.showStatusInput=!e.showStatusInput),["prevent"]))},A)])])},J.__scopeId="data-v-d351faa8";var N=e({name:"ScreenersInfo",props:{contestId:{type:String,required:!0},screeners:{type:Array,required:!0}},data:()=>({screenerInput:null,confirmDelete:null}),methods:{async addScreener(e){const t=await this.$http.executePost(`/admin/contests/${this.contestId}/screeners/add`,{screenerInput:this.screenerInput},e);this.$http.isError(t)||(this.$store.dispatch("updateToastMessages",{message:`added ${this.screenerInput} (${this.screeners.length+1})`,type:"info"}),this.$store.commit("addScreener",{contestId:this.contestId,screener:t}))},async removeScreener(e,t){const s=await this.$http.executePost(`/admin/contests/${this.contestId}/screeners/remove`,{screenerId:e},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:"deleted",type:"info"}),this.$store.commit("deleteScreener",{contestId:this.contestId,screenerId:e}))}}});const q={class:"row"},B={key:0},R=["onClick"],E=["onClick"],P={key:1,class:"text-white-50 m-4"};N.render=function(e,t,s,r,c,y){const b=u("user-link");return n(),o("div",null,[i("p",q,[a(i("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.screenerInput=t),class:"form-control form-control-sm w-50",autocomplete:"off",placeholder:"new screener username/osuId...",onKeyup:t[1]||(t[1]=m((t=>e.addScreener(t)),["enter"]))},null,544),[[d,e.screenerInput,void 0,{number:!0}]])]),e.screeners.length?(n(),o("ul",B,[(n(!0),o(p,null,h(e.screeners,(t=>(n(),o("li",{key:t.id},[g(b,{user:t},null,8,["user"]),e.confirmDelete!=t.id?(n(),o("a",{key:0,href:"#",class:"text-danger",onClick:l((s=>e.confirmDelete=t.id),["prevent"])}," delete ",8,R)):(n(),o("a",{key:1,class:"text-danger",href:"#",onClick:l((s=>e.removeScreener(t.id,s)),["prevent"])}," confirm ",8,E))])))),128))])):(n(),o("div",P," None... "))])};var F=e({name:"JudgesInfo",props:{contestId:{type:String,required:!0},judges:{type:Array,required:!0}},data:()=>({judgeInput:null,confirmDelete:null}),methods:{async addJudge(e){const t=await this.$http.executePost(`/admin/contests/${this.contestId}/judges/add`,{judgeInput:this.judgeInput},e);this.$http.isError(t)||(this.$store.dispatch("updateToastMessages",{message:`added ${this.judgeInput} (${this.judges.length+1})`,type:"info"}),this.$store.commit("addJudge",{contestId:this.contestId,judge:t}))},async removeJudge(e,t){const s=await this.$http.executePost(`/admin/contests/${this.contestId}/judges/remove`,{judgeId:e},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:"deleted",type:"info"}),this.$store.commit("deleteJudge",{contestId:this.contestId,judgeId:e}))}}});const O={class:"row"},U={key:0},z=["onClick"],_=["onClick"],L={key:1,class:"text-white-50 m-4"};F.render=function(e,t,s,r,c,y){const b=u("user-link");return n(),o("div",null,[i("p",O,[a(i("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.judgeInput=t),class:"form-control form-control-sm w-50",autocomplete:"off",placeholder:"new judge's username/osuId...",onKeyup:t[1]||(t[1]=m((t=>e.addJudge(t)),["enter"]))},null,544),[[d,e.judgeInput,void 0,{number:!0}]])]),e.judges.length?(n(),o("ul",U,[(n(!0),o(p,null,h(e.judges,(t=>(n(),o("li",{key:t.id},[g(b,{user:t},null,8,["user"]),e.confirmDelete!=t.id?(n(),o("a",{key:0,href:"#",class:"text-danger",onClick:l((s=>e.confirmDelete=t.id),["prevent"])}," delete ",8,z)):(n(),o("a",{key:1,class:"text-danger",href:"#",onClick:l((s=>e.removeJudge(t.id,s)),["prevent"])}," confirm ",8,_))])))),128))])):(n(),o("div",L," None... "))])};var H=e({name:"ScreeningDetail",props:{evaluations:{type:Array,required:!0}}});const G={class:"p-3"},K={class:"ms-4 small text-white-50",style:{"word-break":"break-word"}},Q={key:0};H.render=function(e,t,s,a,d,l){const c=u("user-link");return n(),o("div",G,[(n(!0),o(p,null,h(e.evaluations,(e=>(n(),o("div",{key:e.id},[i("div",null,[g(c,{user:e.screener},null,8,["user"]),y(" ("+r(e.vote)+") ",1),i("div",K,r(e.comment),1)])])))),128)),e.evaluations.length?b("",!0):(n(),o("div",Q," No screenings... "))])};var W=e({name:"MessageTemplate",components:{BotChatMessage:v},props:{osuId:{type:Number,default:0},submissionId:{type:String,required:!0},contestName:{type:String,required:!0},contestId:{type:String,required:!0}},computed:{messages(){let e=[];return e.push(`hello! thank you for participating in ${this.contestName}!`),e.push(`screening/judging details for your submission can be found here: https://mappersguild.com/contestresults?submission=${this.submissionId}`),e.push("a news post including the full results will be published soon!"),e}}});W.render=function(e,t,s,i,r,a){const d=u("bot-chat-message");return n(),o("div",null,[g(d,{messages:e.messages,"message-type":"contest","mongo-id":e.contestId,users:[{osuId:e.osuId}]},null,8,["messages","mongo-id","users"])])};const X={name:"BotChatMessagesAllParticipants",props:{mongoId:{type:String,required:!0}},methods:{async sendAllMessages(e){confirm("Are you sure?")&&await this.$http.executePost(`/admin/contests/${this.mongoId}/sendAllMessages`,{},e)}}};X.render=function(e,t,s,r,a,d){return n(),o("div",null,[i("a",{class:"btn btn-sm w-100 btn-success mb-2",onClick:t[0]||(t[0]=e=>d.sendAllMessages(e))}," Send results messages to all participants ")])};var Y=e({name:"ScreeningResults",components:{ScreeningDetail:H,MessageTemplate:W,BotChatMessagesAllParticipants:X},props:{contestId:{type:String,required:!0},contestName:{type:String,required:!0},judgingThreshold:{type:Number,default:0},submissions:{type:Array,required:!0}},data(){return{newJudgingThreshold:this.judgingThreshold}},computed:{sortedSubmissions(){const e=JSON.parse(JSON.stringify(this.submissions));for(let t=0;t<e.length;t++){const s=e[t].evaluations.reduce(((e,t)=>t.vote?e+t.vote:e),0);e[t].total=s}return e.sort(((e,t)=>e.total>t.total?-1:t.total>e.total?1:0)),e}},methods:{async updateJudgingThreshold(e){const t=await this.$http.executePost(`/admin/contests/${this.contestId}/updateJudgingThreshold`,{judgingThreshold:this.newJudgingThreshold},e);this.$http.isError(t)||(this.$store.dispatch("updateToastMessages",{message:"updated judging threshold",type:"info"}),this.$store.commit("updateJudgingThreshold",{contestId:this.contestId,judgingThreshold:t}))}}});const Z={class:"row mb-2"},ee={class:"d-flex justify-content-between"},te=["href"],se=i("i",{class:"fas fa-angle-down"},null,-1),ne=["id"];Y.render=function(e,t,s,l,c,m){const b=u("screening-detail"),I=u("message-template"),S=u("bot-chat-messages-all-participants");return n(),o("div",null,[i("div",Z,[a(i("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.newJudgingThreshold=t),class:"form-control form-control-sm col-sm-2 me-2 w-25",type:"text",autocomplete:"off",placeholder:"judging threshold"},null,512),[[d,e.newJudgingThreshold]]),i("button",{type:"button",class:"btn btn-sm btn-outline-info col-sm-2",onClick:t[1]||(t[1]=t=>e.updateJudgingThreshold(t))}," Save ")]),i("ul",null,[(n(!0),o(p,null,h(e.sortedSubmissions,(t=>(n(),o("li",{key:t.id},[i("div",ee,[i("a",{class:f(t.total>=e.judgingThreshold?"text-success":""),"data-bs-toggle":"collapse",href:`#collapse-${t.id}`},[y(r(t.name)+" ("+r(t.total)+") ",1),se],10,te)]),i("div",{id:`collapse-${t.id}`,class:"collapse"},[i("div",null,[g(b,{evaluations:t.evaluations},null,8,["evaluations"]),g(I,{"osu-id":t.creator.osuId,"submission-id":t.id,"contest-name":e.contestName,"contest-id":e.contestId},null,8,["osu-id","submission-id","contest-name","contest-id"])])],8,ne)])))),128))]),g(S,{"mongo-id":e.contestId},null,8,["mongo-id"])])};var oe=e({name:"JudgingDetail",components:{ModalDialog:w},props:{submission:{type:Object,default:null}},data:()=>({commentsExpanded:[]}),methods:{showComment(e){const t=this.commentsExpanded.findIndex((t=>t===e));-1!==t?this.commentsExpanded.splice(t,1):this.commentsExpanded.push(e)},getCollapseClass(e){return this.commentsExpanded.includes(e)?"fa-chevron-down":"fa-chevron-right"}}});const ie={class:"container"},re=["href","onClick"],ae={key:1,class:"small text-capitalize ms-3"},de=["id"],le={class:"small text-white-50",style:{"white-space":"pre-line"}},ce={key:0};oe.render=function(e,t,s,a,d,l){const c=u("user-link"),m=u("modal-dialog");return n(),I(m,{id:"detailModal",loaded:Boolean(e.submission)},{header:S((()=>[y(r(e.submission.creator.username)+" ("+r(e.submission.name)+") ",1)])),default:S((()=>[i("div",ie,[(n(!0),o(p,null,h(e.submission.judgings,((t,s)=>(n(),o("div",{key:t.id},[g(c,{user:t.judge},null,8,["user"]),(n(!0),o(p,null,h(t.judgingScores,(t=>(n(),o("div",{key:t.id,class:"my-1"},["comments"==t.criteria.name?(n(),o("a",{key:0,class:"small fw-bold text-capitalize","data-bs-toggle":"collapse",href:`#judgingToCriteria${t.id}`,onClick:s=>e.showComment(t.id)},[i("i",{class:f(["small fas me-2",e.getCollapseClass(t.id)])},null,2),y(" "+r(t.criteria.name),1)],8,re)):(n(),o("span",ae,r(t.criteria.name)+" ("+r(t.score)+") ",1)),i("p",{id:`judgingToCriteria${t.id}`,class:"text-light ms-4 collapse"},[i("span",le,r(t.comment),1)],8,de)])))),128)),s<e.submission.judgings.length-1?(n(),o("hr",ce)):b("",!0)])))),128))])])),_:1},8,["loaded"])};var ue=e({name:"JudgingLeaderboard",props:{contest:{type:Object,required:!0},usersScores:{type:Array,required:!0},judgesCorrel:{type:Array,required:!0}},data(){return{selectedScore:null,displayMode:"criterias",sortDesc:!1,judges:this.contest.judges}},computed:{scoreDetail(){if(this.selectedScore)return this.contest.submissions.find((e=>{var t;return e.creator.id==(null==(t=this.selectedScore)?void 0:t.creator.id)}))}},methods:{getCriteriaScore(e,t){var s;return(null==(s=e.criteriaSum.find((e=>e.criteriaId===t)))?void 0:s.sum)||0},getJudgeScore(e,t,s=!1){const n=e.judgingSum.find((e=>e.judgeId===t)),o=(null==n?void 0:n.standardized)||0;return s?`${(null==n?void 0:n.sum)||0} (${o.toFixed(3)})`:(null==n?void 0:n.sum)||0},getJudgeAvg(e){var t;return(null==(t=this.judgesCorrel.find((t=>t.id===e)))?void 0:t.rawAvg.toFixed(4))||0},getJudgeSd(e){var t;return(null==(t=this.judgesCorrel.find((t=>t.id===e)))?void 0:t.sd.toFixed(4))||0},getJudgeCorrel(e){var t;return((null==(t=this.judgesCorrel.find((t=>t.id===e)))?void 0:t.correl)||0).toFixed(4)},getFinalScore:e=>isNaN(e)?"0":e.toFixed(4),sortByCriteria(e){this.sortDesc=!this.sortDesc,this.$store.commit("sortByCriteria",{criteriaId:e,sortDesc:this.sortDesc})},sortByJudge(e){this.sortDesc=!this.sortDesc,this.$store.commit("sortByJudge",{judgeId:e,sortDesc:this.sortDesc})},sortByRawScore(){this.sortDesc=!this.sortDesc,this.$store.commit("sortByRawScore",{sortDesc:this.sortDesc})},sortByStdScore(){this.sortDesc=!this.sortDesc,this.$store.commit("sortByStdScore",{sortDesc:this.sortDesc})}}});const me={class:"container"},pe={class:"row my-3"},he={class:"col-sm"},ge=y(" | "),ye=y(" | "),be={class:"row"},fe={class:"col-sm"},Ie={class:"table table-sm table-responsive-lg"},Se=i("th",null,"#",-1),Ce=i("th",null,"Name",-1),ve=["onClick"],we=["onClick"],ke=["onClick"],je={class:"cursor-default"},$e=i("td",null,null,-1),xe=i("td",null,"AVG",-1),De=i("td",null,null,-1),Je=i("td",null,null,-1),Me={class:"cursor-default"},Te=i("td",null,null,-1),Ve=i("td",null,"SD",-1),Ae=i("td",null,null,-1),Ne=i("td",null,null,-1),qe={class:"cursor-default"},Be=i("td",null,null,-1),Re=i("td",null,"COR",-1),Ee=i("td",null,null,-1),Pe=i("td",null,null,-1);ue.render=function(e,t,s,a,d,c){return n(),o("div",me,[i("div",pe,[i("div",he,[i("a",{href:"#",class:f("criterias"===e.displayMode?"border-bottom border-secondary":""),onClick:t[0]||(t[0]=l((t=>e.displayMode="criterias"),["prevent"]))}," Criteria ",2),ge,i("a",{href:"#",class:f("judges"===e.displayMode?"border-bottom border-secondary":""),onClick:t[1]||(t[1]=l((t=>e.displayMode="judges"),["prevent"]))}," Judge ",2),ye,i("a",{href:"#",class:f("detail"===e.displayMode?"border-bottom border-secondary":""),onClick:t[2]||(t[2]=l((t=>e.displayMode="detail"),["prevent"]))}," Judge (SD) ",2)])]),i("div",be,[i("div",fe,[i("table",Ie,[i("thead",null,[i("tr",null,[Se,Ce,"criterias"===e.displayMode?(n(!0),o(p,{key:0},h(e.contest.criterias,(t=>(n(),o("th",{key:t.id},[i("a",{href:"#",class:"text-capitalize",onClick:l((s=>e.sortByCriteria(t.id)),["prevent"])},r(t.name),9,ve)])))),128)):(n(!0),o(p,{key:1},h(e.judges,(t=>(n(),o("th",{key:t.id},[i("a",{href:"#",onClick:l((s=>e.sortByJudge(t.id)),["prevent"])},r(t.username),9,we)])))),128)),i("th",null,[i("a",{href:"#",onClick:t[3]||(t[3]=l(((...t)=>e.sortByRawScore&&e.sortByRawScore(...t)),["prevent"]))}," Final Score (raw) ")]),i("th",null,[i("a",{href:"#",onClick:t[4]||(t[4]=l(((...t)=>e.sortByStdScore&&e.sortByStdScore(...t)),["prevent"]))}," Final Score (standardized) ")])])]),i("tbody",null,[(n(!0),o(p,null,h(e.usersScores,((t,s)=>(n(),o("tr",{key:s,"data-bs-toggle":"modal","data-bs-target":"#detailModal",onClick:s=>e.selectedScore=t},[i("td",null,r(s+1),1),i("td",null,r(t.creator.username),1),"criterias"===e.displayMode?(n(!0),o(p,{key:0},h(e.contest.criterias,(s=>(n(),o("td",{key:s.id},r(e.getCriteriaScore(t,s.id)),1)))),128)):(n(!0),o(p,{key:1},h(e.judges,(s=>(n(),o("td",{key:s.id},r(e.getJudgeScore(t,s.id,"detail"===e.displayMode)),1)))),128)),i("td",null,r(t.rawFinalScore),1),i("td",null,r(e.getFinalScore(t.standardizedFinalScore)),1)],8,ke)))),128)),"detail"===e.displayMode?(n(),o(p,{key:0},[i("tr",je,[$e,xe,(n(!0),o(p,null,h(e.judges,(t=>(n(),o("td",{key:t.id},r(e.getJudgeAvg(t.id)),1)))),128)),De,Je]),i("tr",Me,[Te,Ve,(n(!0),o(p,null,h(e.judges,(t=>(n(),o("td",{key:t.id},r(e.getJudgeSd(t.id)),1)))),128)),Ae,Ne]),i("tr",qe,[Be,Re,(n(!0),o(p,null,h(e.judges,(t=>(n(),o("td",{key:t.id},r(e.getJudgeCorrel(t.id)),1)))),128)),Ee,Pe])],64)):b("",!0)])])])])])};var Fe=e({name:"MarkdownJudgingLeaderboard",components:{CopyPaste:k},props:{usersScores:{type:Array,required:!0},contest:{type:Object,required:!0},judgeCount:{type:Number,required:!0}},methods:{getSubmissionIdByCreatorId(e){var t;return(null==(t=this.contest)?void 0:t.submissions.find((t=>t.creator.id===e))).id},getCriteriaSumbyName(e,t){const s=t.find((t=>t.name===e));return(null==s?void 0:s.sum)||NaN}}});const Oe=i("div",null," | :-- | :-- | :-- | :-- | :-- | :-- | :-- | :-- | :-- | ",-1);Fe.render=function(e,t,s,a,d,l){const c=u("copy-paste");return n(),I(c,null,{default:S((()=>[i("div",null," | Rank | Beatmap | Judging | Musical representation ("+r(10*e.judgeCount)+") | Creativity ("+r(10*e.judgeCount)+") | Gameplay ("+r(10*e.judgeCount)+") | Limitation ("+r(5*e.judgeCount)+") | Raw total | Standardized total | ",1),Oe,(n(!0),o(p,null,h(e.usersScores,((t,s)=>(n(),o("div",{key:s}," | \\#"+r(s+1)+" | [TITLE](LINK) by ["+r(t.creator.username)+"](https://osu.ppy.sh/users/"+r(t.creator.osuId)+") | [see details](https://mappersguild.com/contestresults?submission="+r(e.getSubmissionIdByCreatorId(t.creator.id))+") | "+r(e.getCriteriaSumbyName("musical representation",t.criteriaSum))+" | "+r(e.getCriteriaSumbyName("creativity",t.criteriaSum))+" | "+r(e.getCriteriaSumbyName("gameplay",t.criteriaSum))+" | "+r(e.getCriteriaSumbyName("limitation",t.criteriaSum))+" | **"+r(t.rawFinalScore)+"** | **"+r(Math.round(100*t.standardizedFinalScore)/100)+"** ",1)))),128))])),_:1})};var Ue=e({name:"JudgingResults",components:{JudgingDetail:oe,JudgingLeaderboard:ue,MarkdownJudgingLeaderboard:Fe},props:{contestId:{type:String,required:!0}},data:()=>({contest:null,selected:null,usersScores:[],judgesCorrel:[]}),computed:{judgeCount(){var e;return(null==(e=this.contest)?void 0:e.judges.length)||0}},async created(){const e=await this.$http.executeGet(`/admin/judging/${this.contestId}`);this.$http.isError(e)||(this.contest=e.contest,this.usersScores=e.usersScores,this.judgesCorrel=e.judgesCorrel)},methods:{getJudgesInvolvedCount:e=>e.judgings.map((e=>e.judge)).length,getJudgesInvolved:e=>e.judgings.map((e=>e.judge.username)).join(", "),getSubmissionIdByCreatorId(e){var t;return(null==(t=this.contest)?void 0:t.submissions.find((t=>t.creator.id===e))).id}}});const ze={key:0},_e={class:"container"},Le={key:0,class:"table table-sm table-responsive-lg"},He=i("thead",null,[i("tr",null,[i("th",null,"User"),i("th",null,"Count"),i("th",null,"Judges")])],-1),Ge=["onClick"],Ke={key:1,class:"text-white-50"};Ue.render=function(e,t,s,a,d,l){const c=u("judging-leaderboard"),m=u("markdown-judging-leaderboard"),y=u("judging-detail");return n(),o("div",null,[e.contest?(n(),o("div",ze,[g(c,{contest:e.contest,"users-scores":e.usersScores,"judges-correl":e.judgesCorrel},null,8,["contest","users-scores","judges-correl"]),i("div",_e,[e.contest.submissions.length?(n(),o("table",Le,[He,i("tbody",null,[(n(!0),o(p,null,h(e.contest.submissions,(t=>(n(),o("tr",{key:t.id,"data-bs-toggle":"modal","data-bs-target":"#detailModalAdmin",onClick:s=>e.selected=t},[i("td",null,r(`${t.creator.username} (${t.name||"Not anonymized"})`),1),i("td",{class:f(e.getJudgesInvolvedCount(t)>=e.judgeCount?"text-success":"text-danger")},r(e.getJudgesInvolvedCount(t))+" done of "+r(e.judgeCount),3),i("td",null,r(e.getJudgesInvolved(t)),1)],8,Ge)))),128))])])):b("",!0)]),g(m,{"users-scores":e.usersScores,contest:e.contest,"judge-count":e.judgeCount},null,8,["users-scores","contest","judge-count"]),g(y,{id:"detailModalAdmin",submission:e.selected},null,8,["submission"])])):(n(),o("div",Ke," Loading... "))])};var Qe=e({name:"CriteriaSelection",props:{contestId:{type:String,required:!0},criterias:{type:Array,required:!0}},data:()=>({allCriterias:[],nameInput:"",maxScoreInput:""}),computed:{criteriaIds(){return this.criterias.map((e=>e.id))}},async created(){await this.loadAllCriterias()},methods:{async loadAllCriterias(){const e=await this.$http.executeGet("/admin/contests/criterias/");this.$http.isError(e)||(this.allCriterias=e.criterias)},async toggleCriteria(e){const t=await this.$http.executePost(`/admin/contests/${this.contestId}/toggleCriteria`,{criteriaId:e});this.$http.isError(t)||(this.$store.dispatch("updateToastMessages",{message:"toggled criteria",type:"info"}),this.$store.commit("updateContestCriterias",{contestId:this.contestId,criterias:t}))},async addCriteria(e){const t=await this.$http.executePost("/admin/contests/addCriteria",{name:this.nameInput.toLowerCase(),maxScore:parseInt(this.maxScoreInput)},e);this.$http.isError(t)||(this.$store.dispatch("updateToastMessages",{message:"added criteria",type:"info"}),this.allCriterias=t)}}});const We={class:"list-unstyled ms-4"},Xe=["onClick"],Ye={class:"text-white-50 ms-1 text-capitalize"},Ze={class:"row"};Qe.render=function(e,t,s,c,u,m){return n(),o("div",null,[i("ul",We,[(n(!0),o(p,null,h(e.allCriterias,(t=>(n(),o("li",{key:t.id},[i("a",{href:"#",onClick:l((s=>e.toggleCriteria(t.id)),["prevent"])},[i("i",{class:f(["fas",e.criteriaIds.includes(t.id)?"text-done fa-check":"text-danger fa-times"])},null,2)],8,Xe),i("span",Ye,r(t.name)+" ("+r(t.maxScore)+")",1)])))),128))]),i("p",Ze,[a(i("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.nameInput=t),class:"form-control form-control-sm w-25 col-sm-2 me-2",type:"text",autocomplete:"off",placeholder:"new criteria's name..."},null,512),[[d,e.nameInput]]),a(i("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.maxScoreInput=t),class:"form-control form-control-sm w-25 col-sm-2 me-2",type:"text",autocomplete:"off",placeholder:"new criteria's max score..."},null,512),[[d,e.maxScoreInput]]),i("button",{type:"button",class:"btn btn-sm btn-outline-info col-sm-2 me-2",onClick:t[2]||(t[2]=t=>e.addCriteria(t))}," Add criteria ")])])};var et=e({name:"SubmissionsInfo",props:{contestId:{type:String,required:!0},submissions:{type:Array,required:!0}},data:()=>({name:"",creatorOsuId:"",confirmDelete:null}),methods:{async addSubmission(e){const t=await this.$http.executePost(`/admin/contests/${this.contestId}/submissions/create`,{name:this.name,osuId:this.creatorOsuId},e);this.$http.isError(t)||(this.$store.dispatch("updateToastMessages",{message:`added ${this.creatorOsuId} as ${this.name}`,type:"info"}),this.$store.commit("addSubmission",{contestId:this.contestId,submission:t}))},async addSubmissionsFromCsv(e){const t=await this.$http.executePost(`/admin/contests/${this.contestId}/submissions/createFromCsv`,{},e);this.$http.isError(t)||(this.$store.dispatch("updateToastMessages",{message:"added csv entries",type:"info"}),this.$store.commit("addSubmissionsFromCsv",{contestId:this.contestId,submissions:t}))},async deleteSubmission(e,t){const s=await this.$http.executePost(`/admin/contests/${this.contestId}/submissions/${e}/delete`,{},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:"deleted",type:"info"}),this.$store.commit("deleteSubmission",{contestId:this.contestId,submissionId:e}))}}});const tt={class:"row"},st={key:0},nt={key:1},ot=i("span",{class:"text-white-50 me-1"},"by",-1),it=["onClick"],rt=["onClick"],at={key:2};et.render=function(e,t,s,c,m,f){const I=u("user-link");return n(),o("div",null,[i("p",tt,[a(i("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.name=t),class:"form-control form-control-sm w-25 col-sm-3 me-2",type:"text",autocomplete:"off",placeholder:"new submission's name..."},null,512),[[d,e.name]]),a(i("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.creatorOsuId=t),class:"form-control form-control-sm w-25 col-sm-3 me-2",type:"text",autocomplete:"off",placeholder:"new submission's creator osuId..."},null,512),[[d,e.creatorOsuId]]),i("button",{type:"button",class:"btn btn-sm btn-outline-info col-sm-3 me-2",onClick:t[2]||(t[2]=t=>e.addSubmission(t))}," Add submission ")]),e.submissions.length?b("",!0):(n(),o("p",st,[i("button",{type:"button",class:"btn btn-sm btn-outline-info",onClick:t[3]||(t[3]=t=>e.addSubmissionsFromCsv(t))}," Add submissions from CSV (local only) ")])),e.submissions.length?(n(),o("ul",nt,[(n(!0),o(p,null,h(e.submissions,(t=>(n(),o("li",{key:t.id},[y(r(t.name)+" ",1),ot,g(I,{user:t.creator},null,8,["user"]),e.confirmDelete!=t.id?(n(),o("a",{key:0,href:"#",class:"text-danger",onClick:l((s=>e.confirmDelete=t.id),["prevent"])}," delete ",8,it)):(n(),o("a",{key:1,class:"text-danger",href:"#",onClick:l((s=>e.deleteSubmission(t.id,s)),["prevent"])}," confirm ",8,rt))])))),128))])):(n(),o("div",at," None... "))])};var dt=e({name:"DownloadInfo",props:{contestId:{type:String,required:!0},download:{type:String,default:null}},data(){return{newDownload:this.download,showDownloadInput:!1}},methods:{async updateDownload(e){const t=await this.$http.executePost(`/admin/contests/${this.contestId}/updateDownload`,{download:this.newDownload},e);this.$http.isError(t)||(this.showDownloadInput=!1,this.$store.dispatch("updateToastMessages",{message:"updated contest start date",type:"info"}),this.$store.commit("updateDownload",{contestId:this.contestId,download:t}))}}});t("data-v-58eb1c3a");const lt={class:"text-white-50"},ct=y(" Download: "),ut=["href"],mt={key:1},pt=[i("i",{class:"fas fa-edit"},null,-1)];s(),dt.render=function(e,t,s,c,u,m){return n(),o("div",null,[i("p",lt,[ct,!e.showDownloadInput&&e.download?(n(),o("a",{key:0,href:e.download,target:"_blank"},r(e.download),9,ut)):e.showDownloadInput?a((n(),o("input",{key:2,"onUpdate:modelValue":t[0]||(t[0]=t=>e.newDownload=t),class:"form-control form-control-sm w-50 d-inline",type:"text",autocomplete:"off",placeholder:"link...",onChange:t[1]||(t[1]=t=>e.updateDownload(t))},null,544)),[[d,e.newDownload]]):(n(),o("span",mt,"No download")),i("a",{href:"#",class:"ms-1 d-inline",onClick:t[2]||(t[2]=l((t=>e.showDownloadInput=!e.showDownloadInput),["prevent"]))},pt)])])},dt.__scopeId="data-v-58eb1c3a";var ht=e({name:"MarkdownHelperThanks",components:{CopyPaste:k},props:{screeners:{type:Array,default:()=>[]},judges:{type:Array,default:()=>[]}}});const gt=y(" Thanks to "),yt=y(" for screening this month's entries, as well as "),bt=y(" for judging this month's finalists! ");ht.render=function(e,t,s,i,a,d){const l=u("copy-paste");return n(),I(l,null,{default:S((()=>[gt,(n(!0),o(p,null,h(e.screeners,((t,s)=>(n(),o("span",{key:t.id}," ["+r(t.username)+"](https://osu.ppy.sh/users/"+r(t.osuId)+")"+r(s===e.screeners.length-2?", and ":s===e.screeners.length-1?"":", "),1)))),128)),yt,(n(!0),o(p,null,h(e.judges,((t,s)=>(n(),o("span",{key:"j-"+t.id}," ["+r(t.username)+"](https://osu.ppy.sh/users/"+r(t.osuId)+")"+r(s===e.judges.length-2?", and ":s===e.judges.length-1?"":", "),1)))),128)),bt])),_:1})};var ft=e({name:"ContestInfo",components:{DateInfo:j,StatusInfo:J,ScreenersInfo:N,JudgesInfo:F,ScreeningResults:Y,JudgingResults:Ue,CriteriaSelection:Qe,SubmissionsInfo:et,DownloadInfo:dt,MarkdownHelperThanks:ht},props:{contest:{type:Object,required:!0}},data(){return{newContestStart:this.contest.contestStart,showContestStartDateInput:!1,screenersAndJudgesVisible:!1,submissionsVisible:!1,screeningResultsVisible:!1,judgingCriteriaVisible:!1,judgingResultsVisible:!1}}});const It={class:"container card card-body py-3 mb-2"},St={class:"container"},Ct=y(" Submissions "),vt=i("hr",null,null,-1),wt=y(" Screeners and Judges "),kt={key:2,class:"row"},jt={key:3},$t=y(" Screening Results "),xt=i("hr",null,null,-1),Dt=y(" Judging Criteria "),Jt=y(" Judging Results ");ft.render=function(e,t,s,a,d,l){const c=u("date-info"),m=u("status-info"),p=u("download-info"),h=u("submissions-info"),y=u("screeners-info"),f=u("judges-info"),S=u("markdown-helper-thanks"),C=u("screening-results"),v=u("criteria-selection"),w=u("judging-results");return n(),o("div",It,[i("h4",null,r(e.contest.name),1),i("div",St,[g(c,{"contest-id":e.contest.id,"contest-start":e.contest.contestStart?e.contest.contestStart.slice(0,10):null},null,8,["contest-id","contest-start"]),g(m,{"contest-id":e.contest.id,status:e.contest.status},null,8,["contest-id","status"]),i("div",null,[i("h5",null,[Ct,i("button",{type:"button",class:"btn btn-sm btn-outline-info",onClick:t[0]||(t[0]=t=>e.submissionsVisible=!e.submissionsVisible)},r(e.submissionsVisible?"Hide":"Show"),1)]),e.submissionsVisible?(n(),I(p,{key:0,"contest-id":e.contest.id,download:e.contest.download},null,8,["contest-id","download"])):b("",!0),e.submissionsVisible?(n(),I(h,{key:1,"contest-id":e.contest.id,submissions:e.contest.submissions},null,8,["contest-id","submissions"])):b("",!0),vt,i("h5",null,[wt,i("button",{type:"button",class:"btn btn-sm btn-outline-info",onClick:t[1]||(t[1]=t=>e.screenersAndJudgesVisible=!e.screenersAndJudgesVisible)},r(e.screenersAndJudgesVisible?"Hide":"Show"),1)]),e.screenersAndJudgesVisible?(n(),o("div",kt,[g(y,{class:"col-sm-6","contest-id":e.contest.id,screeners:e.contest.screeners},null,8,["contest-id","screeners"]),g(f,{class:"col-sm-6","contest-id":e.contest.id,judges:e.contest.judges},null,8,["contest-id","judges"]),g(S,{screeners:e.contest.screeners,judges:e.contest.judges},null,8,["screeners","judges"])])):b("",!0),e.contest.submissions.length?(n(),o("div",jt,[i("h5",null,[$t,i("button",{type:"button",class:"btn btn-sm btn-outline-info",onClick:t[2]||(t[2]=t=>e.screeningResultsVisible=!e.screeningResultsVisible)},r(e.screeningResultsVisible?"Hide":"Show"),1)]),e.screeningResultsVisible?(n(),I(C,{key:0,"contest-id":e.contest.id,"contest-name":e.contest.name,submissions:e.contest.submissions,"judging-threshold":e.contest.judgingThreshold},null,8,["contest-id","contest-name","submissions","judging-threshold"])):b("",!0),xt,i("h5",null,[Dt,i("button",{type:"button",class:"btn btn-sm btn-outline-info",onClick:t[3]||(t[3]=t=>e.judgingCriteriaVisible=!e.judgingCriteriaVisible)},r(e.judgingCriteriaVisible?"Hide":"Show"),1)]),e.judgingCriteriaVisible?(n(),I(v,{key:1,"contest-id":e.contest.id,criterias:e.contest.criterias},null,8,["contest-id","criterias"])):b("",!0),i("h5",null,[Jt,i("button",{type:"button",class:"btn btn-sm btn-outline-info",onClick:t[4]||(t[4]=t=>e.judgingResultsVisible=!e.judgingResultsVisible)},r(e.judgingResultsVisible?"Hide":"Show"),1)]),e.judgingResultsVisible?(n(),I(w,{key:2,"contest-id":e.contest.id},null,8,["contest-id"])):b("",!0)])):b("",!0)])])])};var Mt=e({name:"AddContest",data:()=>({contestName:""}),methods:{async addContest(e){const t=await this.$http.executePost("/admin/contests/create",{name:this.contestName},e);this.$http.isError(t)||(this.$store.dispatch("updateToastMessages",{message:"Contest created",type:"info"}),this.$store.commit("addContest",t))}}});const Tt={class:"container card card-body py-3 mb-2"};Mt.render=function(e,t,s,r,l,c){return n(),o("div",Tt,[a(i("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.contestName=t),class:"form-control mb-2",type:"text",placeholder:"name"},null,512),[[d,e.contestName,void 0,{trim:!0}]]),i("button",{class:"btn w-100 btn-info",type:"button",onClick:t[1]||(t[1]=t=>e.addContest(t))}," Add new contest ")])};var Vt={state:{contests:[]},mutations:{setContests(e,t){e.contests=t},addContest(e,t){e.contests.unshift(t)},addSubmission(e,t){const s=e.contests.find((e=>e.id==t.contestId));null==s||s.submissions.push(t.submission)},addSubmissionsFromCsv(e,t){const s=e.contests.find((e=>e.id==t.contestId));s&&(s.submissions=t.submissions)},deleteSubmission(e,t){const s=e.contests.find((e=>e.id==t.contestId));if(s){const e=s.submissions.findIndex((e=>e.id==t.submissionId));-1!==e&&s.submissions.splice(e,1)}},addScreener(e,t){const s=e.contests.find((e=>e.id==t.contestId));null==s||s.screeners.push(t.screener)},deleteScreener(e,t){const s=e.contests.find((e=>e.id==t.contestId));if(s){const e=s.screeners.findIndex((e=>e.id==t.screenerId));-1!==e&&s.screeners.splice(e,1)}},addJudge(e,t){const s=e.contests.find((e=>e.id==t.contestId));null==s||s.judges.push(t.judge)},deleteJudge(e,t){const s=e.contests.find((e=>e.id==t.contestId));if(s){const e=s.screeners.findIndex((e=>e.id==t.screenerId));-1!==e&&s.screeners.splice(e,1)}},updateStatus(e,t){const s=e.contests.find((e=>e.id==t.contestId));s&&(s.status=t.status)},updateContestStart(e,t){const s=e.contests.find((e=>e.id==t.contestId));s&&(s.contestStart=t.contestStart)},updateDownload(e,t){const s=e.contests.find((e=>e.id==t.contestId));s&&(s.download=t.download)},updateJudgingThreshold(e,t){const s=e.contests.find((e=>e.id==t.contestId));s&&(s.judgingThreshold=t.judgingThreshold)},updateContestCriterias(e,t){const s=e.contests.find((e=>e.id==t.contestId));s&&(s.criterias=t.criterias)}}},At=e({name:"ContestPage",components:{ContestInfo:ft,AddContest:Mt},computed:C({contests:e=>e.contests.contests}),beforeCreate(){this.$store.hasModule("contests")||this.$store.registerModule("contests",Vt)},unmounted(){this.$store.hasModule("contests")&&this.$store.unregisterModule("contests")},async created(){const e=await this.$http.initialRequest("/admin/contests/relevantInfo");this.$http.isError(e)||this.$store.commit("setContests",e)}});At.render=function(e,t,s,i,r,a){const d=u("add-contest"),l=u("contest-info");return n(),o("div",null,[g(d),(n(!0),o(p,null,h(e.contests,(e=>(n(),I(l,{key:e.id,contest:e},null,8,["contest"])))),128))])};export{At as default};
