import{d as M,m as S,_ as w,o,e as i,a as s,i as h,t as c,j as _,k as l,n as v,p as b,s as D,u as N,b as P,q as C,z as A,V as O,F as m,r as U,c as p,M as V,W as I,w as q,x as G,y as F,T as Q}from"./index-d778fb55.js";import{M as R}from"./ModalDialog-0f65ad78.js";import{T as E}from"./task-21eeb954.js";import{F as L}from"./FilterBox-9e97b851.js";import{M as H,F as B}from"./extras-d07962e0.js";const j=M({name:"UserCard",props:{user:{type:Object,required:!0}},computed:S("users",["filterMode"]),methods:{selectUser(){this.$store.commit("users/setSelectedUserId",this.user.id)}}});const J=e=>(D("data-v-096980af"),e=e(),N(),e),W=["src"],z={class:"mb-2"},K={class:"text-secondary"},X={class:"card-text small"},Y={class:"card-text small"},Z=J(()=>s("i",{class:"fas fa-coins"},null,-1)),x={key:0,class:"card-text small"},ee={key:1,class:"card-text small"},se={key:2,class:"card-text small"},te={key:3,class:"card-text small"};function oe(e,t,r,a,f,$){const u=b("user-link");return o(),i("div",{class:"col-sm-6 col-md-4 col-lg-4 col-xl-3 my-2",onClick:t[0]||(t[0]=g=>e.selectUser())},[s("div",{class:v(["card card-hover card-level-2 card-body","border-rank-"+e.user.rank]),"data-bs-toggle":"modal","data-bs-target":"#extendedInfo"},[s("img",{src:"https://a.ppy.sh/"+e.user.osuId,class:"card-avatar-img"},null,8,W),s("div",z,[h(u,{user:e.user},null,8,["user"])]),s("div",K,[s("div",X,[s("b",null,"Total points: "+c(e.user.totalPoints),1)]),s("div",Y,[_(" Available points: "+c(e.user.availablePoints)+" ",1),Z]),e.filterMode=="osu"?(o(),i("p",x," osu! points: "+c(Math.round(e.user.osuPoints*10)/10),1)):e.filterMode=="taiko"?(o(),i("p",ee," osu!taiko points: "+c(Math.round(e.user.taikoPoints*10)/10),1)):e.filterMode=="catch"?(o(),i("p",se," osu!catch points: "+c(Math.round(e.user.catchPoints*10)/10),1)):e.filterMode=="mania"?(o(),i("p",te," osu!mania points: "+c(Math.round(e.user.maniaPoints*10)/10),1)):l("",!0)])],2)])}const ie=w(j,[["render",oe],["__scopeId","data-v-096980af"]]),ne=M({name:"UserListElement",props:{user:{type:Object,required:!0}},computed:S("users",["filterMode"]),methods:{selectUser(){this.$store.commit("users/setSelectedUserId",this.user.id)}}});const re=e=>(D("data-v-de1752fb"),e=e(),N(),e),ae={class:"row"},le={class:"col-sm-4"},de=["src"],ce={class:"col-sm-4 text-secondary"},ue={class:"card-text small"},pe={class:"col-sm-4 text-secondary"},he={key:0,class:"card-text small"},me=re(()=>s("i",{class:"fas fa-coins"},null,-1)),ge={key:1,class:"card-text small"},fe={key:2,class:"card-text small"},ye={key:3,class:"card-text small"},_e={key:4,class:"card-text small"};function be(e,t,r,a,f,$){const u=b("user-link"),g=C("bs-tooltip");return o(),i("div",{class:v(["card card-body card-level-2 p-1","left-border-rank-"+e.user.rank]),"data-bs-toggle":"modal","data-bs-target":"#extendedInfo",onClick:t[0]||(t[0]=d=>e.selectUser())},[s("div",ae,[s("div",le,[e.user.rank?P((o(),i("i",{key:0,class:v(["fas fa-crown mx-1 me-2","text-rank-"+e.user.rank])},null,2)),[[g,`rank ${e.user.rank} user`]]):l("",!0),s("img",{src:"https://a.ppy.sh/"+e.user.osuId,class:"list-avatar-img"},null,8,de),h(u,{class:"ms-1",user:e.user},null,8,["user"])]),s("div",ce,[s("div",ue,[_(" Total points: "),s("b",null,c(e.user.totalPoints),1)])]),s("div",pe,[e.filterMode=="any"?(o(),i("div",he,[_(" Available points: "+c(e.user.availablePoints)+" ",1),me])):l("",!0),e.filterMode=="osu"?(o(),i("div",ge,[_(" osu! points: "),s("b",null,c(Math.round(e.user.osuPoints*10)/10),1)])):e.filterMode=="taiko"?(o(),i("div",fe,[_(" osu!taiko points: "),s("b",null,c(Math.round(e.user.taikoPoints*10)/10),1)])):e.filterMode=="catch"?(o(),i("div",ye,[_(" osu!catch points: "),s("b",null,c(Math.round(e.user.catchPoints*10)/10),1)])):e.filterMode=="mania"?(o(),i("div",_e,[_(" osu!mania points: "),s("b",null,c(Math.round(e.user.maniaPoints*10)/10),1)])):l("",!0)])])],2)}const ke=w(ne,[["render",be],["__scopeId","data-v-de1752fb"]]),Ue=M({name:"UserPointsRow",props:{points:{type:Number,required:!0},display:{type:String,required:!0},tooltipTitle:{type:String,required:!0}}}),$e={class:"text-secondary"},Pe={scope:"row"},ve={scope:"row"};function Me(e,t,r,a,f,$){const u=C("bs-tooltip");return o(),i("tr",$e,[P((o(),i("td",Pe,[_(c(e.display),1)])),[[u,e.tooltipTitle,"left"]]),s("td",ve,c(Math.round(e.points*10)/10),1)])}const we=w(Ue,[["render",Me]]),Se=M({props:{points:{type:Number,required:!0},bgClass:{type:String,required:!0},tooltipText:{type:String,required:!0},displayText:{type:String,required:!0},badge:{type:String,default:"main"}},computed:{...A("users",["selectedUser"]),maxPoints(){if(this.badge=="mission")return this.selectedUser.completedMissions.length>3?this.selectedUser.completedMissions.length:3;let e;switch(this.selectedUser.rank){case 0:e=100;break;case 1:e=250;break;case 2:e=500;break;case 3:e=1e3;break;case 4:e=2500;break;case 5:e=this.selectedUser.totalPoints;break}return e}},methods:{generateWidth(e){return`width: ${e/(this.maxPoints/100)}%;`},generateTooltipText(){return this.badge=="main"?`${this.tooltipText} (${Math.round(this.points)} points)`:this.tooltipText},generateDisplayText(){return this.badge=="main"?`${this.displayText} (${Math.round(this.points)} points)`:this.displayText}}});const qe={class:"segment-text"};function Ce(e,t,r,a,f,$){const u=C("bs-tooltip");return P((o(),i("div",{key:e.$route.query.id,class:v(["segment",e.bgClass]),style:O(e.generateWidth(e.points))},[s("span",qe,c(e.generateDisplayText()),1)],6)),[[u,e.generateTooltipText()]])}const Ie=w(Se,[["render",Ce],["__scopeId","data-v-6d7df64b"]]),Ae=M({name:"RewardProgress",components:{RewardProgressSegment:Ie},props:{badge:{type:String,required:!0}},data(){return{bgOptions:["bg-easy","bg-normal","bg-hard","bg-insane","bg-expert","bg-rank-0","bg-rank-4","bg-wip","bg-qualified","bg-done"]}},computed:{...A("users",["selectedUser"]),maxPoints(){if(this.badge=="mission")return this.selectedUser.completedMissions.length>3?this.selectedUser.completedMissions.length:3;let e;switch(this.selectedUser.rank){case 0:e=100;break;case 1:e=250;break;case 2:e=500;break;case 3:e=1e3;break;case 4:e=2500;break;case 5:e=this.selectedUser.totalPoints;break}return e}}});const Te={class:"d-flex mb-2"},Fe={href:"https://osu.ppy.sh/wiki/en/Community/Mappers_Guild#rewards",target:"_blank"},Qe=["src"],Be={href:"https://osu.ppy.sh/wiki/en/Community/Mappers_Guild#rewards",target:"_blank",class:"ms-auto"},De=["src"],Ne={href:"/missions",target:"_blank",class:"mt-3"},Oe=["src"],Ve={class:"progress-bar osu-badge"};function Ge(e,t,r,a,f,$){const u=b("reward-progress-segment"),g=C("bs-tooltip");return o(),i(m,null,[s("div",Te,[s("a",Fe,[e.selectedUser.rank>0&&e.badge=="main"?P((o(),i("img",{key:e.$route.query.id,src:`/images/rank${e.selectedUser.rank}.png`,class:"osu-badge badge-small"},null,8,Qe)),[[g,`${e.selectedUser.username}'s current MG rank`]]):l("",!0)]),s("a",Be,[e.selectedUser.rank<5&&e.badge=="main"?P((o(),i("img",{key:e.$route.query.id,src:`/images/rank${e.selectedUser.rank+1}.png`,class:"osu-badge badge-small"},null,8,De)),[[g,`${e.selectedUser.username}'s next MG rank`]]):l("",!0)]),s("a",Ne,[e.badge=="mission"?P((o(),i("img",{key:e.$route.query.id,src:"/images/questbadge.png",class:"osu-badge badge-small"},null,8,Oe)),[[g,"quest trailblazer"]]):l("",!0)])]),s("div",Ve,[e.badge=="main"?(o(),i(m,{key:0},[h(u,{points:e.selectedUser.easyPoints,"bg-class":"bg-easy","tooltip-text":"mapping Easy difficulties","display-text":"Easy"},null,8,["points"]),h(u,{points:e.selectedUser.normalPoints,"bg-class":"bg-normal","tooltip-text":"mapping Normal difficulties","display-text":"Normal"},null,8,["points"]),h(u,{points:e.selectedUser.hardPoints,"bg-class":"bg-hard","tooltip-text":"mapping Hard difficulties","display-text":"Hard"},null,8,["points"]),h(u,{points:e.selectedUser.insanePoints,"bg-class":"bg-insane","tooltip-text":"mapping Insane difficulties","display-text":"Insane"},null,8,["points"]),h(u,{points:e.selectedUser.expertPoints,"bg-class":"bg-expert","tooltip-text":"mapping Expert difficulties","display-text":"Expert"},null,8,["points"]),h(u,{points:e.selectedUser.hitsoundPoints,"bg-class":"bg-rank-0","tooltip-text":"Hitsounding","display-text":"HS"},null,8,["points"]),h(u,{points:e.selectedUser.storyboardPoints,"bg-class":"bg-rank-4","tooltip-text":"Storyboarding","display-text":"SB"},null,8,["points"]),h(u,{points:e.selectedUser.questPoints,"bg-class":"bg-wip","tooltip-text":"Completing quests","display-text":"Quests"},null,8,["points"]),h(u,{points:e.selectedUser.missionPoints,"bg-class":"bg-qualified","tooltip-text":"Completing priority quests","display-text":"Priority quests"},null,8,["points"]),h(u,{points:e.selectedUser.modPoints,"bg-class":"bg-done","tooltip-text":"Modding","display-text":"Mods"},null,8,["points"]),h(u,{points:e.selectedUser.hostPoints,"bg-class":"bg-ranked","tooltip-text":"Hosting mapsets","display-text":"Host"},null,8,["points"]),h(u,{points:e.selectedUser.contestCreatorPoints+e.selectedUser.contestParticipantPoints+e.selectedUser.contestScreenerPoints+e.selectedUser.contestJudgePoints,"bg-class":"bg-open","tooltip-text":"Anything related to FA mapping contests ","display-text":"Contests"},null,8,["points"]),h(u,{points:e.selectedUser.legacyPoints,"bg-class":"bg-blocked","tooltip-text":"Legacy","display-text":"Legacy"},null,8,["points"]),h(u,{points:e.maxPoints-e.selectedUser.totalPoints,"bg-class":"bg-black","tooltip-text":"Points until next badge","display-text":"..."},null,8,["points","display-text"])],64)):e.badge=="mission"?(o(),i(m,{key:1},[(o(!0),i(m,null,U(e.selectedUser.completedMissions,(d,y)=>(o(),p(u,{key:y,points:1,"bg-class":e.bgOptions[y],"tooltip-text":d.name,"display-text":d.name,badge:"mission"},null,8,["bg-class","tooltip-text","display-text"]))),128)),h(u,{points:2,"bg-class":"bg-black","display-text":"...",badge:"mission"},null,8,["display-text"])],64)):l("",!0)])],64)}const Re=w(Ae,[["render",Ge],["__scopeId","data-v-dd5c44e5"]]),Ee=M({name:"UserInfo",components:{UserPointsRow:we,ModalDialog:R,ModesIcons:V,RewardProgress:Re},data(){return{currentQuests:[],currentMissions:[],createdQuestNames:[],spentPoints:[],userBeatmaps:[],sortOrder:Object.values(E)}},computed:{...S(["loggedInUser"]),...A("users",["selectedUser"])},watch:{async selectedUser(){await this.loadEverything()}},async created(){await this.loadEverything()},methods:{async loadEverything(){if(!this.selectedUser)return;this.$router.push(`/users?id=${this.selectedUser.id}`),this.currentQuests=[],this.currentMissions=[],this.createdQuestNames=[],this.spentPoints=[],this.userBeatmaps=[];const[e,t,r,a,f]=await Promise.all([this.$http.executeGet(`/users/${this.selectedUser.id}/quests`),this.$http.executeGet(`/users/${this.selectedUser.id}/missions`),this.$http.executeGet(`/users/findCreatedQuests/${this.selectedUser.id}`),this.$http.executeGet(`/users/findSpentPoints/${this.selectedUser.id}`),this.$http.executeGet(`/users/findUserBeatmaps/${this.selectedUser.id}`)]);if(this.$http.isError(e)||(this.currentQuests=e),this.$http.isError(t)||(this.currentMissions=t),this.$http.isError(r)||(this.createdQuestNames=r),this.$http.isError(a)||(this.spentPoints=a),!this.$http.isError(f)){const $=["WIP","Done","Qualified","Ranked"];this.userBeatmaps=f.sort(function(u,g){return $.indexOf(u.status)-$.indexOf(g.status)})}},findIcon(e){return e==I.WIP?"fa-ellipsis-h":e==I.Done?"fa-check":e==I.Qualified||e==I.Ranked?"fa-check-circle":""},userTasks(e){[...e.tasks].sort((a,f)=>this.sortOrder.indexOf(a.name)-this.sortOrder.indexOf(f.name));let r="";return e.tasks.forEach(a=>{a.mappers.forEach(f=>{f.id==this.selectedUser.id&&(r+=a.name+", ")})}),r.slice(0,-2)},calculatePoints(e){let t=25;return e.art||(t+=10),e.requiredMapsets<1?t=727:e.requiredMapsets==1?t+=100:e.requiredMapsets<10&&(t+=(10-e.requiredMapsets)*7.5),t},findSpentPointsAction(e){switch(e){case"acceptQuest":return"Accepted quest:";case"reopenQuest":return"Reopened quest:";case"extendDeadline":return"Extended quest deadline:";case"createQuest":return"Created quest:";case"rerollShowcaseMissionSong":return"Rerolled priority quest song:";default:return"undefined action"}},findSpentPointsValue(e,t){switch(e){case"acceptQuest":return t.price;case"reopenQuest":return t.reopenPrice;case"extendDeadline":return 10;case"createQuest":return this.calculatePoints(t);case"rerollShowcaseMissionSong":return 50;default:return 0}}}}),Le=s("div",{class:"radial-divisor"},null,-1),He={class:"row"},je={class:"col-md-6"},Je={class:"table table-sm small"},We=s("thead",null,[s("tr",null,[s("th",{scope:"col"}," Task "),s("th",{scope:"col"}," Points ")])],-1),ze=s("td",{scope:"row"}," Total points earned ",-1),Ke={scope:"row"},Xe=s("td",{scope:"row"}," Available points ",-1),Ye={scope:"row"},Ze=s("i",{class:"fas fa-coins"},null,-1),xe={class:"col-md-6"},es={class:"small"},ss={key:1,class:"text-secondary"},ts={key:0,class:"small"},os={class:"p-0 mb-2 ms-4"},is=["href"],ns={key:1,class:"small"},rs={class:"p-0 mb-2 ms-4"},as=["href"],ls=s("div",{class:"small"}," Completed priority quests: ",-1),ds={class:"p-0 mb-2 ms-4"},cs=["href"],us=s("div",{class:"small"}," Completed quests: ",-1),ps={class:"p-0 mb-2 ms-4"},hs=["href"],ms={key:4,class:"small"},gs={class:"p-0 mb-2 ms-4"},fs=s("div",{class:"radial-divisor"},null,-1),ys={class:"row"},_s={class:"col-sm"},bs=s("p",null,"Mappers' Guild beatmaps:",-1),ks={class:"table table-sm"},Us=s("thead",null,[s("tr",null,[s("th",{scope:"col"}," Mapset "),s("th",{scope:"col"}," Host "),s("th",{scope:"col"}," Tasks "),s("th",{scope:"col"})])],-1),$s={key:0},Ps=s("td",{scope:"row"}," ... ",-1),vs=s("td",{scope:"row"}," ... ",-1),Ms=s("td",{scope:"row"}," ... ",-1),ws=s("td",{scope:"row"},null,-1),Ss=[Ps,vs,Ms,ws],qs={scope:"row"},Cs=["href"],Is={scope:"row"},As={scope:"row",class:"text-secondary"},Ts={scope:"row",class:"text-secondary"},Fs=["href"],Qs=s("i",{class:"fas fa-link"},null,-1),Bs=[Qs],Ds=s("div",{class:"radial-divisor"},null,-1),Ns={class:"row"},Os={class:"col-sm"},Vs=s("p",null,"Spent points logs:",-1),Gs={class:"table table-sm"},Rs=s("thead",null,[s("tr",null,[s("th",{scope:"col"}," Action "),s("th",{scope:"col"}," Spent points ")])],-1),Es={key:0},Ls=s("td",{scope:"row"}," ... ",-1),Hs=s("td",{scope:"row"}," ... ",-1),js=[Ls,Hs],Js={scope:"row",class:"text-secondary"},Ws=["href"],zs=["href"],Ks={scope:"row",class:"text-secondary"},Xs=s("i",{class:"fas fa-coins"},null,-1),Ys=s("div",{class:"radial-divisor"},null,-1),Zs={class:"float-end"};function xs(e,t,r,a,f,$){const u=b("user-link"),g=b("reward-progress"),d=b("user-points-row"),y=b("modes-icons"),k=b("modal-dialog"),T=C("bs-tooltip");return o(),p(k,{id:"extendedInfo",loaded:!!e.selectedUser,"header-class":e.selectedUser?"bg-rank-"+e.selectedUser.rank:""},{header:q(()=>[h(u,{class:"text-dark",user:e.selectedUser},null,8,["user"])]),default:q(()=>[h(g,{badge:"main"}),e.selectedUser.completedMissions&&e.selectedUser.completedMissions.length?(o(),p(g,{key:0,badge:"mission"})):l("",!0),Le,s("div",He,[s("div",je,[s("table",Je,[We,s("tbody",null,[e.selectedUser.easyPoints?(o(),p(d,{key:0,points:e.selectedUser.easyPoints,display:"mapping Easy difficulties","tooltip-title":"~5 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.normalPoints?(o(),p(d,{key:1,points:e.selectedUser.normalPoints,display:"mapping Normal difficulties","tooltip-title":"~6 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.hardPoints?(o(),p(d,{key:2,points:e.selectedUser.hardPoints,display:"mapping Hard difficulties","tooltip-title":"~7 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.insanePoints?(o(),p(d,{key:3,points:e.selectedUser.insanePoints,display:"mapping Insane difficulties","tooltip-title":"~8 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.expertPoints?(o(),p(d,{key:4,points:e.selectedUser.expertPoints,display:"mapping Expert difficulties","tooltip-title":"~8 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.hitsoundPoints?(o(),p(d,{key:5,points:e.selectedUser.hitsoundPoints,display:"hitsounding","tooltip-title":"~2 points per mapset"},null,8,["points"])):l("",!0),e.selectedUser.storyboardPoints?(o(),p(d,{key:6,points:e.selectedUser.storyboardPoints,display:"creating storyboards","tooltip-title":"2, 7.5, or 10 points per storyboard"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.questPoints?(o(),p(d,{key:7,points:e.selectedUser.questPoints,display:"completing quests","tooltip-title":"7 bonus points for completing quests on time"},null,8,["points"])):l("",!0),e.selectedUser.missionPoints?(o(),p(d,{key:8,points:e.selectedUser.missionPoints,display:"completing priority quests","tooltip-title":"5-24 bonus points for completing priority quests"},null,8,["points"])):l("",!0),e.selectedUser.modPoints?(o(),p(d,{key:9,points:e.selectedUser.modPoints,display:"modding mapsets","tooltip-title":"~1 point per mod"},null,8,["points"])):l("",!0),e.selectedUser.hostPoints?(o(),p(d,{key:10,points:e.selectedUser.hostPoints,display:"hosting mapsets","tooltip-title":"3 points per mapset hosted"},null,8,["points"])):l("",!0),e.selectedUser.contestCreatorPoints?(o(),p(d,{key:11,points:e.selectedUser.contestCreatorPoints,display:"FA contest creation","tooltip-title":"creation of FA beatmapping contests hosted on Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.contestParticipantPoints?(o(),p(d,{key:12,points:e.selectedUser.contestParticipantPoints,display:"FA contest participation","tooltip-title":"participating in FA beatmapping contests hosted on Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.contestScreenerPoints?(o(),p(d,{key:13,points:e.selectedUser.contestScreenerPoints,display:"FA contest screening","tooltip-title":"screening entries in FA beatmapping contests hosted on Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.contestJudgePoints?(o(),p(d,{key:14,points:e.selectedUser.contestJudgePoints,display:"FA contest judging","tooltip-title":"judging entries in FA beatmapping contests hosted on Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.legacyPoints?(o(),p(d,{key:15,points:e.selectedUser.legacyPoints,display:"legacy","tooltip-title":"points for things that are no longer applicable to Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.osuPoints?(o(),p(d,{key:16,points:e.selectedUser.osuPoints,display:"Total osu! points","tooltip-title":"mapping osu! game mode"},null,8,["points"])):l("",!0),e.selectedUser.taikoPoints?(o(),p(d,{key:17,points:e.selectedUser.taikoPoints,display:"Total osu!taiko points","tooltip-title":"mapping osu!taiko game mode"},null,8,["points"])):l("",!0),e.selectedUser.catchPoints?(o(),p(d,{key:18,points:e.selectedUser.catchPoints,display:"Total osu!catch points","tooltip-title":"mapping osu!catch game mode"},null,8,["points"])):l("",!0),e.selectedUser.maniaPoints?(o(),p(d,{key:19,points:e.selectedUser.maniaPoints,display:"Total osu!mania points","tooltip-title":"mapping osu!mania game mode"},null,8,["points"])):l("",!0),s("tr",null,[ze,s("td",Ke,c(e.selectedUser.totalPoints),1)]),s("tr",null,[Xe,s("td",Ye,[_(c(e.selectedUser.availablePoints)+" ",1),Ze])])])])]),s("div",xe,[s("p",es,[_(" Rank: "),e.selectedUser.rank>0?P((o(),i("i",{key:e.$route.query.id,class:v(["fas fa-crown","text-rank-"+e.selectedUser.rank])},null,2)),[[T,`rank ${e.selectedUser.rank} user`]]):(o(),i("span",ss," None "))]),e.currentMissions.length?(o(),i("div",ts," Current missions: ")):l("",!0),s("ul",os,[(o(!0),i(m,null,U(e.currentMissions,n=>(o(),i("li",{key:n.id,class:"small text-secondary"},[s("a",{href:"/missions?id="+n.id,target:"_blank"},c(n.name.length>40?n.name.slice(0,40)+"...":n.name),9,is)]))),128))]),e.currentQuests.length?(o(),i("div",ns," Current quests: ")):l("",!0),s("ul",rs,[(o(!0),i(m,null,U(e.currentQuests,n=>(o(),i("li",{key:n.id,class:"small text-secondary"},[s("a",{href:"/quests?id="+n.id,target:"_blank"},c(n.name.length>40?n.name.slice(0,40)+"...":n.name),9,as)]))),128))]),e.selectedUser.completedMissions&&e.selectedUser.completedMissions.length?(o(),i(m,{key:2},[ls,s("ul",ds,[(o(!0),i(m,null,U(e.selectedUser.completedMissions,n=>(o(),i("li",{key:n.id,class:"small text-secondary"},[s("a",{href:"/missions?id="+n.id,target:"_blank"},c(n.name.length>40?n.name.slice(0,40)+"...":n.name),9,cs)]))),128))])],64)):l("",!0),e.selectedUser.completedQuests&&e.selectedUser.completedQuests.length?(o(),i(m,{key:3},[us,s("ul",ps,[(o(!0),i(m,null,U(e.selectedUser.completedQuests,n=>(o(),i("li",{key:n.id,class:"small text-secondary"},[s("a",{href:"/quests?id="+n.id,target:"_blank"},c(n.name.length>40?n.name.slice(0,40)+"...":n.name),9,hs)]))),128))])],64)):l("",!0),e.createdQuestNames.length?(o(),i("div",ms," Created quests: ")):l("",!0),s("ul",gs,[(o(!0),i(m,null,U(e.createdQuestNames,n=>(o(),i("li",{key:n,class:"small text-secondary"},c(n.length>40?n.slice(0,40)+"...":n),1))),128))])])]),fs,s("div",ys,[s("div",_s,[bs,s("table",ks,[Us,s("tbody",null,[e.userBeatmaps.length?l("",!0):(o(),i("tr",$s,Ss)),(o(!0),i(m,null,U(e.userBeatmaps,n=>(o(),i("tr",{key:n.id},[s("td",qs,[P(s("i",{class:v(["fas me-1",["text-"+n.status.toLowerCase(),e.findIcon(n.status)]])},null,2),[[T,n.status]]),s("a",{href:"/beatmaps?id="+n.id,target:"_blank",class:"me-1"},c(n.song.artist)+" - "+c(n.song.title),9,Cs),n.mode!=="osu"?(o(),p(y,{key:0,modes:[n.mode],color:"secondary"},null,8,["modes"])):l("",!0)]),s("td",Is,[h(u,{user:n.host},null,8,["user"])]),s("td",As,c(e.userTasks(n)),1),s("td",Ts,[n.url?(o(),i("a",{key:0,href:n.url,target:"_blank"},Bs,8,Fs)):l("",!0)])]))),128))])])])]),Ds,s("div",Ns,[s("div",Os,[Vs,s("table",Gs,[Rs,s("tbody",null,[e.spentPoints.length?l("",!0):(o(),i("tr",Es,js)),(o(!0),i(m,null,U(e.spentPoints,n=>(o(),i("tr",{key:n.id},[s("td",Js,[_(c(e.findSpentPointsAction(n.category))+" ",1),n.quest?(o(),i("a",{key:0,href:"/quests/?id="+n.quest.id,target:"_blank"},c(n.quest.name),9,Ws)):n.mission?(o(),i("a",{key:1,href:"/missions/?id="+n.mission.id,target:"_blank"},c(n.mission.name),9,zs)):l("",!0)]),s("td",Ks,[_(c(e.findSpentPointsValue(n.category,n.quest))+" ",1),Xs])]))),128))])])])]),Ys,s("p",Zs," Joined: "+c(e.selectedUser.createdAt.slice(0,10)),1)]),_:1},8,["loaded","header-class"])}const et=w(Ee,[["render",xs]]),st=M({name:"UserPageFilters",components:{FilterBox:L,ModeFilters:H},data(){return{sorted:!1,sortOptions:{username:"Name",rank:"Rank",createdAt:"Joined"},displayOptions:{list:"List",cards:"Cards"}}},computed:S("users",["sortBy","displayAs","filterMode","filterValue"]),methods:{...G("users",["updateDisplay","updateSorting","updateFilterValue","updateFilterMode"])}}),tt={class:"card card-body mb-2"},ot={class:"container"},it={class:"row small mt-3"},nt=s("div",{class:"col-auto filter-title"}," Sort ",-1),rt={class:"col"},at=["onClick"],lt={class:"row small mt-3"},dt=s("div",{class:"col-auto filter-title"}," Display ",-1),ct={class:"col"},ut=["onClick"];function pt(e,t,r,a,f,$){const u=b("mode-filters"),g=b("filter-box");return o(),i("div",tt,[s("div",ot,[h(g,{placeholder:"enter to search for username...","filter-value":e.filterValue,"onUpdate:filterValue":t[1]||(t[1]=d=>e.updateFilterValue(d))},{filters:q(()=>[h(u,{"filter-mode":e.filterMode,"onUpdate:filterMode":t[0]||(t[0]=d=>e.updateFilterMode(d))},null,8,["filter-mode"])]),_:1},8,["filter-value"]),s("div",it,[nt,s("div",rt,[(o(!0),i(m,null,U(e.sortOptions,(d,y)=>(o(),i("a",{key:y,class:v(e.sortBy===y?"sorted":"unsorted"),href:"#",onClick:F(k=>e.updateSorting(y),["prevent"])},c(d),11,at))),128))])]),s("div",lt,[dt,s("div",ct,[(o(!0),i(m,null,U(e.displayOptions,(d,y)=>(o(),i("a",{key:y,class:v(e.displayAs===y?"sorted":"unsorted"),href:"#",onClick:F(k=>e.updateDisplay(y),["prevent"])},c(d),11,ut))),128))])])])])}const ht=w(st,[["render",pt]]),mt={namespaced:!0,state:{users:[],selectedUserId:null,filterValue:"",filterMode:B.any,sortBy:"rank",displayAs:"list",sortDesc:!0,pagination:{page:1,limit:16,maxPages:1}},mutations:{setUsers(e,t){e.users=t},setFilterValue(e,t){e.filterValue=t},setFilterMode(e,t){e.filterMode=t},setSelectedUserId(e,t){e.selectedUserId=t},updateUser(e,t){const r=e.users.findIndex(a=>a.id===t.id);r!==-1&&(e.users[r]=t)},setSortBy(e,t){e.sortBy=t},setSortDesc(e,t){e.sortDesc=t},setDisplayAs(e,t){e.displayAs=t},increasePaginationPage(e){e.pagination.page+=1},decreasePaginationPage(e){e.pagination.page-=1},resetPaginationPage(e){e.pagination.page=1},updatePaginationMaxPages(e,t){e.pagination.maxPages=t}},getters:{filteredUsers:e=>{let t=[...e.users];if(e.filterMode!==B.any){const r=e.filterMode;t=t.filter(a=>!!(r=="osu"&&a.osuPoints||r=="taiko"&&a.taikoPoints||r=="catch"&&a.catchPoints||r=="mania"&&a.maniaPoints))}return e.filterValue.length>2&&(t=t.filter(r=>r.username.toLowerCase().includes(e.filterValue.toLowerCase()))),e.sortBy==="createdAt"?t.sort((r,a)=>+r.createdAt-+a.createdAt):e.sortBy==="username"?t.sort((r,a)=>a.username.toLowerCase().localeCompare(r.username.toLowerCase())):e.sortBy==="rank"&&(e.filterMode==="osu"?t.sort((r,a)=>r.osuPoints-a.osuPoints):e.filterMode==="taiko"?t.sort((r,a)=>r.taikoPoints-a.taikoPoints):e.filterMode==="catch"?t.sort((r,a)=>r.catchPoints-a.catchPoints):e.filterMode==="mania"?t.sort((r,a)=>r.maniaPoints-a.maniaPoints):t.sort((r,a)=>r.totalPoints-a.totalPoints)),e.sortDesc&&t.reverse(),t},paginatedUsers:(e,t)=>t.filteredUsers.slice(e.pagination.limit*(e.pagination.page-1),e.pagination.limit*e.pagination.page),selectedUser:e=>e.users.find(t=>t.id===e.selectedUserId),allUsers:e=>e.users},actions:{updateFilterMode({commit:e},t){e("resetPaginationPage"),e("setFilterMode",t)},updateFilterValue({commit:e},t){e("resetPaginationPage"),e("setFilterValue",t)},updatePaginationMaxPages({commit:e,getters:t,state:r}){const a=Math.ceil(t.filteredUsers.length/r.pagination.limit);e("updatePaginationMaxPages",a)},updateSorting({commit:e,state:t},r){t.sortBy!==r||t.sortDesc===!1?e("setSortDesc",!0):e("setSortDesc",!1),e("setSortBy",r)},updateDisplay({commit:e,state:t},r){t.displayAs!==r&&(e("setDisplayAs",r),console.log(r))}}},gt=mt,ft=M({name:"UserPage",components:{UserCard:ie,UserInfo:et,UserPageFilters:ht,UserListElement:ke},computed:{...S(["loggedInUser"]),...S("users",["pagination","displayAs"]),...A("users",["paginatedUsers","allUsers","filteredUsers"])},watch:{paginatedUsers(){this.$store.dispatch("users/updatePaginationMaxPages")}},beforeCreate(){this.$store.hasModule("users")||this.$store.registerModule("users",gt)},async created(){const e=await this.$http.initialRequest("/users/query");if(!this.$http.isError(e)){this.$store.commit("users/setUsers",e.users);const t=this.$route.query.id;t&&this.allUsers.findIndex(a=>a.id==t)>=0&&(this.$store.commit("users/setSelectedUserId",t),this.$bs.showModal("extendedInfo"))}},methods:{showOlder(){this.$store.commit("users/increasePaginationPage")},showNewer(){this.$store.commit("users/decreasePaginationPage")}}}),yt={key:0,class:"container card card-body py-3"},_t=["disabled"],bt=s("i",{class:"fas fa-angle-up me-1"},null,-1),kt=s("i",{class:"fas fa-angle-up ms-1"},null,-1),Ut={class:"small text-center mx-auto"},$t=["disabled"],Pt=s("i",{class:"fas fa-angle-down me-1"},null,-1),vt=s("i",{class:"fas fa-angle-down ms-1"},null,-1),Mt={key:1,class:"container card card-body py-3"},wt=s("div",{class:"radial-divisor"},null,-1);function St(e,t,r,a,f,$){const u=b("user-page-filters"),g=b("user-card"),d=b("user-list-element"),y=b("user-info");return o(),i("div",null,[h(u),e.displayAs=="cards"?(o(),i("div",yt,[s("button",{disabled:e.pagination.page==1,class:"btn btn-sm btn-primary mx-auto my-2 d-block",type:"button",onClick:t[0]||(t[0]=(...k)=>e.showNewer&&e.showNewer(...k))},[bt,_(" show newer "),kt],8,_t),s("div",null,[h(Q,{name:"list",tag:"div",class:"row px-3"},{default:q(()=>[(o(!0),i(m,null,U(e.paginatedUsers,k=>(o(),p(g,{key:k.id,user:k},null,8,["user"]))),128))]),_:1}),s("div",Ut,c(e.paginatedUsers.length===0?"0":e.pagination.page)+" of "+c(e.pagination.maxPages),1),s("button",{disabled:e.pagination.page>=e.pagination.maxPages,class:"btn btn-sm btn-primary mx-auto my-2 d-block",type:"button",onClick:t[1]||(t[1]=(...k)=>e.showOlder&&e.showOlder(...k))},[Pt,_(" show older "),vt],8,$t)])])):e.displayAs=="list"?(o(),i("div",Mt,[h(Q,{name:"list",tag:"div",class:"row px-3"},{default:q(()=>[(o(),p(d,{key:e.loggedInUser.id,user:e.loggedInUser},null,8,["user"])),wt,(o(!0),i(m,null,U(e.filteredUsers,k=>(o(),p(d,{key:k.id,user:k},null,8,["user"]))),128))]),_:1})])):l("",!0),h(y)])}const Ft=w(ft,[["render",St]]);export{Ft as default};
