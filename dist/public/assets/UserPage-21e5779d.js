import{d as $,m as S,_ as b,o,e as a,a as s,k as y,t as c,h as g,q as l,n as M,i as f,y as q,z as A,b as F,s as B,M as V,u as Q,c as u,w as v,r as P,F as k,j as N,l as T,T as D}from"./index-2d571758.js";import{M as O}from"./ModalDialog-f42320a0.js";import{a as G}from"./task-0811ab65.js";import{B as w}from"./beatmap-c2b9f550.js";import{F as R}from"./FilterBox-8893f4d2.js";import{M as E,F as I}from"./extras-76790458.js";const L=$({name:"UserCard",props:{user:{type:Object,required:!0}},computed:S(["filterMode"]),methods:{selectUser(){this.$store.commit("users/setSelectedUserId",this.user.id)}}});const j=e=>(q("data-v-356a03c7"),e=e(),A(),e),J=["src"],z={class:"mb-2"},H={class:"text-secondary"},W={class:"card-text small"},K={class:"card-text small"},X=j(()=>s("i",{class:"fas fa-coins"},null,-1)),Y={key:0,class:"card-text small"},Z={key:1,class:"card-text small"},x={key:2,class:"card-text small"},ee={key:3,class:"card-text small"};function se(e,t,i,n,m,U){const p=f("user-link");return o(),a("div",{class:"col-sm-6 col-md-4 col-lg-4 col-xl-3 my-2",onClick:t[0]||(t[0]=d=>e.selectUser())},[s("div",{class:M(["card card-hover card-level-2 card-body","border-rank-"+e.user.rank]),"data-bs-toggle":"modal","data-bs-target":"#extendedInfo"},[s("img",{src:"https://a.ppy.sh/"+e.user.osuId,class:"card-avatar-img"},null,8,J),s("div",z,[y(p,{user:e.user},null,8,["user"])]),s("div",H,[s("div",W,[s("b",null,"Total points: "+c(e.user.totalPoints),1)]),s("div",K,[g(" Available points: "+c(e.user.availablePoints)+" ",1),X]),e.filterMode=="osu"?(o(),a("p",Y," osu! points: "+c(Math.round(e.user.osuPoints*10)/10),1)):e.filterMode=="taiko"?(o(),a("p",Z," osu!taiko points: "+c(Math.round(e.user.taikoPoints*10)/10),1)):e.filterMode=="catch"?(o(),a("p",x," osu!catch points: "+c(Math.round(e.user.catchPoints*10)/10),1)):e.filterMode=="mania"?(o(),a("p",ee," osu!mania points: "+c(Math.round(e.user.maniaPoints*10)/10),1)):l("",!0)])],2)])}const te=b(L,[["render",se],["__scopeId","data-v-356a03c7"]]),oe=$({name:"UserPointsRow",props:{points:{type:Number,required:!0},display:{type:String,required:!0},tooltipTitle:{type:String,required:!0}}}),ie={class:"text-white-50"},ne={scope:"row"},re={scope:"row"};function ae(e,t,i,n,m,U){const p=B("bs-tooltip");return o(),a("tr",ie,[F((o(),a("td",ne,[g(c(e.display),1)])),[[p,e.tooltipTitle,"left"]]),s("td",re,c(Math.round(e.points*10)/10),1)])}const le=b(oe,[["render",ae]]),de=$({name:"UserInfo",components:{UserPointsRow:le,ModalDialog:O,ModesIcons:V},data(){return{currentQuests:[],createdQuestNames:[],spentPoints:[],userBeatmaps:[],sortOrder:Object.values(G)}},computed:{...S(["loggedInUser"]),...Q("users",["selectedUser"])},watch:{async selectedUser(){if(!this.selectedUser||this.selectedUser.id===this.$route.query.id)return;this.$router.push(`/users?id=${this.selectedUser.id}`),this.currentQuests=[],this.createdQuestNames=[],this.spentPoints=[],this.userBeatmaps=[];const[e,t,i,n]=await Promise.all([this.$http.executeGet(`/users/${this.selectedUser.id}/quests`),this.$http.executeGet(`/users/findCreatedQuests/${this.selectedUser.id}`),this.$http.executeGet(`/users/findSpentPoints/${this.selectedUser.id}`),this.$http.executeGet(`/users/findUserBeatmaps/${this.selectedUser.id}`)]);if(this.$http.isError(e)||(this.currentQuests=e),this.$http.isError(t)||(this.createdQuestNames=t),this.$http.isError(i)||(this.spentPoints=i),!this.$http.isError(n)){const m=["WIP","Done","Qualified","Ranked"];this.userBeatmaps=n.sort(function(U,p){return m.indexOf(U.status)-m.indexOf(p.status)})}}},methods:{findIcon(e){return e==w.WIP?"fa-ellipsis-h":e==w.Done?"fa-check":e==w.Qualified||e==w.Ranked?"fa-check-circle":""},userTasks(e){[...e.tasks].sort((n,m)=>this.sortOrder.indexOf(n.name)-this.sortOrder.indexOf(m.name));let i="";return e.tasks.forEach(n=>{n.mappers.forEach(m=>{m.id==this.selectedUser.id&&(i+=n.name+", ")})}),i.slice(0,-2)},calculatePoints(e){let t=25;return e.art||(t+=10),e.requiredMapsets<1?t=727:e.requiredMapsets==1?t+=100:e.requiredMapsets<10&&(t+=(10-e.requiredMapsets)*7.5),t},findSpentPointsAction(e){switch(e){case"acceptQuest":return"Accepted quest:";case"reopenQuest":return"Reopened quest:";case"extendDeadline":return"Extended quest deadline:";case"createQuest":return"Created quest:";default:return"undefined action"}},findSpentPointsValue(e,t){switch(e){case"acceptQuest":return t.price;case"reopenQuest":return t.reopenPrice;case"extendDeadline":return 10;case"createQuest":return this.calculatePoints(t);default:return 0}}}}),ce={class:"row"},ue={class:"col-md-6"},pe={class:"table table-sm"},he=s("thead",null,[s("tr",null,[s("th",{scope:"col"}," Task "),s("th",{scope:"col"}," Points ")])],-1),me=s("td",{scope:"row"}," Total points earned ",-1),fe={scope:"row"},_e=s("td",{scope:"row"}," Available points ",-1),ge={scope:"row"},ye=s("i",{class:"fas fa-coins"},null,-1),Pe={class:"col-md-6"},ke={class:"small"},Ue={key:1,class:"text-white-50"},$e={key:0,class:"small"},be={class:"p-0 mb-2 ms-4"},we=["href"],Me={key:1,class:"small"},ve={class:"p-0 mb-2 ms-4"},Se={key:2,class:"small"},Ce={class:"p-0 mb-2 ms-4"},Fe=["href"],Ie=s("div",{class:"radial-divisor"},null,-1),Be={class:"row"},Qe={class:"col-sm"},qe=s("p",null,"Mappers' Guild beatmaps:",-1),Ae={class:"table table-sm"},Ve=s("thead",null,[s("tr",null,[s("th",{scope:"col"}," Mapset "),s("th",{scope:"col"}," Host "),s("th",{scope:"col"}," Tasks "),s("th",{scope:"col"})])],-1),Ne={key:0},Te=s("td",{scope:"row"}," ... ",-1),De=s("td",{scope:"row"}," ... ",-1),Oe=s("td",{scope:"row"}," ... ",-1),Ge=s("td",{scope:"row"},null,-1),Re=[Te,De,Oe,Ge],Ee={scope:"row"},Le=["href"],je={scope:"row"},Je={scope:"row",class:"text-white-50"},ze={scope:"row",class:"text-white-50"},He=["href"],We=s("i",{class:"fas fa-link"},null,-1),Ke=[We],Xe=s("div",{class:"radial-divisor"},null,-1),Ye={class:"row"},Ze={class:"col-sm"},xe=s("p",null,"Spent points logs:",-1),es={class:"table table-sm"},ss=s("thead",null,[s("tr",null,[s("th",{scope:"col"}," Action "),s("th",{scope:"col"}," Spent points ")])],-1),ts={key:0},os=s("td",{scope:"row"}," ... ",-1),is=s("td",{scope:"row"}," ... ",-1),ns=[os,is],rs={scope:"row",class:"text-white-50"},as=["href"],ls={scope:"row",class:"text-white-50"},ds=s("i",{class:"fas fa-coins"},null,-1),cs=s("div",{class:"radial-divisor"},null,-1),us={class:"float-end"};function ps(e,t,i,n,m,U){const p=f("user-link"),d=f("user-points-row"),_=f("modes-icons"),h=f("modal-dialog"),C=B("bs-tooltip");return o(),u(h,{id:"extendedInfo",loaded:Boolean(e.selectedUser),"header-class":e.selectedUser?"bg-rank-"+e.selectedUser.rank:""},{header:v(()=>[y(p,{class:"text-dark",user:e.selectedUser},null,8,["user"])]),default:v(()=>[s("div",ce,[s("div",ue,[s("table",pe,[he,s("tbody",null,[e.selectedUser.easyPoints?(o(),u(d,{key:0,points:e.selectedUser.easyPoints,display:"mapping Easy difficulties","tooltip-title":"~5 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.normalPoints?(o(),u(d,{key:1,points:e.selectedUser.normalPoints,display:"mapping Normal difficulties","tooltip-title":"~6 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.hardPoints?(o(),u(d,{key:2,points:e.selectedUser.hardPoints,display:"mapping Hard difficulties","tooltip-title":"~7 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.insanePoints?(o(),u(d,{key:3,points:e.selectedUser.insanePoints,display:"mapping Insane difficulties","tooltip-title":"~8 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.expertPoints?(o(),u(d,{key:4,points:e.selectedUser.expertPoints,display:"mapping Expert difficulties","tooltip-title":"~8 points per difficulty. +2 if quest mapset"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.storyboardPoints?(o(),u(d,{key:5,points:e.selectedUser.storyboardPoints,display:"creating storyboards","tooltip-title":"2, 7.5, or 10 points per storyboard"},null,8,["points","tooltip-title"])):l("",!0),e.selectedUser.questPoints?(o(),u(d,{key:6,points:e.selectedUser.questPoints,display:"completing quests","tooltip-title":"5 bonus points for completing quests on time"},null,8,["points"])):l("",!0),e.selectedUser.modPoints?(o(),u(d,{key:7,points:e.selectedUser.modPoints,display:"modding mapsets","tooltip-title":"1 point per mod"},null,8,["points"])):l("",!0),e.selectedUser.hostPoints?(o(),u(d,{key:8,points:e.selectedUser.hostPoints,display:"hosting mapsets","tooltip-title":"5 points per mapset hosted"},null,8,["points"])):l("",!0),e.selectedUser.contestCreatorPoints?(o(),u(d,{key:9,points:e.selectedUser.contestCreatorPoints,display:"FA contest creation","tooltip-title":"creation of FA beatmapping contests hosted on Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.contestParticipantPoints?(o(),u(d,{key:10,points:e.selectedUser.contestParticipantPoints,display:"FA contest participation","tooltip-title":"participating in FA beatmapping contests hosted on Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.contestScreenerPoints?(o(),u(d,{key:11,points:e.selectedUser.contestScreenerPoints,display:"FA contest screening","tooltip-title":"screening entries in FA beatmapping contests hosted on Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.contestJudgePoints?(o(),u(d,{key:12,points:e.selectedUser.contestJudgePoints,display:"FA contest judging","tooltip-title":"judging entries in FA beatmapping contests hosted on Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.legacyPoints?(o(),u(d,{key:13,points:e.selectedUser.legacyPoints,display:"legacy","tooltip-title":"points for things that are no longer applicable to Mappers' Guild"},null,8,["points"])):l("",!0),e.selectedUser.osuPoints?(o(),u(d,{key:14,points:e.selectedUser.osuPoints,display:"Total osu! points","tooltip-title":"mapping osu! game mode"},null,8,["points"])):l("",!0),e.selectedUser.taikoPoints?(o(),u(d,{key:15,points:e.selectedUser.taikoPoints,display:"Total osu!taiko points","tooltip-title":"mapping osu!taiko game mode"},null,8,["points"])):l("",!0),e.selectedUser.catchPoints?(o(),u(d,{key:16,points:e.selectedUser.catchPoints,display:"Total osu!catch points","tooltip-title":"mapping osu!catch game mode"},null,8,["points"])):l("",!0),e.selectedUser.maniaPoints?(o(),u(d,{key:17,points:e.selectedUser.maniaPoints,display:"Total osu!mania points","tooltip-title":"mapping osu!mania game mode"},null,8,["points"])):l("",!0),s("tr",null,[me,s("td",fe,c(e.selectedUser.totalPoints),1)]),s("tr",null,[_e,s("td",ge,[g(c(e.selectedUser.availablePoints)+" ",1),ye])])])])]),s("div",Pe,[s("p",ke,[g(" Rank: "),e.selectedUser.rank>0?F((o(),a("i",{key:0,class:M(["fas fa-crown","text-rank-"+e.selectedUser.rank])},null,2)),[[C,`rank ${e.selectedUser.rank} user`]]):(o(),a("span",Ue," None "))]),e.currentQuests.length?(o(),a("div",$e," Current quests: ")):l("",!0),s("ul",be,[(o(!0),a(k,null,P(e.currentQuests,r=>(o(),a("li",{key:r.id,class:"small text-white-50"},[s("a",{href:"/quests?id="+r.id,target:"_blank"},c(r.name.length>40?r.name.slice(0,40)+"...":r.name),9,we)]))),128))]),e.currentQuests.length?(o(),a("div",Me," Created quests: ")):l("",!0),s("ul",ve,[(o(!0),a(k,null,P(e.createdQuestNames,r=>(o(),a("li",{key:r,class:"small text-white-50"},c(r.length>40?r.slice(0,40)+"...":r),1))),128))]),e.selectedUser.completedQuests.length?(o(),a("div",Se," Completed quests: ")):l("",!0),s("ul",Ce,[(o(!0),a(k,null,P(e.selectedUser.completedQuests,r=>(o(),a("li",{key:r.id,class:"small text-white-50"},[s("a",{href:"/quests?id="+r.id,target:"_blank"},c(r.name.length>40?r.name.slice(0,40)+"...":r.name),9,Fe)]))),128))])])]),Ie,s("div",Be,[s("div",Qe,[qe,s("table",Ae,[Ve,s("tbody",null,[e.userBeatmaps.length?l("",!0):(o(),a("tr",Ne,Re)),(o(!0),a(k,null,P(e.userBeatmaps,r=>(o(),a("tr",{key:r.id},[s("td",Ee,[F(s("i",{class:M(["fas me-1",["text-"+r.status.toLowerCase(),e.findIcon(r.status)]])},null,2),[[C,r.status]]),s("a",{href:"/beatmaps?id="+r.id,target:"_blank",class:"me-1"},c(r.song.artist)+" - "+c(r.song.title),9,Le),r.mode!=="osu"?(o(),u(_,{key:0,modes:[r.mode]},null,8,["modes"])):l("",!0)]),s("td",je,[y(p,{user:r.host},null,8,["user"])]),s("td",Je,c(e.userTasks(r)),1),s("td",ze,[r.url?(o(),a("a",{key:0,href:r.url,target:"_blank"},Ke,8,He)):l("",!0)])]))),128))])])])]),Xe,s("div",Ye,[s("div",Ze,[xe,s("table",es,[ss,s("tbody",null,[e.spentPoints.length?l("",!0):(o(),a("tr",ts,ns)),(o(!0),a(k,null,P(e.spentPoints,r=>(o(),a("tr",{key:r.id},[s("td",rs,[g(c(e.findSpentPointsAction(r.category))+" ",1),s("a",{href:"/quests/?id="+r.quest.id,target:"_blank"},c(r.quest.name),9,as)]),s("td",ls,[g(c(e.findSpentPointsValue(r.category,r.quest))+" ",1),ds])]))),128))])])])]),cs,s("p",us," Joined: "+c(e.selectedUser.createdAt.slice(0,10)),1)]),_:1},8,["loaded","header-class"])}const hs=b(de,[["render",ps]]),ms=$({name:"UserPageFilters",components:{FilterBox:R,ModeFilters:E},data(){return{sorted:!1,sortOptions:{username:"Name",rank:"Rank",createdAt:"Joined"}}},computed:S("users",["sortBy","filterMode","filterValue"]),methods:{...N("users",["updateSorting","updateFilterValue","updateFilterMode"])}}),fs={class:"card card-body mb-2"},_s={class:"container"},gs={class:"row small mt-3"},ys=s("div",{class:"col-auto filter-title"}," Sort ",-1),Ps={class:"col"},ks=["onClick"];function Us(e,t,i,n,m,U){const p=f("mode-filters"),d=f("filter-box");return o(),a("div",fs,[s("div",_s,[y(d,{placeholder:"enter to search for username...","filter-value":e.filterValue,"onUpdate:filterValue":t[1]||(t[1]=_=>e.updateFilterValue(_))},{filters:v(()=>[y(p,{"filter-mode":e.filterMode,"onUpdate:filterMode":t[0]||(t[0]=_=>e.updateFilterMode(_))},null,8,["filter-mode"])]),_:1},8,["filter-value"]),s("div",gs,[ys,s("div",Ps,[(o(!0),a(k,null,P(e.sortOptions,(_,h)=>(o(),a("a",{key:h,class:M(e.sortBy===h?"sorted":"unsorted"),href:"#",onClick:T(C=>e.updateSorting(h),["prevent"])},c(_),11,ks))),128))])])])])}const $s=b(ms,[["render",Us]]),bs={namespaced:!0,state:{users:[],selectedUserId:null,filterValue:"",filterMode:I.any,sortBy:"rank",sortDesc:!0,pagination:{page:1,limit:16,maxPages:1}},mutations:{setUsers(e,t){e.users=t},setFilterValue(e,t){e.filterValue=t},setFilterMode(e,t){e.filterMode=t},setSelectedUserId(e,t){e.selectedUserId=t},updateUser(e,t){const i=e.users.findIndex(n=>n.id===t.id);i!==-1&&(e.users[i]=t)},setSortBy(e,t){e.sortBy=t},setSortDesc(e,t){e.sortDesc=t},increasePaginationPage(e){e.pagination.page+=1},decreasePaginationPage(e){e.pagination.page-=1},resetPaginationPage(e){e.pagination.page=1},updatePaginationMaxPages(e,t){e.pagination.maxPages=t}},getters:{filteredUsers:e=>{let t=[...e.users];if(e.filterMode!==I.any){const i=e.filterMode;t=t.filter(n=>!!(i=="osu"&&n.osuPoints||i=="taiko"&&n.taikoPoints||i=="catch"&&n.catchPoints||i=="mania"&&n.maniaPoints))}return e.filterValue.length>2&&(t=t.filter(i=>i.username.toLowerCase().includes(e.filterValue.toLowerCase()))),e.sortBy==="createdAt"?t.sort((i,n)=>+i.createdAt-+n.createdAt):e.sortBy==="username"?t.sort((i,n)=>n.username.toLowerCase().localeCompare(i.username.toLowerCase())):e.sortBy==="rank"&&(e.filterMode==="osu"?t.sort((i,n)=>i.osuPoints-n.osuPoints):e.filterMode==="taiko"?t.sort((i,n)=>i.taikoPoints-n.taikoPoints):e.filterMode==="catch"?t.sort((i,n)=>i.catchPoints-n.catchPoints):e.filterMode==="mania"?t.sort((i,n)=>i.maniaPoints-n.maniaPoints):t.sort((i,n)=>i.totalPoints-n.totalPoints)),e.sortDesc&&t.reverse(),t},paginatedUsers:(e,t)=>t.filteredUsers.slice(e.pagination.limit*(e.pagination.page-1),e.pagination.limit*e.pagination.page),selectedUser:e=>e.users.find(t=>t.id===e.selectedUserId),allUsers:e=>e.users},actions:{updateFilterMode({commit:e},t){e("resetPaginationPage"),e("setFilterMode",t)},updateFilterValue({commit:e},t){e("resetPaginationPage"),e("setFilterValue",t)},updatePaginationMaxPages({commit:e,getters:t,state:i}){const n=Math.ceil(t.filteredUsers.length/i.pagination.limit);e("updatePaginationMaxPages",n)},updateSorting({commit:e,state:t},i){t.sortBy!==i||t.sortDesc===!1?e("setSortDesc",!0):e("setSortDesc",!1),e("setSortBy",i)}}},ws=bs,Ms=$({name:"UserPage",components:{UserCard:te,UserInfo:hs,UserPageFilters:$s},computed:{...S("users",["pagination"]),...Q("users",["paginatedUsers","allUsers"])},watch:{paginatedUsers(){this.$store.dispatch("users/updatePaginationMaxPages")}},beforeCreate(){this.$store.hasModule("users")||this.$store.registerModule("users",ws)},async created(){const e=await this.$http.initialRequest("/users/query");if(!this.$http.isError(e)){this.$store.commit("users/setUsers",e.users);const t=this.$route.query.id;t&&this.allUsers.findIndex(n=>n.id==t)>=0&&(this.$store.commit("users/setSelectedUserId",t),this.$bs.showModal("extendedInfo"))}},methods:{showOlder(){this.$store.commit("users/increasePaginationPage")},showNewer(){this.$store.commit("users/decreasePaginationPage")}}}),vs={class:"container card card-body py-3"},Ss=["disabled"],Cs=s("i",{class:"fas fa-angle-up me-1"},null,-1),Fs=s("i",{class:"fas fa-angle-up ms-1"},null,-1),Is={class:"small text-center mx-auto"},Bs=["disabled"],Qs=s("i",{class:"fas fa-angle-down me-1"},null,-1),qs=s("i",{class:"fas fa-angle-down ms-1"},null,-1);function As(e,t,i,n,m,U){const p=f("user-page-filters"),d=f("user-card"),_=f("user-info");return o(),a("div",null,[y(p),s("div",vs,[s("button",{disabled:e.pagination.page==1,class:"btn btn-sm btn-primary mx-auto my-2 d-block",type:"button",onClick:t[0]||(t[0]=(...h)=>e.showNewer&&e.showNewer(...h))},[Cs,g(" show newer "),Fs],8,Ss),s("div",null,[y(D,{name:"list",tag:"div",class:"row px-3"},{default:v(()=>[(o(!0),a(k,null,P(e.paginatedUsers,h=>(o(),u(d,{key:h.id,user:h},null,8,["user"]))),128))]),_:1}),s("div",Is,c(e.paginatedUsers.length===0?"0":e.pagination.page)+" of "+c(e.pagination.maxPages),1),s("button",{disabled:e.pagination.page>=e.pagination.maxPages,class:"btn btn-sm btn-primary mx-auto my-2 d-block",type:"button",onClick:t[1]||(t[1]=(...h)=>e.showOlder&&e.showOlder(...h))},[Qs,g(" show older "),qs],8,Bs)])]),y(_)])}const Rs=b(Ms,[["render",As]]);export{Rs as default};
