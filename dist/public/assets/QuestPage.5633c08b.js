var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,o=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&n(e,s,t[s]);if(a)for(var s of a(t))i.call(t,s)&&n(e,s,t[s]);return e},l=(e,a)=>t(e,s(a));import{d,h as u,o as c,b as p,j as m,w as h,F as y,g as f,t as b,f as g,m as q,L as v,k,i as Q,q as P,n as w,s as $,y as x,l as I,H as A,I as M,v as O,e as U,O as L,p as F,a as j}from"./vendor.b9ef672a.js";import{_ as D}from"./FilterBox.b3263039.js";import{_ as C,F as E}from"./extras.acd395c6.js";import{_ as T}from"./FormTextarea.5ea73115.js";import{b as S,_ as R,c as V,d as _,e as B,f as W,g as J,h as N,i as G}from"./index.85c79094.js";import{_ as H}from"./SubmitQuestModal.2ebde300.js";import{_ as Y}from"./AssociatedBeatmaps.36fa295d.js";import{_ as z}from"./ModalDialog.4a9168b4.js";var K=d({name:"ArtistFilters",components:{FormSelect:T},props:{isLoading:Boolean,filterArtist:{type:String,default:""}},emits:["update:filterArtist"],data:()=>({featuredArtists:[],selectedArtist:""}),watch:{selectedArtist(){}},async created(){const e=await this.$http.executeGet("/featuredArtists");e&&(this.featuredArtists=e.sort(((e,t)=>e.label.toLowerCase()>t.label.toLowerCase()?1:t.label.toLowerCase()>e.label.toLowerCase()?-1:0)))},methods:{}});const X={class:"row mt-3"},Z=g("option",{value:"-",disabled:""}," --- ",-1),ee=g("option",{value:"none"}," No specific artist ",-1),te=g("option",{value:"user"}," User-submitted quests ",-1),se=g("option",{value:"-",disabled:""}," --- ",-1),ae=g("option",{value:"-",disabled:""}," Jump to an artist by typing their name! ",-1),re=g("option",{value:"-",disabled:""}," --- ",-1),ie=["value"];K.render=function(e,t,s,a,r,i){const n=u("form-select");return c(),p("div",X,[m(n,{modelValue:e.selectedArtist,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedArtist=t),label:"Artist",placeholder:"Any","auto-columns":!0,onChange:t[1]||(t[1]=t=>e.$emit("update:filterArtist",e.selectedArtist))},{default:h((()=>[Z,ee,te,se,ae,re,(c(!0),p(y,null,f(e.featuredArtists,(e=>(c(),p("option",{key:e.id,value:e.osuId},b(e.label),9,ie)))),128))])),_:1},8,["modelValue"])])};var ne=d({components:{FilterBox:D,ModeFilters:C,ArtistFilters:K},computed:l(o(o({},q(["loggedInUser"])),q("quests",["filterMode","filterArtist"])),{validRank(){return this.loggedInUser.rank>=1}}),methods:l(o({},v("quests",["updateFilterValue","updateFilterMode","updateFilterArtist","searchQuests"])),{filterByMode(e){this.updateFilterMode(e),this.searchQuests()},filterByArtist(e){this.updateFilterArtist(e),this.searchQuests()}})});const oe={class:"container card card-body py-3 mb-2"},le=["disabled","data-bs-toggle","title","data-bs-target"],de=[k(" Submit quest for approval "),g("i",{class:"fas fa-plus fa-xs"},null,-1)];ne.render=function(e,t,s,a,r,i){const n=u("mode-filters"),o=u("artist-filters"),l=u("filter-box");return c(),p("div",oe,[m(l,{placeholder:"enter to search for quest...","onUpdate:filterValue":t[2]||(t[2]=t=>e.updateFilterValue(t))},{filters:h((()=>[m(n,{"filter-mode":e.filterMode,"onUpdate:filterMode":t[0]||(t[0]=t=>e.filterByMode(t))},null,8,["filter-mode"]),m(o,{"filter-artist":e.filterArtist,"onUpdate:filterArtist":t[1]||(t[1]=t=>e.filterByArtist(t))},null,8,["filter-artist"])])),default:h((()=>[g("button",{class:"btn btn-primary",disabled:!e.validRank,"data-bs-toggle":e.validRank?"modal":"tooltip",title:e.validRank?"":"designing custom quests is available to tier 1+ users only","data-bs-target":e.validRank?"#submitQuest":""},de,8,le)])),_:1})])};var ue=d({components:{QuestCard:S},props:{status:{type:String,required:!0},quests:{type:Array,required:!0}},data:()=>({collapsed:!1}),computed:l(o({},q("quests",["isLoadingQuests","isFirstLoadDone"])),{questCount(){return this.openQuests&&!this.isFirstLoadDone||!this.isLoadingQuests?this.quests.length.toString():"..."},openQuests(){return"Open"===this.status}}),methods:l(o({},v("quests",["searchQuests"])),{showAll(){this.searchQuests(!0)}})});const ce={class:"container card card-body my-2"},pe=["href"],me=["id"],he={class:"col-sm"},ye={class:"text-center"},fe=["disabled"],be=[g("i",{class:"fas fa-angle-down me-1"},null,-1),k(" show all quests "),g("i",{class:"fas fa-angle-down ms-1"},null,-1)];ue.render=function(e,t,s,a,r,i){const n=u("quest-card"),o=Q("bs-tooltip");return c(),p("div",ce,[g("h5",{class:w(e.collapsed?"mb-0":"mb-2")},[g("a",{href:"#"+e.status,"data-bs-toggle":"collapse",onClick:t[0]||(t[0]=P((t=>e.collapsed=!e.collapsed),["prevent"]))},[k(b(e.status)+" quests ("+b(e.questCount)+") ",1),g("i",{class:w(["fas",e.collapsed?"fa-angle-up":"fa-angle-down"])},null,2)],8,pe)],2),g("div",{id:e.status,class:w(["row show",{"loading-data":e.isLoadingQuests&&e.isFirstLoadDone}])},[g("div",he,[m(x,{name:"list",tag:"div"},{default:h((()=>[(c(!0),p(y,null,f(e.quests,(e=>(c(),$(n,{key:e.id,quest:e},null,8,["quest"])))),128))])),_:1})]),g("div",ye,[I(g("button",{class:"btn btn-sm btn-primary",type:"button",disabled:e.isLoadingQuests,onClick:t[1]||(t[1]=t=>e.showAll())},be,8,fe),[[o,"this can take a few seconds. searching for a specific artist is probably better"]])])],10,me)])};var ge=d({name:"LeaderActions",props:{party:{type:Object,required:!0},status:{type:String,required:!0},quest:{type:Object,required:!0},price:{type:Number,required:!0}},data:()=>({addUsername:"",dropdownUserId:""}),computed:l(o({},q(["loggedInUser"])),{enoughPoints(){let e=0;return this.party.members.forEach((t=>{t.availablePoints<this.price&&e++})),!(e&&this.loggedInUser.availablePoints<this.price*e)}}),methods:{async togglePartyLock(e){const t=await this.$http.executePost(`/parties/${this.party.id}/toggleLock`,{},e);this.$http.isError(t)||this.$store.dispatch("quests/updateParty",t)},async addToParty(e){const t=await this.$http.executePost(`/parties/${this.party.id}/add`,{user:this.addUsername},e);this.$http.isError(t)||(this.$store.dispatch("quests/updateParty",t),this.$store.dispatch("updateToastMessages",{message:"Added",type:"success"}))},async transferPartyLeader(e){if(!this.dropdownUserId)return void this.$store.dispatch("updateToastMessages",{message:"Select a member to transfer leadership!",type:"info"});const t=await this.$http.executePost(`/parties/${this.party.id}/transferLeadership`,{userId:this.dropdownUserId},e);this.$http.isError(t)||this.$store.dispatch("quests/updateParty",t)},async kickPartyMember(e){if(this.dropdownUserId){if(confirm("Are you sure? "+(this.party.members.length==this.quest.minParty&&"wip"==this.quest.status?"This party has the minimum required members to run the quest, so kicking will cause the quest to be dropped.":""))){const t=await this.$http.executePost(`/parties/${this.party.id}/kick`,{userId:this.dropdownUserId},e);this.$http.isError(t)||(this.$store.dispatch("quests/updateParty",t),"wip"==this.quest.status&&(t.members.length<this.quest.minParty||t.rank<this.quest.minRank)&&this.dropQuest(e))}}else this.$store.dispatch("updateToastMessages",{message:"Select a member to kick :(",type:"info"})},async extendDeadline(e){if(confirm(`Are you sure?\n\nAll members of your party will spend 10 points.\n\nYou have ${this.loggedInUser.availablePoints} points available.`)){const t=await this.$http.executePost(`/quests/${this.quest.id}/extendDeadline`,{},e);this.$http.isError(t)||(this.$store.dispatch("quests/updateQuest",t.quest),this.$store.commit("setAvailablePoints",t.availablePoints))}},async dropQuest(e){if(confirm("Are you sure?")){const t=await this.$http.executePost(`/quests/${this.quest.id}/drop`,{},e);this.$http.isError(t)||(this.$bs.hideModal("editQuest"),this.$store.dispatch("quests/setQuests",t))}},async acceptQuest(e){const t=this.party.modes;let s="";for(let a=0;a<t.length;a++)s+=t[a],a<t.length-1&&(s+=", ");if(confirm(`Are you sure?\n\nThis quest will only allow beatmaps of these modes: ${s}\n\nAll members of your party will spend ${this.price} points. If any members of your party don't have enough points, your available points will be subtracted instead.\n\nYou have ${this.loggedInUser.availablePoints} points available.`)){const t=await this.$http.executePost(`/quests/${this.quest.id}/accept`,{},e);this.$http.isError(t)||(this.$store.dispatch("quests/setQuests",t.quests),this.$store.commit("setAvailablePoints",t.availablePoints),this.$bs.hideModal("editQuest"))}},async deleteParty(e){if(confirm("Are you sure?")){const t=await this.$http.executePost(`/parties/${this.party.id}/delete`,{},e);this.$http.isError(t)||(this.$store.dispatch("quests/updateQuest",t),this.$bs.hideModal("editQuest"))}}}});const qe={class:"row row-cols-md-auto g-2 align-items-center mb-3"},ve={class:"col-12"},ke={class:" input-group input-group-sm"},Qe=[k(" Add ")],Pe={class:"col-12"},we={class:"input-group input-group-sm"},$e=g("option",{value:"",disabled:""}," Select a member ",-1),xe=["value"],Ie=[k(" Lead ")],Ae=[k(" Kick ")],Me={class:"col-12"},Oe={class:"col-12"},Ue=[k(" Delete "),g("i",{class:"fas fa-minus fa-xs"},null,-1)],Le={key:1,class:"col-12"},Fe=[k(" Drop quest "),g("i",{class:"fas fa-times fa-xs"},null,-1)],je={key:2,class:"col-12"},De=["disabled"];var Ce,Ee;ge.render=function(e,t,s,a,r,i){const n=Q("bs-tooltip");return c(),p("div",qe,[g("div",ve,[g("div",ke,[I(g("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.addUsername=t),class:"form-control",type:"text",placeholder:"username...",maxlength:"18",onKeyup:t[1]||(t[1]=M((t=>e.addToParty(t)),["enter"]))},null,544),[[A,e.addUsername]]),I(g("button",{class:"btn btn-outline-info",onClick:t[2]||(t[2]=t=>e.addToParty(t))},Qe,512),[[n,"add user to party"]])])]),g("div",Pe,[g("div",we,[I(g("select",{"onUpdate:modelValue":t[3]||(t[3]=t=>e.dropdownUserId=t),class:"form-select"},[$e,(c(!0),p(y,null,f(e.party.members,(t=>(c(),p(y,{key:t.id},[t.id!==e.loggedInUser.id?(c(),p("option",{key:0,value:t.id},b(t.username),9,xe)):U("",!0)],64)))),128))],512),[[O,e.dropdownUserId]]),I(g("button",{class:"btn btn-outline-info",onClick:t[4]||(t[4]=t=>e.transferPartyLeader(t))},Ie,512),[[n,"change party leader"]]),I(g("button",{class:"btn btn-outline-info",onClick:t[5]||(t[5]=t=>e.kickPartyMember(t))},Ae,512),[[n,"kick party member"]])])]),"open"===e.status?(c(),p(y,{key:0},[g("div",Me,[g("button",{class:"btn btn-sm btn-outline-info w-100",onClick:t[6]||(t[6]=P((t=>e.togglePartyLock(t)),["prevent"]))},[k(b(e.party.lock?"Unlock":"Lock")+" ",1),g("i",{class:w(["fas",e.party.lock?"fa-unlock":"fa-lock"])},null,2)])]),g("div",Oe,[g("button",{class:"btn btn-sm btn-outline-danger w-100",onClick:t[7]||(t[7]=P((t=>e.deleteParty(t)),["prevent"]))},Ue)])],64)):U("",!0),"wip"===e.status?(c(),p("div",Le,[g("button",{class:"btn btn-sm btn-outline-danger w-100",onClick:t[8]||(t[8]=P((t=>e.dropQuest(t)),["prevent"]))},Fe)])):"open"===e.quest.status&&e.party.rank>=e.quest.minRank&&e.party.members.length>=e.quest.minParty&&e.party.members.length<=e.quest.maxParty?(c(),p("div",je,[g("button",{class:"btn btn-sm btn-outline-success w-100",disabled:!e.enoughPoints,onClick:t[9]||(t[9]=P((t=>e.acceptQuest(t)),["prevent"]))},[k(b(e.price?`Accept quest for ${e.price} ${1==e.price?"point":"points"} from each party member`:"Accept Quest")+" ",1),g("i",{class:w(["fas small",e.price?"fa-coins":"fa-check"])},null,2)],8,De)])):U("",!0)])},(Ee=Ce||(Ce={})).Open="open",Ee.WIP="wip",Ee.Done="done",Ee.Pending="pending",Ee.Rejected="rejected",Ee.Hidden="hidden",Ee.Scheduled="scheduled";var Te=d({props:{party:{type:Object,default:null},quest:{type:Object,default:null}},computed:l(o({},q(["loggedInUser"])),{isWip(){var e;return(null==(e=this.quest)?void 0:e.status)==Ce.WIP},isOpen(){var e;return(null==(e=this.quest)?void 0:e.status)==Ce.Open},isDone(){var e;return(null==(e=this.quest)?void 0:e.status)==Ce.Done},isLeader(){var e;return(null==(e=this.party)?void 0:e.leader.id)==this.loggedInUser.id}})}),Se=d({mixins:[Te],props:{party:{type:Object,required:!0}}});const Re={class:"mx-1"},Ve={key:0,class:"fas fa-lock fa-sm"},_e={key:1,class:"fas fa-unlock fa-sm"};Se.render=function(e,t,s,a,r,i){const n=Q("bs-tooltip");return c(),p("span",Re,[e.party.lock?I((c(),p("i",Ve,null,512)),[[n,"party is locked"]]):I((c(),p("i",_e,null,512)),[[n,"party is open"]])])};var Be=d({name:"PartyTitle",components:{LockDetail:Se},mixins:[Te],props:{party:{type:Object,required:!0},quest:{type:Object,required:!0},memberOfAnyParty:Boolean},computed:l(o({},q(["loggedInUser"])),{inCurrentParty(){return this.party.members.some((e=>e.id===this.loggedInUser.id))}}),methods:{async joinParty(e){const t=await this.$http.executePost(`/parties/${this.party.id}/add`,{},e);this.$http.isError(t)||(this.$store.dispatch("quests/updateParty",t),this.$store.dispatch("updateToastMessages",{message:"Joined party",type:"success"}))},async leaveParty(e){if(confirm("Are you sure? "+(this.party.members.length==this.quest.minParty&&this.isWip?"This party has the minimum required members to run the quest, so leaving will cause the quest to be dropped.":""))){const t=await this.$http.executePost(`/parties/${this.party.id}/leave`,{},e);this.$http.isError(t)||(this.$store.dispatch("quests/updateParty",t),this.isWip&&(t.members.length<this.quest.minParty||t.rank<this.quest.minRank)&&this.dropQuest(e))}},async dropQuest(e){const t=await this.$http.executePost(`/quests/${this.quest.id}/drop`,{},e);this.$http.isError(t)||(this.$store.dispatch("quests/setQuests",t),this.$bs.hideModal("editQuest"))}}});const We={class:"row"},Je={class:"col-sm"},Ne={class:"d-inline-block"},Ge=k("'s party "),He=[k(" Join "),g("i",{class:"fas fa-user-plus fa-xs"},null,-1)],Ye=[k(" Leave "),g("i",{class:"fas fa-user-minus fa-xs"},null,-1)];Be.render=function(e,t,s,a,r,i){const n=u("user-link"),o=u("lock-detail"),l=Q("bs-tooltip");return c(),p("div",We,[g("div",Je,[g("h5",Ne,[m(n,{user:e.party.leader},null,8,["user"]),Ge]),e.party.rank>0?I((c(),p("i",{key:0,class:w(["fas fa-crown fa-sm mx-1","text-rank-"+e.party.rank])},null,2)),[[l,`rank ${e.party.rank} party`]]):U("",!0),e.isOpen?(c(),$(o,{key:1,party:e.party},null,8,["party"])):U("",!0),e.loggedInUser.id!=e.party.leader.id?(c(),p(y,{key:2},[e.memberOfAnyParty||e.party.lock||!e.isOpen?U("",!0):(c(),p("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:t[0]||(t[0]=P((t=>e.joinParty(t)),["prevent"]))},He)),e.inCurrentParty&&(e.isOpen||e.isWip)?(c(),p("button",{key:1,class:"btn btn-sm btn-outline-danger ms-1",onClick:t[1]||(t[1]=P((t=>e.leaveParty(t)),["prevent"]))},Ye)):U("",!0)],64)):U("",!0)])])};var ze=d({props:{quest:{type:Object,required:!0}},computed:{timeRemaining(){if(!this.quest.deadline)return 0;const e=(new Date).getTime(),t=new Date(this.quest.deadline).getTime()-e;return Math.floor(t/864e5)}}});const Ke={class:"row"},Xe={class:"col-sm"},Ze={key:0,class:"ms-3"},et=k(" Completed: "),tt={class:"text-secondary"},st={key:1},at={class:"ms-3"},rt=k(" Deadline: "),it={class:"text-secondary"},nt={class:"ms-3"},ot=k(" Time remaining: ");ze.render=function(e,t,s,a,r,i){return c(),p("div",Ke,[g("div",Xe,["done"===e.quest.status?(c(),p("div",Ze,[et,g("span",tt,b(e.quest.completed.toString().slice(0,10)),1)])):U("",!0),"wip"===e.quest.status?(c(),p("div",st,[g("div",at,[rt,g("span",it,b(e.quest.deadline.toString().slice(0,10)),1)]),g("div",nt,[ot,g("span",{class:w(e.timeRemaining>0?"text-secondary":"text-danger")},b(e.timeRemaining)+" days",3)])])):U("",!0)])])};var lt=d({props:{members:{type:Array,required:!0},price:{type:Number,required:!0},status:{type:String,required:!0}}});const dt={class:"ms-3 mt-1"},ut={class:"mb-0"},ct={key:1,class:"text-danger"};lt.render=function(e,t,s,a,r,i){const n=u("user-link"),o=Q("bs-tooltip");return c(),p("div",dt,[g("b",null," Members: ("+b(e.members.length)+") ",1),g("ul",ut,[(c(!0),p(y,null,f(e.members,(t=>(c(),p("li",{key:t.id},[m(n,{class:"me-1",user:t},null,8,["user"]),t.rank>0?I((c(),p("i",{key:0,class:w(["fas fa-crown","text-rank-"+t.rank])},null,2)),[[o,`rank ${t.rank} user`]]):U("",!0),"open"==e.status&&t.availablePoints<e.price?(c(),p("span",ct,b(`(${t.availablePoints} points available)`),1)):U("",!0)])))),128))])])};var pt=d({props:{members:{type:Array,required:!0},price:{type:Number,required:!0},partyId:{type:String,required:!0},leaderId:{type:String,required:!0}},computed:o({},q(["loggedInUser"])),methods:{async addToParty(e){const t=await this.$http.executePost(`/parties/${this.partyId}/add`,{user:null},e);this.$http.isError(t)||(this.$store.dispatch("quests/updateParty",t),this.$store.dispatch("updateToastMessages",{message:"Joined party",type:"success"}))},async removeFromPendingMembers(e,t){t.target.classList.add("fake-button-disable");const s=await this.$http.executePost(`/parties/${this.partyId}/removeFromPendingMembers`,{userId:e},t);this.$http.isError(s)||(this.$store.dispatch("quests/updateParty",s),this.$store.dispatch("updateToastMessages",{message:"Removed user from pending members",type:"success"})),t.target.classList.remove("fake-button-disable")}}});const mt={class:"ms-3 mt-1"},ht={class:"small text-secondary"},yt={class:"mb-0"},ft=["onClick"],bt=[g("i",{class:"fas text-danger fa-times"},null,-1)],gt={key:2,class:"text-danger small"},qt=k(" Join quest ");pt.render=function(e,t,s,a,r,i){const n=u("user-link"),o=Q("bs-tooltip");return c(),p("div",mt,[g("b",null," Pending members: ("+b(e.members.length)+") ",1),g("div",ht,b(1==e.members.length?"This user needs ":"These users need")+" to confirm before they're able to join the party. If you're the party leader, link this page to the "+b(1==e.members.length?"user ":"users")+" below! ",1),g("ul",yt,[(c(!0),p(y,null,f(e.members,(s=>(c(),p("li",{key:s.id},[e.leaderId==e.loggedInUser.id?I((c(),p("a",{key:0,class:"me-1",href:"#",onClick:P((t=>e.removeFromPendingMembers(s.id,t)),["stop","prevent"])},bt,8,ft)),[[o,"remove user from pending members"]]):U("",!0),m(n,{class:"me-1",user:s},null,8,["user"]),s.rank>0?I((c(),p("i",{key:1,class:w(["fas fa-crown","text-rank-"+s.rank])},null,2)),[[o,`rank ${s.rank} user`]]):U("",!0),s.availablePoints<e.price?(c(),p("span",gt,b(`${s.availablePoints} points available. If this user joins, available points will be taken from other party members`),1)):U("",!0),e.loggedInUser.id==s.id?(c(),p("button",{key:3,class:"btn btn-sm btn-outline-success ms-1",onClick:t[0]||(t[0]=t=>e.addToParty(t))},[qt,g("i",{class:w(["fas small",e.price?"fa-coins":"fa-check"])},null,2)])):U("",!0)])))),128))])])};var vt=d({components:{ModesIcons:R},props:{party:{type:Object,required:!0},questId:{type:String,required:!0}},methods:{async togglePartyMode(e){const t=await this.$http.executePost(`/parties/${this.party.id}/toggleMode`,{mode:e});this.$http.isError(t)||this.$store.dispatch("quests/updateParty",t)}}});const kt={class:"ms-3 mt-1"},Qt=g("b",{class:"me-1"},"Modes:",-1);vt.render=function(e,t,s,a,r,i){var n;const o=u("modes-icons");return c(),p("div",kt,[Qt,m(o,{modes:e.party.modes,toggler:e.party.leader.id==(null==(n=e.$store.state.loggedInUser)?void 0:n.id),onToggle:t[0]||(t[0]=t=>e.togglePartyMode(t))},null,8,["modes","toggler"])])};var Pt=d({name:"PartyDetail",components:{LeaderActions:ge,PartyTitle:Be,QuestTiming:ze,MembersDetail:lt,PendingMembersDetail:pt,ModeDetail:vt},mixins:[Te],props:{party:{type:Object,default:null},quest:{type:Object,required:!0},memberOfAnyParty:Boolean},computed:o({},q(["loggedInUser"]))});const wt={class:"container card card-body mt-1"};Pt.render=function(e,t,s,a,r,i){const n=u("leader-actions"),o=u("party-title"),l=u("quest-timing"),d=u("mode-detail"),h=u("members-detail"),f=u("pending-members-detail");return c(),p("div",wt,[e.isOpen||e.isWip?(c(),p(y,{key:0},[e.party.leader.id==e.loggedInUser.id||3178418==e.loggedInUser.osuId?(c(),$(n,{key:0,party:e.party,status:e.quest.status,quest:e.quest,price:e.quest.price},null,8,["party","status","quest","price"])):U("",!0),m(o,{party:e.party,quest:e.quest,"member-of-any-party":e.memberOfAnyParty},null,8,["party","quest","member-of-any-party"])],64)):U("",!0),e.isDone||e.isWip?(c(),$(l,{key:1,quest:e.quest},null,8,["quest"])):U("",!0),e.isOpen?(c(),$(d,{key:2,party:e.party,"quest-id":e.quest.id},null,8,["party","quest-id"])):U("",!0),m(h,{members:e.party.members,price:e.quest.price,status:e.quest.status},null,8,["members","price","status"]),e.party.pendingMembers&&e.party.pendingMembers.length&&!e.isDone?(c(),$(f,{key:3,members:e.party.pendingMembers,price:e.quest.price,"party-id":e.party.id,"leader-id":e.party.leader.id},null,8,["members","price","party-id","leader-id"])):U("",!0)])};var $t=d({components:{PartyDetail:Pt,AssociatedBeatmaps:Y},mixins:[Te],props:{quest:{type:Object,required:!0},memberOfAnyParty:Boolean,collapse:Boolean},methods:{async createParty(e){const t=await this.$http.executePost("/parties/create",{questId:this.quest.id},e);this.$http.isError(t)||this.$store.dispatch("quests/updateQuest",t)}}});const xt={class:"container"},It={key:0,class:"row"},At={class:"col"},Mt=[k(" Add party "),g("i",{class:"fas fa-plus fa-xs"},null,-1)],Ot={class:"col-sm-12"},Ut={key:0,class:"col-sm-12 mt-2"};$t.render=function(e,t,s,a,r,i){const n=u("party-detail"),o=u("associated-beatmaps");return c(),p("div",xt,[e.isOpen&&!e.memberOfAnyParty?(c(),p("div",It,[g("div",At,[g("button",{class:"btn btn-sm w-100 btn-outline-info mb-2",onClick:t[0]||(t[0]=P((t=>e.createParty(t)),["prevent"]))},Mt)])])):U("",!0),(c(!0),p(y,null,f(e.quest.parties,(t=>(c(),p("div",{key:t.id,class:"row"},[g("div",Ot,[m(n,{party:t,quest:e.quest,"member-of-any-party":e.memberOfAnyParty},null,8,["party","quest","member-of-any-party"])]),e.isDone||e.isWip?(c(),p("div",Ut,[m(o,{"associated-maps":e.quest.associatedMaps},null,8,["associated-maps"])])):U("",!0)])))),128))])};var Lt=d({name:"ExpirationDate",props:{isExpired:{type:Boolean,required:!0},expiration:{type:Date,required:!0}}});const Ft={class:"small"},jt={class:"text-secondary"};Lt.render=function(e,t,s,a,r,i){return c(),p("div",Ft,[k(" Quest "+b(e.isExpired?"expired":"expires")+": ",1),g("span",jt,b(e.expiration.toLocaleDateString()),1)])};var Dt=d({name:"ReopenQuest",props:{questId:{type:String,required:!0},status:{type:String,required:!0},price:{type:Number,required:!0}},computed:l(o({},q(["loggedInUser"])),{enoughPoints(){return this.loggedInUser.availablePoints-this.price>0}}),methods:{async reopenQuest(e){if(confirm(`Are you sure?\n\nYou are about to spend ${this.price} Mappers' Guild points to re-open this quest.\n\nYou have ${this.loggedInUser.availablePoints} points available.`)){const t=await this.$http.executePost(`/quests/${this.questId}/reopen`,{status:this.status},e);this.$http.isError(t)||(this.$store.dispatch("quests/setQuests",t.quests),this.$store.commit("setAvailablePoints",t.availablePoints),this.$bs.hideModal("editQuest"))}}}});const Ct={class:"row"},Et={class:"col-sm-12"},Tt=["disabled"],St=g("i",{class:"fas fa-coins fa-xs"},null,-1);Dt.render=function(e,t,s,a,r,i){return c(),p("div",Ct,[g("div",Et,[g("button",{class:"btn btn-sm w-100 btn-outline-success mb-2",disabled:!e.enoughPoints,onClick:t[0]||(t[0]=P((t=>e.reopenQuest(t)),["prevent"]))},[k(" Re-open quest for "+b(e.price)+" points ",1),St],8,Tt)])])};var Rt=d({name:"QuestInfoModal",components:{QuestSize:V,QuestPrice:_,QuestTime:B,QuestModes:W,PartyInfo:$t,ModalDialog:z,ExpirationDate:Lt,ReopenQuest:Dt},computed:l(o(o({},q(["loggedInUser"])),L("quests",["selectedQuest"])),{memberOfAnyParty(){return this.selectedQuest.parties.some((e=>e.members.some((e=>e.id===this.loggedInUser.id))))},headerClass(){var e;return(null==(e=this.selectedQuest)?void 0:e.creator)?"pishifat"==this.selectedQuest.creator.username?"bg-warning":"bg-primary":""}})});F("data-v-33f10ff2");const Vt=["href"],_t={key:0},Bt=k(" created by "),Wt={key:1,class:"small"},Jt=["href"],Nt={class:"container"},Gt={class:"row"},Ht={class:"col-sm-12 text-center"},Yt={key:0},zt=["href"],Kt=["src"],Xt={key:1},Zt=["src"],es={class:"row mb-3 text-center"},ts={class:"col-sm-12"},ss={class:"col-sm-12 text-secondary"},as={class:"row justify-content-center text-center"},rs={class:"col-sm-12"},is={class:"col-sm-6 col-lg-2"},ns={class:"col-sm-6 col-lg-2"},os={class:"col-sm-6 col-lg-4"},ls={key:0,class:"col-sm-6 col-lg-3"},ds=g("div",{class:"radial-divisor"},null,-1);j(),Rt.render=function(e,t,s,a,r,i){const n=u("user-link"),o=u("quest-size"),l=u("quest-price"),d=u("quest-time"),y=u("quest-modes"),f=u("expiration-date"),q=u("reopen-quest"),v=u("party-info"),k=u("modal-dialog");return c(),$(k,{id:"editQuest","header-class":e.headerClass,loaded:Boolean(e.selectedQuest)},{header:h((()=>[g("a",{href:`/quests?id=${e.selectedQuest.id}`,target:"_blank",class:"text-dark"},b(e.selectedQuest.name),9,Vt),"pishifat"!=e.selectedQuest.creator.username?(c(),p("span",_t,[Bt,m(n,{class:"text-dark",user:e.selectedQuest.creator},null,8,["user"])])):U("",!0),e.selectedQuest.art?(c(),p("div",Wt,[g("a",{href:"https://osu.ppy.sh/beatmaps/artists/"+e.selectedQuest.art,target:"_blank"}," View featured artist listing ",8,Jt)])):U("",!0)])),default:h((()=>[g("div",Nt,[g("div",Gt,[g("div",Ht,[e.selectedQuest.art?(c(),p("span",Yt,[g("a",{href:"https://osu.ppy.sh/beatmaps/artists/"+e.selectedQuest.art,target:"_blank"},[g("img",{src:"https://assets.ppy.sh/artists/"+e.selectedQuest.art+"/cover.jpg",class:"card-avatar-img-modal"},null,8,Kt)],8,zt)])):(c(),p("span",Xt,[g("img",{src:e.selectedQuest.isMbc?"/images/mbc-icon.png":"/images/no-art-icon.png",class:"card-avatar-img-modal"},null,8,Zt)]))])]),g("div",es,[g("div",ts,[g("h5",null,b(e.selectedQuest.name),1)]),g("div",ss,b(e.selectedQuest.descriptionMain),1)]),g("div",as,[g("div",rs,[m(o,{quest:e.selectedQuest},null,8,["quest"])]),g("div",is,[m(l,{price:e.selectedQuest.price},null,8,["price"])]),g("div",ns,[m(d,{timeframe:e.selectedQuest.timeframe},null,8,["timeframe"])]),g("div",os,[m(y,{status:e.selectedQuest.status,modes:e.selectedQuest.modes},null,8,["status","modes"])]),e.selectedQuest.expiration?(c(),p("div",ls,[m(f,{"is-expired":e.selectedQuest.isExpired,expiration:new Date(e.selectedQuest.expiration)},null,8,["is-expired","expiration"])])):U("",!0)]),ds,e.selectedQuest.isExpired?(c(),$(q,{key:0,"quest-id":e.selectedQuest.id,status:e.selectedQuest.status,price:e.selectedQuest.reopenPrice},null,8,["quest-id","status","price"])):(c(),$(v,{key:1,quest:e.selectedQuest,"member-of-any-party":e.memberOfAnyParty},null,8,["quest","member-of-any-party"]))])])),_:1},8,["header-class","loaded"])},Rt.__scopeId="data-v-33f10ff2";var us=d({name:"QuestInformation",components:{ExampleQuest:J},computed:o({},q("quests",["exampleQuest"]))});const cs={class:"container card card-body py-3 mb-2"},ps=[k(" How do quests work? "),g("i",{class:"fas fa-angle-down"},null,-1)],ms={id:"questInformation",class:"collapse ms-4"},hs=g("div",{class:"small text-secondary"}," Quests reward mappers for following certain requirements when creating their Featured Artist maps. Most quests involve creating and ranking a certain number of beatmaps for a specific Featured Artist, and new quests are added weekly. ",-1),ys=g("hr",null,null,-1),fs=g("div",{class:"small text-secondary mt-2"}," To begin a quest, a party must claim it. Only one party can run a quest per mode. ",-1),bs=g("div",{class:"small text-secondary mt-2"}," If a quest is not claimed within 90 days, it expires. To re-open an expired quest, a user must spend some of their available points. ",-1),gs=g("div",{class:"small text-secondary mt-2"}," Here's a breakdown of this example quest: ",-1),qs=[k(" What are the rewards for completing a quest? "),g("i",{class:"fas fa-angle-down"},null,-1)],vs=g("div",{id:"questRewards",class:"collapse ms-4 small text-secondary"},[g("ul",null,[g("li",null,[g("b",null,"7 points"),k(" if a quest is completed on time.")]),g("li",null,[g("b",null,"+2 bonus points per difficulty on a ranked beatmap."),k(" This scales with length, so longer maps earn more points.")]),g("li",null,"If a beatmap is ranked after the quest's deadline, bonus points are adjusted as follows:"),g("ul",null,[g("li",null,"1.5 points for 0-20 days late"),g("li",null,"1 point for 21-40 days late"),g("li",null,"0.5 points for 40+ days late")])])],-1);us.render=function(e,t,s,a,r,i){const n=u("example-quest");return c(),p("div",cs,[g("a",{href:"#questInformation","data-bs-toggle":"collapse",onClick:t[0]||(t[0]=P((()=>{}),["prevent"]))},ps),g("div",ms,[hs,ys,fs,bs,gs,m(n,{quest:e.exampleQuest},null,8,["quest"])]),g("a",{href:"#questRewards","data-bs-toggle":"collapse",onClick:t[1]||(t[1]=P((()=>{}),["prevent"]))},qs),vs])};const ks={updateQuest({commit:e},t){e("updateQuest",t)},updateParty({commit:e},t){e("updateParty",t)},setQuests({commit:e},t){e("setQuests",t)},updateFilterValue({commit:e},t){e("setFilterValue",t)},updateFilterMode({commit:e},t){e("setFilterMode",t)},updateFilterArtist({commit:e},t){e("setFilterArtist",t)},async loadQuests({commit:e,rootState:t},s){var a;const r=null==(a=t.loggedInUser)?void 0:a.mainMode;let i=`/quests/search?mode=${r}&limit=100`;s&&(i+=`&id=${s}`);const n=await N.initialRequest(i);G(n)||(e("setQuests",n),e("setFilterMode",r),e("setIsLoadingQuests",!1),s&&e("setSelectedQuestId",s))},async searchQuests({commit:e,state:t},s){e("setIsLoadingQuests",!0);let a=100;s&&(a=1e4,e("setFilterArtist",""));const r=await N.executeGet(`/quests/search?mode=${t.filterMode}&artist=${t.filterArtist}&limit=${a}`);G(r)||e("setQuests",r),e("setIsLoadingQuests",!1)}};var Qs={namespaced:!0,state:{quests:[],exampleQuest:null,filterValue:"",filterMode:E.any,filterArtist:"",isLoadingQuests:!0,selectedQuestId:null,isFirstLoadDone:!1},mutations:{setFirstLoadDone(e){e.isFirstLoadDone=!0},setQuests(e,t){e.quests=t},setFilterValue(e,t){e.filterValue=t},setFilterMode(e,t){e.filterMode=t},setFilterArtist(e,t){e.filterArtist=t},setExampleQuest(e,t){e.exampleQuest=t},setIsLoadingQuests(e,t){e.isLoadingQuests=t},setSelectedQuestId(e,t){e.selectedQuestId=t},updateQuest(e,t){const s=e.quests.findIndex((e=>e.id===t.id));-1!==s&&(e.quests[s]=t)},updateParty(e,t){const s=e.quests.findIndex((t=>t.id===e.selectedQuestId));if(-1!==s){const a=e.quests[s].parties.findIndex((e=>e.id===t.id));-1!==a&&(e.quests[s].parties[a]=t)}}},getters:{selectedQuest:e=>{if(e.selectedQuestId)return e.quests.find((t=>t.id===e.selectedQuestId))},filteredQuests:e=>{let t=e.quests;if(e.filterMode!==E.any){const s=e.filterMode;t=t.filter((e=>e.modes.includes(s)))}return e.filterValue.length>2&&(t=t.filter((t=>t.name.toLowerCase().includes(e.filterValue.toLowerCase())))),t},openQuests:(e,t)=>t.filteredQuests.filter((e=>e.status==Ce.Open)),wipQuests:(e,t)=>t.filteredQuests.filter((e=>e.status==Ce.WIP)),completeQuests:(e,t)=>t.filteredQuests.filter((e=>e.status==Ce.Done))},actions:ks},Ps=d({name:"QuestPage",components:{QuestPageFilters:ne,StatusQuests:ue,SubmitQuestModal:H,QuestInfoModal:Rt,QuestInformation:us},computed:o(o({},q("quests",["isFirstLoadDone","isLoadingQuests","exampleQuest"])),L("quests",["openQuests","wipQuests","completeQuests","expiredQuests"])),beforeCreate(){this.$store.hasModule("quests")||this.$store.registerModule("quests",Qs)},async created(){const e=this.$route.query.id;await this.$store.dispatch("quests/loadQuests",e),e&&this.$bs.showModal("editQuest"),this.$store.commit("quests/setFirstLoadDone");const t=await this.$http.executeGet("/exampleQuest");this.$http.isError(t)||this.$store.commit("quests/setExampleQuest",t)}});const ws=g("div",{class:"radial-divisor"},null,-1),$s=g("div",{class:"radial-divisor"},null,-1);Ps.render=function(e,t,s,a,r,i){const n=u("quest-page-filters"),o=u("quest-information"),l=u("status-quests"),d=u("submit-quest-modal"),h=u("quest-info-modal");return c(),p("div",null,[m(n),m(o),m(l,{status:"Open",quests:e.openQuests},null,8,["quests"]),ws,m(l,{status:"Work-in-progress",quests:e.wipQuests},null,8,["quests"]),$s,m(l,{status:"Complete",quests:e.completeQuests},null,8,["quests"]),m(d),m(h)])};export{Ps as default};
