var t=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,n=(t,e)=>{for(var a in e||(e={}))o.call(e,a)&&i(t,a,e[a]);if(s)for(var a of s(e))l.call(e,a)&&i(t,a,e[a]);return t},d=(t,s)=>e(t,a(s));import{B as r,a as c}from"./beatmap.8dd9b4cb.js";import{_ as m}from"./ModalDialog.472e77e7.js";import{d as u,i as p,o as b,u as h,w as k,f,q as g,G as v,b as y,g as B,t as w,F as L,H as C,I as x,l as $,m as I,J as T,j as M,n as S,s as P,K as O,p as q,a as A,k as Q,e as U,L as E,N as j,x as F,O as D,P as V,h as H}from"./vendor.df51a6ea.js";import{_}from"./FilterBox.bcc8c7b5.js";import{_ as N,F as R}from"./extras.5f9b059b.js";import{T as G,a as W}from"./task.5925ddbb.js";import{_ as K}from"./index.4c7cc028.js";import{_ as J}from"./UserLinkList.e91517e6.js";var X=u({name:"CreateBeatmapModal",components:{ModalDialog:m},data:()=>({featuredArtists:[],featuredSongs:[],selectedArtist:"",selectedSong:"",selectedMode:"osu",checkedTasks:[],checkedLocks:[],modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"}],tasks:["Easy","Normal","Hard","Insane","Expert"]}),async created(){const t=await this.$http.executeGet("/featuredArtists");t&&(this.featuredArtists=t.sort(((t,e)=>t.label.toLowerCase()>e.label.toLowerCase()?1:e.label.toLowerCase()>t.label.toLowerCase()?-1:0)))},methods:{async setArtist(t){if(!this.selectedArtist)return void this.$store.dispatch("updateToastMessages",{message:"Select an artist!",type:"info"});t.target.disabled=!0;const e=await this.$http.executeGet(`/featuredArtists/${this.selectedArtist}/songs`);e&&(this.featuredSongs=e.sort(((t,e)=>t.title.toLowerCase()>e.title.toLowerCase()?1:e.title.toLowerCase()>t.title.toLowerCase()?-1:0))),t.target.disabled=!1},async saveNewMap(t){if(!this.selectedSong)return void this.$store.dispatch("updateToastMessages",{message:"Select a song!",type:"info"});const e=await this.$http.executePost("/beatmaps/create/",{song:this.selectedSong,tasks:this.checkedTasks,tasksLocked:this.checkedLocks,mode:this.selectedMode,status:r.WIP},t);this.$http.isError(e)||(this.$bs.hideModal("addBeatmap"),this.$store.commit("beatmaps/addBeatmap",e))}}});const z={class:"container"},Y={class:"mb-3 row"},Z=f("div",{class:"col-lg-1"},[f("p",{style:{"margin-top":"3px"}}," Artist: ")],-1),tt={class:"col-lg-11"},et={id:"artistForm",class:"input-group input-group-sm mb-3"},at=f("option",{value:"",disabled:""}," Select an artist ",-1),st=f("option",{value:"-",disabled:""}," --- ",-1),ot=["value"],lt=f("div",{class:"col-lg-1"},[f("p",{style:{"margin-top":"3px"}}," Song: ")],-1),it={class:"col-lg-11"},nt=["disabled"],dt=f("option",{value:"",disabled:""}," Select an artist to view songs ",-1),rt=f("option",{value:"-",disabled:""}," --- ",-1),ct=["value"],mt=f("p",null," Game-mode: ",-1),ut={class:"mb-3 row"},pt={class:"col-sm-10"},bt=["id","value"],ht=["for"],kt=f("br",null,null,-1),ft=f("small",{class:"text-white-50"},"If you want a hybrid mapset, change this later.",-1),gt=f("p",null,[$(" Select one or more difficulties "),f("i",null,"you plan on mapping"),$(". These can be changed later: ")],-1),vt={class:"mb-3 row"},yt={class:"col-sm-10"},Bt=["id","value"],wt=["for"],Lt=f("p",null,[$(" Select one or more difficulties "),f("i",null,"you don't want anyone else to claim"),$(". These can be changed later: "),f("br"),f("small",{class:"text-white-50"},"For example, if you don't want any guest difficulties, you should mark everything.")],-1),Ct={class:"mb-3 row"},xt={class:"col-sm-10"},$t=["id","value"],It=["for"],Tt=f("div",{class:"radial-divisor"},null,-1),Mt=f("small",{class:"text-white-50"},[$("Check the "),f("a",{href:"/faq#rewards",target:"_blank"},"FAQ"),$(" to ensure your beatmap is elligible for points.")],-1);X.render=function(t,e,a,s,o,l){const i=p("modal-dialog");return b(),h(i,{id:"addBeatmap",title:"Add beatmap"},{default:k((()=>[f("div",z,[f("div",Y,[Z,f("div",tt,[f("div",et,[g(f("select",{"onUpdate:modelValue":e[0]||(e[0]=e=>t.selectedArtist=e),class:"form-select"},[at,st,(b(!0),y(L,null,B(t.featuredArtists,(t=>(b(),y("option",{key:t.id,value:t.id},w(t.label),9,ot)))),128))],512),[[v,t.selectedArtist]]),f("button",{id:"artistButton",class:"btn btn-outline-info",onClick:e[1]||(e[1]=e=>t.setArtist(e))}," Load songs ")])]),lt,f("div",it,[g(f("select",{"onUpdate:modelValue":e[2]||(e[2]=e=>t.selectedSong=e),class:"form-select form-select-sm",disabled:!t.featuredSongs.length},[dt,rt,(b(!0),y(L,null,B(t.featuredSongs,(t=>(b(),y("option",{key:t.id,value:t.id},w(t.title)+" --- ("+w(t.artist)+") ",9,ct)))),128))],8,nt),[[v,t.selectedSong]])])]),mt,f("div",ut,[f("div",pt,[(b(!0),y(L,null,B(t.modes,(a=>(b(),y("div",{key:a.value,class:"form-check form-check-inline"},[g(f("input",{id:a.value,"onUpdate:modelValue":e[3]||(e[3]=e=>t.selectedMode=e),class:"form-check-input",type:"radio",value:a.value},null,8,bt),[[C,t.selectedMode]]),f("label",{class:"form-check-label",for:a.value},w(a.name),9,ht)])))),128)),kt,ft])]),gt,f("div",vt,[f("div",yt,[(b(!0),y(L,null,B(t.tasks,(a=>(b(),y("div",{key:a,class:"form-check"},[g(f("input",{id:a,"onUpdate:modelValue":e[4]||(e[4]=e=>t.checkedTasks=e),class:"form-check-input",type:"checkbox",value:a},null,8,Bt),[[x,t.checkedTasks]]),f("label",{class:"form-check-label",for:a},w(a),9,wt)])))),128))])]),Lt,f("div",Ct,[f("div",xt,[(b(!0),y(L,null,B(t.tasks,(a=>(b(),y("div",{key:a,class:"form-check"},[g(f("input",{id:`lock-${a}`,"onUpdate:modelValue":e[5]||(e[5]=e=>t.checkedLocks=e),class:"form-check-input",type:"checkbox",value:a},null,8,$t),[[x,t.checkedLocks]]),f("label",{class:"form-check-label",for:`lock-${a}`},w(a),9,It)])))),128))])])]),Tt,f("button",{type:"submit",class:"btn btn-outline-success w-100",onClick:e[6]||(e[6]=e=>t.saveNewMap(e))}," Save "),Mt])),_:1})};var St=u({name:"BeatmapPageFilters",components:{FilterBox:_,ModeFilters:N},data:()=>({statuses:{any:"Any",WIP:"WIP",Done:"Done",Qualified:"Qualified",Ranked:"Ranked"},quests:{any:"Any",none:"None"}}),computed:I("beatmaps",["filterMode","filterValue","filterStatus","filterQuest"]),methods:d(n({},T("beatmaps",["updateFilterValue","updateFilterMode","updateFilterStatus","updateFilterQuest"])),{getStatusSortClass(t){return this.filterStatus===t?"sorted":"unsorted"},getQuestSortClass(t){return this.filterQuest===t?"sorted":"unsorted"}})});const Pt={class:"container card card-body py-3 mb-2"},Ot=f("button",{class:"btn btn-primary",href:"#","data-bs-toggle":"modal","data-bs-target":"#addBeatmap"},[$(" Add beatmap "),f("i",{class:"fas fa-plus fa-xs"})],-1),qt={class:"row mt-3"},At=f("div",{class:"col-auto filter-title"}," Status ",-1),Qt={class:"col"},Ut=["onClick"],Et={class:"row mt-3"},jt=f("div",{class:"col-auto filter-title"}," Quest ",-1),Ft={class:"col"},Dt=["onClick"];function Vt(t,e,a){const s={class:["px-1","text-"+e.toLowerCase()]};return a&&(s["data-bs-toggle"]="tooltip",s["data-bs-placement"]="top",s.title=a),O("span",s,t)}St.render=function(t,e,a,s,o,l){const i=p("mode-filters"),n=p("filter-box");return b(),y("div",Pt,[M(n,{placeholder:"enter to search for song/username...","filter-value":t.filterValue,"onUpdate:filterValue":e[1]||(e[1]=e=>t.updateFilterValue(e))},{filters:k((()=>[M(i,{"filter-mode":t.filterMode,"onUpdate:filterMode":e[0]||(e[0]=e=>t.updateFilterMode(e))},null,8,["filter-mode"]),f("div",qt,[At,f("div",Qt,[(b(!0),y(L,null,B(t.statuses,((e,a)=>(b(),y("a",{key:a,href:"#",class:S(["status",t.getStatusSortClass(a)]),onClick:P((e=>t.updateFilterStatus(a)),["prevent"])},w(e),11,Ut)))),128))])]),f("div",Et,[jt,f("div",Ft,[(b(!0),y(L,null,B(t.quests,((e,a)=>(b(),y("a",{key:a,href:"#",class:S(["quest",t.getQuestSortClass(a)]),onClick:P((e=>t.updateFilterQuest(a)),["prevent"])},w(e),11,Dt)))),128))])])])),default:k((()=>[Ot])),_:1},8,["filter-value"])])};var Ht=u({props:{tasks:{type:Array,required:!0},tasksLocked:{type:Array,required:!0},mode:{type:String,required:!0}},render(){const t=[{name:"Storyboard",short:"SB",locked:!1,status:[]},{name:"Easy",short:"E",locked:!1,status:[]},{name:"Normal",short:"N",locked:!1,status:[]},{name:"Hard",short:"H",locked:!1,status:[]},{name:"Insane",short:"I",locked:!1,status:[]},{name:"Expert",short:"X",locked:!1,status:[]}],e=[{name:"osu",short:"circle",count:0,status:G.Done},{name:"taiko",short:"drum",count:0,status:G.Done},{name:"catch",short:"apple-alt",count:0,status:G.Done},{name:"mania",short:"stream",count:0,status:G.Done}],a=[],s=this.tasks.length>=10,o=this.mode===c.Hybrid;for(const l of t){let t=!1;const i=this.tasksLocked.includes(l.name);for(const a of this.tasks)if(l.name===a.name){l.status.push(a.status),t=!0;const s=e.findIndex((t=>t.name===a.mode));-1!==s&&(e[s].count++,a.status===G.WIP&&(e[s].status=G.WIP))}if(!o){if(s&&l.status.length>1)a.push(Vt(l.short+"+","secondary",l.status.length.toString()));else for(const t of l.status)a.push(Vt(l.short,t));t||a.push(Vt(l.short,i?"blocked":"open"))}}if(o)for(const l of e)a.push(Vt([O("i",{class:["fas","fa-"+l.short]})],l.count?l.status:"blocked",l.count.toString()));return O("span",{class:"fw-bold"},a)}}),_t=u({props:{beatmap:{type:Object,required:!0}},computed:{url(){var t;return this.beatmap.isShowcase||!(null==(t=this.beatmap.quest)?void 0:t.art)?"/images/no-art-icon.png":this.beatmap.quest.isMbc?"/images/mbc-icon.png":`https://assets.ppy.sh/artists/${this.beatmap.quest.art}/cover.jpg`}}});q("data-v-5218fee0");const Nt=["src"];A(),_t.render=function(t,e,a,s,o,l){const i=Q("bs-tooltip");return t.beatmap.quest||t.beatmap.isShowcase?g((b(),y("img",{key:0,class:"rounded-circle me-1 quest-icon",src:t.url},null,8,Nt)),[[i,t.beatmap.quest&&t.beatmap.quest.name||"FA showcase"]]):U("",!0)},_t.__scopeId="data-v-5218fee0";var Rt=u({name:"BeatmapCard",components:{ProcessTasks:Ht,QuestImg:_t,ModesIcons:K},props:{beatmap:{type:Object,required:!0}},emits:["update:selectedBeatmap"],data:()=>({defaultUrl:"https://osu.ppy.sh/images/layout/beatmaps/default-bg.png"}),computed:{statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}},methods:{fallbackImage(t){t.target.src=this.defaultUrl},formatMetadata(t,e){const a=t+" - "+e;return a.length>34?a.slice(0,34)+"...":a},processUrl(t){if(t&&-1!==t.indexOf("osu.ppy.sh/beatmapsets/")){const e=t.indexOf("beatmapsets/")+"beatmapsets/".length,a=t.indexOf("#");let s;return s=-1!==a?t.slice(e,a):t.slice(e),`https://assets.ppy.sh/beatmaps/${s}/covers/card.jpg`}return this.defaultUrl}}});q("data-v-c6fa65f0");const Gt=["src"],Wt={class:"card-img-overlay",style:{padding:"0.50rem 0.50rem 0 0.50rem"}},Kt={class:"card-title mb-1"},Jt={class:"card-text"},Xt=$(" Hosted by ");A(),Rt.render=function(t,e,a,s,o,l){const i=p("quest-img"),n=p("user-link"),d=p("modes-icons"),r=p("process-tasks");return b(),y("div",{class:"my-2 col-sm-12 col-md-6 col-lg-4",onClick:e[1]||(e[1]=e=>t.$emit("update:selectedBeatmap",t.beatmap))},[f("div",{class:S(["card card-hover map-card bg-dark",t.statusBorder]),"data-bs-toggle":"modal","data-bs-target":"#editBeatmap"},[f("img",{class:"card-img",src:t.processUrl(t.beatmap.url),style:{opacity:"0.2"},onError:e[0]||(e[0]=e=>t.fallbackImage(e))},null,40,Gt),f("div",Wt,[f("p",Kt,w(t.formatMetadata(t.beatmap.song.artist,t.beatmap.song.title)),1),f("small",Jt,[M(i,{beatmap:t.beatmap},null,8,["beatmap"]),Xt,M(n,{class:"me-1",user:t.beatmap.host},null,8,["user"]),"osu"!==t.beatmap.mode?(b(),h(d,{key:0,modes:[t.beatmap.mode]},null,8,["modes"])):U("",!0),M(r,{class:"float-end pt-1",tasks:t.beatmap.tasks,"tasks-locked":t.beatmap.tasksLocked,mode:t.beatmap.mode},null,8,["tasks","tasks-locked","mode"])])])],2)])},Rt.__scopeId="data-v-c6fa65f0";var zt=u({components:{BeatmapCard:Rt},computed:E("beatmaps",["hostedBeatmaps"]),methods:j("beatmaps",["setSelectedBeatmap"])});const Yt={class:"container card card-body py-3"},Zt={class:"ms-2"},te={href:"#hostedBeatmaps","data-bs-toggle":"collapse"},ee=f("i",{class:"fas fa-angle-down"},null,-1),ae={key:0,id:"hostedBeatmaps",class:"show"},se={key:0,class:"ms-5 text-white-50"};zt.render=function(t,e,a,s,o,l){const i=p("beatmap-card");return b(),y("div",Yt,[f("h5",Zt,[f("a",te,[$(" My mapsets ("+w(t.hostedBeatmaps?t.hostedBeatmaps.length:"...")+") ",1),ee])]),t.hostedBeatmaps?(b(),y("div",ae,[M(F,{name:"list",tag:"div",class:"row"},{default:k((()=>[(b(!0),y(L,null,B(t.hostedBeatmaps,(a=>(b(),h(i,{key:a.id,beatmap:a,"onUpdate:selectedBeatmap":e[0]||(e[0]=e=>t.setSelectedBeatmap(e))},null,8,["beatmap"])))),128))])),_:1}),t.hostedBeatmaps.length?U("",!0):(b(),y("p",se," None... "))])):U("",!0)])};var oe=u({components:{BeatmapCard:Rt},props:{isLoadingGuestBeatmaps:Boolean},computed:E("beatmaps",["guestDifficultyBeatmaps"]),methods:j("beatmaps",["setSelectedBeatmap"])});const le={class:"container card card-body py-3"},ie={class:"ms-2"},ne={href:"#guestDifficultyBeatmaps","data-bs-toggle":"collapse"},de=f("i",{class:"fas fa-angle-down"},null,-1),re={key:0,class:"ms-5 text-white-50"};oe.render=function(t,e,a,s,o,l){const i=p("beatmap-card");return b(),y("div",le,[f("h5",ie,[f("a",ne,[$(" My guest difficulties ("+w(t.guestDifficultyBeatmaps&&!t.isLoadingGuestBeatmaps?t.guestDifficultyBeatmaps.length:"...")+") ",1),de])]),t.guestDifficultyBeatmaps?(b(),y("div",{key:0,id:"guestDifficultyBeatmaps",class:S(["collapse",{"loading-data":t.isLoadingGuestBeatmaps}])},[t.guestDifficultyBeatmaps.length||t.isLoadingGuestBeatmaps?U("",!0):(b(),y("p",re," None... ")),M(F,{name:"list",tag:"div",class:"row"},{default:k((()=>[(b(!0),y(L,null,B(t.guestDifficultyBeatmaps,(a=>(b(),h(i,{key:a.id,beatmap:a,"onUpdate:selectedBeatmap":e[0]||(e[0]=e=>t.setSelectedBeatmap(e))},null,8,["beatmap"])))),128))])),_:1})],2)):U("",!0)])};var ce=u({name:"ModeChoice",props:{beatmap:{type:Object,required:!0}},methods:{async setMode(t,e,a){const s=await this.$http.executePost(`/beatmaps/${t}/setMode`,{mode:e},a);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s)}}});q("data-v-1895db98");const me={id:"mode",class:"mb-3"},ue=f("div",{class:"d-inline-block me-2"}," Mode ",-1),pe=["disabled"],be=[f("i",{class:"far fa-circle"},null,-1)],he=["disabled"],ke=[f("i",{class:"fas fa-drum"},null,-1)],fe=["disabled"],ge=[f("i",{class:"fas fa-apple-alt"},null,-1)],ve=["disabled"],ye=[f("i",{class:"fas fa-stream"},null,-1)],Be=["disabled"],we=[f("i",{class:"fas fa-check-double"},null,-1)];A(),ce.render=function(t,e,a,s,o,l){const i=Q("bs-tooltip");return b(),y("div",me,[ue,g(f("button",{class:S(["btn btn-sm rounded-100 me-1","osu"==t.beatmap.mode?"btn-info":"btn-outline-info"]),disabled:"osu"==t.beatmap.mode,onClick:e[0]||(e[0]=e=>t.setMode(t.beatmap.id,"osu",e))},be,10,pe),[[i,"osu!"]]),g(f("button",{class:S(["btn btn-sm rounded-100 me-1","taiko"==t.beatmap.mode?"btn-info":"btn-outline-info"]),disabled:"taiko"==t.beatmap.mode,onClick:e[1]||(e[1]=e=>t.setMode(t.beatmap.id,"taiko",e))},ke,10,he),[[i,"osu!taiko"]]),g(f("button",{class:S(["btn btn-sm rounded-100 me-1","catch"==t.beatmap.mode?"btn-info":"btn-outline-info"]),disabled:"catch"==t.beatmap.mode,onClick:e[2]||(e[2]=e=>t.setMode(t.beatmap.id,"catch",e))},ge,10,fe),[[i,"osu!catch"]]),g(f("button",{class:S(["btn btn-sm rounded-100 me-1","mania"==t.beatmap.mode?"btn-info":"btn-outline-info"]),disabled:"mania"==t.beatmap.mode,onClick:e[3]||(e[3]=e=>t.setMode(t.beatmap.id,"mania",e))},ye,10,ve),[[i,"osu!mania"]]),g(f("button",{class:S(["btn btn-sm rounded-100 me-1","hybrid"==t.beatmap.mode?"btn-info":"btn-outline-info"]),disabled:"hybrid"==t.beatmap.mode,onClick:e[4]||(e[4]=e=>t.setMode(t.beatmap.id,"hybrid",e))},we,10,Be),[[i,"multiple modes"]])])},ce.__scopeId="data-v-1895db98";var Le=u({name:"StatusChoice",props:{beatmap:{type:Object,required:!0}},methods:{async setStatus(t,e){const a=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setStatus`,{status:t},e);this.$http.isError(a)||this.$store.dispatch("beatmaps/updateBeatmap",a)}}});const Ce={id:"mapsetStatus",class:"mb-3"},xe=f("div",{class:"d-inline-block me-2"}," Status ",-1),$e=["disabled"],Ie=[$(" Done ")],Te=["disabled"],Me=[$(" WIP ")];Le.render=function(t,e,a,s,o,l){const i=Q("bs-tooltip");return b(),y("div",Ce,[xe,g(f("button",{class:S(["btn btn-sm me-1","Done"==t.beatmap.status?"btn-success":"btn-outline-success"]),disabled:"Done"==t.beatmap.status,onClick:e[0]||(e[0]=e=>t.setStatus("Done",e))},Ie,10,$e),[[i,"mark mapset and all diffs as done","bottom"]]),g(f("button",{class:S(["btn btn-sm me-1","WIP"==t.beatmap.status?"btn-warning":"btn-outline-warning"]),disabled:"WIP"==t.beatmap.status,onClick:e[1]||(e[1]=e=>t.setStatus("WIP",e))},Me,10,Te),[[i,"mark mapset as work-in-progress","bottom"]])])};var Se=u({name:"NewTask",props:{isHost:Boolean,taskToAddCollaborator:{type:Object,default:null},beatmap:{type:Object,required:!0}},emits:["update:taskToAddCollaborator"],data:()=>({selectedTask:W.Easy,selectedMode:c.Osu,requestTaskUsername:""}),computed:{remainingTasks(){let t=Object.values(W);return this.beatmap.tasksLocked&&this.beatmap.tasksLocked.length&&!this.isHost&&(t=t.filter((t=>!this.beatmap.tasksLocked.includes(t)))),this.selectedTask=t[0]||"",t}},methods:{async addTask(t,e){if(this.requestTaskUsername&&this.requestTaskUsername.length)return void this.requestTask(t,e);let a;a=this.beatmap.mode==c.Hybrid?this.selectedMode:this.beatmap.mode;const s=await this.$http.executePost("/beatmaps/addTask/"+t,{taskName:this.selectedTask,mode:a},e);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s)},async requestTask(t,e){let a;a=this.beatmap.mode==c.Hybrid?this.selectedMode:this.beatmap.mode;const s=await this.$http.executePost("/beatmaps/requestTask/"+t,{taskName:this.selectedTask,user:this.requestTaskUsername,mode:a},e);this.$http.isError(s)||(this.$store.dispatch("beatmaps/updateBeatmap",s),this.$store.dispatch("updateToastMessages",{message:"Difficulty request sent!",type:"success"}))},async addCollab(t){let e;e=this.beatmap.mode==c.Hybrid?this.taskToAddCollaborator.mode:this.beatmap.mode;const a=await this.$http.executePost("/beatmaps/task/"+this.taskToAddCollaborator.id+"/addCollab",{user:this.requestTaskUsername,taskName:this.taskToAddCollaborator.name,mode:e},t);this.$http.isError(a)||(this.$store.dispatch("beatmaps/updateBeatmap",a),this.$store.dispatch("updateToastMessages",{message:"Collab invite sent!",type:"success"}))}}});const Pe={key:0,class:"row mt-2 mb-3"},Oe={class:"col-sm-12"},qe={class:"input-group input-group-sm mx-auto"},Ae=["value"],Qe=[f("option",{value:"osu"}," osu! ",-1),f("option",{value:"taiko"}," osu!taiko ",-1),f("option",{value:"catch"}," osu!catch ",-1),f("option",{value:"mania"}," osu!mania ",-1)],Ue=[f("i",{class:"fas fa-plus"},null,-1)],Ee={key:0,class:"col-sm-12 mt-1 text-center"},je=$(" Adding collaborator for the selected difficulty "),Fe=[f("i",{class:"fas fa-times-circle"},null,-1)];Se.render=function(t,e,a,s,o,l){const i=Q("bs-tooltip");return"WIP"!=t.beatmap.status&&"Secret"!=t.beatmap.status||!t.remainingTasks.length?U("",!0):(b(),y("div",Pe,[f("div",Oe,[f("div",qe,[t.taskToAddCollaborator?U("",!0):g((b(),y("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=e=>t.selectedTask=e),class:"form-select"},[(b(!0),y(L,null,B(t.remainingTasks,(t=>(b(),y("option",{key:t,value:t},w(t),9,Ae)))),128))],512)),[[v,t.selectedTask]]),"hybrid"!=t.beatmap.mode||t.taskToAddCollaborator?U("",!0):g((b(),y("select",{key:1,"onUpdate:modelValue":e[1]||(e[1]=e=>t.selectedMode=e),class:"form-select"},Qe,512)),[[v,t.selectedMode]]),t.isHost||t.taskToAddCollaborator?g((b(),y("input",{key:2,"onUpdate:modelValue":e[2]||(e[2]=e=>t.requestTaskUsername=e),class:"form-control",type:"text",placeholder:"request to... (optional)",maxlength:"18",onKeyup:e[3]||(e[3]=V((e=>t.taskToAddCollaborator?t.addCollab(e):t.requestTask(t.beatmap.id,e)),["enter"]))},null,544)),[[D,t.requestTaskUsername]]):U("",!0),g(f("button",{class:"btn btn-outline-info",onClick:e[4]||(e[4]=e=>t.taskToAddCollaborator?t.addCollab(e):t.addTask(t.beatmap.id,e))},Ue,512),[[i,"add difficulty"]])])]),t.taskToAddCollaborator?(b(),y("div",Ee,[f("small",null,[je,f("a",{class:"text-danger",href:"#",onClick:e[5]||(e[5]=P((e=>t.$emit("update:taskToAddCollaborator",null)),["prevent"]))},Fe)])])):U("",!0)]))};var De=u({name:"TasksChoice",components:{NewTask:Se,ModesIcons:K},props:{beatmap:{type:Object,required:!0},isHost:Boolean,isRanked:Boolean,isQualified:Boolean},data:()=>({taskToAddCollaborator:null}),computed:d(n({},I(["loggedInUser"])),{sortedTasks(){const t=["Easy","Normal","Hard","Insane","Expert","Storyboard"],e=["osu","taiko","catch","mania","sb"];return[...this.beatmap.tasks].sort((function(e,a){return t.indexOf(e.name)-t.indexOf(a.name)})).sort((function(t,a){return e.indexOf(t.mode)-e.indexOf(a.mode)}))}}),methods:{isOwner(t){return t.some((t=>t.osuId==this.loggedInUser.osuId))},canEditTask(t){return this.isOwner(t.mappers)||this.isHost},async setTaskStatus(t,e,a){a.target.classList.add("fake-button-disable");const s=await this.$http.executePost("/beatmaps/setTaskStatus/"+t,{status:e});this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),a.target.classList.remove("fake-button-disable")},async removeTask(t,e){e.target.classList.add("fake-button-disable");const a=await this.$http.executePost("/beatmaps/removeTask/"+t,{beatmapId:this.beatmap.id});this.$http.isError(a)||this.$store.dispatch("beatmaps/updateBeatmap",a),e.target.classList.remove("fake-button-disable")},canEditTaskCollaborators(t){return"Done"!=t.status&&!this.isQualified&&"Done"!=this.beatmap.status&&this.isOwner(t.mappers)},async removeCollab(t,e,a){a.target.classList.add("fake-button-disable");const s=await this.$http.executePost("/beatmaps/task/"+t+"/removeCollab",{user:e});this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),a.target.classList.remove("fake-button-disable")},isAddingCollaborator(t){var e;return(null==(e=this.taskToAddCollaborator)?void 0:e.id)==t.id}}});const Ve={class:"row"},He={class:"col-sm-12"},_e={class:"table table-sm"},Ne=f("th",null,"Difficulty",-1),Re=f("th",null,"Mapper(s)",-1),Ge={key:0},We=["id"],Ke=[f("i",{class:"fas fa-times"},null,-1)],Je=["onClick"],Xe=[f("i",{class:"fas fa-plus"},null,-1)],ze=["onClick"],Ye=[f("i",{class:"fas fa-minus"},null,-1)],Ze={key:0},ta=["onClick"],ea=[f("i",{class:"fas fa-minus"},null,-1)],aa=["onClick"],sa=[f("i",{class:"fas fa-check"},null,-1)],oa=["onClick"],la=[f("i",{class:"fas fa-ellipsis-h"},null,-1)],ia={key:0,class:"col-sm-12 mt-2"};De.render=function(t,e,a,s,o,l){const i=p("modes-icons"),n=p("user-link"),d=p("new-task"),r=Q("bs-tooltip");return b(),y("div",Ve,[f("div",He,[f("table",_e,[f("thead",null,[f("tr",null,[Ne,Re,t.isRanked||t.isQualified?U("",!0):(b(),y("th",Ge))])]),M(F,{tag:"tbody",name:"list"},{default:k((()=>[(b(!0),y(L,null,B(t.sortedTasks,(a=>(b(),y("tr",{id:a.id+"Row",key:a.id},[f("td",{class:S(["text-white-50",`card-status-${a.status.toLowerCase()}`])},[$(w(a.name)+" ",1),"hybrid"==t.beatmap.mode?(b(),h(i,{key:0,modes:[a.mode]},null,8,["modes"])):U("",!0)],2),f("td",null,[(b(!0),y(L,null,B(a.mappers,((s,o)=>(b(),y("div",{key:s.id},[0==o&&t.canEditTaskCollaborators(a)?(b(),y(L,{key:0},[t.isAddingCollaborator(a)?g((b(),y("a",{key:0,href:"#",class:"text-danger",onClick:e[0]||(e[0]=P((e=>t.taskToAddCollaborator=null),["prevent"]))},Ke,512)),[[r,"cancel"]]):g((b(),y("a",{key:1,href:"#",class:"text-success",onClick:P((e=>t.taskToAddCollaborator=a),["prevent"])},Xe,8,Je)),[[r,"invite new collaborator"]])],64)):U("",!0),M(n,{class:"mx-1",user:s},null,8,["user"]),a.mappers.length>1&&t.canEditTaskCollaborators(a)&&s.osuId!=t.loggedInUser.osuId?g((b(),y("a",{key:1,href:"#",class:"text-danger",onClick:P((e=>t.removeCollab(a.id,s.id,e)),["prevent"])},Ye,8,ze)),[[r,"remove collaborator"]]):U("",!0)])))),128))]),t.isRanked||t.isQualified?U("",!0):(b(),y("td",Ze,[t.canEditTask(a)?(b(),y(L,{key:0},[g(f("a",{href:"#",class:"text-danger me-1",onClick:P((e=>t.removeTask(a.id,e)),["prevent"])},ea,8,ta),[[r,"delete"]]),"WIP"==a.status?g((b(),y("a",{key:0,href:"#",class:"text-success me-1",onClick:P((e=>t.setTaskStatus(a.id,"Done",e)),["prevent"])},sa,8,aa)),[[r,"mark as done"]]):U("",!0),"Done"==a.status&&"Done"!=t.beatmap.status?g((b(),y("a",{key:1,href:"#",class:"text-wip me-1",onClick:P((e=>t.setTaskStatus(a.id,"WIP",e)),["prevent"])},la,8,oa)),[[r,"mark as WIP"]]):U("",!0)],64)):U("",!0)]))],8,We)))),128))])),_:1})])]),t.isRanked||t.isQualified?U("",!0):(b(),y("div",ia,[M(d,{"task-to-add-collaborator":t.taskToAddCollaborator,"onUpdate:task-to-add-collaborator":e[1]||(e[1]=e=>t.taskToAddCollaborator=e),beatmap:t.beatmap,"is-host":t.isHost},null,8,["task-to-add-collaborator","beatmap","is-host"])]))])};var na=u({name:"QuestChoice",props:{beatmap:{type:Object,required:!0}},data:()=>({userQuests:[],showQuestInput:!1,dropdownQuestId:""}),computed:I(["loggedInUser"]),watch:{beatmap(){var t;this.showQuestInput=!1,this.dropdownQuestId=(null==(t=this.beatmap.quest)?void 0:t.id)||""}},async created(){const t=await this.$http.executeGet(`/users/${this.loggedInUser.id}/quests`);this.$http.isError(t)||(this.userQuests=t)},methods:{async linkQuest(t){const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/linkQuest`,{questId:this.dropdownQuestId},t);this.$http.isError(e)||this.$store.dispatch("beatmaps/updateBeatmap",e)}}});const da={class:"row mb-2"},ra={class:"col"},ca=$(" Quest "),ma=[f("i",{class:"fas fa-edit"},null,-1)],ua={class:"small ms-3 text-white-50"},pa={key:0},ba={key:1},ha={key:0,class:"row mb-2"},ka={class:"col"},fa={class:"input-group input-group-sm"},ga=f("option",{value:""}," No quest ",-1),va=["value"],ya=[$(" Save ")];na.render=function(t,e,a,s,o,l){const i=Q("bs-tooltip");return b(),y("div",null,[f("div",da,[f("div",ra,[f("div",null,[ca,g(f("a",{id:"editLink",href:"#",class:S([t.showQuestInput?"text-danger":"","text-success small ms-1"]),onClick:e[0]||(e[0]=P((e=>t.showQuestInput=!t.showQuestInput),["prevent"]))},ma,2),[[i,"connect mapset with a quest","right"]])]),f("div",ua,[t.beatmap.quest?(b(),y("span",pa,w(t.beatmap.quest.name),1)):(b(),y("i",ba,"none"))])])]),t.showQuestInput?(b(),y("div",ha,[f("div",ka,[f("div",fa,[g(f("select",{"onUpdate:modelValue":e[1]||(e[1]=e=>t.dropdownQuestId=e),class:"form-select"},[ga,(b(!0),y(L,null,B(t.userQuests,(t=>(b(),y("option",{key:t.id,value:t.id},w(t.name),9,va)))),128))],512),[[v,t.dropdownQuestId]]),g(f("button",{class:"btn btn-outline-info",onClick:e[2]||(e[2]=e=>t.linkQuest(e))},ya,512),[[i,"link beatmap to quest"]])])])])):U("",!0)])};var Ba=u({name:"ModdersList",components:{UserLinkList:J},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:d(n({},I(["loggedInUser"])),{isModder(){return this.beatmap.modders.some((t=>t.osuId==this.loggedInUser.osuId))}}),methods:{async updateModder(t){t.target.classList.add("fake-button-disable");const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateModder`);this.$http.isError(e)||this.$store.dispatch("beatmaps/updateBeatmap",e),t.target.classList.remove("fake-button-disable")}}});const wa={id:"modders",class:"row mb-2"},La={class:"col"},Ca={key:0,class:"ms-1"},xa={class:"small ms-3"},$a={key:0,class:"text-white-50"};Ba.render=function(t,e,a,s,o,l){const i=p("user-link-list"),n=Q("bs-tooltip");return b(),y("div",wa,[f("div",La,[f("div",null,[$(" Modders ("+w(t.beatmap.modders.length)+") ",1),t.canEdit?g((b(),y("small",Ca,[f("a",{href:"#",class:S(t.isModder?"text-danger":"text-success"),onClick:e[0]||(e[0]=P((e=>t.updateModder(e)),["prevent"]))},[f("i",{class:S(["fas",t.isModder?"fa-minus":"fa-plus"])},null,2)],2)],512)),[[n,"add/remove yourself from modder list","right"]]):U("",!0)]),f("div",xa,[0==t.beatmap.modders.length?(b(),y("i",$a," none ")):(b(),h(i,{key:1,users:t.beatmap.modders},null,8,["users"]))])])])};var Ia=u({name:"NominatorsList",components:{UserLinkList:J},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:d(n({},I(["loggedInUser"])),{isBn(){return this.beatmap.bns.some((t=>t.osuId==this.loggedInUser.osuId))}}),methods:{async updateBn(t){t.target.classList.add("fake-button-disable");const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateBn`);this.$http.isError(e)||this.$store.dispatch("beatmaps/updateBeatmap",e),t.target.classList.remove("fake-button-disable")}}});const Ta={key:0,class:"ms-1"},Ma=[f("i",{class:"fas fa-minus"},null,-1)],Sa=[f("i",{class:"fas fa-plus"},null,-1)],Pa={class:"small ms-3"},Oa={key:0,class:"text-white-50"};Ia.render=function(t,e,a,s,o,l){const i=p("user-link-list"),n=Q("bs-tooltip");return b(),y("div",null,[f("div",null,[$(" Potential Nominators ("+w(t.beatmap.bns.length)+") ",1),t.canEdit?g((b(),y("small",Ta,[t.isBn?(b(),y("a",{key:0,href:"#",class:"text-danger",onClick:e[0]||(e[0]=P((e=>t.updateBn(e)),["prevent"]))},Ma)):U("",!0),!t.isBn&&t.beatmap.bns.length<2?(b(),y("a",{key:1,href:"#",class:"text-success",onClick:e[1]||(e[1]=P((e=>t.updateBn(e)),["prevent"]))},Sa)):U("",!0)],512)),[[n,"add/remove yourself from potential BN list","right"]]):U("",!0)]),f("div",Pa,[0==t.beatmap.bns.length?(b(),y("i",Oa,"none")):(b(),h(i,{key:1,users:t.beatmap.bns},null,8,["users"]))])])};var qa=u({name:"BeatmapLink",props:{beatmap:{type:Object,required:!0}},data:()=>({url:"",showLinkInput:!1}),watch:{beatmap(t){t&&(this.showLinkInput=!1,this.url=t.url)}},created(){this.url=this.beatmap.url},methods:{async saveLink(t){const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setLink`,{url:this.url},t);this.$http.isError(e)||(this.showLinkInput=!1,this.$store.dispatch("beatmaps/updateBeatmap",e))}}});const Aa={class:"row mb-2"},Qa={class:"col"},Ua=$(" Link "),Ea=[f("i",{class:"fas fa-edit"},null,-1)],ja={class:"small ms-3"},Fa=["href"],Da={key:1,class:"text-white-50"},Va={key:0,class:"row mb-2"},Ha={class:"col-sm-12"},_a={class:"input-group input-group-sm"},Na=[$(" Save ")];qa.render=function(t,e,a,s,o,l){const i=Q("bs-tooltip");return b(),y("div",null,[f("div",Aa,[f("div",Qa,[f("div",null,[Ua,g(f("a",{id:"editLink",href:"#",class:S(["text-success small ms-1",{"text-danger":t.showLinkInput}]),onClick:e[0]||(e[0]=P((e=>t.showLinkInput=!t.showLinkInput),["prevent"]))},Ea,2),[[i,"edit link","right"]])]),f("div",ja,[t.beatmap.url?(b(),y("a",{key:0,href:t.beatmap.url,target:"_blank"},w(t.beatmap.url),9,Fa)):(b(),y("i",Da,"none"))])])]),t.showLinkInput?(b(),y("div",Va,[f("div",Ha,[f("div",_a,[g(f("input",{"onUpdate:modelValue":e[1]||(e[1]=e=>t.url=e),class:"form-control form-control-sm",type:"text",placeholder:"URL",onKeyup:e[2]||(e[2]=V((e=>t.saveLink(e)),["enter"]))},null,544),[[D,t.url]]),g(f("button",{id:"addLinkButton",class:"btn btn-outline-info",type:"submit",onClick:e[3]||(e[3]=e=>t.saveLink(e))},Na,512),[[i,"use new osu!web link for card image","right"]])])])])):U("",!0)])};var Ra=u({name:"LocksChoice",props:{beatmap:{type:Object,required:!0}},data:()=>({lockTaskSelection:"",showLocksInput:!1}),computed:{remainingTasks(){var t,e;let a=Object.values(W);return(null==(e=null==(t=this.beatmap)?void 0:t.tasksLocked)?void 0:e.length)&&(a=a.filter((t=>!this.beatmap.tasksLocked.includes(t)))),this.lockTaskSelection=a[0]||"",a}},watch:{beatmap(){this.showLocksInput=!1}},methods:{async unlockTask(t,e){e.target.classList.add("fake-button-disable");const a=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/unlockTask`,{task:t});this.$http.isError(a)||this.$store.dispatch("beatmaps/updateBeatmap",a),e.target.classList.remove("fake-button-disable")},async lockTask(t){const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/lockTask`,{task:this.lockTaskSelection},t);this.$http.isError(e)||this.$store.dispatch("beatmaps/updateBeatmap",e)}}});const Ga={id:"locks",class:"row mb-1"},Wa={class:"col"},Ka=$(" Locks "),Ja=[f("i",{class:"fas fa-edit"},null,-1)],Xa={class:"small ms-3"},za={key:0},Ya={key:1},Za=["onClick"],ts=[f("i",{class:"fas fa-minus"},null,-1)],es={class:"text-white-50 mx-1"},as={key:0,class:"row"},ss={class:"col"},os={class:"input-group input-group-sm"},ls=["value"],is=[f("i",{class:"fas fa-lock"},null,-1)];Ra.render=function(t,e,a,s,o,l){const i=Q("bs-tooltip");return b(),y("div",null,[f("div",Ga,[f("div",Wa,[f("div",null,[Ka,6!=t.beatmap.tasksLocked.length?(b(),y("a",{key:0,class:"text-success small ms-1",href:"#",onClick:e[0]||(e[0]=P((e=>t.showLocksInput=!t.showLocksInput),["prevent"]))},Ja)):U("",!0)]),f("div",Xa,[0==t.beatmap.tasksLocked.length?(b(),y("i",za,"none")):U("",!0),t.beatmap.tasksLocked.length>0?(b(),y("div",Ya,[(b(!0),y(L,null,B(t.beatmap.tasksLocked,(e=>(b(),y("div",{key:e},[g(f("a",{href:"#",class:"text-danger",onClick:P((a=>t.unlockTask(e,a)),["prevent"])},ts,8,Za),[[i,"unlock","left"]]),f("span",es,w(e),1)])))),128))])):U("",!0)])])]),t.showLocksInput?(b(),y("div",as,[f("div",ss,[f("div",os,[g(f("select",{"onUpdate:modelValue":e[1]||(e[1]=e=>t.lockTaskSelection=e),class:"form-select"},[(b(!0),y(L,null,B(t.remainingTasks,(t=>(b(),y("option",{key:t,value:t},w(t),9,ls)))),128))],512),[[v,t.lockTaskSelection]]),g(f("button",{id:"lockTask",class:"btn btn-outline-info",onClick:e[2]||(e[2]=e=>t.lockTask(e))},is,512),[[i,"prevent other mappers from claiming a difficulty","right"]])])])])):U("",!0)])};var ns=u({name:"Points",props:{beatmap:{type:Object,required:!0}},data:()=>({tasksPointsArray:null,usersPointsArrays:null,pointsInfo:null,totalPoints:null,isLoading:!1}),watch:{beatmap(){this.tasksPointsArray=null,this.usersPointsArrays=null,this.pointsInfo=null,this.totalPoints=null,this.isLoading=!1}},methods:{async findPoints(t){this.isLoading=!0;const e=await this.$http.executeGet(`/beatmaps/${this.beatmap.id}/findPoints`,t);this.$http.isError(e)||(this.tasksPointsArray=e.tasksPointsArray,this.usersPointsArrays=e.usersPointsArrays,this.pointsInfo=e.pointsInfo,this.totalPoints=e.totalPoints),this.isLoading=!1}}});const ds={class:"row"},rs={class:"col-sm-12"},cs=[$(" Calculate points ")],ms={key:1,class:"small text-white-50 ms-2"},us={key:2,class:"small text-white-50 ms-2"},ps={key:0,class:"col-sm-6"},bs={class:"small text-white-50"},hs={class:"col-sm-6"},ks={key:0,class:"small text-white-50"},fs={key:1,class:"col-sm-12"},gs={class:"small text-white-50 ms-2"};ns.render=function(t,e,a,s,o,l){const i=Q("bs-tooltip");return b(),y("div",null,[f("div",ds,[f("div",rs,[t.tasksPointsArray?U("",!0):g((b(),y("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:e[0]||(e[0]=e=>t.findPoints(e))},cs,512)),[[i,"calculate points for all difficulties"]]),t.isLoading?(b(),y("span",ms," calculating... ")):t.pointsInfo?(b(),y("span",us,w(t.pointsInfo),1)):U("",!0)]),t.tasksPointsArray?(b(),y("div",ps,[f("ul",bs,[(b(!0),y(L,null,B(t.tasksPointsArray,((t,e)=>(b(),y("li",{key:e},w(t),1)))),128))])])):U("",!0),f("div",hs,[t.usersPointsArrays?(b(),y("ul",ks,[(b(!0),y(L,null,B(t.usersPointsArrays,((e,a)=>(b(),y("li",{key:a},w(t.usersPointsArrays[a][0])+": "+w(t.usersPointsArrays[a][1]),1)))),128))])):U("",!0)]),t.totalPoints?(b(),y("div",fs,[f("span",gs," total: "+w(Math.round(10*t.totalPoints)/10),1)])):U("",!0)])])};var vs=u({name:"BeatmapInfo",components:{ModeChoice:ce,StatusChoice:Le,TasksChoice:De,QuestChoice:na,ModdersList:Ba,NominatorsList:Ia,BeatmapLink:qa,LocksChoice:Ra,Points:ns},props:{beatmap:{type:Object,required:!0}},data:()=>({userQuests:null}),computed:d(n({},I(["loggedInUser"])),{isHost(){return!(!this.loggedInUser.id||!this.beatmap)&&this.loggedInUser.id===this.beatmap.host.id},isRanked(){return this.beatmap.status===r.Ranked},isQualified(){return this.beatmap.status===r.Qualified}}),methods:{async deleteMap(t){if(confirm("Are you sure you want to delete?")){t.target.disabled=!0;const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/delete`,{},t);this.$http.isError(e)||(this.$bs.hideModal("editBeatmap"),this.$store.commit("beatmaps/deleteBeatmap",e)),t.target.disabled=!1}}}});q("data-v-5f08e831");const ys={key:0,class:"container"},Bs={class:"row"},ws={class:"row mb-2"},Ls={class:"col-sm-6"},Cs={key:0,id:"bns",class:"col-sm-6"},xs=f("hr",null,null,-1),$s={class:"row"},Is={class:"col-sm"},Ts={key:0,class:"col-lg-5 bm-col-separator-left"},Ms={class:"row mb-2"},Ss={class:"col-sm"},Ps={class:"row mb-2"},Os={class:"col-sm"},qs=f("hr",null,null,-1),As={class:"row"},Qs={class:"col-sm-4 text-end"},Us={class:"small text-white-50"};A(),vs.render=function(t,e,a,s,o,l){const i=p("modders-list"),n=p("nominators-list"),d=p("tasks-choice"),r=p("mode-choice"),c=p("status-choice"),m=p("quest-choice"),u=p("beatmap-link"),k=p("locks-choice"),g=p("points");return t.beatmap?(b(),y("div",ys,[f("div",Bs,[f("div",{class:S(!t.isHost||t.isRanked||t.isQualified?"col-sm-12":"col-lg-7")},[f("div",ws,[f("div",Ls,[M(i,{beatmap:t.beatmap,"can-edit":!t.isHost&&!t.isRanked},null,8,["beatmap","can-edit"])]),!t.isRanked||t.beatmap.bns?(b(),y("div",Cs,[M(n,{beatmap:t.beatmap,"can-edit":!t.isHost&&!t.isRanked},null,8,["beatmap","can-edit"])])):U("",!0)]),xs,f("div",$s,[f("div",Is,[M(d,{beatmap:t.beatmap,"is-host":t.isHost,"is-ranked":t.isRanked,"is-qualified":t.isQualified},null,8,["beatmap","is-host","is-ranked","is-qualified"])])])],2),!t.isHost||t.isRanked||t.isQualified?U("",!0):(b(),y("div",Ts,[f("div",Ms,[f("div",Ss,["WIP"==t.beatmap.status||"Secret"==t.beatmap.status?(b(),h(r,{key:0,beatmap:t.beatmap},null,8,["beatmap"])):U("",!0)])]),f("div",Ps,[f("div",Os,["Secret"!==t.beatmap.status?(b(),h(c,{key:0,beatmap:t.beatmap},null,8,["beatmap"])):U("",!0)])]),"Secret"!==t.beatmap.status?(b(),h(m,{key:0,beatmap:t.beatmap},null,8,["beatmap"])):U("",!0),M(u,{beatmap:t.beatmap},null,8,["beatmap"]),"WIP"==t.beatmap.status||"Secret"==t.beatmap.status?(b(),h(k,{key:1,beatmap:t.beatmap},null,8,["beatmap"])):U("",!0)]))]),qs,f("div",As,[M(g,{class:"col-sm-8",beatmap:t.beatmap},null,8,["beatmap"]),f("div",Qs,[f("span",Us," Created: "+w(t.beatmap.createdAt.toString().slice(0,10)),1),t.isHost&&!t.isRanked?(b(),y("button",{key:0,id:"deleteButton",class:"btn btn-sm btn-outline-danger ms-2",onClick:e[0]||(e[0]=e=>t.deleteMap(e))}," Delete ")):U("",!0)])])])):U("",!0)},vs.__scopeId="data-v-5f08e831";var Es=u({name:"BeatmapTableRow",components:{BeatmapInfo:vs,ProcessTasks:Ht,QuestImg:_t,ModesIcons:K},props:{beatmap:{type:Object,required:!0}},methods:{selectBeatmap(){this.$route.query.id!==this.beatmap.id&&this.$router.push(`/beatmaps?id=${this.beatmap.id}`)},formatMetadata(){const t=this.beatmap.song.artist+" - "+this.beatmap.song.title;return t.length>70?t.slice(0,70)+"...":t},statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}}});const js={class:"container"},Fs={class:"row"},Ds={class:"col-sm-6"},Vs=["data-bs-target"],Hs=f("i",{class:"fas fa-angle-down"},null,-1),_s={class:"col-sm-2 small d-flex justify-content-end align-items-center"},Ns={class:"col-sm-3 small"},Rs=f("span",{class:"text-white-50 me-1"},"Hosted by",-1),Gs={key:0,class:"text-white-50"},Ws={key:0,class:"col-sm-1 d-flex justify-content-end align-items-center"},Ks=["href"],Js=[f("i",{class:"fas fa-link"},null,-1)],Xs=["id"];Es.render=function(t,e,a,s,o,l){const i=p("quest-img"),n=p("process-tasks"),d=p("user-link"),r=p("modes-icons"),c=p("beatmap-info");return b(),y("div",null,[f("div",{class:S(["card card-body card-level-2 my-1 p-1",t.statusBorder()])},[f("div",js,[f("div",Fs,[f("div",Ds,[M(i,{beatmap:t.beatmap},null,8,["beatmap"]),f("a",{href:"#","data-bs-toggle":"collapse","data-bs-target":"#details"+t.beatmap.id,onClick:e[0]||(e[0]=e=>t.selectBeatmap())},[$(w(t.formatMetadata())+" ",1),Hs],8,Vs)]),f("div",_s,[M(n,{tasks:t.beatmap.tasks,"tasks-locked":t.beatmap.tasksLocked,mode:t.beatmap.mode},null,8,["tasks","tasks-locked","mode"])]),f("div",Ns,[Rs,M(d,{class:"me-1",user:t.beatmap.host},null,8,["user"]),"osu"!==t.beatmap.mode?(b(),y("span",Gs,[M(r,{modes:[t.beatmap.mode]},null,8,["modes"])])):U("",!0)]),t.beatmap.url?(b(),y("div",Ws,[f("a",{href:t.beatmap.url,target:"_blank"},Js,8,Ks)])):U("",!0)])])],2),f("div",{id:"details"+t.beatmap.id,class:S(["collapse my-2 mx-4 row border-end border-start py-3","border-"+t.beatmap.status.toLowerCase()])},[M(c,{beatmap:t.beatmap},null,8,["beatmap"])],10,Xs)])};var zs=u({components:{BeatmapTableRow:Es},computed:I("beatmaps",{otherBeatmaps:"allBeatmaps",isLoadingOtherBeatmaps:"isLoadingOtherBeatmaps",filterValue:"filterValue"}),methods:{async showMore(t){t.target.disabled=!0,this.$store.commit("beatmaps/increaseFetchLimit"),await this.$store.dispatch("beatmaps/loadOtherBeatmaps"),t.target.disabled=!1}}});const Ys={class:"container card card-body py-3"},Zs={class:"ms-2"},to={href:"#otherBeatmaps","data-bs-toggle":"collapse"},eo=f("i",{class:"fas fa-angle-down"},null,-1),ao={key:0,id:"otherBeatmaps",class:"collapse"},so={key:0,class:"ms-5 text-white-50"},oo={key:1,class:"text-center"},lo=[f("i",{class:"fas fa-angle-down me-1"},null,-1),$(" show more "),f("i",{class:"fas fa-angle-down ms-1"},null,-1)];zs.render=function(t,e,a,s,o,l){const i=p("beatmap-table-row");return b(),y("div",Ys,[f("h5",Zs,[f("a",to,[$(" Other beatmaps ("+w(t.otherBeatmaps&&!t.isLoadingOtherBeatmaps?t.otherBeatmaps.length:"...")+") ",1),eo])]),t.otherBeatmaps?(b(),y("div",ao,[f("div",{class:S({"loading-data":t.isLoadingOtherBeatmaps})},[t.otherBeatmaps.length||t.isLoadingOtherBeatmaps?U("",!0):(b(),y("p",so," None... ")),(b(!0),y(L,null,B(t.otherBeatmaps,(t=>(b(),h(i,{key:t.id,beatmap:t},null,8,["beatmap"])))),128)),t.filterValue?U("",!0):(b(),y("div",oo,[f("button",{class:"btn btn-sm btn-outline-info my-4",onClick:e[0]||(e[0]=P((e=>t.showMore(e)),["prevent"]))},lo)]))],2)])):U("",!0)])};var io=u({components:{BeatmapInfo:vs,ModalDialog:m,QuestImg:_t,ModesIcons:K},props:{selectedBeatmap:{type:Object,default:()=>({})}},watch:{selectedBeatmap(){this.selectedBeatmap&&this.$route.query.id!==this.selectedBeatmap.id&&this.$router.replace(`/beatmaps?id=${this.selectedBeatmap.id}`)}}});const no=["href"],ro=f("i",{class:"fas fa-link"},null,-1),co={key:1},mo=$(" |");io.render=function(t,e,a,s,o,l){const i=p("quest-img"),n=p("user-link"),d=p("modes-icons"),r=p("beatmap-info"),c=p("modal-dialog");return b(),h(c,{id:"editBeatmap",loaded:Boolean(t.selectedBeatmap),"header-class":t.selectedBeatmap?"bg-"+t.selectedBeatmap.status.toLowerCase():""},{header:k((()=>[M(i,{beatmap:t.selectedBeatmap},null,8,["beatmap"]),t.selectedBeatmap.url?(b(),y("a",{key:0,href:t.selectedBeatmap.url,target:"_blank"},[ro,$(" "+w(t.selectedBeatmap.song.artist)+" - "+w(t.selectedBeatmap.song.title),1)],8,no)):(b(),y("span",co,w(t.selectedBeatmap.song.artist)+" - "+w(t.selectedBeatmap.song.title),1)),mo,M(n,{class:"mx-1",user:t.selectedBeatmap.host},null,8,["user"]),M(d,{modes:[t.selectedBeatmap.mode]},null,8,["modes"])])),default:k((()=>[M(r,{beatmap:t.selectedBeatmap},null,8,["beatmap"])])),_:1},8,["loaded","header-class"])};var uo={namespaced:!0,state:{allBeatmaps:[],userBeatmaps:[],filterValue:"",filterMode:R.any,filterStatus:"any",filterQuest:"any",selectedBeatmap:null,selectedBeatmapId:null,fetchLimit:30,isLoadingOtherBeatmaps:!0},mutations:{setAllBeatmaps(t,e){t.allBeatmaps=e},setUserBeatmaps(t,e){t.userBeatmaps=e},setFilterValue(t,e){t.filterValue=e},setFilterMode(t,e){t.filterMode=e},setFilterStatus(t,e){t.filterStatus=e},setFilterQuest(t,e){t.filterQuest=e},setIsLoadingOtherBeatmaps(t,e){t.isLoadingOtherBeatmaps=e},increaseFetchLimit(t){t.fetchLimit+=50},setSelectedBeatmap(t,e){const a=Object.values(W);e.tasks.sort((function(t,e){return a.indexOf(t.name)-a.indexOf(e.name)})),e.tasksLocked.sort((function(t,e){return a.indexOf(t)-a.indexOf(e)})),t.selectedBeatmap=e},addBeatmap(t,e){t.userBeatmaps.unshift(e)},updateBeatmap(t,e){let a=t.allBeatmaps.findIndex((t=>t.id===e.id));-1!==a&&(t.allBeatmaps[a]=e),a=t.userBeatmaps.findIndex((t=>t.id===e.id)),-1!==a&&(t.userBeatmaps[a]=e)},deleteBeatmap(t,e){let a=t.allBeatmaps.findIndex((t=>t.id===e.id));-1!==a&&t.allBeatmaps.splice(a,1),a=t.userBeatmaps.findIndex((t=>t.id===e.id)),-1!==a&&t.userBeatmaps.splice(a,1)}},getters:{filteredUserBeatmaps:t=>{let e=t.userBeatmaps;if(t.filterMode!==R.any){const a=t.filterMode;e=e.filter((t=>t.mode===a||t.mode===c.Hybrid))}if("any"!==t.filterStatus&&(e=e.filter((e=>e.status===t.filterStatus))),"any"!==t.filterQuest&&(e=e.filter((t=>!t.quest))),t.filterValue){const a=t.filterValue.toLowerCase().trim().split(" ").filter((t=>t.length));e=e.filter((t=>{let e=t.song.artist+" "+t.song.title+" "+t.host.username;return t.tasks.forEach((t=>{t.mappers.forEach((t=>{e+=" "+t.username}))})),e=e.toLowerCase(),a.some((t=>e.includes(t)))}))}return e},guestDifficultyBeatmaps:(t,e,a)=>e.filteredUserBeatmaps.filter((t=>{var e;return t.host.id!==(null==(e=a.loggedInUser)?void 0:e.id)})),hostedBeatmaps:(t,e,a)=>e.filteredUserBeatmaps.filter((t=>{var e;return t.host.id===(null==(e=a.loggedInUser)?void 0:e.id)}))},actions:{updateBeatmap({commit:t,state:e},a){var s;t("updateBeatmap",a),(null==(s=e.selectedBeatmap)?void 0:s.id)===a.id&&t("setSelectedBeatmap",a)},async updateFilterMode({commit:t,dispatch:e},a){t("setFilterMode",a),await e("loadOtherBeatmaps")},async updateFilterStatus({commit:t,dispatch:e},a){t("setFilterStatus",a),await e("loadOtherBeatmaps")},async updateFilterQuest({commit:t,dispatch:e},a){t("setFilterQuest",a),await e("loadOtherBeatmaps")},async updateFilterValue({commit:t,dispatch:e},a){t("setFilterValue",a),await e("loadOtherBeatmaps")},async loadOtherBeatmaps({commit:t,state:e}){var a;t("setIsLoadingOtherBeatmaps",!0);const s="any"!==e.filterStatus?`&status=${e.filterStatus}`:"",o="any"!==e.filterQuest?`&quest=${e.filterQuest}`:"",l=e.filterValue?`&search=${e.filterValue}`:"",i=await H.get(`/api/beatmaps/search?mode=${e.filterMode}&limit=${e.fetchLimit+s+o+l}`);(null==(a=i.data)?void 0:a.allBeatmaps)&&t("setAllBeatmaps",i.data.allBeatmaps),t("setIsLoadingOtherBeatmaps",!1)}}},po=u({name:"BeatmapPage",components:{BeatmapPageFilters:St,HostedBeatmaps:zt,GuestDifficulties:oe,OtherBeatmaps:zs,EditBeatmapModal:io,CreateBeatmapModal:X},data:()=>({isLoadingGuestBeatmaps:!0}),computed:I("beatmaps",["selectedBeatmap"]),beforeCreate(){this.$store.hasModule("beatmaps")||this.$store.registerModule("beatmaps",uo)},async created(){const t=this.$route.query.id;let e,a;t?([e,a]=await Promise.all([this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.executeGet("/beatmaps/searchOnLoad/"+t)]),this.$http.isError(a)||(this.$store.commit("beatmaps/setSelectedBeatmap",a),this.$bs.showModal("editBeatmap"))):e=await this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.isError(e)||(this.$store.commit("beatmaps/setUserBeatmaps",e.beatmaps),this.$store.commit("beatmaps/setFilterMode",e.mainMode)),await Promise.all([this.loadGuestBeatmaps(),this.$store.dispatch("beatmaps/loadOtherBeatmaps")]),this.isLoadingGuestBeatmaps=!1},methods:{async loadGuestBeatmaps(){const t=await this.$http.executeGet("/beatmaps/guestBeatmaps");t&&this.$store.commit("beatmaps/setUserBeatmaps",t.userBeatmaps)}}});const bo=f("div",{class:"radial-divisor"},null,-1),ho=f("div",{class:"radial-divisor"},null,-1);po.render=function(t,e,a,s,o,l){const i=p("beatmap-page-filters"),n=p("hosted-beatmaps"),d=p("guest-difficulties"),r=p("other-beatmaps"),c=p("edit-beatmap-modal"),m=p("create-beatmap-modal");return b(),y("div",null,[M(i),M(n),bo,M(d,{"is-loading-guest-beatmaps":t.isLoadingGuestBeatmaps},null,8,["is-loading-guest-beatmaps"]),ho,M(r),M(c,{"selected-beatmap":t.selectedBeatmap},null,8,["selected-beatmap"]),M(m)])};export{po as default};
