import{M as S}from"./ModalDialog-1d2a7952.js";import{S as T}from"./task-21eeb954.js";import{d as v,M,_ as Q,o,c as U,w as c,e as d,t as i,j as m,a as e,i as b,b as n,v as l,r as k,F as f,f as h,k as y,p as u}from"./index-6a126013.js";import{T as B}from"./TasksChoice-28992a44.js";const R=v({name:"BeatmapInfoAdmin",components:{ModalDialog:S,ModesIcons:M,TasksChoice:B},props:{beatmap:{type:Object,required:!0}},data(){return{status:this.beatmap.status,taskId:null,modderId:null,beatmapUrl:this.beatmap.url,storyboardQuality:null,storyboardTaskId:null,packId:this.beatmap.packId,rejectionInput:""}},computed:{sortedTasks(){const t=T;return[...this.beatmap.tasks].sort(function(s,p){return t.indexOf(s.name)-t.indexOf(p.name)})}},watch:{beatmap(){this.findBeatmapInfo()}},mounted(){this.findBeatmapInfo()},methods:{findBeatmapInfo(){this.status=this.beatmap.status,this.taskId=null,this.modderId=null,this.beatmapUrl=this.beatmap.url,this.storyboardQuality=null,this.storyboardTaskId=null,this.packId=this.beatmap.packId,this.beatmap.tasks.forEach(t=>{t.name=="Storyboard"&&(t.sbQuality&&(this.storyboardQuality=t.sbQuality),this.storyboardTaskId=t.id)}),this.rejectionInput=""},findTaskInfo(t){let s=`${t.name} --- `;const p=t.mappers.map(r=>r.username);return s+=p.join(", "),t.name=="Storyboard"&&(s+=` --- ${t.sbQuality}`),s},async updateBeatmapStatus(t){const s=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateStatus`,{status:this.status},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:"updated beatmap status",type:"info"}),this.$store.commit("updateBeatmapStatus",{beatmapId:this.beatmap.id,status:s}))},async deleteTask(t){const s=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/tasks/${this.taskId}/delete`,{},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:"deleted task",type:"info"}),this.$store.commit("deleteTask",{beatmapId:this.beatmap.id,taskId:this.taskId}))},async deleteModder(t){const s=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/modders/${this.modderId}/delete`,{},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:"deleted modder",type:"info"}),this.$store.commit("deleteModder",{beatmapId:this.beatmap.id,modderId:this.modderId}))},async updateUrl(t){const s=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateUrl`,{url:this.beatmapUrl},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:"updated URL",type:"info"}),this.$store.commit("updateUrl",{beatmapId:this.beatmap.id,url:s}))},async updateStoryboardQuality(t){const s=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateStoryboardQuality`,{storyboardQuality:this.storyboardQuality,taskId:this.storyboardTaskId},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:"updated storyboard quality",type:"info"}),this.$store.commit("updateStoryboardQuality",{beatmapId:this.beatmap.id,taskId:this.storyboardTaskId,task:s}))},async updatePackId(t){const s=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updatePackId`,{packId:this.packId},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:"updated pack id",type:"info"}),this.$store.commit("updatePackId",{beatmapId:this.beatmap.id,packId:s}))},async updateIsShowcase(t){const s=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateIsShowcase`,{isShowcase:!this.beatmap.isShowcase},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:`updated isShowcase: ${s}`,type:"info"}),this.$store.commit("updateIsShowcase",{beatmapId:this.beatmap.id,isShowcase:s}))},async updateQueuedForRank(t){const s=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateQueuedForRank`,{queuedForRank:!this.beatmap.queuedForRank},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:`updated queuedForRank: ${s}`,type:"info"}),this.$store.commit("updateQueuedForRank",{beatmapId:this.beatmap.id,queuedForRank:s}))},async updateSkipWebhook(t){const s=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/updateSkipWebhook`,{skipWebhook:!this.beatmap.skipWebhook},t);this.$http.isError(s)||(this.$store.dispatch("updateToastMessages",{message:`updated skipWebhook: ${s}`,type:"info"}),this.$store.commit("updateSkipBeatmapWebhook",{beatmapId:this.beatmap.id,skipWebhook:s}))},async rejectMapset(t,s){if(confirm("Are you sure?")){const r=await this.$http.executePost(`/admin/beatmaps/${this.beatmap.id}/rejectMapset`,{messages:this.rejectionInput,isResolvable:s},t);this.$http.isError(r)||(this.$store.dispatch("updateToastMessages",{message:"updated beatmap status",type:"info"}),this.$store.commit("updateBeatmapStatus",{beatmapId:this.beatmap.id,status:r}))}}}}),C=["href"],P={key:1},j=["href"],E={class:"container"},F={class:"row"},W={class:"row"},_=["value"],V=e("hr",null,null,-1),q={class:"row"},D=e("option",{value:"WIP"}," WIP ",-1),O=e("option",{value:"Done"}," Done ",-1),A=e("option",{value:"Qualified"}," Qualified ",-1),N=e("option",{value:"Ranked"}," Ranked ",-1),L=[D,O,A,N],G={class:"row"},H=["value"],z={class:"row"},J={key:0,class:"row"},K=e("option",{value:"1"}," 1 ",-1),X=e("option",{value:"2"}," 2 ",-1),Y=e("option",{value:"3"}," 3 ",-1),Z=[K,X,Y],x={class:"row"},tt={class:"row"},st={class:"col-sm-6"},et={class:"text-danger me-2"},at={key:1},ot={class:"row"},it={class:"col-sm-6"},dt={class:"text-danger me-2"},nt={class:"row"},pt={class:"col-sm-6"},rt={class:"text-danger me-2"},mt={class:"row"};function lt(t,s,p,r,ut,bt){const I=u("user-link"),$=u("modes-icons"),w=u("tasks-choice"),g=u("modal-dialog");return o(),U(g,{id:"editBeatmap",loaded:Boolean(t.beatmap)},{header:c(()=>[t.beatmap.url?(o(),d("a",{key:0,href:t.beatmap.url,target:"_blank"},i(t.beatmap.song.artist)+" - "+i(t.beatmap.song.title),9,C)):(o(),d("span",P,i(t.beatmap.song.artist)+" - "+i(t.beatmap.song.title),1)),m(" | "),e("a",{href:`/beatmaps?id=${t.beatmap.id}`,target:"_blank"},"MG url",8,j),m(" | "),b(I,{class:"me-1",user:t.beatmap.host},null,8,["user"]),b($,{modes:[t.beatmap.mode],color:"dark"},null,8,["modes"])]),default:c(()=>[e("div",E,[e("div",F,[b(w,{beatmap:t.beatmap,"is-host":!0,"is-qualified":!1,"is-ranked":!1,"is-admin":!0},null,8,["beatmap"])]),e("p",W,[n(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>t.taskId=a),class:"form-select form-select-sm w-50 mx-2"},[(o(!0),d(f,null,k(t.sortedTasks,a=>(o(),d("option",{key:a.id,value:a.id},i(t.findTaskInfo(a)),9,_))),128))],512),[[l,t.taskId]]),e("button",{class:"btn btn-sm btn-outline-danger w-25",onClick:s[1]||(s[1]=a=>t.deleteTask(a))}," Remove difficulty ")]),V,e("p",q,[n(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>t.status=a),class:"form-select form-select-sm w-50 mx-2"},L,512),[[l,t.status]]),e("button",{class:"btn btn-sm btn-outline-info w-25",onClick:s[3]||(s[3]=a=>t.updateBeatmapStatus(a))}," Save status ")]),e("p",G,[n(e("select",{"onUpdate:modelValue":s[4]||(s[4]=a=>t.modderId=a),class:"form-select form-select-sm w-50 mx-2"},[(o(!0),d(f,null,k(t.beatmap.modders,a=>(o(),d("option",{key:a.id,value:a.id},i(a.username),9,H))),128))],512),[[l,t.modderId]]),e("button",{class:"btn btn-sm btn-outline-danger w-25",onClick:s[5]||(s[5]=a=>t.deleteModder(a))}," Remove modder ")]),e("p",z,[n(e("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>t.beatmapUrl=a),class:"form-control form-control-sm mx-2 w-50",type:"text",autocomplete:"off",placeholder:"beatmap url..."},null,512),[[h,t.beatmapUrl]]),e("button",{class:"btn btn-sm btn-outline-info w-25",onClick:s[7]||(s[7]=a=>t.updateUrl(a))}," Save URL ")]),t.storyboardTaskId?(o(),d("p",J,[n(e("select",{"onUpdate:modelValue":s[8]||(s[8]=a=>t.storyboardQuality=a),class:"form-select form-select-sm w-50 mx-2"},Z,512),[[l,t.storyboardQuality]]),e("button",{class:"btn btn-sm btn-outline-info w-25",onClick:s[9]||(s[9]=a=>t.updateStoryboardQuality(a))}," Save Storyboard Quality ")])):y("",!0),e("p",x,[n(e("input",{"onUpdate:modelValue":s[10]||(s[10]=a=>t.packId=a),class:"form-control form-control-sm mx-2 w-50",type:"text",autocomplete:"off",placeholder:"osu! beatmap pack ID..."},null,512),[[h,t.packId]]),e("button",{class:"btn btn-sm btn-outline-info w-25",onClick:s[11]||(s[11]=a=>t.updatePackId(a))}," Save pack ID ")]),e("p",tt,[e("span",st,[m(" Featured Artist showcase: "),e("span",et,i(t.beatmap.isShowcase?"true":"false"),1)]),e("button",{class:"btn btn-sm btn-outline-info ms-3 w-25",onClick:s[12]||(s[12]=a=>t.updateIsShowcase(a))}," Toggle ")]),t.beatmap.status=="Qualified"?(o(),d("span",at,[e("p",ot,[e("span",it,[m(" Queued for rank: "),e("span",dt,i(t.beatmap.queuedForRank?"true":"false"),1)]),e("button",{class:"btn btn-sm btn-outline-info ms-3 w-25",onClick:s[13]||(s[13]=a=>t.updateQueuedForRank(a))}," Toggle ")]),e("p",nt,[e("span",pt,[m(" Skip webhook: "),e("span",rt,i(t.beatmap.skipWebhook?"true":"false"),1)]),e("button",{class:"btn btn-sm btn-outline-info ms-3 w-25",onClick:s[14]||(s[14]=a=>t.updateSkipWebhook(a))}," Toggle ")]),e("p",mt,[n(e("textarea",{"onUpdate:modelValue":s[15]||(s[15]=a=>t.rejectionInput=a),class:"form-control form-control-sm w-25",type:"text",autocomplete:"off",placeholder:"messages separated by new lines..."},null,512),[[h,t.rejectionInput]]),e("button",{class:"btn btn-sm btn-outline-info ms-2 w-25",onClick:s[16]||(s[16]=a=>t.rejectMapset(a,!0))}," Reject with resolution option "),e("button",{class:"btn btn-sm btn-outline-danger ms-2 w-25",onClick:s[17]||(s[17]=a=>t.rejectMapset(a,!1))}," Reject WITHOUT resolution ")])])):y("",!0)])]),_:1},8,["loaded"])}const yt=Q(R,[["render",lt]]);export{yt as B};
