import{d as y,M as V,m as O,B as U,_ as v,o as a,c as I,w as q,a as t,b as $,v as P,e as i,r as B,t as h,F as w,f as D,g as E,h as ne,i as k,j as b,k as c,n as M,T as H,l as le,p as f,q as T,s as K,u as Y,x as de,y as L,z as N,A as X,C as J,D as W,E as re}from"./index-6a126013.js";import{S as F,T as C,a as A}from"./task-21eeb954.js";import{M as Z}from"./ModalDialog-1d2a7952.js";import{U as G}from"./UserLinkList-0706768b.js";import{F as ue}from"./FilterBox-e6745151.js";import{M as pe,F as z}from"./extras-b2474ef7.js";import{T as ce}from"./TasksChoice-28992a44.js";const me=y({name:"CreateBeatmapModal",components:{ModalDialog:Z,UserLinkList:G,ModesIcons:V},data(){return{featuredArtists:[],featuredSongs:[],selectedArtist:"",artistInput:"",selectedSong:"",selectedMode:"osu",selectedTaskStatus:"",previousSelectedMode:"",selectedTaskMode:"osu",checkedLocks:[],modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}],tasks:F,newTaskName:"",newTaskMapper:"",tempTasks:[]}},computed:{...O(["loggedInUser"]),filteredTasks(){return this.selectedMode=="taiko"?[...F].filter(e=>e!=C.Hitsounds):F},sortedTasks(){const e=F,s=["osu","taiko","catch","mania","hs","sb"];return[...this.tempTasks].sort(function(l,u){return e.indexOf(l.name)-e.indexOf(u.name)}).sort(function(l,u){return s.indexOf(l.mode)-s.indexOf(u.mode)})}},watch:{selectedMode(){if(this.selectedMode==U.Taiko){const e=this.tempTasks.findIndex(s=>s.name==C.Hitsounds);e>=0&&(this.tempTasks.splice(e,1),this.newTaskName="")}this.selectedMode==U.Hybrid&&(this.tempTasks=[]),this.previousSelectedMode==U.Hybrid&&(this.tempTasks=[]),this.previousSelectedMode=this.selectedMode}},async created(){const e=await this.$http.executeGet("/featuredArtists");e&&(this.featuredArtists=e.sort((s,o)=>s.label.toLowerCase()>o.label.toLowerCase()?1:o.label.toLowerCase()>s.label.toLowerCase()?-1:0))},methods:{async setArtist(e){if(!this.selectedArtist&&!this.artistInput){this.$store.dispatch("updateToastMessages",{message:"Select or type an artist!",type:"danger"});return}if(this.artistInput){const o=this.featuredArtists.find(l=>l.label.toLowerCase().includes(this.artistInput.toLowerCase()));o&&(this.selectedArtist=o.id)}if(!this.selectedArtist){this.$store.dispatch("updateToastMessages",{message:"Couldn't find artist! Check your typing or select one from the list.",type:"danger"});return}e.target.disabled=!0;const s=await this.$http.executeGet(`/featuredArtists/${this.selectedArtist}/songs`);s&&(this.featuredSongs=s.sort((o,l)=>o.title.toLowerCase()>l.title.toLowerCase()?1:l.title.toLowerCase()>o.title.toLowerCase()?-1:0)),e.target.disabled=!1},async addTempTask(e){if(!this.newTaskName.length||!this.selectedTaskStatus.length){this.$store.dispatch("updateToastMessages",{message:"Missing task or status",type:"danger"});return}const s=this.tempTasks.find(u=>u.name==C.Hitsounds),o=this.tempTasks.find(u=>u.name==C.Storyboard);if(s&&this.newTaskName==C.Hitsounds){this.$store.dispatch("updateToastMessages",{message:'Only one "Hitsounds" task allowed',type:"danger"});return}if(o&&this.newTaskName==C.Storyboard){this.$store.dispatch("updateToastMessages",{message:'Only one "Storyboard" task allowed',type:"danger"});return}const l=await this.$http.executeGet(`/beatmaps/validateUsers/${this.newTaskMapper.length?this.newTaskMapper:this.loggedInUser.username}`,e);l&&l.length&&this.tempTasks.push({name:this.newTaskName,mappers:l,mode:this.selectedTaskMode,status:this.selectedTaskStatus,random:Math.random().toString()})},removeTempTask(e){const s=this.tempTasks.findIndex(o=>o.random==e);this.tempTasks.splice(s,1)},async saveNewMap(e){if(!this.selectedSong){this.$store.dispatch("updateToastMessages",{message:"Select a song!",type:"info"});return}const s=await this.$http.executePost("/beatmaps/create/",{song:this.selectedSong,tasks:this.tempTasks,tasksLocked:this.checkedLocks,mode:this.selectedMode},e);this.$http.isError(s)||(this.$bs.hideModal("addBeatmap"),this.$store.commit("beatmaps/addBeatmap",s))}}});const _=e=>(K("data-v-fcc1500e"),e=e(),Y(),e),he={class:"container"},fe={class:"mb-3 row"},be=_(()=>t("div",{class:"col-lg-1"},[t("p",{style:{"margin-top":"3px"}}," Artist: ")],-1)),_e={class:"col-lg-11"},ke={id:"artistForm",class:"input-group input-group-sm mb-3"},$e=_(()=>t("option",{value:""}," Select an artist ",-1)),ge=_(()=>t("option",{value:"-",disabled:""}," --- ",-1)),ye=["value"],ve=_(()=>t("div",{class:"col-lg-1"},[t("p",{style:{"margin-top":"3px"}}," Song: ")],-1)),Be={class:"col-lg-11"},we=["disabled"],Me=_(()=>t("option",{value:"",disabled:""}," Select an artist to view songs ",-1)),Ie=_(()=>t("option",{value:"-",disabled:""}," --- ",-1)),Le=["value"],Te=_(()=>t("hr",null,null,-1)),Se=_(()=>t("p",null," Game-mode: ",-1)),Ce={class:"mb-3 row"},Pe={class:"col-sm-10"},qe=["id","value"],Oe=["for"],Ae=_(()=>t("br",null,null,-1)),Ue=_(()=>t("hr",null,null,-1)),Fe=_(()=>t("div",{class:"mb-2"},[b(" Set your mapset's difficulties "),t("div",{class:"small text-secondary"}," These can be changed later. ")],-1)),Qe={key:0,class:"table table-sm"},Ve=_(()=>t("thead",null,[t("tr",null,[t("th",null,"Difficulty"),t("th",null,"Mapper(s)"),t("th",null,"Status"),t("th")])],-1)),De={class:"text-secondary"},Ee=["onClick"],Ne=_(()=>t("i",{class:"fas fa-times"},null,-1)),He=[Ne],Ge={class:"col-sm-12"},je={class:"input-group input-group-sm mx-auto"},Re=_(()=>t("option",{value:"",disabled:"",selected:""}," Select a task ",-1)),We=["value"],ze=_(()=>t("option",{value:"osu"}," osu! ",-1)),Ke=_(()=>t("option",{value:"taiko"}," osu!taiko ",-1)),Ye=_(()=>t("option",{value:"catch"}," osu!catch ",-1)),Xe=_(()=>t("option",{value:"mania"}," osu!mania ",-1)),Je=[ze,Ke,Ye,Xe],Ze=_(()=>t("option",{value:"",disabled:"",selected:""}," Select a status ",-1)),xe=_(()=>t("option",{value:"WIP"}," Work-in-progress ",-1)),es=_(()=>t("option",{value:"Done"}," Done ",-1)),ss=[Ze,xe,es],ts=_(()=>t("i",{class:"fas fa-plus"},null,-1)),as=[ts],os={class:"text-secondary small mt-1"},is={class:"small"},ns=_(()=>t("li",null,'You can leave the "mapper" field empty for your own difficulties.',-1)),ls=_(()=>t("li",null,'Use comma separation for collabs, like "mapper1, mapper2".',-1)),ds=_(()=>t("li",null,'There can only be one entry for "Storyboard" and "Hitsounds".',-1)),rs={key:0},us=_(()=>t("hr",null,null,-1)),ps=_(()=>t("div",{class:"mb-2"},[b(" Set any difficulties that nobody else is allowed to claim. "),t("div",{class:"small text-secondary"}," For example, if you don't want any guest difficulties, you should select all. These can be changed later. ")],-1)),cs={class:"mb-3 row"},ms={class:"col-sm-10"},hs=["id","value"],fs=["for"],bs=_(()=>t("div",{class:"radial-divisor"},null,-1)),_s={class:"small text-secondary mt-2"},ks={class:"small"},$s=_(()=>t("i",null,"after",-1)),gs=_(()=>t("li",null,[b("Your beatmap was ranked "),t("i",null,"after"),b(" the Featured Artist was announced, excluding maps created for the announcement")],-1)),ys=_(()=>t("li",null,"Difficulties match between Mappers' Guild and osu! website (including difficulty levels and mappers)",-1)),vs=_(()=>t("li",null,[t("b",null,"Try to get permission for your map's background."),b(" It's unrealistic (and annoying to mappers) to police all background usage, but if you support the goal of the Mappers' Guild, please use appropriately permitted backgrounds. At minimum, your background should not contain content from other media franchises (like Mikasa from Attack on Titan), excluding creative commons content (like Hatsune Miku) or content permitted by franchise owners (like Touhou).")],-1));function Bs(e,s,o,l,u,m){const r=f("modes-icons"),n=f("user-link-list"),p=f("modal-dialog"),g=T("bs-tooltip");return a(),I(p,{id:"addBeatmap",title:"Add beatmap"},{default:q(()=>[t("div",he,[t("div",fe,[be,t("div",_e,[t("div",ke,[$(t("select",{"onUpdate:modelValue":s[0]||(s[0]=d=>e.selectedArtist=d),class:"form-select"},[$e,ge,(a(!0),i(w,null,B(e.featuredArtists,d=>(a(),i("option",{key:d.id,value:d.id},h(d.label),9,ye))),128))],512),[[P,e.selectedArtist]]),$(t("input",{"onUpdate:modelValue":s[1]||(s[1]=d=>e.artistInput=d),type:"text",class:"form-control",placeholder:"or input the artist's name...",onKeyup:s[2]||(s[2]=E(d=>e.setArtist(d),["enter"]))},null,544),[[D,e.artistInput]]),t("button",{id:"artistButton",class:"btn btn-outline-info",onClick:s[3]||(s[3]=d=>e.setArtist(d))}," Load songs ")])]),ve,t("div",Be,[$(t("select",{"onUpdate:modelValue":s[4]||(s[4]=d=>e.selectedSong=d),class:"form-select form-select-sm",disabled:!e.featuredSongs.length},[Me,Ie,(a(!0),i(w,null,B(e.featuredSongs,d=>(a(),i("option",{key:d.id,value:d.id},h(d.title)+" --- ("+h(d.artist)+") ",9,Le))),128))],8,we),[[P,e.selectedSong]])])]),Te,Se,t("div",Ce,[t("div",Pe,[(a(!0),i(w,null,B(e.modes,d=>(a(),i("div",{key:d.value,class:"form-check form-check-inline"},[$(t("input",{id:d.value,"onUpdate:modelValue":s[5]||(s[5]=S=>e.selectedMode=S),class:"form-check-input",type:"radio",value:d.value},null,8,qe),[[ne,e.selectedMode]]),t("label",{class:"form-check-label",for:d.value},h(d.name),9,Oe)]))),128)),Ae])]),Ue,Fe,e.tempTasks.length?(a(),i("table",Qe,[Ve,k(H,{tag:"tbody",name:"list"},{default:q(()=>[(a(!0),i(w,null,B(e.tempTasks,d=>(a(),i("tr",{key:d.random},[t("td",De,[b(h(d.name)+" ",1),e.selectedMode=="hybrid"?(a(),I(r,{key:0,modes:[d.mode],color:"secondary"},null,8,["modes"])):c("",!0)]),t("td",null,[k(n,{users:d.mappers},null,8,["users"])]),t("td",{class:M(d.status=="WIP"?"text-wip":"text-success")},h(d.status),3),t("td",null,[$((a(),i("a",{href:"#",class:"text-danger",onClick:S=>e.removeTempTask(d.random)},He,8,Ee)),[[g,"delete"]])])]))),128))]),_:1})])):c("",!0),t("div",Ge,[t("div",je,[$(t("select",{"onUpdate:modelValue":s[6]||(s[6]=d=>e.newTaskName=d),class:"form-select"},[Re,(a(!0),i(w,null,B(e.filteredTasks,d=>(a(),i("option",{key:d,value:d},h(d),9,We))),128))],512),[[P,e.newTaskName]]),e.selectedMode=="hybrid"?$((a(),i("select",{key:0,"onUpdate:modelValue":s[7]||(s[7]=d=>e.selectedTaskMode=d),class:"form-select"},Je,512)),[[P,e.selectedTaskMode]]):c("",!0),$(t("select",{"onUpdate:modelValue":s[8]||(s[8]=d=>e.selectedTaskStatus=d),class:"form-select"},ss,512),[[P,e.selectedTaskStatus]]),$(t("input",{"onUpdate:modelValue":s[9]||(s[9]=d=>e.newTaskMapper=d),class:"form-control",type:"text",placeholder:"mapper name or osu! ID...",onKeyup:s[10]||(s[10]=E(d=>e.addTempTask(d),["enter"]))},null,544),[[D,e.newTaskMapper]]),$((a(),i("button",{class:"btn btn-outline-info",onClick:s[11]||(s[11]=d=>e.addTempTask(d))},as)),[[g,"add difficulty"]])]),t("div",os,[t("ul",is,[ns,ls,ds,e.selectedMode=="taiko"?(a(),i("li",rs,' "Hitsounds" cannot be added to osu!taiko. ')):c("",!0)])])]),us,ps,t("div",cs,[t("div",ms,[(a(!0),i(w,null,B(e.filteredTasks,d=>(a(),i("div",{key:d,class:"form-check"},[$(t("input",{id:`lock-${d}`,"onUpdate:modelValue":s[12]||(s[12]=S=>e.checkedLocks=S),class:"form-check-input",type:"checkbox",value:d},null,8,hs),[[le,e.checkedLocks]]),t("label",{class:"form-check-label",for:`lock-${d}`},h(d),9,fs)]))),128))])])]),t("button",{type:"submit",class:"btn btn-outline-success w-100",onClick:s[13]||(s[13]=d=>e.saveNewMap(d))}," Create beatmap "),bs,t("div",_s,[t("div",ks,[b(" Note that you can only earn points for beatmaps that fit these requirements: "),t("ul",null,[t("li",null,[b("Your beatmap was ranked "),$s,b(" you joined the Mappers' Guild ("),t("code",null,h(e.loggedInUser.createdAt),1),b(")")]),gs,ys,vs])])])]),_:1})}const ws=v(me,[["render",Bs],["__scopeId","data-v-fcc1500e"]]),Ms=y({name:"BeatmapPageFilters",components:{FilterBox:ue,ModeFilters:pe},data(){return{statuses:{any:"Any",WIP:"WIP",Done:"Done",Qualified:"Qualified",Ranked:"Ranked"},quests:{any:"Any",none:"None"}}},computed:O("beatmaps",["filterMode","filterValue","filterStatus","filterQuest"]),methods:{...de("beatmaps",["updateFilterValue","updateFilterMode","updateFilterStatus","updateFilterQuest"]),getStatusSortClass(e){return this.filterStatus===e?"sorted":"unsorted"},getQuestSortClass(e){return this.filterQuest===e?"sorted":"unsorted"}}}),Is={class:"container card card-body py-3 mb-2"},Ls=t("button",{class:"btn btn-primary",href:"#","data-bs-toggle":"modal","data-bs-target":"#addBeatmap"},[b(" Add beatmap "),t("i",{class:"fas fa-plus fa-xs"})],-1),Ts={class:"row mt-3"},Ss=t("div",{class:"col-auto filter-title"}," Status ",-1),Cs={class:"col"},Ps=["onClick"],qs={class:"row mt-3"},Os=t("div",{class:"col-auto filter-title"}," Quest ",-1),As={class:"col"},Us=["onClick"];function Fs(e,s,o,l,u,m){const r=f("mode-filters"),n=f("filter-box");return a(),i("div",Is,[k(n,{placeholder:"enter to search for song/username...","filter-value":e.filterValue,"onUpdate:filterValue":s[1]||(s[1]=p=>e.updateFilterValue(p))},{filters:q(()=>[k(r,{"filter-mode":e.filterMode,"onUpdate:filterMode":s[0]||(s[0]=p=>e.updateFilterMode(p))},null,8,["filter-mode"]),t("div",Ts,[Ss,t("div",Cs,[(a(!0),i(w,null,B(e.statuses,(p,g)=>(a(),i("a",{key:g,href:"#",class:M(["status",e.getStatusSortClass(g)]),onClick:L(d=>e.updateFilterStatus(g),["prevent"])},h(p),11,Ps))),128))])]),t("div",qs,[Os,t("div",As,[(a(!0),i(w,null,B(e.quests,(p,g)=>(a(),i("a",{key:g,href:"#",class:M(["quest",e.getQuestSortClass(g)]),onClick:L(d=>e.updateFilterQuest(g),["prevent"])},h(p),11,Us))),128))])])]),default:q(()=>[Ls]),_:1},8,["filter-value"])])}const Qs=v(Ms,[["render",Fs]]);function Q(e,s,o){const l={class:["px-1","text-"+s.toLowerCase()]};return o&&(l["data-bs-toggle"]="tooltip",l["data-bs-placement"]="top",l.title=o),N("span",l,e)}const x=y({props:{tasks:{type:Array,required:!0},tasksLocked:{type:Array,required:!0},mode:{type:String,required:!0}},render(){const e=[{name:"Easy",short:"E",locked:!1,status:[]},{name:"Normal",short:"N",locked:!1,status:[]},{name:"Hard",short:"H",locked:!1,status:[]},{name:"Insane",short:"I",locked:!1,status:[]},{name:"Expert",short:"X",locked:!1,status:[]}],s=[{name:"osu",short:"circle",count:0,status:A.Done},{name:"taiko",short:"drum",count:0,status:A.Done},{name:"catch",short:"apple-alt",count:0,status:A.Done},{name:"mania",short:"stream",count:0,status:A.Done}],o=[],l=this.tasks.length>=10,u=this.mode===U.Hybrid;for(const m of e){let r=!1;const n=this.tasksLocked.includes(m.name);for(const p of this.tasks)if(m.name===p.name){m.status.push(p.status),r=!0;const g=s.findIndex(d=>d.name===p.mode);g!==-1&&(s[g].count++,p.status===A.WIP&&(s[g].status=A.WIP))}if(!u){if(l&&m.status.length>1)o.push(Q(m.short+"+","secondary",m.status.length.toString()));else for(const p of m.status)o.push(Q(m.short,p));r||o.push(Q(m.short,n?"blocked":"open"))}}if(u)for(const m of s)o.push(Q([N("i",{class:["fas","fa-"+m.short]})],m.count?m.status:"blocked",m.count.toString()));return N("span",{class:"fw-bold"},o)}}),Vs=y({props:{beatmap:{type:Object,required:!0}},computed:{url(){var e;if(this.beatmap.mission)switch(this.beatmap.mission.tier){case 1:return"/images/dark-bronze.png";case 2:return"/images/dark-silver.png";case 3:return"/images/dark-gold.png";case 4:return"/images/dark-platinum.png";default:return"/images/dark-bronze.png"}return this.beatmap.isShowcase||!((e=this.beatmap.quest)!=null&&e.art)?"/images/no-art-icon.png":this.beatmap.quest.isMbc?"/images/mbc-icon.png":`https://assets.ppy.sh/artists/${this.beatmap.quest.art}/cover.jpg`}}});const Ds=["src"];function Es(e,s,o,l,u,m){const r=T("bs-tooltip");return e.beatmap.quest||e.beatmap.mission||e.beatmap.isShowcase?$((a(),i("img",{key:e.$route.query.id,class:"rounded-circle me-1 quest-icon",src:e.url},null,8,Ds)),[[r,e.beatmap.quest&&e.beatmap.quest.name||e.beatmap.mission&&e.beatmap.mission.name||"FA showcase"]]):c("",!0)}const j=v(Vs,[["render",Es],["__scopeId","data-v-c16b6cea"]]),Ns=y({name:"BeatmapCard",components:{ProcessTasks:x,QuestImg:j,ModesIcons:V},props:{beatmap:{type:Object,required:!0}},emits:["update:selectedBeatmap"],data(){return{defaultUrl:"https://osu.ppy.sh/images/layout/beatmaps/default-bg.png"}},computed:{statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}},methods:{fallbackImage(e){e.target.src=this.defaultUrl},formatMetadata(e,s){return e+" - "+s},processUrl(e){if(e&&e.indexOf("osu.ppy.sh/beatmapsets/")!==-1){const s=e.indexOf("beatmapsets/")+12,o=e.indexOf("#");let l;return o!==-1?l=e.slice(s,o):l=e.slice(s),`https://assets.ppy.sh/beatmaps/${l}/covers/card.jpg`}else return this.defaultUrl}}});const Hs=["src"],Gs={class:"card-img-overlay",style:{padding:"0.50rem 0.50rem 0 0.50rem"}},js={class:"card-title mb-1 text-truncate"},Rs={class:"card-text"};function Ws(e,s,o,l,u,m){const r=f("quest-img"),n=f("user-link"),p=f("modes-icons"),g=f("process-tasks");return a(),i("div",{class:"my-2 col-sm-12 col-md-6 col-lg-4",onClick:s[1]||(s[1]=d=>e.$emit("update:selectedBeatmap",e.beatmap))},[t("div",{class:M(["card card-hover map-card bg-dark",e.statusBorder]),"data-bs-toggle":"modal","data-bs-target":"#editBeatmap"},[t("img",{class:"card-img",src:e.processUrl(e.beatmap.url),style:{opacity:"0.2"},onError:s[0]||(s[0]=d=>e.fallbackImage(d))},null,40,Hs),t("div",Gs,[t("p",js,h(e.formatMetadata(e.beatmap.song.artist,e.beatmap.song.title)),1),t("small",Rs,[k(r,{beatmap:e.beatmap},null,8,["beatmap"]),b(" Hosted by "),k(n,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),I(p,{key:0,modes:[e.beatmap.mode]},null,8,["modes"])):c("",!0),k(g,{class:"float-end pt-1",tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])])])],2)])}const ee=v(Ns,[["render",Ws],["__scopeId","data-v-87c36204"]]),zs=y({components:{BeatmapCard:ee},computed:X("beatmaps",["hostedBeatmaps"]),methods:J("beatmaps",["setSelectedBeatmap"])}),Ks={class:"container card card-body py-3"},Ys={class:"ms-2"},Xs={href:"#hostedBeatmaps","data-bs-toggle":"collapse"},Js=t("i",{class:"fas fa-angle-down"},null,-1),Zs={key:0,id:"hostedBeatmaps",class:"show"},xs={key:0,class:"ms-5 text-secondary"};function et(e,s,o,l,u,m){const r=f("beatmap-card");return a(),i("div",Ks,[t("h5",Ys,[t("a",Xs,[b(" My mapsets ("+h(e.hostedBeatmaps?e.hostedBeatmaps.length:"...")+") ",1),Js])]),e.hostedBeatmaps?(a(),i("div",Zs,[k(H,{name:"list",tag:"div",class:"row"},{default:q(()=>[(a(!0),i(w,null,B(e.hostedBeatmaps,n=>(a(),I(r,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":s[0]||(s[0]=p=>e.setSelectedBeatmap(p))},null,8,["beatmap"]))),128))]),_:1}),e.hostedBeatmaps.length?c("",!0):(a(),i("p",xs," None... "))])):c("",!0)])}const st=v(zs,[["render",et]]),tt=y({components:{BeatmapCard:ee},props:{isLoadingGuestBeatmaps:Boolean},computed:X("beatmaps",["guestDifficultyBeatmaps"]),methods:J("beatmaps",["setSelectedBeatmap"])}),at={class:"container card card-body py-3"},ot={class:"ms-2"},it={href:"#guestDifficultyBeatmaps","data-bs-toggle":"collapse"},nt=t("i",{class:"fas fa-angle-down"},null,-1),lt={key:0,class:"ms-5 text-secondary"};function dt(e,s,o,l,u,m){const r=f("beatmap-card");return a(),i("div",at,[t("h5",ot,[t("a",it,[b(" My guest difficulties ("+h(e.guestDifficultyBeatmaps&&!e.isLoadingGuestBeatmaps?e.guestDifficultyBeatmaps.length:"...")+") ",1),nt])]),e.guestDifficultyBeatmaps?(a(),i("div",{key:0,id:"guestDifficultyBeatmaps",class:M(["collapse",{"loading-data":e.isLoadingGuestBeatmaps}])},[!e.guestDifficultyBeatmaps.length&&!e.isLoadingGuestBeatmaps?(a(),i("p",lt," None... ")):c("",!0),k(H,{name:"list",tag:"div",class:"row"},{default:q(()=>[(a(!0),i(w,null,B(e.guestDifficultyBeatmaps,n=>(a(),I(r,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":s[0]||(s[0]=p=>e.setSelectedBeatmap(p))},null,8,["beatmap"]))),128))]),_:1})],2)):c("",!0)])}const rt=v(tt,[["render",dt]]),ut=y({name:"ModeChoice",props:{beatmap:{type:Object,required:!0}},data(){return{selectedMode:this.beatmap.mode,showInput:!1,modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}]}},methods:{async setMode(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setMode`,{mode:this.selectedMode},e);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),this.showInput=!1}}}),pt={id:"mode"},ct={class:"row mb-2"},mt={class:"col"},ht=t("i",{class:"fas fa-edit"},null,-1),ft=[ht],bt={class:"small ms-3 text-secondary"},_t={key:0,class:"row mb-2"},kt={class:"col"},$t={class:"input-group input-group-sm"},gt=["value"];function yt(e,s,o,l,u,m){const r=T("bs-tooltip");return a(),i("div",pt,[t("div",ct,[t("div",mt,[t("div",null,[b(" Mode "),$((a(),i("a",{id:"editMode",href:"#",class:M([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:s[0]||(s[0]=L(n=>e.showInput=!e.showInput,["prevent"]))},ft,2)),[[r,"edit mode","right"]])]),t("div",bt,h(e.beatmap.mode=="hybrid"?"Multiple modes":e.beatmap.mode=="osu"?"osu!":"osu!"+e.beatmap.mode),1)])]),e.showInput?(a(),i("div",_t,[t("div",kt,[t("div",$t,[$(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.selectedMode=n),class:"form-select"},[(a(!0),i(w,null,B(e.modes,n=>(a(),i("option",{key:n.value,value:n.value},h(n.name),9,gt))),128))],512),[[P,e.selectedMode]]),$((a(),i("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.setMode(n))},[b(" Save ")])),[[r,"link beatmap to quest"]])])])])):c("",!0)])}const vt=v(ut,[["render",yt]]),Bt=y({name:"StatusChoice",props:{beatmap:{type:Object,required:!0}},methods:{async setStatus(e,s){const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setStatus`,{status:e},s);this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o)}}}),wt={id:"mapsetStatus"},Mt=t("div",{class:"d-inline-block me-2"}," Status ",-1),It=["disabled"],Lt=["disabled"],Tt={class:"small text-secondary"},St=t("div",{class:"small text-secondary mt-1"},[t("div",{class:"small"},' Maps marked as "Done" will be processed for points when they reach the Ranked category on osu!. ')],-1);function Ct(e,s,o,l,u,m){const r=T("bs-tooltip");return a(),i("div",wt,[Mt,$((a(),i("button",{class:M(["btn btn-sm me-1",e.beatmap.status=="WIP"?"btn-warning":"btn-outline-warning"]),disabled:e.beatmap.status=="WIP",onClick:s[0]||(s[0]=n=>e.setStatus("WIP",n))},[b(" WIP ")],10,It)),[[r,"mark mapset as work-in-progress","bottom"]]),$((a(),i("button",{class:M(["btn btn-sm me-1",e.beatmap.status=="Done"?"btn-success":"btn-outline-success"]),disabled:e.beatmap.status=="Done",onClick:s[1]||(s[1]=n=>e.setStatus("Done",n))},[b(" Done ")],10,Lt)),[[r,"mark mapset and all diffs as done","bottom"]]),t("span",Tt,'(currently "'+h(e.beatmap.status)+'")',1),St])}const Pt=v(Bt,[["render",Ct]]),qt=y({name:"QuestOrMissionChoice",props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:[],openMissions:[],showInput:!1,dropdownId:""}},computed:O(["loggedInUser"]),watch:{async beatmap(){var s,o;this.showInput=!1,this.dropdownId=((s=this.beatmap.quest)==null?void 0:s.id)||((o=this.beatmap.mission)==null?void 0:o.id)||"";const e=await this.$http.executeGet(`/missions/open/${this.beatmap.mode}/${this.beatmap.id}`);this.$http.isError(e)||(this.openMissions=e)}},async created(){const e=await this.$http.executeGet(`/users/${this.loggedInUser.id}/quests`),s=await this.$http.executeGet(`/missions/open/${this.beatmap.mode}/${this.beatmap.id}`);this.$http.isError(e)||(this.userQuests=e),this.$http.isError(s)||(this.openMissions=s)},methods:{async linkQuestOrMission(e){const s=this.userQuests.find(l=>l.id==this.dropdownId),o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/${s?"linkQuest":"linkMission"}`,{questOrMissionId:this.dropdownId},e);this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o)}}}),Ot={class:"row mb-2"},At={class:"col"},Ut=t("i",{class:"fas fa-edit"},null,-1),Ft=[Ut],Qt={class:"small ms-3 text-secondary"},Vt=["href"],Dt=["href"],Et={key:2},Nt={key:0,class:"row mb-2"},Ht={class:"col"},Gt={class:"input-group input-group-sm"},jt=t("option",{value:""}," No quest ",-1),Rt={key:0,disabled:""},Wt=["value"],zt={key:1,disabled:""},Kt=["value"];function Yt(e,s,o,l,u,m){const r=T("bs-tooltip");return a(),i("div",null,[t("div",Ot,[t("div",At,[t("div",null,[b(" Quest "),$((a(),i("a",{id:"editLink",href:"#",class:M([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:s[0]||(s[0]=L(n=>e.showInput=!e.showInput,["prevent"]))},Ft,2)),[[r,"connect mapset with a quest","right"]])]),t("div",Qt,[e.beatmap.quest?(a(),i("a",{key:0,href:`/quests?id=${e.beatmap.quest.id}`},h(e.beatmap.quest.name),9,Vt)):e.beatmap.mission?(a(),i("a",{key:1,href:`/missions?id=${e.beatmap.mission.id}`},h(e.beatmap.mission.name),9,Dt)):(a(),i("i",Et,"none"))])])]),e.showInput?(a(),i("div",Nt,[t("div",Ht,[t("div",Gt,[$(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.dropdownId=n),class:"form-select"},[jt,e.userQuests.length?(a(),i("option",Rt," --- claimed quests --- ")):c("",!0),(a(!0),i(w,null,B(e.userQuests,n=>(a(),i("option",{key:n.id,value:n.id},h(n.name),9,Wt))),128)),e.openMissions.length?(a(),i("option",zt," --- open priority quests --- ")):c("",!0),(a(!0),i(w,null,B(e.openMissions,n=>(a(),i("option",{key:n.id,value:n.id},h(n.name),9,Kt))),128))],512),[[P,e.dropdownId]]),$((a(),i("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.linkQuestOrMission(n))},[b(" Save ")])),[[r,"link beatmap to quest"]])])])])):c("",!0)])}const Xt=v(qt,[["render",Yt]]),Jt=y({name:"ModdersList",components:{UserLinkList:G},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...O(["loggedInUser"]),isModder(){return this.beatmap.modders.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateModder(e){e.target.classList.add("fake-button-disable");const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateModder`);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),e.target.classList.remove("fake-button-disable")}}}),Zt={id:"modders",class:"row mb-2"},xt={class:"col"},ea={key:0,class:"ms-1"},sa={class:"small ms-3"},ta={key:0,class:"text-secondary"};function aa(e,s,o,l,u,m){const r=f("user-link-list"),n=T("bs-tooltip");return a(),i("div",Zt,[t("div",xt,[t("div",null,[b(" Modders ("+h(e.beatmap.modders.length)+") ",1),e.canEdit?$((a(),i("small",ea,[t("a",{href:"#",class:M(e.isModder?"text-danger":"text-success"),onClick:s[0]||(s[0]=L(p=>e.updateModder(p),["prevent"]))},[t("i",{class:M(["fas",e.isModder?"fa-minus":"fa-plus"])},null,2)],2)])),[[n,"add/remove yourself from modder list","right"]]):c("",!0)]),t("div",sa,[e.beatmap.modders.length==0?(a(),i("i",ta," none ")):(a(),I(r,{key:1,users:e.beatmap.modders},null,8,["users"]))])])])}const oa=v(Jt,[["render",aa]]),ia=y({name:"NominatorsList",components:{UserLinkList:G},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...O(["loggedInUser"]),isBn(){return this.beatmap.bns.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateBn(e){e.target.classList.add("fake-button-disable");const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateBn`);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),e.target.classList.remove("fake-button-disable")}}}),na={key:0,class:"ms-1"},la=t("i",{class:"fas fa-minus"},null,-1),da=[la],ra=t("i",{class:"fas fa-plus"},null,-1),ua=[ra],pa={class:"small ms-3"},ca={key:0,class:"text-secondary"};function ma(e,s,o,l,u,m){const r=f("user-link-list"),n=T("bs-tooltip");return a(),i("div",null,[t("div",null,[b(" Nominators ("+h(e.beatmap.bns.length)+") ",1),e.canEdit?$((a(),i("small",na,[e.isBn?(a(),i("a",{key:0,href:"#",class:"text-danger",onClick:s[0]||(s[0]=L(p=>e.updateBn(p),["prevent"]))},da)):c("",!0),!e.isBn&&e.beatmap.bns.length<2?(a(),i("a",{key:1,href:"#",class:"text-success",onClick:s[1]||(s[1]=L(p=>e.updateBn(p),["prevent"]))},ua)):c("",!0)])),[[n,"add/remove yourself from potential BN list","right"]]):c("",!0)]),t("div",pa,[e.beatmap.bns.length==0?(a(),i("i",ca,"none")):(a(),I(r,{key:1,users:e.beatmap.bns},null,8,["users"]))])])}const ha=v(ia,[["render",ma]]),fa=y({name:"BeatmapLink",props:{beatmap:{type:Object,required:!0}},data(){return{url:"",showLinkInput:!1}},watch:{beatmap(e){e&&(this.showLinkInput=!1,this.url=e.url)}},created(){this.url=this.beatmap.url},methods:{async saveLink(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setLink`,{url:this.url},e);this.$http.isError(s)||(this.showLinkInput=!1,this.$store.dispatch("beatmaps/updateBeatmap",s))}}}),ba={class:"row mb-2"},_a={class:"col"},ka=t("i",{class:"fas fa-edit"},null,-1),$a=[ka],ga={class:"small ms-3"},ya=["href"],va={key:1,class:"text-secondary"},Ba={key:0,class:"row mb-2"},wa={class:"col-sm-12"},Ma={class:"input-group input-group-sm"};function Ia(e,s,o,l,u,m){const r=T("bs-tooltip");return a(),i("div",null,[t("div",ba,[t("div",_a,[t("div",null,[b(" Link "),$((a(),i("a",{id:"editLink",href:"#",class:M(["text-success small ms-1",{"text-danger":e.showLinkInput}]),onClick:s[0]||(s[0]=L(n=>e.showLinkInput=!e.showLinkInput,["prevent"]))},$a,2)),[[r,"edit link","right"]])]),t("div",ga,[e.beatmap.url?(a(),i("a",{key:0,href:e.beatmap.url,target:"_blank",class:"text-truncate",style:{display:"block"}},h(e.beatmap.url),9,ya)):(a(),i("i",va,"none"))])])]),e.showLinkInput?(a(),i("div",Ba,[t("div",wa,[t("div",Ma,[$(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.url=n),class:"form-control form-control-sm",type:"text",placeholder:"URL",onKeyup:s[2]||(s[2]=E(n=>e.saveLink(n),["enter"]))},null,544),[[D,e.url]]),t("button",{id:"addLinkButton",class:"btn btn-outline-info",type:"submit",onClick:s[3]||(s[3]=n=>e.saveLink(n))}," Save ")])])])):c("",!0)])}const La=v(fa,[["render",Ia]]),Ta=y({name:"LocksChoice",props:{beatmap:{type:Object,required:!0},beatmapId:{type:String,required:!0}},data(){return{lockTaskSelection:"",showLocksInput:!1,phaseEdit:!1}},computed:{remainingTasks(){var s,o;let e=F;return(o=(s=this.beatmap)==null?void 0:s.tasksLocked)!=null&&o.length&&(e=e.filter(l=>!this.beatmap.tasksLocked.includes(l))),this.beatmap.mode==U.Taiko&&(e=e.filter(l=>l!==C.Hitsounds)),e}},watch:{beatmapId(){this.showLocksInput=!1},beatmap(){this.beatmap.tasksLocked.length>=6&&(this.showLocksInput=!1)}},methods:{async unlockTask(e,s){s.target.classList.add("fake-button-disable");const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/unlockTask`,{task:e});this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o),s.target.classList.remove("fake-button-disable")},async lockTask(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/lockTask`,{task:this.lockTaskSelection},e);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s)}}}),Sa={id:"locks",class:"row mb-1"},Ca={class:"col"},Pa=t("i",{class:"fas fa-edit"},null,-1),qa=[Pa],Oa={class:"small ms-3"},Aa={key:0},Ua={key:1},Fa=["onClick"],Qa=t("i",{class:"fas fa-minus"},null,-1),Va=[Qa],Da={class:"text-secondary mx-1"},Ea={key:0,class:"row"},Na={class:"col"},Ha={class:"input-group input-group-sm"},Ga=["value"],ja=t("i",{class:"fas fa-lock"},null,-1),Ra=[ja];function Wa(e,s,o,l,u,m){const r=T("bs-tooltip");return a(),i("div",null,[t("div",Sa,[t("div",Ca,[t("div",null,[b(" Locks "),(e.beatmap.mode=="taiko"?e.beatmap.tasksLocked.length<6:e.beatmap.tasksLocked.length<7)?$((a(),i("a",{key:0,class:M(["text-success small ms-1",{"text-danger":e.showLocksInput}]),href:"#",onClick:s[0]||(s[0]=L(n=>e.showLocksInput=!e.showLocksInput,["prevent"]))},qa,2)),[[r,"edit locks","right"]]):c("",!0)]),t("div",Oa,[e.beatmap.tasksLocked.length==0?(a(),i("i",Aa,"none")):c("",!0),e.beatmap.tasksLocked.length>0?(a(),i("div",Ua,[(a(!0),i(w,null,B(e.beatmap.tasksLocked,n=>(a(),i("div",{key:n},[$((a(),i("a",{href:"#",class:M(["text-danger",e.phaseEdit?"fake-button-disable":""]),onClick:L(p=>e.unlockTask(n,p),["prevent"])},Va,10,Fa)),[[r,"unlock","left"]]),t("span",Da,h(n),1)]))),128))])):c("",!0)])])]),e.showLocksInput?(a(),i("div",Ea,[t("div",Na,[t("div",Ha,[$(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.lockTaskSelection=n),class:"form-select"},[(a(!0),i(w,null,B(e.remainingTasks,n=>(a(),i("option",{key:n,value:n},h(n),9,Ga))),128))],512),[[P,e.lockTaskSelection]]),$((a(),i("button",{id:"lockTask",class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.lockTask(n))},Ra)),[[r,"prevent other mappers from claiming a difficulty","right"]])])])])):c("",!0)])}const za=v(Ta,[["render",Wa]]),Ka=y({name:"Points",props:{beatmap:{type:Object,required:!0}},data(){return{tasksPointsArray:null,usersPointsArrays:null,pointsInfo:null,totalPoints:null,bnPoints:null,isLoading:!1}},watch:{beatmap(){this.tasksPointsArray=null,this.usersPointsArrays=null,this.pointsInfo=null,this.totalPoints=null,this.bnPoints=null,this.isLoading=!1}},methods:{async findPoints(e){this.isLoading=!0;const s=await this.$http.executeGet(`/beatmaps/${this.beatmap.id}/findPoints`,e);this.$http.isError(s)||(this.tasksPointsArray=s.tasksPointsArray,this.usersPointsArrays=s.usersPointsArrays,this.pointsInfo=s.pointsInfo,this.totalPoints=s.totalPoints,this.bnPoints=s.bnPoints),this.isLoading=!1}}}),Ya={class:"row"},Xa={class:"col-sm-12"},Ja={key:1,class:"small text-danger"},Za={key:0},xa={key:2,class:"small text-secondary ms-2"},eo={key:3,class:"small text-secondary ms-2"},so={key:0,class:"col-sm-6"},to={class:"small text-secondary"},ao=t("li",null,"Map host: 3",-1),oo={class:"col-sm-6"},io={key:0,class:"small text-secondary"},no={key:1,class:"col-sm-12"},lo={class:"small text-secondary ms-2"};function ro(e,s,o,l,u,m){const r=T("bs-tooltip");return a(),i("div",null,[t("div",Ya,[t("div",Xa,[!e.tasksPointsArray&&!e.beatmap.invalidForPoints?$((a(),i("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:s[0]||(s[0]=n=>e.findPoints(n))},[b(" Calculate points ")])),[[r,"calculate points for all difficulties"]]):c("",!0),e.beatmap.invalidForPoints?(a(),i("div",Ja,[b(" This beatmap is ineligible for points "),e.beatmap.invalidReason?(a(),i("span",Za,[b(" for the following reason: "),t("i",null,h(e.beatmap.invalidReason),1)])):c("",!0)])):c("",!0),e.isLoading?(a(),i("div",xa," calculating... ")):e.pointsInfo?(a(),i("div",eo,h(e.pointsInfo),1)):c("",!0)]),e.tasksPointsArray?(a(),i("div",so,[t("ul",to,[(a(!0),i(w,null,B(e.tasksPointsArray,(n,p)=>(a(),i("li",{key:p},h(n),1))),128)),t("li",null,"BN mod/nomination: "+h(e.bnPoints),1),ao])])):c("",!0),t("div",oo,[e.usersPointsArrays?(a(),i("ul",io,[(a(!0),i(w,null,B(e.usersPointsArrays,(n,p)=>(a(),i("li",{key:p},h(e.usersPointsArrays[p][0])+": "+h(e.usersPointsArrays[p][0]==e.beatmap.host.username?e.usersPointsArrays[p][1]+5:e.usersPointsArrays[p][1]),1))),128))])):c("",!0)]),e.totalPoints?(a(),i("div",no,[t("span",lo," total: "+h(Math.round(e.totalPoints*10)/10+5),1)])):c("",!0)])])}const uo=v(Ka,[["render",ro]]),po=y({name:"BeatmapInfo",components:{ModeChoice:vt,StatusChoice:Pt,TasksChoice:ce,QuestOrMissionChoice:Xt,ModdersList:oa,NominatorsList:ha,BeatmapLink:La,LocksChoice:za,Points:uo},props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:null}},computed:{...O(["loggedInUser"]),isHost(){return this.loggedInUser.id&&this.beatmap?this.loggedInUser.id===this.beatmap.host.id:!1},isRanked(){return this.beatmap.status===W.Ranked},isQualified(){return this.beatmap.status===W.Qualified}},methods:{async deleteMap(e){if(confirm("Are you sure you want to delete?")){e.target.disabled=!0;const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/delete`,{},e);this.$http.isError(o)||(this.$bs.hideModal("editBeatmap"),this.$store.commit("beatmaps/deleteBeatmap",o)),e.target.disabled=!1}}}});const R=e=>(K("data-v-4727d833"),e=e(),Y(),e),co={key:0,class:"container"},mo={class:"row"},ho={class:"row mb-2"},fo={class:"col-sm-6"},bo={key:0,id:"bns",class:"col-sm-6"},_o=R(()=>t("hr",null,null,-1)),ko={class:"row"},$o={class:"col-sm"},go={key:0,class:"col-lg-5 bm-col-separator-left"},yo={key:0,class:"row"},vo={class:"col-sm"},Bo=R(()=>t("hr",null,null,-1)),wo={class:"row"},Mo={class:"col-sm"},Io=R(()=>t("hr",null,null,-1)),Lo={class:"row"},To={class:"col-sm-4 text-end"},So={class:"small text-secondary"};function Co(e,s,o,l,u,m){const r=f("modders-list"),n=f("nominators-list"),p=f("tasks-choice"),g=f("status-choice"),d=f("mode-choice"),S=f("quest-or-mission-choice"),te=f("beatmap-link"),ae=f("locks-choice"),oe=f("points");return e.beatmap?(a(),i("div",co,[t("div",mo,[t("div",{class:M(e.isHost&&!e.isRanked?"col-lg-7":"col-sm-12")},[t("div",ho,[t("div",fo,[k(r,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])]),!e.isRanked||e.beatmap.bns?(a(),i("div",bo,[k(n,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])])):c("",!0)]),_o,t("div",ko,[t("div",$o,[k(p,{beatmap:e.beatmap,"is-host":e.isHost,"is-ranked":e.isRanked,"is-qualified":e.isQualified},null,8,["beatmap","is-host","is-ranked","is-qualified"])])])],2),e.isHost&&!e.isRanked?(a(),i("div",go,[e.isQualified?c("",!0):(a(),i("div",yo,[t("div",vo,[k(g,{beatmap:e.beatmap},null,8,["beatmap"]),Bo])])),t("div",wo,[t("div",Mo,[e.beatmap.status=="WIP"?(a(),I(d,{key:0,class:"mb-2",beatmap:e.beatmap},null,8,["beatmap"])):c("",!0)])]),k(S,{beatmap:e.beatmap},null,8,["beatmap"]),e.isQualified?c("",!0):(a(),I(te,{key:1,beatmap:e.beatmap},null,8,["beatmap"])),e.beatmap.status=="WIP"?(a(),I(ae,{key:2,beatmap:e.beatmap,"beatmap-id":e.beatmap.id},null,8,["beatmap","beatmap-id"])):c("",!0)])):c("",!0)]),Io,t("div",Lo,[k(oe,{class:"col-sm-8",beatmap:e.beatmap},null,8,["beatmap"]),t("div",To,[t("span",So," Created: "+h(e.beatmap.createdAt.toString().slice(0,10)),1),e.isHost&&!e.isRanked?(a(),i("button",{key:0,id:"deleteButton",class:"btn btn-sm btn-outline-danger ms-2",onClick:s[0]||(s[0]=ie=>e.deleteMap(ie))}," Delete ")):c("",!0)])])])):c("",!0)}const se=v(po,[["render",Co],["__scopeId","data-v-4727d833"]]),Po=y({name:"BeatmapTableRow",components:{BeatmapInfo:se,ProcessTasks:x,QuestImg:j,ModesIcons:V},props:{beatmap:{type:Object,required:!0}},methods:{selectBeatmap(){this.$route.query.id!==this.beatmap.id&&this.$router.push(`/beatmaps?id=${this.beatmap.id}`)},formatMetadata(){return this.beatmap.song.artist+" - "+this.beatmap.song.title},statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}}}),qo={class:"container"},Oo={class:"row"},Ao={class:"col-sm-6"},Uo=["data-bs-target"],Fo=t("i",{class:"fas fa-angle-down"},null,-1),Qo={class:"col-sm-2 small d-flex justify-content-end align-items-center"},Vo={class:"col-sm-3 small"},Do=t("span",{class:"text-secondary me-1"},"Hosted by",-1),Eo={key:0,class:"text-secondary"},No={key:0,class:"col-sm-1 d-flex justify-content-end align-items-center"},Ho=["href"],Go=t("i",{class:"fas fa-link"},null,-1),jo=[Go],Ro=["id"];function Wo(e,s,o,l,u,m){const r=f("quest-img"),n=f("process-tasks"),p=f("user-link"),g=f("modes-icons"),d=f("beatmap-info");return a(),i("div",null,[t("div",{class:M(["card card-body card-level-2 my-1 p-1",e.statusBorder()])},[t("div",qo,[t("div",Oo,[t("div",Ao,[k(r,{beatmap:e.beatmap},null,8,["beatmap"]),t("a",{href:"#","data-bs-toggle":"collapse","data-bs-target":"#details"+e.beatmap.id,class:"text-truncate",onClick:s[0]||(s[0]=S=>e.selectBeatmap())},[b(h(e.formatMetadata())+" ",1),Fo],8,Uo)]),t("div",Qo,[k(n,{tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])]),t("div",Vo,[Do,k(p,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),i("span",Eo,[k(g,{modes:[e.beatmap.mode],color:"secondary"},null,8,["modes"])])):c("",!0)]),e.beatmap.url?(a(),i("div",No,[t("a",{href:e.beatmap.url,target:"_blank"},jo,8,Ho)])):c("",!0)])])],2),t("div",{id:"details"+e.beatmap.id,class:M(["collapse my-2 mx-4 row border-end border-start py-3","border-"+e.beatmap.status.toLowerCase()])},[k(d,{beatmap:e.beatmap},null,8,["beatmap"])],10,Ro)])}const zo=v(Po,[["render",Wo]]),Ko=y({components:{BeatmapTableRow:zo},computed:O("beatmaps",{otherBeatmaps:"allBeatmaps",isLoadingOtherBeatmaps:"isLoadingOtherBeatmaps",filterValue:"filterValue"}),methods:{async showMore(e){e.target.disabled=!0,this.$store.commit("beatmaps/increaseFetchLimit"),await this.$store.dispatch("beatmaps/loadOtherBeatmaps"),e.target.disabled=!1}}}),Yo={class:"container card card-body py-3"},Xo={class:"ms-2"},Jo={href:"#otherBeatmaps","data-bs-toggle":"collapse"},Zo=t("i",{class:"fas fa-angle-down"},null,-1),xo={key:0,id:"otherBeatmaps",class:"collapse"},ei={key:0,class:"ms-5 text-secondary"},si={key:1,class:"text-center"},ti=t("i",{class:"fas fa-angle-down me-1"},null,-1),ai=t("i",{class:"fas fa-angle-down ms-1"},null,-1);function oi(e,s,o,l,u,m){const r=f("beatmap-table-row");return a(),i("div",Yo,[t("h5",Xo,[t("a",Jo,[b(" Other beatmaps ("+h(e.otherBeatmaps&&!e.isLoadingOtherBeatmaps?e.otherBeatmaps.length:"...")+") ",1),Zo])]),e.otherBeatmaps?(a(),i("div",xo,[t("div",{class:M({"loading-data":e.isLoadingOtherBeatmaps})},[!e.otherBeatmaps.length&&!e.isLoadingOtherBeatmaps?(a(),i("p",ei," None... ")):c("",!0),(a(!0),i(w,null,B(e.otherBeatmaps,n=>(a(),I(r,{key:n.id,beatmap:n},null,8,["beatmap"]))),128)),e.filterValue?c("",!0):(a(),i("div",si,[t("button",{class:"btn btn-sm btn-outline-info my-4",onClick:s[0]||(s[0]=L(n=>e.showMore(n),["prevent"]))},[ti,b(" show more "),ai])]))],2)])):c("",!0)])}const ii=v(Ko,[["render",oi]]),ni=y({components:{BeatmapInfo:se,ModalDialog:Z,QuestImg:j,ModesIcons:V},props:{selectedBeatmap:{type:Object,default:()=>({})}},watch:{selectedBeatmap(){this.selectedBeatmap&&this.$route.query.id!==this.selectedBeatmap.id&&this.$router.replace(`/beatmaps?id=${this.selectedBeatmap.id}`)}}}),li=["href"],di=t("i",{class:"fas fa-link"},null,-1),ri={key:1};function ui(e,s,o,l,u,m){const r=f("quest-img"),n=f("user-link"),p=f("modes-icons"),g=f("beatmap-info"),d=f("modal-dialog");return a(),I(d,{id:"editBeatmap",loaded:Boolean(e.selectedBeatmap),"header-class":e.selectedBeatmap?"bg-"+e.selectedBeatmap.status.toLowerCase():""},{header:q(()=>[k(r,{beatmap:e.selectedBeatmap},null,8,["beatmap"]),e.selectedBeatmap.url?(a(),i("a",{key:0,href:e.selectedBeatmap.url,target:"_blank"},[di,b(" "+h(e.selectedBeatmap.song.artist)+" - "+h(e.selectedBeatmap.song.title),1)],8,li)):(a(),i("span",ri,h(e.selectedBeatmap.song.artist)+" - "+h(e.selectedBeatmap.song.title),1)),b(" |"),k(n,{class:"mx-1",user:e.selectedBeatmap.host},null,8,["user"]),k(p,{modes:[e.selectedBeatmap.mode],color:"dark"},null,8,["modes"])]),default:q(()=>[k(g,{beatmap:e.selectedBeatmap},null,8,["beatmap"])]),_:1},8,["loaded","header-class"])}const pi=v(ni,[["render",ui]]),ci={namespaced:!0,state:{allBeatmaps:[],userBeatmaps:[],filterValue:"",filterMode:z.any,filterStatus:"any",filterQuest:"any",selectedBeatmap:null,selectedBeatmapId:null,fetchLimit:30,isLoadingOtherBeatmaps:!0},mutations:{setAllBeatmaps(e,s){e.allBeatmaps=s},setUserBeatmaps(e,s){e.userBeatmaps=s},setFilterValue(e,s){e.filterValue=s},setFilterMode(e,s){e.filterMode=s},setFilterStatus(e,s){e.filterStatus=s},setFilterQuest(e,s){e.filterQuest=s},setIsLoadingOtherBeatmaps(e,s){e.isLoadingOtherBeatmaps=s},increaseFetchLimit(e){e.fetchLimit+=50},setSelectedBeatmap(e,s){const o=Object.values(C);s.tasks.sort(function(l,u){return o.indexOf(l.name)-o.indexOf(u.name)}),s.tasksLocked.sort(function(l,u){return o.indexOf(l)-o.indexOf(u)}),e.selectedBeatmap=s},addBeatmap(e,s){e.userBeatmaps.unshift(s)},updateBeatmap(e,s){let o=e.allBeatmaps.findIndex(l=>l.id===s.id);o!==-1&&(e.allBeatmaps[o]=s),o=e.userBeatmaps.findIndex(l=>l.id===s.id),o!==-1&&(e.userBeatmaps[o]=s)},deleteBeatmap(e,s){let o=e.allBeatmaps.findIndex(l=>l.id===s.id);o!==-1&&e.allBeatmaps.splice(o,1),o=e.userBeatmaps.findIndex(l=>l.id===s.id),o!==-1&&e.userBeatmaps.splice(o,1)}},getters:{filteredUserBeatmaps:e=>{let s=e.userBeatmaps;if(e.filterMode!==z.any){const o=e.filterMode;s=s.filter(l=>l.mode===o||l.mode===U.Hybrid)}if(e.filterStatus!=="any"&&(s=s.filter(o=>o.status===e.filterStatus)),e.filterQuest!=="any"&&(s=s.filter(o=>!o.quest)),e.filterValue){const o=e.filterValue.toLowerCase().trim().split(" ").filter(l=>l.length);s=s.filter(l=>{let u=l.song.artist+" "+l.song.title+" "+l.host.username;return l.tasks.forEach(m=>{m.mappers.forEach(r=>{u+=" "+r.username})}),u=u.toLowerCase(),o.some(m=>u.includes(m))})}return s},guestDifficultyBeatmaps:(e,s,o)=>s.filteredUserBeatmaps.filter(l=>{var u;return l.host.id!==((u=o.loggedInUser)==null?void 0:u.id)}),hostedBeatmaps:(e,s,o)=>s.filteredUserBeatmaps.filter(l=>{var u;return l.host.id===((u=o.loggedInUser)==null?void 0:u.id)})},actions:{updateBeatmap({commit:e,state:s},o){var l;e("updateBeatmap",o),((l=s.selectedBeatmap)==null?void 0:l.id)===o.id&&e("setSelectedBeatmap",o)},async updateFilterMode({commit:e,dispatch:s},o){e("setFilterMode",o),await s("loadOtherBeatmaps")},async updateFilterStatus({commit:e,dispatch:s},o){e("setFilterStatus",o),await s("loadOtherBeatmaps")},async updateFilterQuest({commit:e,dispatch:s},o){e("setFilterQuest",o),await s("loadOtherBeatmaps")},async updateFilterValue({commit:e,dispatch:s},o){e("setFilterValue",o),await s("loadOtherBeatmaps")},async loadOtherBeatmaps({commit:e,state:s}){var r;e("setIsLoadingOtherBeatmaps",!0);const o=s.filterStatus!=="any"?`&status=${s.filterStatus}`:"",l=s.filterQuest!=="any"?`&quest=${s.filterQuest}`:"",u=s.filterValue?`&search=${s.filterValue}`:"",m=await re.get(`/api/beatmaps/search?mode=${s.filterMode}&limit=${s.fetchLimit+o+l+u}`);(r=m.data)!=null&&r.allBeatmaps&&e("setAllBeatmaps",m.data.allBeatmaps),e("setIsLoadingOtherBeatmaps",!1)}}},mi=ci,hi=y({name:"BeatmapPage",components:{BeatmapPageFilters:Qs,HostedBeatmaps:st,GuestDifficulties:rt,OtherBeatmaps:ii,EditBeatmapModal:pi,CreateBeatmapModal:ws},data(){return{isLoadingGuestBeatmaps:!0}},computed:O("beatmaps",["selectedBeatmap"]),beforeCreate(){this.$store.hasModule("beatmaps")||this.$store.registerModule("beatmaps",mi)},async created(){const e=this.$route.query.id;let s,o;e?([s,o]=await Promise.all([this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.executeGet("/beatmaps/searchOnLoad/"+e)]),this.$http.isError(o)||(this.$store.commit("beatmaps/setSelectedBeatmap",o),this.$bs.showModal("editBeatmap"))):s=await this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.isError(s)||(this.$store.commit("beatmaps/setUserBeatmaps",s.beatmaps),this.$store.commit("beatmaps/setFilterMode",s.mainMode)),await Promise.all([this.loadGuestBeatmaps(),this.$store.dispatch("beatmaps/loadOtherBeatmaps")]),this.isLoadingGuestBeatmaps=!1},methods:{async loadGuestBeatmaps(){const e=await this.$http.executeGet("/beatmaps/guestBeatmaps");e&&this.$store.commit("beatmaps/setUserBeatmaps",e.userBeatmaps)}}}),fi=t("div",{class:"radial-divisor"},null,-1),bi=t("div",{class:"radial-divisor"},null,-1);function _i(e,s,o,l,u,m){const r=f("beatmap-page-filters"),n=f("hosted-beatmaps"),p=f("guest-difficulties"),g=f("other-beatmaps"),d=f("edit-beatmap-modal"),S=f("create-beatmap-modal");return a(),i("div",null,[k(r),k(n),fi,k(p,{"is-loading-guest-beatmaps":e.isLoadingGuestBeatmaps},null,8,["is-loading-guest-beatmaps"]),bi,k(g),k(d,{"selected-beatmap":e.selectedBeatmap},null,8,["selected-beatmap"]),k(S)])}const Mi=v(hi,[["render",_i]]);export{Mi as default};
