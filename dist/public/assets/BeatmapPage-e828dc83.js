import{B as V,a as q}from"./beatmap-c2b9f550.js";import{M as W}from"./ModalDialog-003d733b.js";import{d as g,_ as y,o,c as T,w as M,a as s,b,v as A,e as n,r as w,t as f,F as v,f as nt,g as R,h as k,i as m,m as S,j as lt,k as $,n as B,l as C,p as j,q as u,s as I,M as F,u as K,x as z,T as H,y as X,z as J,A as Y,B as Z,C as dt}from"./index-098c3321.js";import{F as rt}from"./FilterBox-a71c400c.js";import{M as ut,F as G}from"./extras-34aab60e.js";import{T as P,a as E}from"./task-0811ab65.js";import{U as x}from"./UserLinkList-9825781f.js";const ct=g({name:"CreateBeatmapModal",components:{ModalDialog:W},data(){return{featuredArtists:[],featuredSongs:[],selectedArtist:"",selectedSong:"",selectedMode:"osu",checkedTasks:[],checkedLocks:[],modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"}],tasks:["Easy","Normal","Hard","Insane","Expert"]}},async created(){const t=await this.$http.executeGet("/featuredArtists");t&&(this.featuredArtists=t.sort((e,i)=>e.label.toLowerCase()>i.label.toLowerCase()?1:i.label.toLowerCase()>e.label.toLowerCase()?-1:0))},methods:{async setArtist(t){if(!this.selectedArtist){this.$store.dispatch("updateToastMessages",{message:"Select an artist!",type:"info"});return}t.target.disabled=!0;const e=await this.$http.executeGet(`/featuredArtists/${this.selectedArtist}/songs`);e&&(this.featuredSongs=e.sort((i,l)=>i.title.toLowerCase()>l.title.toLowerCase()?1:l.title.toLowerCase()>i.title.toLowerCase()?-1:0)),t.target.disabled=!1},async saveNewMap(t){if(!this.selectedSong){this.$store.dispatch("updateToastMessages",{message:"Select a song!",type:"info"});return}const e=await this.$http.executePost("/beatmaps/create/",{song:this.selectedSong,tasks:this.checkedTasks,tasksLocked:this.checkedLocks,mode:this.selectedMode,status:V.WIP},t);this.$http.isError(e)||(this.$bs.hideModal("addBeatmap"),this.$store.commit("beatmaps/addBeatmap",e))}}}),pt={class:"container"},mt={class:"mb-3 row"},ht=s("div",{class:"col-lg-1"},[s("p",{style:{"margin-top":"3px"}}," Artist: ")],-1),bt={class:"col-lg-11"},ft={id:"artistForm",class:"input-group input-group-sm mb-3"},$t=s("option",{value:"",disabled:""}," Select an artist ",-1),_t=s("option",{value:"-",disabled:""}," --- ",-1),kt=["value"],gt=s("div",{class:"col-lg-1"},[s("p",{style:{"margin-top":"3px"}}," Song: ")],-1),yt={class:"col-lg-11"},vt=["disabled"],Bt=s("option",{value:"",disabled:""}," Select an artist to view songs ",-1),wt=s("option",{value:"-",disabled:""}," --- ",-1),Ct=["value"],Lt=s("p",null," Game-mode: ",-1),Tt={class:"mb-3 row"},It={class:"col-sm-10"},Mt=["id","value"],St=["for"],Pt=s("br",null,null,-1),qt=s("small",{class:"text-white-50"},"If you want a hybrid mapset, change this later.",-1),At=s("p",null,[k(" Select one or more difficulties "),s("i",null,"you plan on mapping"),k(". These can be changed later: ")],-1),Ot={class:"mb-3 row"},Qt={class:"col-sm-10"},Ut=["id","value"],Et=["for"],Ft=s("p",null,[k(" Select one or more difficulties "),s("i",null,"you don't want anyone else to claim"),k(". These can be changed later: "),s("br"),s("small",{class:"text-white-50"},"For example, if you don't want any guest difficulties, you should mark everything.")],-1),Dt={class:"mb-3 row"},Vt={class:"col-sm-10"},jt=["id","value"],Ht=["for"],Nt=s("div",{class:"radial-divisor"},null,-1),Rt=s("small",{class:"text-white-50"},[k("Check the "),s("a",{href:"/faq#rewards",target:"_blank"},"FAQ"),k(" to ensure your beatmap is elligible for points.")],-1);function Gt(t,e,i,l,c,p){const d=m("modal-dialog");return o(),T(d,{id:"addBeatmap",title:"Add beatmap"},{default:M(()=>[s("div",pt,[s("div",mt,[ht,s("div",bt,[s("div",ft,[b(s("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.selectedArtist=a),class:"form-select"},[$t,_t,(o(!0),n(v,null,w(t.featuredArtists,a=>(o(),n("option",{key:a.id,value:a.id},f(a.label),9,kt))),128))],512),[[A,t.selectedArtist]]),s("button",{id:"artistButton",class:"btn btn-outline-info",onClick:e[1]||(e[1]=a=>t.setArtist(a))}," Load songs ")])]),gt,s("div",yt,[b(s("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.selectedSong=a),class:"form-select form-select-sm",disabled:!t.featuredSongs.length},[Bt,wt,(o(!0),n(v,null,w(t.featuredSongs,a=>(o(),n("option",{key:a.id,value:a.id},f(a.title)+" --- ("+f(a.artist)+") ",9,Ct))),128))],8,vt),[[A,t.selectedSong]])])]),Lt,s("div",Tt,[s("div",It,[(o(!0),n(v,null,w(t.modes,a=>(o(),n("div",{key:a.value,class:"form-check form-check-inline"},[b(s("input",{id:a.value,"onUpdate:modelValue":e[3]||(e[3]=r=>t.selectedMode=r),class:"form-check-input",type:"radio",value:a.value},null,8,Mt),[[nt,t.selectedMode]]),s("label",{class:"form-check-label",for:a.value},f(a.name),9,St)]))),128)),Pt,qt])]),At,s("div",Ot,[s("div",Qt,[(o(!0),n(v,null,w(t.tasks,a=>(o(),n("div",{key:a,class:"form-check"},[b(s("input",{id:a,"onUpdate:modelValue":e[4]||(e[4]=r=>t.checkedTasks=r),class:"form-check-input",type:"checkbox",value:a},null,8,Ut),[[R,t.checkedTasks]]),s("label",{class:"form-check-label",for:a},f(a),9,Et)]))),128))])]),Ft,s("div",Dt,[s("div",Vt,[(o(!0),n(v,null,w(t.tasks,a=>(o(),n("div",{key:a,class:"form-check"},[b(s("input",{id:`lock-${a}`,"onUpdate:modelValue":e[5]||(e[5]=r=>t.checkedLocks=r),class:"form-check-input",type:"checkbox",value:a},null,8,jt),[[R,t.checkedLocks]]),s("label",{class:"form-check-label",for:`lock-${a}`},f(a),9,Ht)]))),128))])])]),Nt,s("button",{type:"submit",class:"btn btn-outline-success w-100",onClick:e[6]||(e[6]=a=>t.saveNewMap(a))}," Save "),Rt]),_:1})}const Wt=y(ct,[["render",Gt]]),Kt=g({name:"BeatmapPageFilters",components:{FilterBox:rt,ModeFilters:ut},data(){return{statuses:{any:"Any",WIP:"WIP",Done:"Done",Qualified:"Qualified",Ranked:"Ranked"},quests:{any:"Any",none:"None"}}},computed:S("beatmaps",["filterMode","filterValue","filterStatus","filterQuest"]),methods:{...lt("beatmaps",["updateFilterValue","updateFilterMode","updateFilterStatus","updateFilterQuest"]),getStatusSortClass(t){return this.filterStatus===t?"sorted":"unsorted"},getQuestSortClass(t){return this.filterQuest===t?"sorted":"unsorted"}}}),zt={class:"container card card-body py-3 mb-2"},Xt=s("button",{class:"btn btn-primary",href:"#","data-bs-toggle":"modal","data-bs-target":"#addBeatmap"},[k(" Add beatmap "),s("i",{class:"fas fa-plus fa-xs"})],-1),Jt={class:"row mt-3"},Yt=s("div",{class:"col-auto filter-title"}," Status ",-1),Zt={class:"col"},xt=["onClick"],te={class:"row mt-3"},ee=s("div",{class:"col-auto filter-title"}," Quest ",-1),se={class:"col"},ae=["onClick"];function oe(t,e,i,l,c,p){const d=m("mode-filters"),a=m("filter-box");return o(),n("div",zt,[$(a,{placeholder:"enter to search for song/username...","filter-value":t.filterValue,"onUpdate:filterValue":e[1]||(e[1]=r=>t.updateFilterValue(r))},{filters:M(()=>[$(d,{"filter-mode":t.filterMode,"onUpdate:filterMode":e[0]||(e[0]=r=>t.updateFilterMode(r))},null,8,["filter-mode"]),s("div",Jt,[Yt,s("div",Zt,[(o(!0),n(v,null,w(t.statuses,(r,_)=>(o(),n("a",{key:_,href:"#",class:B(["status",t.getStatusSortClass(_)]),onClick:C(h=>t.updateFilterStatus(_),["prevent"])},f(r),11,xt))),128))])]),s("div",te,[ee,s("div",se,[(o(!0),n(v,null,w(t.quests,(r,_)=>(o(),n("a",{key:_,href:"#",class:B(["quest",t.getQuestSortClass(_)]),onClick:C(h=>t.updateFilterQuest(_),["prevent"])},f(r),11,ae))),128))])])]),default:M(()=>[Xt]),_:1},8,["filter-value"])])}const ie=y(Kt,[["render",oe]]);function U(t,e,i){const l={class:["px-1","text-"+e.toLowerCase()]};return i&&(l["data-bs-toggle"]="tooltip",l["data-bs-placement"]="top",l.title=i),j("span",l,t)}const tt=g({props:{tasks:{type:Array,required:!0},tasksLocked:{type:Array,required:!0},mode:{type:String,required:!0}},render(){const t=[{name:"Storyboard",short:"SB",locked:!1,status:[]},{name:"Easy",short:"E",locked:!1,status:[]},{name:"Normal",short:"N",locked:!1,status:[]},{name:"Hard",short:"H",locked:!1,status:[]},{name:"Insane",short:"I",locked:!1,status:[]},{name:"Expert",short:"X",locked:!1,status:[]}],e=[{name:"osu",short:"circle",count:0,status:P.Done},{name:"taiko",short:"drum",count:0,status:P.Done},{name:"catch",short:"apple-alt",count:0,status:P.Done},{name:"mania",short:"stream",count:0,status:P.Done}],i=[],l=this.tasks.length>=10,c=this.mode===q.Hybrid;for(const p of t){let d=!1;const a=this.tasksLocked.includes(p.name);for(const r of this.tasks)if(p.name===r.name){p.status.push(r.status),d=!0;const _=e.findIndex(h=>h.name===r.mode);_!==-1&&(e[_].count++,r.status===P.WIP&&(e[_].status=P.WIP))}if(!c){if(l&&p.status.length>1)i.push(U(p.short+"+","secondary",p.status.length.toString()));else for(const r of p.status)i.push(U(p.short,r));d||i.push(U(p.short,a?"blocked":"open"))}}if(c)for(const p of e)i.push(U([j("i",{class:["fas","fa-"+p.short]})],p.count?p.status:"blocked",p.count.toString()));return j("span",{class:"fw-bold"},i)}}),ne=g({props:{beatmap:{type:Object,required:!0}},computed:{url(){var t;return this.beatmap.isShowcase||!((t=this.beatmap.quest)!=null&&t.art)?"/images/no-art-icon.png":this.beatmap.quest.isMbc?"/images/mbc-icon.png":`https://assets.ppy.sh/artists/${this.beatmap.quest.art}/cover.jpg`}}});const le=["src"];function de(t,e,i,l,c,p){const d=I("bs-tooltip");return t.beatmap.quest||t.beatmap.isShowcase?b((o(),n("img",{key:0,class:"rounded-circle me-1 quest-icon",src:t.url},null,8,le)),[[d,t.beatmap.quest&&t.beatmap.quest.name||"FA showcase"]]):u("",!0)}const N=y(ne,[["render",de],["__scopeId","data-v-72cf78b4"]]),re=g({name:"BeatmapCard",components:{ProcessTasks:tt,QuestImg:N,ModesIcons:F},props:{beatmap:{type:Object,required:!0}},emits:["update:selectedBeatmap"],data(){return{defaultUrl:"https://osu.ppy.sh/images/layout/beatmaps/default-bg.png"}},computed:{statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}},methods:{fallbackImage(t){t.target.src=this.defaultUrl},formatMetadata(t,e){const i=t+" - "+e;return i.length>34?i.slice(0,34)+"...":i},processUrl(t){if(t&&t.indexOf("osu.ppy.sh/beatmapsets/")!==-1){const e=t.indexOf("beatmapsets/")+12,i=t.indexOf("#");let l;return i!==-1?l=t.slice(e,i):l=t.slice(e),`https://assets.ppy.sh/beatmaps/${l}/covers/card.jpg`}else return this.defaultUrl}}});const ue=["src"],ce={class:"card-img-overlay",style:{padding:"0.50rem 0.50rem 0 0.50rem"}},pe={class:"card-title mb-1"},me={class:"card-text"};function he(t,e,i,l,c,p){const d=m("quest-img"),a=m("user-link"),r=m("modes-icons"),_=m("process-tasks");return o(),n("div",{class:"my-2 col-sm-12 col-md-6 col-lg-4",onClick:e[1]||(e[1]=h=>t.$emit("update:selectedBeatmap",t.beatmap))},[s("div",{class:B(["card card-hover map-card bg-dark",t.statusBorder]),"data-bs-toggle":"modal","data-bs-target":"#editBeatmap"},[s("img",{class:"card-img",src:t.processUrl(t.beatmap.url),style:{opacity:"0.2"},onError:e[0]||(e[0]=h=>t.fallbackImage(h))},null,40,ue),s("div",ce,[s("p",pe,f(t.formatMetadata(t.beatmap.song.artist,t.beatmap.song.title)),1),s("small",me,[$(d,{beatmap:t.beatmap},null,8,["beatmap"]),k(" Hosted by "),$(a,{class:"me-1",user:t.beatmap.host},null,8,["user"]),t.beatmap.mode!=="osu"?(o(),T(r,{key:0,modes:[t.beatmap.mode]},null,8,["modes"])):u("",!0),$(_,{class:"float-end pt-1",tasks:t.beatmap.tasks,"tasks-locked":t.beatmap.tasksLocked,mode:t.beatmap.mode},null,8,["tasks","tasks-locked","mode"])])])],2)])}const et=y(re,[["render",he],["__scopeId","data-v-e1a6d32a"]]),be=g({components:{BeatmapCard:et},computed:K("beatmaps",["hostedBeatmaps"]),methods:z("beatmaps",["setSelectedBeatmap"])}),fe={class:"container card card-body py-3"},$e={class:"ms-2"},_e={href:"#hostedBeatmaps","data-bs-toggle":"collapse"},ke=s("i",{class:"fas fa-angle-down"},null,-1),ge={key:0,id:"hostedBeatmaps",class:"show"},ye={key:0,class:"ms-5 text-white-50"};function ve(t,e,i,l,c,p){const d=m("beatmap-card");return o(),n("div",fe,[s("h5",$e,[s("a",_e,[k(" My mapsets ("+f(t.hostedBeatmaps?t.hostedBeatmaps.length:"...")+") ",1),ke])]),t.hostedBeatmaps?(o(),n("div",ge,[$(H,{name:"list",tag:"div",class:"row"},{default:M(()=>[(o(!0),n(v,null,w(t.hostedBeatmaps,a=>(o(),T(d,{key:a.id,beatmap:a,"onUpdate:selectedBeatmap":e[0]||(e[0]=r=>t.setSelectedBeatmap(r))},null,8,["beatmap"]))),128))]),_:1}),t.hostedBeatmaps.length?u("",!0):(o(),n("p",ye," None... "))])):u("",!0)])}const Be=y(be,[["render",ve]]),we=g({components:{BeatmapCard:et},props:{isLoadingGuestBeatmaps:Boolean},computed:K("beatmaps",["guestDifficultyBeatmaps"]),methods:z("beatmaps",["setSelectedBeatmap"])}),Ce={class:"container card card-body py-3"},Le={class:"ms-2"},Te={href:"#guestDifficultyBeatmaps","data-bs-toggle":"collapse"},Ie=s("i",{class:"fas fa-angle-down"},null,-1),Me={key:0,class:"ms-5 text-white-50"};function Se(t,e,i,l,c,p){const d=m("beatmap-card");return o(),n("div",Ce,[s("h5",Le,[s("a",Te,[k(" My guest difficulties ("+f(t.guestDifficultyBeatmaps&&!t.isLoadingGuestBeatmaps?t.guestDifficultyBeatmaps.length:"...")+") ",1),Ie])]),t.guestDifficultyBeatmaps?(o(),n("div",{key:0,id:"guestDifficultyBeatmaps",class:B(["collapse",{"loading-data":t.isLoadingGuestBeatmaps}])},[!t.guestDifficultyBeatmaps.length&&!t.isLoadingGuestBeatmaps?(o(),n("p",Me," None... ")):u("",!0),$(H,{name:"list",tag:"div",class:"row"},{default:M(()=>[(o(!0),n(v,null,w(t.guestDifficultyBeatmaps,a=>(o(),T(d,{key:a.id,beatmap:a,"onUpdate:selectedBeatmap":e[0]||(e[0]=r=>t.setSelectedBeatmap(r))},null,8,["beatmap"]))),128))]),_:1})],2)):u("",!0)])}const Pe=y(we,[["render",Se]]),qe=g({name:"ModeChoice",props:{beatmap:{type:Object,required:!0}},methods:{async setMode(t,e,i){const l=await this.$http.executePost(`/beatmaps/${t}/setMode`,{mode:e},i);this.$http.isError(l)||this.$store.dispatch("beatmaps/updateBeatmap",l)}}});const O=t=>(X("data-v-c110d5eb"),t=t(),J(),t),Ae={id:"mode",class:"mb-3"},Oe=O(()=>s("div",{class:"d-inline-block me-2"}," Mode ",-1)),Qe=["disabled"],Ue=O(()=>s("i",{class:"far fa-circle"},null,-1)),Ee=[Ue],Fe=["disabled"],De=O(()=>s("i",{class:"fas fa-drum"},null,-1)),Ve=[De],je=["disabled"],He=O(()=>s("i",{class:"fas fa-apple-alt"},null,-1)),Ne=[He],Re=["disabled"],Ge=O(()=>s("i",{class:"fas fa-stream"},null,-1)),We=[Ge],Ke=["disabled"],ze=O(()=>s("i",{class:"fas fa-check-double"},null,-1)),Xe=[ze];function Je(t,e,i,l,c,p){const d=I("bs-tooltip");return o(),n("div",Ae,[Oe,b((o(),n("button",{class:B(["btn btn-sm rounded-100 me-1",t.beatmap.mode=="osu"?"btn-info":"btn-outline-info"]),disabled:t.beatmap.mode=="osu",onClick:e[0]||(e[0]=a=>t.setMode(t.beatmap.id,"osu",a))},Ee,10,Qe)),[[d,"osu!"]]),b((o(),n("button",{class:B(["btn btn-sm rounded-100 me-1",t.beatmap.mode=="taiko"?"btn-info":"btn-outline-info"]),disabled:t.beatmap.mode=="taiko",onClick:e[1]||(e[1]=a=>t.setMode(t.beatmap.id,"taiko",a))},Ve,10,Fe)),[[d,"osu!taiko"]]),b((o(),n("button",{class:B(["btn btn-sm rounded-100 me-1",t.beatmap.mode=="catch"?"btn-info":"btn-outline-info"]),disabled:t.beatmap.mode=="catch",onClick:e[2]||(e[2]=a=>t.setMode(t.beatmap.id,"catch",a))},Ne,10,je)),[[d,"osu!catch"]]),b((o(),n("button",{class:B(["btn btn-sm rounded-100 me-1",t.beatmap.mode=="mania"?"btn-info":"btn-outline-info"]),disabled:t.beatmap.mode=="mania",onClick:e[3]||(e[3]=a=>t.setMode(t.beatmap.id,"mania",a))},We,10,Re)),[[d,"osu!mania"]]),b((o(),n("button",{class:B(["btn btn-sm rounded-100 me-1",t.beatmap.mode=="hybrid"?"btn-info":"btn-outline-info"]),disabled:t.beatmap.mode=="hybrid",onClick:e[4]||(e[4]=a=>t.setMode(t.beatmap.id,"hybrid",a))},Xe,10,Ke)),[[d,"multiple modes"]])])}const Ye=y(qe,[["render",Je],["__scopeId","data-v-c110d5eb"]]),Ze=g({name:"StatusChoice",props:{beatmap:{type:Object,required:!0}},methods:{async setStatus(t,e){const i=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setStatus`,{status:t},e);this.$http.isError(i)||this.$store.dispatch("beatmaps/updateBeatmap",i)}}}),xe={id:"mapsetStatus",class:"mb-3"},ts=s("div",{class:"d-inline-block me-2"}," Status ",-1),es=["disabled"],ss=["disabled"];function as(t,e,i,l,c,p){const d=I("bs-tooltip");return o(),n("div",xe,[ts,b((o(),n("button",{class:B(["btn btn-sm me-1",t.beatmap.status=="Done"?"btn-success":"btn-outline-success"]),disabled:t.beatmap.status=="Done",onClick:e[0]||(e[0]=a=>t.setStatus("Done",a))},[k(" Done ")],10,es)),[[d,"mark mapset and all diffs as done","bottom"]]),b((o(),n("button",{class:B(["btn btn-sm me-1",t.beatmap.status=="WIP"?"btn-warning":"btn-outline-warning"]),disabled:t.beatmap.status=="WIP",onClick:e[1]||(e[1]=a=>t.setStatus("WIP",a))},[k(" WIP ")],10,ss)),[[d,"mark mapset as work-in-progress","bottom"]])])}const os=y(Ze,[["render",as]]),is=g({name:"NewTask",props:{isHost:Boolean,taskToAddCollaborator:{type:Object,default:null},beatmap:{type:Object,required:!0}},emits:["update:taskToAddCollaborator"],data(){return{selectedTask:E.Easy,selectedMode:q.Osu,requestTaskUsername:""}},computed:{remainingTasks(){let t=Object.values(E);return this.beatmap.tasksLocked&&this.beatmap.tasksLocked.length&&!this.isHost&&(t=t.filter(e=>!this.beatmap.tasksLocked.includes(e))),this.selectedTask=t[0]||"",t}},methods:{async addTask(t,e){if(this.requestTaskUsername&&this.requestTaskUsername.length){this.requestTask(t,e);return}let i;this.beatmap.mode==q.Hybrid?i=this.selectedMode:i=this.beatmap.mode;const l=await this.$http.executePost("/beatmaps/addTask/"+t,{taskName:this.selectedTask,mode:i},e);this.$http.isError(l)||this.$store.dispatch("beatmaps/updateBeatmap",l)},async requestTask(t,e){let i;this.beatmap.mode==q.Hybrid?i=this.selectedMode:i=this.beatmap.mode;const l=await this.$http.executePost("/beatmaps/requestTask/"+t,{taskName:this.selectedTask,user:this.requestTaskUsername,mode:i},e);this.$http.isError(l)||(this.$store.dispatch("beatmaps/updateBeatmap",l),this.$store.dispatch("updateToastMessages",{message:"Difficulty request sent!",type:"success"}))},async addCollab(t){let e;this.beatmap.mode==q.Hybrid?e=this.taskToAddCollaborator.mode:e=this.beatmap.mode;const i=await this.$http.executePost("/beatmaps/task/"+this.taskToAddCollaborator.id+"/addCollab",{user:this.requestTaskUsername,taskName:this.taskToAddCollaborator.name,mode:e},t);this.$http.isError(i)||(this.$store.dispatch("beatmaps/updateBeatmap",i),this.$store.dispatch("updateToastMessages",{message:"Collab invite sent!",type:"success"}))}}}),ns={key:0,class:"row mt-2 mb-3"},ls={class:"col-sm-12"},ds={class:"input-group input-group-sm mx-auto"},rs=["value"],us=s("option",{value:"osu"}," osu! ",-1),cs=s("option",{value:"taiko"}," osu!taiko ",-1),ps=s("option",{value:"catch"}," osu!catch ",-1),ms=s("option",{value:"mania"}," osu!mania ",-1),hs=[us,cs,ps,ms],bs=s("i",{class:"fas fa-plus"},null,-1),fs=[bs],$s={key:0,class:"col-sm-12 mt-1 text-center"},_s=s("i",{class:"fas fa-times-circle"},null,-1),ks=[_s];function gs(t,e,i,l,c,p){const d=I("bs-tooltip");return(t.beatmap.status=="WIP"||t.beatmap.status=="Secret")&&t.remainingTasks.length?(o(),n("div",ns,[s("div",ls,[s("div",ds,[t.taskToAddCollaborator?u("",!0):b((o(),n("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=a=>t.selectedTask=a),class:"form-select"},[(o(!0),n(v,null,w(t.remainingTasks,a=>(o(),n("option",{key:a,value:a},f(a),9,rs))),128))],512)),[[A,t.selectedTask]]),t.beatmap.mode=="hybrid"&&!t.taskToAddCollaborator?b((o(),n("select",{key:1,"onUpdate:modelValue":e[1]||(e[1]=a=>t.selectedMode=a),class:"form-select"},hs,512)),[[A,t.selectedMode]]):u("",!0),t.isHost||t.taskToAddCollaborator?b((o(),n("input",{key:2,"onUpdate:modelValue":e[2]||(e[2]=a=>t.requestTaskUsername=a),class:"form-control",type:"text",placeholder:"request to... (optional)",maxlength:"18",onKeyup:e[3]||(e[3]=Z(a=>t.taskToAddCollaborator?t.addCollab(a):t.requestTask(t.beatmap.id,a),["enter"]))},null,544)),[[Y,t.requestTaskUsername]]):u("",!0),b((o(),n("button",{class:"btn btn-outline-info",onClick:e[4]||(e[4]=a=>t.taskToAddCollaborator?t.addCollab(a):t.addTask(t.beatmap.id,a))},fs)),[[d,"add difficulty"]])])]),t.taskToAddCollaborator?(o(),n("div",$s,[s("small",null,[k(" Adding collaborator for the selected difficulty "),s("a",{class:"text-danger",href:"#",onClick:e[5]||(e[5]=C(a=>t.$emit("update:taskToAddCollaborator",null),["prevent"]))},ks)])])):u("",!0)])):u("",!0)}const ys=y(is,[["render",gs]]),vs=g({name:"TasksChoice",components:{NewTask:ys,ModesIcons:F},props:{beatmap:{type:Object,required:!0},isHost:Boolean,isRanked:Boolean,isQualified:Boolean},data(){return{taskToAddCollaborator:null}},computed:{...S(["loggedInUser"]),sortedTasks(){const t=["Easy","Normal","Hard","Insane","Expert","Storyboard"],e=["osu","taiko","catch","mania","sb"];return[...this.beatmap.tasks].sort(function(l,c){return t.indexOf(l.name)-t.indexOf(c.name)}).sort(function(l,c){return e.indexOf(l.mode)-e.indexOf(c.mode)})}},methods:{isOwner(t){return t.some(e=>e.osuId==this.loggedInUser.osuId)},canEditTask(t){return this.isOwner(t.mappers)||this.isHost},async setTaskStatus(t,e,i){i.target.classList.add("fake-button-disable");const l=await this.$http.executePost("/beatmaps/setTaskStatus/"+t,{status:e});this.$http.isError(l)||this.$store.dispatch("beatmaps/updateBeatmap",l),i.target.classList.remove("fake-button-disable")},async removeTask(t,e){e.target.classList.add("fake-button-disable");const i=await this.$http.executePost("/beatmaps/removeTask/"+t,{beatmapId:this.beatmap.id});this.$http.isError(i)||this.$store.dispatch("beatmaps/updateBeatmap",i),e.target.classList.remove("fake-button-disable")},canEditTaskCollaborators(t){return t.status!="Done"&&!this.isQualified&&this.beatmap.status!="Done"&&this.isOwner(t.mappers)},async removeCollab(t,e,i){i.target.classList.add("fake-button-disable");const l=await this.$http.executePost("/beatmaps/task/"+t+"/removeCollab",{user:e});this.$http.isError(l)||this.$store.dispatch("beatmaps/updateBeatmap",l),i.target.classList.remove("fake-button-disable")},isAddingCollaborator(t){var e;return((e=this.taskToAddCollaborator)==null?void 0:e.id)==t.id}}}),Bs={class:"row"},ws={class:"col-sm-12"},Cs={class:"table table-sm"},Ls=s("th",null,"Difficulty",-1),Ts=s("th",null,"Mapper(s)",-1),Is={key:0},Ms=["id"],Ss=s("i",{class:"fas fa-times"},null,-1),Ps=[Ss],qs=["onClick"],As=s("i",{class:"fas fa-plus"},null,-1),Os=[As],Qs=["onClick"],Us=s("i",{class:"fas fa-minus"},null,-1),Es=[Us],Fs={key:0},Ds=["onClick"],Vs=s("i",{class:"fas fa-minus"},null,-1),js=[Vs],Hs=["onClick"],Ns=s("i",{class:"fas fa-check"},null,-1),Rs=[Ns],Gs=["onClick"],Ws=s("i",{class:"fas fa-ellipsis-h"},null,-1),Ks=[Ws],zs={key:0,class:"col-sm-12 mt-2"};function Xs(t,e,i,l,c,p){const d=m("modes-icons"),a=m("user-link"),r=m("new-task"),_=I("bs-tooltip");return o(),n("div",Bs,[s("div",ws,[s("table",Cs,[s("thead",null,[s("tr",null,[Ls,Ts,!t.isRanked&&!t.isQualified?(o(),n("th",Is)):u("",!0)])]),$(H,{tag:"tbody",name:"list"},{default:M(()=>[(o(!0),n(v,null,w(t.sortedTasks,h=>(o(),n("tr",{id:h.id+"Row",key:h.id},[s("td",{class:B(["text-white-50",`card-status-${h.status.toLowerCase()}`])},[k(f(h.name)+" ",1),t.beatmap.mode=="hybrid"?(o(),T(d,{key:0,modes:[h.mode]},null,8,["modes"])):u("",!0)],2),s("td",null,[(o(!0),n(v,null,w(h.mappers,(L,D)=>(o(),n("div",{key:L.id},[D==0&&t.canEditTaskCollaborators(h)?(o(),n(v,{key:0},[t.isAddingCollaborator(h)?b((o(),n("a",{key:0,href:"#",class:"text-danger",onClick:e[0]||(e[0]=C(Q=>t.taskToAddCollaborator=null,["prevent"]))},Ps)),[[_,"cancel"]]):b((o(),n("a",{key:1,href:"#",class:"text-success",onClick:C(Q=>t.taskToAddCollaborator=h,["prevent"])},Os,8,qs)),[[_,"invite new collaborator"]])],64)):u("",!0),$(a,{class:"mx-1",user:L},null,8,["user"]),h.mappers.length>1&&t.canEditTaskCollaborators(h)&&L.osuId!=t.loggedInUser.osuId?b((o(),n("a",{key:1,href:"#",class:"text-danger",onClick:C(Q=>t.removeCollab(h.id,L.id,Q),["prevent"])},Es,8,Qs)),[[_,"remove collaborator"]]):u("",!0)]))),128))]),!t.isRanked&&!t.isQualified?(o(),n("td",Fs,[t.canEditTask(h)?(o(),n(v,{key:0},[b((o(),n("a",{href:"#",class:"text-danger me-1",onClick:C(L=>t.removeTask(h.id,L),["prevent"])},js,8,Ds)),[[_,"delete"]]),h.status=="WIP"?b((o(),n("a",{key:0,href:"#",class:"text-success me-1",onClick:C(L=>t.setTaskStatus(h.id,"Done",L),["prevent"])},Rs,8,Hs)),[[_,"mark as done"]]):u("",!0),h.status=="Done"&&t.beatmap.status!="Done"?b((o(),n("a",{key:1,href:"#",class:"text-wip me-1",onClick:C(L=>t.setTaskStatus(h.id,"WIP",L),["prevent"])},Ks,8,Gs)),[[_,"mark as WIP"]]):u("",!0)],64)):u("",!0)])):u("",!0)],8,Ms))),128))]),_:1})])]),!t.isRanked&&!t.isQualified?(o(),n("div",zs,[$(r,{"task-to-add-collaborator":t.taskToAddCollaborator,"onUpdate:taskToAddCollaborator":e[1]||(e[1]=h=>t.taskToAddCollaborator=h),beatmap:t.beatmap,"is-host":t.isHost},null,8,["task-to-add-collaborator","beatmap","is-host"])])):u("",!0)])}const Js=y(vs,[["render",Xs]]),Ys=g({name:"QuestChoice",props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:[],showQuestInput:!1,dropdownQuestId:""}},computed:S(["loggedInUser"]),watch:{beatmap(){var t;this.showQuestInput=!1,this.dropdownQuestId=((t=this.beatmap.quest)==null?void 0:t.id)||""}},async created(){const t=await this.$http.executeGet(`/users/${this.loggedInUser.id}/quests`);this.$http.isError(t)||(this.userQuests=t)},methods:{async linkQuest(t){const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/linkQuest`,{questId:this.dropdownQuestId},t);this.$http.isError(e)||this.$store.dispatch("beatmaps/updateBeatmap",e)}}}),Zs={class:"row mb-2"},xs={class:"col"},ta=s("i",{class:"fas fa-edit"},null,-1),ea=[ta],sa={class:"small ms-3 text-white-50"},aa={key:0},oa={key:1},ia={key:0,class:"row mb-2"},na={class:"col"},la={class:"input-group input-group-sm"},da=s("option",{value:""}," No quest ",-1),ra=["value"];function ua(t,e,i,l,c,p){const d=I("bs-tooltip");return o(),n("div",null,[s("div",Zs,[s("div",xs,[s("div",null,[k(" Quest "),b((o(),n("a",{id:"editLink",href:"#",class:B([t.showQuestInput?"text-danger":"","text-success small ms-1"]),onClick:e[0]||(e[0]=C(a=>t.showQuestInput=!t.showQuestInput,["prevent"]))},ea,2)),[[d,"connect mapset with a quest","right"]])]),s("div",sa,[t.beatmap.quest?(o(),n("span",aa,f(t.beatmap.quest.name),1)):(o(),n("i",oa,"none"))])])]),t.showQuestInput?(o(),n("div",ia,[s("div",na,[s("div",la,[b(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.dropdownQuestId=a),class:"form-select"},[da,(o(!0),n(v,null,w(t.userQuests,a=>(o(),n("option",{key:a.id,value:a.id},f(a.name),9,ra))),128))],512),[[A,t.dropdownQuestId]]),b((o(),n("button",{class:"btn btn-outline-info",onClick:e[2]||(e[2]=a=>t.linkQuest(a))},[k(" Save ")])),[[d,"link beatmap to quest"]])])])])):u("",!0)])}const ca=y(Ys,[["render",ua]]),pa=g({name:"ModdersList",components:{UserLinkList:x},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...S(["loggedInUser"]),isModder(){return this.beatmap.modders.some(t=>t.osuId==this.loggedInUser.osuId)}},methods:{async updateModder(t){t.target.classList.add("fake-button-disable");const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateModder`);this.$http.isError(e)||this.$store.dispatch("beatmaps/updateBeatmap",e),t.target.classList.remove("fake-button-disable")}}}),ma={id:"modders",class:"row mb-2"},ha={class:"col"},ba={key:0,class:"ms-1"},fa={class:"small ms-3"},$a={key:0,class:"text-white-50"};function _a(t,e,i,l,c,p){const d=m("user-link-list"),a=I("bs-tooltip");return o(),n("div",ma,[s("div",ha,[s("div",null,[k(" Modders ("+f(t.beatmap.modders.length)+") ",1),t.canEdit?b((o(),n("small",ba,[s("a",{href:"#",class:B(t.isModder?"text-danger":"text-success"),onClick:e[0]||(e[0]=C(r=>t.updateModder(r),["prevent"]))},[s("i",{class:B(["fas",t.isModder?"fa-minus":"fa-plus"])},null,2)],2)])),[[a,"add/remove yourself from modder list","right"]]):u("",!0)]),s("div",fa,[t.beatmap.modders.length==0?(o(),n("i",$a," none ")):(o(),T(d,{key:1,users:t.beatmap.modders},null,8,["users"]))])])])}const ka=y(pa,[["render",_a]]),ga=g({name:"NominatorsList",components:{UserLinkList:x},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...S(["loggedInUser"]),isBn(){return this.beatmap.bns.some(t=>t.osuId==this.loggedInUser.osuId)}},methods:{async updateBn(t){t.target.classList.add("fake-button-disable");const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateBn`);this.$http.isError(e)||this.$store.dispatch("beatmaps/updateBeatmap",e),t.target.classList.remove("fake-button-disable")}}}),ya={key:0,class:"ms-1"},va=s("i",{class:"fas fa-minus"},null,-1),Ba=[va],wa=s("i",{class:"fas fa-plus"},null,-1),Ca=[wa],La={class:"small ms-3"},Ta={key:0,class:"text-white-50"};function Ia(t,e,i,l,c,p){const d=m("user-link-list"),a=I("bs-tooltip");return o(),n("div",null,[s("div",null,[k(" Potential Nominators ("+f(t.beatmap.bns.length)+") ",1),t.canEdit?b((o(),n("small",ya,[t.isBn?(o(),n("a",{key:0,href:"#",class:"text-danger",onClick:e[0]||(e[0]=C(r=>t.updateBn(r),["prevent"]))},Ba)):u("",!0),!t.isBn&&t.beatmap.bns.length<2?(o(),n("a",{key:1,href:"#",class:"text-success",onClick:e[1]||(e[1]=C(r=>t.updateBn(r),["prevent"]))},Ca)):u("",!0)])),[[a,"add/remove yourself from potential BN list","right"]]):u("",!0)]),s("div",La,[t.beatmap.bns.length==0?(o(),n("i",Ta,"none")):(o(),T(d,{key:1,users:t.beatmap.bns},null,8,["users"]))])])}const Ma=y(ga,[["render",Ia]]),Sa=g({name:"BeatmapLink",props:{beatmap:{type:Object,required:!0}},data(){return{url:"",showLinkInput:!1}},watch:{beatmap(t){t&&(this.showLinkInput=!1,this.url=t.url)}},created(){this.url=this.beatmap.url},methods:{async saveLink(t){const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setLink`,{url:this.url},t);this.$http.isError(e)||(this.showLinkInput=!1,this.$store.dispatch("beatmaps/updateBeatmap",e))}}}),Pa={class:"row mb-2"},qa={class:"col"},Aa=s("i",{class:"fas fa-edit"},null,-1),Oa=[Aa],Qa={class:"small ms-3"},Ua=["href"],Ea={key:1,class:"text-white-50"},Fa={key:0,class:"row mb-2"},Da={class:"col-sm-12"},Va={class:"input-group input-group-sm"};function ja(t,e,i,l,c,p){const d=I("bs-tooltip");return o(),n("div",null,[s("div",Pa,[s("div",qa,[s("div",null,[k(" Link "),b((o(),n("a",{id:"editLink",href:"#",class:B(["text-success small ms-1",{"text-danger":t.showLinkInput}]),onClick:e[0]||(e[0]=C(a=>t.showLinkInput=!t.showLinkInput,["prevent"]))},Oa,2)),[[d,"edit link","right"]])]),s("div",Qa,[t.beatmap.url?(o(),n("a",{key:0,href:t.beatmap.url,target:"_blank"},f(t.beatmap.url),9,Ua)):(o(),n("i",Ea,"none"))])])]),t.showLinkInput?(o(),n("div",Fa,[s("div",Da,[s("div",Va,[b(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.url=a),class:"form-control form-control-sm",type:"text",placeholder:"URL",onKeyup:e[2]||(e[2]=Z(a=>t.saveLink(a),["enter"]))},null,544),[[Y,t.url]]),b((o(),n("button",{id:"addLinkButton",class:"btn btn-outline-info",type:"submit",onClick:e[3]||(e[3]=a=>t.saveLink(a))},[k(" Save ")])),[[d,"use new osu!web link for card image","right"]])])])])):u("",!0)])}const Ha=y(Sa,[["render",ja]]),Na=g({name:"LocksChoice",props:{beatmap:{type:Object,required:!0}},data(){return{lockTaskSelection:"",showLocksInput:!1}},computed:{remainingTasks(){var e,i;let t=Object.values(E);return(i=(e=this.beatmap)==null?void 0:e.tasksLocked)!=null&&i.length&&(t=t.filter(l=>!this.beatmap.tasksLocked.includes(l))),this.lockTaskSelection=t[0]||"",t}},watch:{beatmap(){this.showLocksInput=!1}},methods:{async unlockTask(t,e){e.target.classList.add("fake-button-disable");const i=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/unlockTask`,{task:t});this.$http.isError(i)||this.$store.dispatch("beatmaps/updateBeatmap",i),e.target.classList.remove("fake-button-disable")},async lockTask(t){const e=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/lockTask`,{task:this.lockTaskSelection},t);this.$http.isError(e)||this.$store.dispatch("beatmaps/updateBeatmap",e)}}}),Ra={id:"locks",class:"row mb-1"},Ga={class:"col"},Wa=s("i",{class:"fas fa-edit"},null,-1),Ka=[Wa],za={class:"small ms-3"},Xa={key:0},Ja={key:1},Ya=["onClick"],Za=s("i",{class:"fas fa-minus"},null,-1),xa=[Za],to={class:"text-white-50 mx-1"},eo={key:0,class:"row"},so={class:"col"},ao={class:"input-group input-group-sm"},oo=["value"],io=s("i",{class:"fas fa-lock"},null,-1),no=[io];function lo(t,e,i,l,c,p){const d=I("bs-tooltip");return o(),n("div",null,[s("div",Ra,[s("div",Ga,[s("div",null,[k(" Locks "),t.beatmap.tasksLocked.length!=6?(o(),n("a",{key:0,class:"text-success small ms-1",href:"#",onClick:e[0]||(e[0]=C(a=>t.showLocksInput=!t.showLocksInput,["prevent"]))},Ka)):u("",!0)]),s("div",za,[t.beatmap.tasksLocked.length==0?(o(),n("i",Xa,"none")):u("",!0),t.beatmap.tasksLocked.length>0?(o(),n("div",Ja,[(o(!0),n(v,null,w(t.beatmap.tasksLocked,a=>(o(),n("div",{key:a},[b((o(),n("a",{href:"#",class:"text-danger",onClick:C(r=>t.unlockTask(a,r),["prevent"])},xa,8,Ya)),[[d,"unlock","left"]]),s("span",to,f(a),1)]))),128))])):u("",!0)])])]),t.showLocksInput?(o(),n("div",eo,[s("div",so,[s("div",ao,[b(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.lockTaskSelection=a),class:"form-select"},[(o(!0),n(v,null,w(t.remainingTasks,a=>(o(),n("option",{key:a,value:a},f(a),9,oo))),128))],512),[[A,t.lockTaskSelection]]),b((o(),n("button",{id:"lockTask",class:"btn btn-outline-info",onClick:e[2]||(e[2]=a=>t.lockTask(a))},no)),[[d,"prevent other mappers from claiming a difficulty","right"]])])])])):u("",!0)])}const ro=y(Na,[["render",lo]]),uo=g({name:"Points",props:{beatmap:{type:Object,required:!0}},data(){return{tasksPointsArray:null,usersPointsArrays:null,pointsInfo:null,totalPoints:null,isLoading:!1}},watch:{beatmap(){this.tasksPointsArray=null,this.usersPointsArrays=null,this.pointsInfo=null,this.totalPoints=null,this.isLoading=!1}},methods:{async findPoints(t){this.isLoading=!0;const e=await this.$http.executeGet(`/beatmaps/${this.beatmap.id}/findPoints`,t);this.$http.isError(e)||(this.tasksPointsArray=e.tasksPointsArray,this.usersPointsArrays=e.usersPointsArrays,this.pointsInfo=e.pointsInfo,this.totalPoints=e.totalPoints),this.isLoading=!1}}}),co={class:"row"},po={class:"col-sm-12"},mo={key:1,class:"small text-white-50 ms-2"},ho={key:2,class:"small text-white-50 ms-2"},bo={key:0,class:"col-sm-6"},fo={class:"small text-white-50"},$o={class:"col-sm-6"},_o={key:0,class:"small text-white-50"},ko={key:1,class:"col-sm-12"},go={class:"small text-white-50 ms-2"};function yo(t,e,i,l,c,p){const d=I("bs-tooltip");return o(),n("div",null,[s("div",co,[s("div",po,[t.tasksPointsArray?u("",!0):b((o(),n("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:e[0]||(e[0]=a=>t.findPoints(a))},[k(" Calculate points ")])),[[d,"calculate points for all difficulties"]]),t.isLoading?(o(),n("span",mo," calculating... ")):t.pointsInfo?(o(),n("span",ho,f(t.pointsInfo),1)):u("",!0)]),t.tasksPointsArray?(o(),n("div",bo,[s("ul",fo,[(o(!0),n(v,null,w(t.tasksPointsArray,(a,r)=>(o(),n("li",{key:r},f(a),1))),128))])])):u("",!0),s("div",$o,[t.usersPointsArrays?(o(),n("ul",_o,[(o(!0),n(v,null,w(t.usersPointsArrays,(a,r)=>(o(),n("li",{key:r},f(t.usersPointsArrays[r][0])+": "+f(t.usersPointsArrays[r][1]),1))),128))])):u("",!0)]),t.totalPoints?(o(),n("div",ko,[s("span",go," total: "+f(Math.round(t.totalPoints*10)/10),1)])):u("",!0)])])}const vo=y(uo,[["render",yo]]),Bo=g({name:"BeatmapInfo",components:{ModeChoice:Ye,StatusChoice:os,TasksChoice:Js,QuestChoice:ca,ModdersList:ka,NominatorsList:Ma,BeatmapLink:Ha,LocksChoice:ro,Points:vo},props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:null}},computed:{...S(["loggedInUser"]),isHost(){return this.loggedInUser.id&&this.beatmap?this.loggedInUser.id===this.beatmap.host.id:!1},isRanked(){return this.beatmap.status===V.Ranked},isQualified(){return this.beatmap.status===V.Qualified}},methods:{async deleteMap(t){if(confirm("Are you sure you want to delete?")){t.target.disabled=!0;const i=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/delete`,{},t);this.$http.isError(i)||(this.$bs.hideModal("editBeatmap"),this.$store.commit("beatmaps/deleteBeatmap",i)),t.target.disabled=!1}}}});const st=t=>(X("data-v-9faf922e"),t=t(),J(),t),wo={key:0,class:"container"},Co={class:"row"},Lo={class:"row mb-2"},To={class:"col-sm-6"},Io={key:0,id:"bns",class:"col-sm-6"},Mo=st(()=>s("hr",null,null,-1)),So={class:"row"},Po={class:"col-sm"},qo={key:0,class:"col-lg-5 bm-col-separator-left"},Ao={class:"row mb-2"},Oo={class:"col-sm"},Qo={class:"row mb-2"},Uo={class:"col-sm"},Eo=st(()=>s("hr",null,null,-1)),Fo={class:"row"},Do={class:"col-sm-4 text-end"},Vo={class:"small text-white-50"};function jo(t,e,i,l,c,p){const d=m("modders-list"),a=m("nominators-list"),r=m("tasks-choice"),_=m("mode-choice"),h=m("status-choice"),L=m("quest-choice"),D=m("beatmap-link"),Q=m("locks-choice"),ot=m("points");return t.beatmap?(o(),n("div",wo,[s("div",Co,[s("div",{class:B(t.isHost&&!t.isRanked&&!t.isQualified?"col-lg-7":"col-sm-12")},[s("div",Lo,[s("div",To,[$(d,{beatmap:t.beatmap,"can-edit":!t.isHost&&!t.isRanked},null,8,["beatmap","can-edit"])]),!t.isRanked||t.beatmap.bns?(o(),n("div",Io,[$(a,{beatmap:t.beatmap,"can-edit":!t.isHost&&!t.isRanked},null,8,["beatmap","can-edit"])])):u("",!0)]),Mo,s("div",So,[s("div",Po,[$(r,{beatmap:t.beatmap,"is-host":t.isHost,"is-ranked":t.isRanked,"is-qualified":t.isQualified},null,8,["beatmap","is-host","is-ranked","is-qualified"])])])],2),t.isHost&&!t.isRanked&&!t.isQualified?(o(),n("div",qo,[s("div",Ao,[s("div",Oo,[t.beatmap.status=="WIP"||t.beatmap.status=="Secret"?(o(),T(_,{key:0,beatmap:t.beatmap},null,8,["beatmap"])):u("",!0)])]),s("div",Qo,[s("div",Uo,[t.beatmap.status!=="Secret"?(o(),T(h,{key:0,beatmap:t.beatmap},null,8,["beatmap"])):u("",!0)])]),t.beatmap.status!=="Secret"?(o(),T(L,{key:0,beatmap:t.beatmap},null,8,["beatmap"])):u("",!0),$(D,{beatmap:t.beatmap},null,8,["beatmap"]),t.beatmap.status=="WIP"||t.beatmap.status=="Secret"?(o(),T(Q,{key:1,beatmap:t.beatmap},null,8,["beatmap"])):u("",!0)])):u("",!0)]),Eo,s("div",Fo,[$(ot,{class:"col-sm-8",beatmap:t.beatmap},null,8,["beatmap"]),s("div",Do,[s("span",Vo," Created: "+f(t.beatmap.createdAt.toString().slice(0,10)),1),t.isHost&&!t.isRanked?(o(),n("button",{key:0,id:"deleteButton",class:"btn btn-sm btn-outline-danger ms-2",onClick:e[0]||(e[0]=it=>t.deleteMap(it))}," Delete ")):u("",!0)])])])):u("",!0)}const at=y(Bo,[["render",jo],["__scopeId","data-v-9faf922e"]]),Ho=g({name:"BeatmapTableRow",components:{BeatmapInfo:at,ProcessTasks:tt,QuestImg:N,ModesIcons:F},props:{beatmap:{type:Object,required:!0}},methods:{selectBeatmap(){this.$route.query.id!==this.beatmap.id&&this.$router.push(`/beatmaps?id=${this.beatmap.id}`)},formatMetadata(){const t=this.beatmap.song.artist+" - "+this.beatmap.song.title;return t.length>70?t.slice(0,70)+"...":t},statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}}}),No={class:"container"},Ro={class:"row"},Go={class:"col-sm-6"},Wo=["data-bs-target"],Ko=s("i",{class:"fas fa-angle-down"},null,-1),zo={class:"col-sm-2 small d-flex justify-content-end align-items-center"},Xo={class:"col-sm-3 small"},Jo=s("span",{class:"text-white-50 me-1"},"Hosted by",-1),Yo={key:0,class:"text-white-50"},Zo={key:0,class:"col-sm-1 d-flex justify-content-end align-items-center"},xo=["href"],ti=s("i",{class:"fas fa-link"},null,-1),ei=[ti],si=["id"];function ai(t,e,i,l,c,p){const d=m("quest-img"),a=m("process-tasks"),r=m("user-link"),_=m("modes-icons"),h=m("beatmap-info");return o(),n("div",null,[s("div",{class:B(["card card-body card-level-2 my-1 p-1",t.statusBorder()])},[s("div",No,[s("div",Ro,[s("div",Go,[$(d,{beatmap:t.beatmap},null,8,["beatmap"]),s("a",{href:"#","data-bs-toggle":"collapse","data-bs-target":"#details"+t.beatmap.id,onClick:e[0]||(e[0]=L=>t.selectBeatmap())},[k(f(t.formatMetadata())+" ",1),Ko],8,Wo)]),s("div",zo,[$(a,{tasks:t.beatmap.tasks,"tasks-locked":t.beatmap.tasksLocked,mode:t.beatmap.mode},null,8,["tasks","tasks-locked","mode"])]),s("div",Xo,[Jo,$(r,{class:"me-1",user:t.beatmap.host},null,8,["user"]),t.beatmap.mode!=="osu"?(o(),n("span",Yo,[$(_,{modes:[t.beatmap.mode]},null,8,["modes"])])):u("",!0)]),t.beatmap.url?(o(),n("div",Zo,[s("a",{href:t.beatmap.url,target:"_blank"},ei,8,xo)])):u("",!0)])])],2),s("div",{id:"details"+t.beatmap.id,class:B(["collapse my-2 mx-4 row border-end border-start py-3","border-"+t.beatmap.status.toLowerCase()])},[$(h,{beatmap:t.beatmap},null,8,["beatmap"])],10,si)])}const oi=y(Ho,[["render",ai]]),ii=g({components:{BeatmapTableRow:oi},computed:S("beatmaps",{otherBeatmaps:"allBeatmaps",isLoadingOtherBeatmaps:"isLoadingOtherBeatmaps",filterValue:"filterValue"}),methods:{async showMore(t){t.target.disabled=!0,this.$store.commit("beatmaps/increaseFetchLimit"),await this.$store.dispatch("beatmaps/loadOtherBeatmaps"),t.target.disabled=!1}}}),ni={class:"container card card-body py-3"},li={class:"ms-2"},di={href:"#otherBeatmaps","data-bs-toggle":"collapse"},ri=s("i",{class:"fas fa-angle-down"},null,-1),ui={key:0,id:"otherBeatmaps",class:"collapse"},ci={key:0,class:"ms-5 text-white-50"},pi={key:1,class:"text-center"},mi=s("i",{class:"fas fa-angle-down me-1"},null,-1),hi=s("i",{class:"fas fa-angle-down ms-1"},null,-1);function bi(t,e,i,l,c,p){const d=m("beatmap-table-row");return o(),n("div",ni,[s("h5",li,[s("a",di,[k(" Other beatmaps ("+f(t.otherBeatmaps&&!t.isLoadingOtherBeatmaps?t.otherBeatmaps.length:"...")+") ",1),ri])]),t.otherBeatmaps?(o(),n("div",ui,[s("div",{class:B({"loading-data":t.isLoadingOtherBeatmaps})},[!t.otherBeatmaps.length&&!t.isLoadingOtherBeatmaps?(o(),n("p",ci," None... ")):u("",!0),(o(!0),n(v,null,w(t.otherBeatmaps,a=>(o(),T(d,{key:a.id,beatmap:a},null,8,["beatmap"]))),128)),t.filterValue?u("",!0):(o(),n("div",pi,[s("button",{class:"btn btn-sm btn-outline-info my-4",onClick:e[0]||(e[0]=C(a=>t.showMore(a),["prevent"]))},[mi,k(" show more "),hi])]))],2)])):u("",!0)])}const fi=y(ii,[["render",bi]]),$i=g({components:{BeatmapInfo:at,ModalDialog:W,QuestImg:N,ModesIcons:F},props:{selectedBeatmap:{type:Object,default:()=>({})}},watch:{selectedBeatmap(){this.selectedBeatmap&&this.$route.query.id!==this.selectedBeatmap.id&&this.$router.replace(`/beatmaps?id=${this.selectedBeatmap.id}`)}}}),_i=["href"],ki=s("i",{class:"fas fa-link"},null,-1),gi={key:1};function yi(t,e,i,l,c,p){const d=m("quest-img"),a=m("user-link"),r=m("modes-icons"),_=m("beatmap-info"),h=m("modal-dialog");return o(),T(h,{id:"editBeatmap",loaded:Boolean(t.selectedBeatmap),"header-class":t.selectedBeatmap?"bg-"+t.selectedBeatmap.status.toLowerCase():""},{header:M(()=>[$(d,{beatmap:t.selectedBeatmap},null,8,["beatmap"]),t.selectedBeatmap.url?(o(),n("a",{key:0,href:t.selectedBeatmap.url,target:"_blank"},[ki,k(" "+f(t.selectedBeatmap.song.artist)+" - "+f(t.selectedBeatmap.song.title),1)],8,_i)):(o(),n("span",gi,f(t.selectedBeatmap.song.artist)+" - "+f(t.selectedBeatmap.song.title),1)),k(" |"),$(a,{class:"mx-1",user:t.selectedBeatmap.host},null,8,["user"]),$(r,{modes:[t.selectedBeatmap.mode]},null,8,["modes"])]),default:M(()=>[$(_,{beatmap:t.selectedBeatmap},null,8,["beatmap"])]),_:1},8,["loaded","header-class"])}const vi=y($i,[["render",yi]]),Bi={namespaced:!0,state:{allBeatmaps:[],userBeatmaps:[],filterValue:"",filterMode:G.any,filterStatus:"any",filterQuest:"any",selectedBeatmap:null,selectedBeatmapId:null,fetchLimit:30,isLoadingOtherBeatmaps:!0},mutations:{setAllBeatmaps(t,e){t.allBeatmaps=e},setUserBeatmaps(t,e){t.userBeatmaps=e},setFilterValue(t,e){t.filterValue=e},setFilterMode(t,e){t.filterMode=e},setFilterStatus(t,e){t.filterStatus=e},setFilterQuest(t,e){t.filterQuest=e},setIsLoadingOtherBeatmaps(t,e){t.isLoadingOtherBeatmaps=e},increaseFetchLimit(t){t.fetchLimit+=50},setSelectedBeatmap(t,e){const i=Object.values(E);e.tasks.sort(function(l,c){return i.indexOf(l.name)-i.indexOf(c.name)}),e.tasksLocked.sort(function(l,c){return i.indexOf(l)-i.indexOf(c)}),t.selectedBeatmap=e},addBeatmap(t,e){t.userBeatmaps.unshift(e)},updateBeatmap(t,e){let i=t.allBeatmaps.findIndex(l=>l.id===e.id);i!==-1&&(t.allBeatmaps[i]=e),i=t.userBeatmaps.findIndex(l=>l.id===e.id),i!==-1&&(t.userBeatmaps[i]=e)},deleteBeatmap(t,e){let i=t.allBeatmaps.findIndex(l=>l.id===e.id);i!==-1&&t.allBeatmaps.splice(i,1),i=t.userBeatmaps.findIndex(l=>l.id===e.id),i!==-1&&t.userBeatmaps.splice(i,1)}},getters:{filteredUserBeatmaps:t=>{let e=t.userBeatmaps;if(t.filterMode!==G.any){const i=t.filterMode;e=e.filter(l=>l.mode===i||l.mode===q.Hybrid)}if(t.filterStatus!=="any"&&(e=e.filter(i=>i.status===t.filterStatus)),t.filterQuest!=="any"&&(e=e.filter(i=>!i.quest)),t.filterValue){const i=t.filterValue.toLowerCase().trim().split(" ").filter(l=>l.length);e=e.filter(l=>{let c=l.song.artist+" "+l.song.title+" "+l.host.username;return l.tasks.forEach(p=>{p.mappers.forEach(d=>{c+=" "+d.username})}),c=c.toLowerCase(),i.some(p=>c.includes(p))})}return e},guestDifficultyBeatmaps:(t,e,i)=>e.filteredUserBeatmaps.filter(l=>{var c;return l.host.id!==((c=i.loggedInUser)==null?void 0:c.id)}),hostedBeatmaps:(t,e,i)=>e.filteredUserBeatmaps.filter(l=>{var c;return l.host.id===((c=i.loggedInUser)==null?void 0:c.id)})},actions:{updateBeatmap({commit:t,state:e},i){var l;t("updateBeatmap",i),((l=e.selectedBeatmap)==null?void 0:l.id)===i.id&&t("setSelectedBeatmap",i)},async updateFilterMode({commit:t,dispatch:e},i){t("setFilterMode",i),await e("loadOtherBeatmaps")},async updateFilterStatus({commit:t,dispatch:e},i){t("setFilterStatus",i),await e("loadOtherBeatmaps")},async updateFilterQuest({commit:t,dispatch:e},i){t("setFilterQuest",i),await e("loadOtherBeatmaps")},async updateFilterValue({commit:t,dispatch:e},i){t("setFilterValue",i),await e("loadOtherBeatmaps")},async loadOtherBeatmaps({commit:t,state:e}){var d;t("setIsLoadingOtherBeatmaps",!0);const i=e.filterStatus!=="any"?`&status=${e.filterStatus}`:"",l=e.filterQuest!=="any"?`&quest=${e.filterQuest}`:"",c=e.filterValue?`&search=${e.filterValue}`:"",p=await dt.get(`/api/beatmaps/search?mode=${e.filterMode}&limit=${e.fetchLimit+i+l+c}`);(d=p.data)!=null&&d.allBeatmaps&&t("setAllBeatmaps",p.data.allBeatmaps),t("setIsLoadingOtherBeatmaps",!1)}}},wi=Bi,Ci=g({name:"BeatmapPage",components:{BeatmapPageFilters:ie,HostedBeatmaps:Be,GuestDifficulties:Pe,OtherBeatmaps:fi,EditBeatmapModal:vi,CreateBeatmapModal:Wt},data(){return{isLoadingGuestBeatmaps:!0}},computed:S("beatmaps",["selectedBeatmap"]),beforeCreate(){this.$store.hasModule("beatmaps")||this.$store.registerModule("beatmaps",wi)},async created(){const t=this.$route.query.id;let e,i;t?([e,i]=await Promise.all([this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.executeGet("/beatmaps/searchOnLoad/"+t)]),this.$http.isError(i)||(this.$store.commit("beatmaps/setSelectedBeatmap",i),this.$bs.showModal("editBeatmap"))):e=await this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.isError(e)||(this.$store.commit("beatmaps/setUserBeatmaps",e.beatmaps),this.$store.commit("beatmaps/setFilterMode",e.mainMode)),await Promise.all([this.loadGuestBeatmaps(),this.$store.dispatch("beatmaps/loadOtherBeatmaps")]),this.isLoadingGuestBeatmaps=!1},methods:{async loadGuestBeatmaps(){const t=await this.$http.executeGet("/beatmaps/guestBeatmaps");t&&this.$store.commit("beatmaps/setUserBeatmaps",t.userBeatmaps)}}}),Li=s("div",{class:"radial-divisor"},null,-1),Ti=s("div",{class:"radial-divisor"},null,-1);function Ii(t,e,i,l,c,p){const d=m("beatmap-page-filters"),a=m("hosted-beatmaps"),r=m("guest-difficulties"),_=m("other-beatmaps"),h=m("edit-beatmap-modal"),L=m("create-beatmap-modal");return o(),n("div",null,[$(d),$(a),Li,$(r,{"is-loading-guest-beatmaps":t.isLoadingGuestBeatmaps},null,8,["is-loading-guest-beatmaps"]),Ti,$(_),$(h,{"selected-beatmap":t.selectedBeatmap},null,8,["selected-beatmap"]),$(L)])}const Ui=y(Ci,[["render",Ii]]);export{Ui as default};
