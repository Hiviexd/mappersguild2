import{d as y,M as U,m as q,_ as v,o as a,c as I,w as P,a as t,b as $,v as C,e as i,r as B,t as h,F as w,f as Q,g as E,h as ie,i as b,j as k,k as m,n as M,T as V,l as ne,p as f,q as S,s as R,u as W,x as le,y as L,B as z,z as F,A as K,C as Y,D as j,E as de}from"./index-0c8d1b90.js";import{M as X}from"./ModalDialog-eaeaef64.js";import{U as D}from"./UserLinkList-f911f37a.js";import{F as re}from"./FilterBox-f5bd62c0.js";import{M as ue,F as H}from"./extras-b8d26cf8.js";import{T as O,a as J}from"./task-0811ab65.js";import{T as pe}from"./TasksChoice-1818eca7.js";const ce=y({name:"CreateBeatmapModal",components:{ModalDialog:X,UserLinkList:D,ModesIcons:U},data(){return{featuredArtists:[],featuredSongs:[],selectedArtist:"",artistInput:"",selectedSong:"",selectedMode:"osu",selectedTaskStatus:"",previousSelectedMode:"",selectedTaskMode:"osu",checkedLocks:[],modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}],tasks:["Easy","Normal","Hard","Insane","Expert","Storyboard"],newTaskName:"",newTaskMapper:"",tempTasks:[]}},computed:{...q(["loggedInUser"]),sortedTasks(){const e=["Easy","Normal","Hard","Insane","Expert","Storyboard"],s=["osu","taiko","catch","mania","sb"];return[...this.tempTasks].sort(function(l,p){return e.indexOf(l.name)-e.indexOf(p.name)}).sort(function(l,p){return s.indexOf(l.mode)-s.indexOf(p.mode)})}},watch:{selectedMode(){this.selectedMode=="hybrid"&&(this.tempTasks=[]),this.previousSelectedMode=="hybrid"&&(this.tempTasks=[]),this.previousSelectedMode=this.selectedMode}},async created(){const e=await this.$http.executeGet("/featuredArtists");e&&(this.featuredArtists=e.sort((s,o)=>s.label.toLowerCase()>o.label.toLowerCase()?1:o.label.toLowerCase()>s.label.toLowerCase()?-1:0))},methods:{async setArtist(e){if(!this.selectedArtist&&!this.artistInput){this.$store.dispatch("updateToastMessages",{message:"Select or type an artist!",type:"danger"});return}if(this.artistInput){const o=this.featuredArtists.find(l=>l.label.toLowerCase().includes(this.artistInput.toLowerCase()));o&&(this.selectedArtist=o.id)}if(!this.selectedArtist){this.$store.dispatch("updateToastMessages",{message:"Couldn't find artist! Check your typing or select one from the list.",type:"danger"});return}e.target.disabled=!0;const s=await this.$http.executeGet(`/featuredArtists/${this.selectedArtist}/songs`);s&&(this.featuredSongs=s.sort((o,l)=>o.title.toLowerCase()>l.title.toLowerCase()?1:l.title.toLowerCase()>o.title.toLowerCase()?-1:0)),e.target.disabled=!1},async addTempTask(e){if(!this.newTaskName.length||!this.selectedTaskStatus.length){this.$store.dispatch("updateToastMessages",{message:"Missing task or status",type:"danger"});return}const s=await this.$http.executeGet(`/beatmaps/validateUsers/${this.newTaskMapper.length?this.newTaskMapper:this.loggedInUser.username}`,e);s&&s.length&&this.tempTasks.push({name:this.newTaskName,mappers:s,mode:this.selectedTaskMode,status:this.selectedTaskStatus,random:Math.random().toString()})},removeTempTask(e){const s=this.tempTasks.findIndex(o=>o.random==e);this.tempTasks.splice(s,1)},async saveNewMap(e){if(!this.selectedSong){this.$store.dispatch("updateToastMessages",{message:"Select a song!",type:"info"});return}const s=await this.$http.executePost("/beatmaps/create/",{song:this.selectedSong,tasks:this.tempTasks,tasksLocked:this.checkedLocks,mode:this.selectedMode},e);this.$http.isError(s)||(this.$bs.hideModal("addBeatmap"),this.$store.commit("beatmaps/addBeatmap",s))}}});const _=e=>(R("data-v-143a232c"),e=e(),W(),e),me={class:"container"},he={class:"mb-3 row"},fe=_(()=>t("div",{class:"col-lg-1"},[t("p",{style:{"margin-top":"3px"}}," Artist: ")],-1)),be={class:"col-lg-11"},_e={id:"artistForm",class:"input-group input-group-sm mb-3"},$e=_(()=>t("option",{value:""}," Select an artist ",-1)),ke=_(()=>t("option",{value:"-",disabled:""}," --- ",-1)),ge=["value"],ye=_(()=>t("div",{class:"col-lg-1"},[t("p",{style:{"margin-top":"3px"}}," Song: ")],-1)),ve={class:"col-lg-11"},Be=["disabled"],we=_(()=>t("option",{value:"",disabled:""}," Select an artist to view songs ",-1)),Me=_(()=>t("option",{value:"-",disabled:""}," --- ",-1)),Ie=["value"],Le=_(()=>t("hr",null,null,-1)),Se=_(()=>t("p",null," Game-mode: ",-1)),Te={class:"mb-3 row"},Ce={class:"col-sm-10"},Pe=["id","value"],qe=["for"],Oe=_(()=>t("br",null,null,-1)),Ae=_(()=>t("hr",null,null,-1)),Ue=_(()=>t("div",{class:"mb-2"},[k(" Set your mapset's difficulties "),t("div",{class:"small text-secondary"}," These can be changed later. ")],-1)),Qe={key:0,class:"table table-sm"},Ee=_(()=>t("thead",null,[t("tr",null,[t("th",null,"Difficulty"),t("th",null,"Mapper(s)"),t("th",null,"Status"),t("th")])],-1)),Fe={class:"text-secondary"},Ve=["onClick"],De=_(()=>t("i",{class:"fas fa-times"},null,-1)),Ne=[De],Ge={class:"col-sm-12"},je={class:"input-group input-group-sm mx-auto"},He=_(()=>t("option",{value:"",disabled:"",selected:""}," Select a task ",-1)),Re=["value"],We=_(()=>t("option",{value:"osu"}," osu! ",-1)),ze=_(()=>t("option",{value:"taiko"}," osu!taiko ",-1)),Ke=_(()=>t("option",{value:"catch"}," osu!catch ",-1)),Ye=_(()=>t("option",{value:"mania"}," osu!mania ",-1)),Xe=[We,ze,Ke,Ye],Je=_(()=>t("option",{value:"",disabled:"",selected:""}," Select a status ",-1)),Ze=_(()=>t("option",{value:"WIP"}," Work-in-progress ",-1)),xe=_(()=>t("option",{value:"Done"}," Done ",-1)),es=[Je,Ze,xe],ss=_(()=>t("i",{class:"fas fa-plus"},null,-1)),ts=[ss],as=_(()=>t("div",{class:"text-secondary small mt-1"},[t("ul",{class:"small"},[t("li",null,'You can leave the "mapper" field empty for your own difficulties.'),t("li",null,'Use comma separation for collabs, like "mapper1, mapper2"')])],-1)),os=_(()=>t("hr",null,null,-1)),is=_(()=>t("div",{class:"mb-2"},[k(" Set any difficulties that nobody else is allowed to claim. "),t("div",{class:"small text-secondary"}," For example, if you don't want any guest difficulties, you should select all. These can be changed later. ")],-1)),ns={class:"mb-3 row"},ls={class:"col-sm-10"},ds=["id","value"],rs=["for"],us=_(()=>t("div",{class:"radial-divisor"},null,-1)),ps={class:"small text-secondary mt-2"},cs={class:"small"},ms=_(()=>t("i",null,"after",-1)),hs=_(()=>t("li",null,[k("Your beatmap was ranked "),t("i",null,"after"),k(" the Featured Artist was announced, excluding maps created for the announcement")],-1)),fs=_(()=>t("li",null,"Difficulties match between Mappers' Guild and osu! website (including difficulty levels and mappers)",-1)),bs=_(()=>t("li",null,"Background does not contain content from other media franchises (like Mikasa from Attack on Titan), excluding creative commons content (like Hatsune Miku) or content permitted by franchise owners (like Touhou)",-1));function _s(e,s,o,l,p,c){const r=f("modes-icons"),n=f("user-link-list"),u=f("modal-dialog"),g=S("bs-tooltip");return a(),I(u,{id:"addBeatmap",title:"Add beatmap"},{default:P(()=>[t("div",me,[t("div",he,[fe,t("div",be,[t("div",_e,[$(t("select",{"onUpdate:modelValue":s[0]||(s[0]=d=>e.selectedArtist=d),class:"form-select"},[$e,ke,(a(!0),i(w,null,B(e.featuredArtists,d=>(a(),i("option",{key:d.id,value:d.id},h(d.label),9,ge))),128))],512),[[C,e.selectedArtist]]),$(t("input",{"onUpdate:modelValue":s[1]||(s[1]=d=>e.artistInput=d),type:"text",class:"form-control",placeholder:"or input the artist's name...",onKeyup:s[2]||(s[2]=E(d=>e.setArtist(d),["enter"]))},null,544),[[Q,e.artistInput]]),t("button",{id:"artistButton",class:"btn btn-outline-info",onClick:s[3]||(s[3]=d=>e.setArtist(d))}," Load songs ")])]),ye,t("div",ve,[$(t("select",{"onUpdate:modelValue":s[4]||(s[4]=d=>e.selectedSong=d),class:"form-select form-select-sm",disabled:!e.featuredSongs.length},[we,Me,(a(!0),i(w,null,B(e.featuredSongs,d=>(a(),i("option",{key:d.id,value:d.id},h(d.title)+" --- ("+h(d.artist)+") ",9,Ie))),128))],8,Be),[[C,e.selectedSong]])])]),Le,Se,t("div",Te,[t("div",Ce,[(a(!0),i(w,null,B(e.modes,d=>(a(),i("div",{key:d.value,class:"form-check form-check-inline"},[$(t("input",{id:d.value,"onUpdate:modelValue":s[5]||(s[5]=T=>e.selectedMode=T),class:"form-check-input",type:"radio",value:d.value},null,8,Pe),[[ie,e.selectedMode]]),t("label",{class:"form-check-label",for:d.value},h(d.name),9,qe)]))),128)),Oe])]),Ae,Ue,e.tempTasks.length?(a(),i("table",Qe,[Ee,b(V,{tag:"tbody",name:"list"},{default:P(()=>[(a(!0),i(w,null,B(e.tempTasks,d=>(a(),i("tr",{key:d.random},[t("td",Fe,[k(h(d.name)+" ",1),e.selectedMode=="hybrid"?(a(),I(r,{key:0,modes:[d.mode]},null,8,["modes"])):m("",!0)]),t("td",null,[b(n,{users:d.mappers},null,8,["users"])]),t("td",{class:M(d.status=="WIP"?"text-wip":"text-success")},h(d.status),3),t("td",null,[$((a(),i("a",{href:"#",class:"text-danger",onClick:T=>e.removeTempTask(d.random)},Ne,8,Ve)),[[g,"delete"]])])]))),128))]),_:1})])):m("",!0),t("div",Ge,[t("div",je,[$(t("select",{"onUpdate:modelValue":s[6]||(s[6]=d=>e.newTaskName=d),class:"form-select"},[He,(a(!0),i(w,null,B(e.tasks,d=>(a(),i("option",{key:d,value:d},h(d),9,Re))),128))],512),[[C,e.newTaskName]]),e.selectedMode=="hybrid"?$((a(),i("select",{key:0,"onUpdate:modelValue":s[7]||(s[7]=d=>e.selectedTaskMode=d),class:"form-select"},Xe,512)),[[C,e.selectedTaskMode]]):m("",!0),$(t("select",{"onUpdate:modelValue":s[8]||(s[8]=d=>e.selectedTaskStatus=d),class:"form-select"},es,512),[[C,e.selectedTaskStatus]]),$(t("input",{"onUpdate:modelValue":s[9]||(s[9]=d=>e.newTaskMapper=d),class:"form-control",type:"text",placeholder:"mapper name or osu! ID...",onKeyup:s[10]||(s[10]=E(d=>e.addTempTask(d),["enter"]))},null,544),[[Q,e.newTaskMapper]]),$((a(),i("button",{class:"btn btn-outline-info",onClick:s[11]||(s[11]=d=>e.addTempTask(d))},ts)),[[g,"add difficulty"]])]),as]),os,is,t("div",ns,[t("div",ls,[(a(!0),i(w,null,B(e.tasks,d=>(a(),i("div",{key:d,class:"form-check"},[$(t("input",{id:`lock-${d}`,"onUpdate:modelValue":s[12]||(s[12]=T=>e.checkedLocks=T),class:"form-check-input",type:"checkbox",value:d},null,8,ds),[[ne,e.checkedLocks]]),t("label",{class:"form-check-label",for:`lock-${d}`},h(d),9,rs)]))),128))])])]),t("button",{type:"submit",class:"btn btn-outline-success w-100",onClick:s[13]||(s[13]=d=>e.saveNewMap(d))}," Create beatmap "),us,t("div",ps,[t("div",cs,[k(" Note that you can only earn points for beatmaps that fit these requirements: "),t("ul",null,[t("li",null,[k("Your beatmap was ranked "),ms,k(" you joined the Mappers' Guild ("),t("code",null,h(e.loggedInUser.createdAt),1),k(")")]),hs,fs,bs])])])]),_:1})}const $s=v(ce,[["render",_s],["__scopeId","data-v-143a232c"]]),ks=y({name:"BeatmapPageFilters",components:{FilterBox:re,ModeFilters:ue},data(){return{statuses:{any:"Any",WIP:"WIP",Done:"Done",Qualified:"Qualified",Ranked:"Ranked"},quests:{any:"Any",none:"None"}}},computed:q("beatmaps",["filterMode","filterValue","filterStatus","filterQuest"]),methods:{...le("beatmaps",["updateFilterValue","updateFilterMode","updateFilterStatus","updateFilterQuest"]),getStatusSortClass(e){return this.filterStatus===e?"sorted":"unsorted"},getQuestSortClass(e){return this.filterQuest===e?"sorted":"unsorted"}}}),gs={class:"container card card-body py-3 mb-2"},ys=t("button",{class:"btn btn-primary",href:"#","data-bs-toggle":"modal","data-bs-target":"#addBeatmap"},[k(" Add beatmap "),t("i",{class:"fas fa-plus fa-xs"})],-1),vs={class:"row mt-3"},Bs=t("div",{class:"col-auto filter-title"}," Status ",-1),ws={class:"col"},Ms=["onClick"],Is={class:"row mt-3"},Ls=t("div",{class:"col-auto filter-title"}," Quest ",-1),Ss={class:"col"},Ts=["onClick"];function Cs(e,s,o,l,p,c){const r=f("mode-filters"),n=f("filter-box");return a(),i("div",gs,[b(n,{placeholder:"enter to search for song/username...","filter-value":e.filterValue,"onUpdate:filterValue":s[1]||(s[1]=u=>e.updateFilterValue(u))},{filters:P(()=>[b(r,{"filter-mode":e.filterMode,"onUpdate:filterMode":s[0]||(s[0]=u=>e.updateFilterMode(u))},null,8,["filter-mode"]),t("div",vs,[Bs,t("div",ws,[(a(!0),i(w,null,B(e.statuses,(u,g)=>(a(),i("a",{key:g,href:"#",class:M(["status",e.getStatusSortClass(g)]),onClick:L(d=>e.updateFilterStatus(g),["prevent"])},h(u),11,Ms))),128))])]),t("div",Is,[Ls,t("div",Ss,[(a(!0),i(w,null,B(e.quests,(u,g)=>(a(),i("a",{key:g,href:"#",class:M(["quest",e.getQuestSortClass(g)]),onClick:L(d=>e.updateFilterQuest(g),["prevent"])},h(u),11,Ts))),128))])])]),default:P(()=>[ys]),_:1},8,["filter-value"])])}const Ps=v(ks,[["render",Cs]]);function A(e,s,o){const l={class:["px-1","text-"+s.toLowerCase()]};return o&&(l["data-bs-toggle"]="tooltip",l["data-bs-placement"]="top",l.title=o),F("span",l,e)}const Z=y({props:{tasks:{type:Array,required:!0},tasksLocked:{type:Array,required:!0},mode:{type:String,required:!0}},render(){const e=[{name:"Storyboard",short:"SB",locked:!1,status:[]},{name:"Easy",short:"E",locked:!1,status:[]},{name:"Normal",short:"N",locked:!1,status:[]},{name:"Hard",short:"H",locked:!1,status:[]},{name:"Insane",short:"I",locked:!1,status:[]},{name:"Expert",short:"X",locked:!1,status:[]}],s=[{name:"osu",short:"circle",count:0,status:O.Done},{name:"taiko",short:"drum",count:0,status:O.Done},{name:"catch",short:"apple-alt",count:0,status:O.Done},{name:"mania",short:"stream",count:0,status:O.Done}],o=[],l=this.tasks.length>=10,p=this.mode===z.Hybrid;for(const c of e){let r=!1;const n=this.tasksLocked.includes(c.name);for(const u of this.tasks)if(c.name===u.name){c.status.push(u.status),r=!0;const g=s.findIndex(d=>d.name===u.mode);g!==-1&&(s[g].count++,u.status===O.WIP&&(s[g].status=O.WIP))}if(!p){if(l&&c.status.length>1)o.push(A(c.short+"+","secondary",c.status.length.toString()));else for(const u of c.status)o.push(A(c.short,u));r||o.push(A(c.short,n?"blocked":"open"))}}if(p)for(const c of s)o.push(A([F("i",{class:["fas","fa-"+c.short]})],c.count?c.status:"blocked",c.count.toString()));return F("span",{class:"fw-bold"},o)}}),qs=y({props:{beatmap:{type:Object,required:!0}},computed:{url(){var e;if(this.beatmap.mission)switch(this.beatmap.mission.tier){case 1:return"/images/dark-bronze.png";case 2:return"/images/dark-silver.png";case 3:return"/images/dark-gold.png";case 4:return"/images/dark-platinum.png";default:return"/images/dark-bronze.png"}return this.beatmap.isShowcase||!((e=this.beatmap.quest)!=null&&e.art)?"/images/no-art-icon.png":this.beatmap.quest.isMbc?"/images/mbc-icon.png":`https://assets.ppy.sh/artists/${this.beatmap.quest.art}/cover.jpg`}}});const Os=["src"];function As(e,s,o,l,p,c){const r=S("bs-tooltip");return e.beatmap.quest||e.beatmap.mission||e.beatmap.isShowcase?$((a(),i("img",{key:0,class:"rounded-circle me-1 quest-icon",src:e.url},null,8,Os)),[[r,e.beatmap.quest&&e.beatmap.quest.name||e.beatmap.mission&&e.beatmap.mission.name||"FA showcase"]]):m("",!0)}const N=v(qs,[["render",As],["__scopeId","data-v-b923d27f"]]),Us=y({name:"BeatmapCard",components:{ProcessTasks:Z,QuestImg:N,ModesIcons:U},props:{beatmap:{type:Object,required:!0}},emits:["update:selectedBeatmap"],data(){return{defaultUrl:"https://osu.ppy.sh/images/layout/beatmaps/default-bg.png"}},computed:{statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}},methods:{fallbackImage(e){e.target.src=this.defaultUrl},formatMetadata(e,s){const o=e+" - "+s;return o.length>34?o.slice(0,34)+"...":o},processUrl(e){if(e&&e.indexOf("osu.ppy.sh/beatmapsets/")!==-1){const s=e.indexOf("beatmapsets/")+12,o=e.indexOf("#");let l;return o!==-1?l=e.slice(s,o):l=e.slice(s),`https://assets.ppy.sh/beatmaps/${l}/covers/card.jpg`}else return this.defaultUrl}}});const Qs=["src"],Es={class:"card-img-overlay",style:{padding:"0.50rem 0.50rem 0 0.50rem"}},Fs={class:"card-title mb-1"},Vs={class:"card-text"};function Ds(e,s,o,l,p,c){const r=f("quest-img"),n=f("user-link"),u=f("modes-icons"),g=f("process-tasks");return a(),i("div",{class:"my-2 col-sm-12 col-md-6 col-lg-4",onClick:s[1]||(s[1]=d=>e.$emit("update:selectedBeatmap",e.beatmap))},[t("div",{class:M(["card card-hover map-card bg-dark",e.statusBorder]),"data-bs-toggle":"modal","data-bs-target":"#editBeatmap"},[t("img",{class:"card-img",src:e.processUrl(e.beatmap.url),style:{opacity:"0.2"},onError:s[0]||(s[0]=d=>e.fallbackImage(d))},null,40,Qs),t("div",Es,[t("p",Fs,h(e.formatMetadata(e.beatmap.song.artist,e.beatmap.song.title)),1),t("small",Vs,[b(r,{beatmap:e.beatmap},null,8,["beatmap"]),k(" Hosted by "),b(n,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),I(u,{key:0,modes:[e.beatmap.mode]},null,8,["modes"])):m("",!0),b(g,{class:"float-end pt-1",tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])])])],2)])}const x=v(Us,[["render",Ds],["__scopeId","data-v-a765c2fc"]]),Ns=y({components:{BeatmapCard:x},computed:K("beatmaps",["hostedBeatmaps"]),methods:Y("beatmaps",["setSelectedBeatmap"])}),Gs={class:"container card card-body py-3"},js={class:"ms-2"},Hs={href:"#hostedBeatmaps","data-bs-toggle":"collapse"},Rs=t("i",{class:"fas fa-angle-down"},null,-1),Ws={key:0,id:"hostedBeatmaps",class:"show"},zs={key:0,class:"ms-5 text-secondary"};function Ks(e,s,o,l,p,c){const r=f("beatmap-card");return a(),i("div",Gs,[t("h5",js,[t("a",Hs,[k(" My mapsets ("+h(e.hostedBeatmaps?e.hostedBeatmaps.length:"...")+") ",1),Rs])]),e.hostedBeatmaps?(a(),i("div",Ws,[b(V,{name:"list",tag:"div",class:"row"},{default:P(()=>[(a(!0),i(w,null,B(e.hostedBeatmaps,n=>(a(),I(r,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":s[0]||(s[0]=u=>e.setSelectedBeatmap(u))},null,8,["beatmap"]))),128))]),_:1}),e.hostedBeatmaps.length?m("",!0):(a(),i("p",zs," None... "))])):m("",!0)])}const Ys=v(Ns,[["render",Ks]]),Xs=y({components:{BeatmapCard:x},props:{isLoadingGuestBeatmaps:Boolean},computed:K("beatmaps",["guestDifficultyBeatmaps"]),methods:Y("beatmaps",["setSelectedBeatmap"])}),Js={class:"container card card-body py-3"},Zs={class:"ms-2"},xs={href:"#guestDifficultyBeatmaps","data-bs-toggle":"collapse"},et=t("i",{class:"fas fa-angle-down"},null,-1),st={key:0,class:"ms-5 text-secondary"};function tt(e,s,o,l,p,c){const r=f("beatmap-card");return a(),i("div",Js,[t("h5",Zs,[t("a",xs,[k(" My guest difficulties ("+h(e.guestDifficultyBeatmaps&&!e.isLoadingGuestBeatmaps?e.guestDifficultyBeatmaps.length:"...")+") ",1),et])]),e.guestDifficultyBeatmaps?(a(),i("div",{key:0,id:"guestDifficultyBeatmaps",class:M(["collapse",{"loading-data":e.isLoadingGuestBeatmaps}])},[!e.guestDifficultyBeatmaps.length&&!e.isLoadingGuestBeatmaps?(a(),i("p",st," None... ")):m("",!0),b(V,{name:"list",tag:"div",class:"row"},{default:P(()=>[(a(!0),i(w,null,B(e.guestDifficultyBeatmaps,n=>(a(),I(r,{key:n.id,beatmap:n,"onUpdate:selectedBeatmap":s[0]||(s[0]=u=>e.setSelectedBeatmap(u))},null,8,["beatmap"]))),128))]),_:1})],2)):m("",!0)])}const at=v(Xs,[["render",tt]]),ot=y({name:"ModeChoice",props:{beatmap:{type:Object,required:!0}},data(){return{selectedMode:this.beatmap.mode,showInput:!1,modes:[{value:"osu",name:"osu!"},{value:"taiko",name:"osu!taiko"},{value:"catch",name:"osu!catch"},{value:"mania",name:"osu!mania"},{value:"hybrid",name:"Multiple modes"}]}},methods:{async setMode(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setMode`,{mode:this.selectedMode},e);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),this.showInput=!1}}}),it={id:"mode"},nt={class:"row mb-2"},lt={class:"col"},dt=t("i",{class:"fas fa-edit"},null,-1),rt=[dt],ut={class:"small ms-3 text-secondary"},pt={key:0,class:"row mb-2"},ct={class:"col"},mt={class:"input-group input-group-sm"},ht=["value"];function ft(e,s,o,l,p,c){const r=S("bs-tooltip");return a(),i("div",it,[t("div",nt,[t("div",lt,[t("div",null,[k(" Mode "),$((a(),i("a",{id:"editMode",href:"#",class:M([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:s[0]||(s[0]=L(n=>e.showInput=!e.showInput,["prevent"]))},rt,2)),[[r,"edit mode","right"]])]),t("div",ut,h(e.beatmap.mode=="hybrid"?"Multiple modes":e.beatmap.mode=="osu"?"osu!":"osu!"+e.beatmap.mode),1)])]),e.showInput?(a(),i("div",pt,[t("div",ct,[t("div",mt,[$(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.selectedMode=n),class:"form-select"},[(a(!0),i(w,null,B(e.modes,n=>(a(),i("option",{key:n.value,value:n.value},h(n.name),9,ht))),128))],512),[[C,e.selectedMode]]),$((a(),i("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.setMode(n))},[k(" Save ")])),[[r,"link beatmap to quest"]])])])])):m("",!0)])}const bt=v(ot,[["render",ft]]),_t=y({name:"StatusChoice",props:{beatmap:{type:Object,required:!0}},methods:{async setStatus(e,s){const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setStatus`,{status:e},s);this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o)}}}),$t={id:"mapsetStatus"},kt=t("div",{class:"d-inline-block me-2"}," Status ",-1),gt=["disabled"],yt=["disabled"],vt={class:"small text-secondary"},Bt=t("div",{class:"small text-secondary mt-1"},[t("div",{class:"small"},' Maps marked as "Done" will be processed for points when they reach the Ranked category on osu!. ')],-1);function wt(e,s,o,l,p,c){const r=S("bs-tooltip");return a(),i("div",$t,[kt,$((a(),i("button",{class:M(["btn btn-sm me-1",e.beatmap.status=="WIP"?"btn-warning":"btn-outline-warning"]),disabled:e.beatmap.status=="WIP",onClick:s[0]||(s[0]=n=>e.setStatus("WIP",n))},[k(" WIP ")],10,gt)),[[r,"mark mapset as work-in-progress","bottom"]]),$((a(),i("button",{class:M(["btn btn-sm me-1",e.beatmap.status=="Done"?"btn-success":"btn-outline-success"]),disabled:e.beatmap.status=="Done",onClick:s[1]||(s[1]=n=>e.setStatus("Done",n))},[k(" Done ")],10,yt)),[[r,"mark mapset and all diffs as done","bottom"]]),t("span",vt,'(currently "'+h(e.beatmap.status)+'")',1),Bt])}const Mt=v(_t,[["render",wt]]),It=y({name:"QuestOrMissionChoice",props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:[],openMissions:[],showInput:!1,dropdownId:""}},computed:q(["loggedInUser"]),watch:{async beatmap(){var s,o;this.showInput=!1,this.dropdownId=((s=this.beatmap.quest)==null?void 0:s.id)||((o=this.beatmap.mission)==null?void 0:o.id)||"";const e=await this.$http.executeGet(`/missions/open/${this.beatmap.mode}/${this.beatmap.id}`);this.$http.isError(e)||(this.openMissions=e)}},async created(){const e=await this.$http.executeGet(`/users/${this.loggedInUser.id}/quests`),s=await this.$http.executeGet(`/missions/open/${this.beatmap.mode}/${this.beatmap.id}`);this.$http.isError(e)||(this.userQuests=e),this.$http.isError(s)||(this.openMissions=s)},methods:{async linkQuestOrMission(e){const s=this.userQuests.find(l=>l.id==this.dropdownId),o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/${s?"linkQuest":"linkMission"}`,{questOrMissionId:this.dropdownId},e);this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o)}}}),Lt={class:"row mb-2"},St={class:"col"},Tt=t("i",{class:"fas fa-edit"},null,-1),Ct=[Tt],Pt={class:"small ms-3 text-secondary"},qt=["href"],Ot=["href"],At={key:2},Ut={key:0,class:"row mb-2"},Qt={class:"col"},Et={class:"input-group input-group-sm"},Ft=t("option",{value:""}," No quest ",-1),Vt={key:0,disabled:""},Dt=["value"],Nt={key:1,disabled:""},Gt=["value"];function jt(e,s,o,l,p,c){const r=S("bs-tooltip");return a(),i("div",null,[t("div",Lt,[t("div",St,[t("div",null,[k(" Quest "),$((a(),i("a",{id:"editLink",href:"#",class:M([e.showInput?"text-danger":"","text-success small ms-1"]),onClick:s[0]||(s[0]=L(n=>e.showInput=!e.showInput,["prevent"]))},Ct,2)),[[r,"connect mapset with a quest","right"]])]),t("div",Pt,[e.beatmap.quest?(a(),i("a",{key:0,href:`/quests?id=${e.beatmap.quest.id}`},h(e.beatmap.quest.name),9,qt)):e.beatmap.mission?(a(),i("a",{key:1,href:`/missions?id=${e.beatmap.mission.id}`},h(e.beatmap.mission.name),9,Ot)):(a(),i("i",At,"none"))])])]),e.showInput?(a(),i("div",Ut,[t("div",Qt,[t("div",Et,[$(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.dropdownId=n),class:"form-select"},[Ft,e.userQuests.length?(a(),i("option",Vt," --- claimed quests --- ")):m("",!0),(a(!0),i(w,null,B(e.userQuests,n=>(a(),i("option",{key:n.id,value:n.id},h(n.name),9,Dt))),128)),e.openMissions.length?(a(),i("option",Nt," --- open priority quests --- ")):m("",!0),(a(!0),i(w,null,B(e.openMissions,n=>(a(),i("option",{key:n.id,value:n.id},h(n.name),9,Gt))),128))],512),[[C,e.dropdownId]]),$((a(),i("button",{class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.linkQuestOrMission(n))},[k(" Save ")])),[[r,"link beatmap to quest"]])])])])):m("",!0)])}const Ht=v(It,[["render",jt]]),Rt=y({name:"ModdersList",components:{UserLinkList:D},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...q(["loggedInUser"]),isModder(){return this.beatmap.modders.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateModder(e){e.target.classList.add("fake-button-disable");const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateModder`);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),e.target.classList.remove("fake-button-disable")}}}),Wt={id:"modders",class:"row mb-2"},zt={class:"col"},Kt={key:0,class:"ms-1"},Yt={class:"small ms-3"},Xt={key:0,class:"text-secondary"};function Jt(e,s,o,l,p,c){const r=f("user-link-list"),n=S("bs-tooltip");return a(),i("div",Wt,[t("div",zt,[t("div",null,[k(" Modders ("+h(e.beatmap.modders.length)+") ",1),e.canEdit?$((a(),i("small",Kt,[t("a",{href:"#",class:M(e.isModder?"text-danger":"text-success"),onClick:s[0]||(s[0]=L(u=>e.updateModder(u),["prevent"]))},[t("i",{class:M(["fas",e.isModder?"fa-minus":"fa-plus"])},null,2)],2)])),[[n,"add/remove yourself from modder list","right"]]):m("",!0)]),t("div",Yt,[e.beatmap.modders.length==0?(a(),i("i",Xt," none ")):(a(),I(r,{key:1,users:e.beatmap.modders},null,8,["users"]))])])])}const Zt=v(Rt,[["render",Jt]]),xt=y({name:"NominatorsList",components:{UserLinkList:D},props:{canEdit:Boolean,beatmap:{type:Object,required:!0}},computed:{...q(["loggedInUser"]),isBn(){return this.beatmap.bns.some(e=>e.osuId==this.loggedInUser.osuId)}},methods:{async updateBn(e){e.target.classList.add("fake-button-disable");const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/updateBn`);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s),e.target.classList.remove("fake-button-disable")}}}),ea={key:0,class:"ms-1"},sa=t("i",{class:"fas fa-minus"},null,-1),ta=[sa],aa=t("i",{class:"fas fa-plus"},null,-1),oa=[aa],ia={class:"small ms-3"},na={key:0,class:"text-secondary"};function la(e,s,o,l,p,c){const r=f("user-link-list"),n=S("bs-tooltip");return a(),i("div",null,[t("div",null,[k(" Nominators ("+h(e.beatmap.bns.length)+") ",1),e.canEdit?$((a(),i("small",ea,[e.isBn?(a(),i("a",{key:0,href:"#",class:"text-danger",onClick:s[0]||(s[0]=L(u=>e.updateBn(u),["prevent"]))},ta)):m("",!0),!e.isBn&&e.beatmap.bns.length<2?(a(),i("a",{key:1,href:"#",class:"text-success",onClick:s[1]||(s[1]=L(u=>e.updateBn(u),["prevent"]))},oa)):m("",!0)])),[[n,"add/remove yourself from potential BN list","right"]]):m("",!0)]),t("div",ia,[e.beatmap.bns.length==0?(a(),i("i",na,"none")):(a(),I(r,{key:1,users:e.beatmap.bns},null,8,["users"]))])])}const da=v(xt,[["render",la]]),ra=y({name:"BeatmapLink",props:{beatmap:{type:Object,required:!0}},data(){return{url:"",showLinkInput:!1}},watch:{beatmap(e){e&&(this.showLinkInput=!1,this.url=e.url)}},created(){this.url=this.beatmap.url},methods:{async saveLink(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/setLink`,{url:this.url},e);this.$http.isError(s)||(this.showLinkInput=!1,this.$store.dispatch("beatmaps/updateBeatmap",s))}}}),ua={class:"row mb-2"},pa={class:"col"},ca=t("i",{class:"fas fa-edit"},null,-1),ma=[ca],ha={class:"small ms-3"},fa=["href"],ba={key:1,class:"text-secondary"},_a={key:0,class:"row mb-2"},$a={class:"col-sm-12"},ka={class:"input-group input-group-sm"};function ga(e,s,o,l,p,c){const r=S("bs-tooltip");return a(),i("div",null,[t("div",ua,[t("div",pa,[t("div",null,[k(" Link "),$((a(),i("a",{id:"editLink",href:"#",class:M(["text-success small ms-1",{"text-danger":e.showLinkInput}]),onClick:s[0]||(s[0]=L(n=>e.showLinkInput=!e.showLinkInput,["prevent"]))},ma,2)),[[r,"edit link","right"]])]),t("div",ha,[e.beatmap.url?(a(),i("a",{key:0,href:e.beatmap.url,target:"_blank",class:"text-truncate",style:{display:"block"}},h(e.beatmap.url),9,fa)):(a(),i("i",ba,"none"))])])]),e.showLinkInput?(a(),i("div",_a,[t("div",$a,[t("div",ka,[$(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.url=n),class:"form-control form-control-sm",type:"text",placeholder:"URL",onKeyup:s[2]||(s[2]=E(n=>e.saveLink(n),["enter"]))},null,544),[[Q,e.url]]),t("button",{id:"addLinkButton",class:"btn btn-outline-info",type:"submit",onClick:s[3]||(s[3]=n=>e.saveLink(n))}," Save ")])])])):m("",!0)])}const ya=v(ra,[["render",ga]]),va=y({name:"LocksChoice",props:{beatmap:{type:Object,required:!0},beatmapId:{type:String,required:!0}},data(){return{lockTaskSelection:"",showLocksInput:!1,phaseEdit:!1}},computed:{remainingTasks(){var s,o;let e=Object.values(J);return(o=(s=this.beatmap)==null?void 0:s.tasksLocked)!=null&&o.length&&(e=e.filter(l=>!this.beatmap.tasksLocked.includes(l))),this.lockTaskSelection=e[0]||"",e}},watch:{beatmapId(){this.showLocksInput=!1},beatmap(){this.beatmap.tasksLocked.length>=6&&(this.showLocksInput=!1)}},methods:{async unlockTask(e,s){s.target.classList.add("fake-button-disable");const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/unlockTask`,{task:e});this.$http.isError(o)||this.$store.dispatch("beatmaps/updateBeatmap",o),s.target.classList.remove("fake-button-disable")},async lockTask(e){const s=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/lockTask`,{task:this.lockTaskSelection},e);this.$http.isError(s)||this.$store.dispatch("beatmaps/updateBeatmap",s)}}}),Ba={id:"locks",class:"row mb-1"},wa={class:"col"},Ma=t("i",{class:"fas fa-edit"},null,-1),Ia=[Ma],La={class:"small ms-3"},Sa={key:0},Ta={key:1},Ca=["onClick"],Pa=t("i",{class:"fas fa-minus"},null,-1),qa=[Pa],Oa={class:"text-secondary mx-1"},Aa={key:0,class:"row"},Ua={class:"col"},Qa={class:"input-group input-group-sm"},Ea=["value"],Fa=t("i",{class:"fas fa-lock"},null,-1),Va=[Fa];function Da(e,s,o,l,p,c){const r=S("bs-tooltip");return a(),i("div",null,[t("div",Ba,[t("div",wa,[t("div",null,[k(" Locks "),e.beatmap.tasksLocked.length<6?$((a(),i("a",{key:0,class:M(["text-success small ms-1",{"text-danger":e.showLocksInput}]),href:"#",onClick:s[0]||(s[0]=L(n=>e.showLocksInput=!e.showLocksInput,["prevent"]))},Ia,2)),[[r,"edit locks","right"]]):m("",!0)]),t("div",La,[e.beatmap.tasksLocked.length==0?(a(),i("i",Sa,"none")):m("",!0),e.beatmap.tasksLocked.length>0?(a(),i("div",Ta,[(a(!0),i(w,null,B(e.beatmap.tasksLocked,n=>(a(),i("div",{key:n},[$((a(),i("a",{href:"#",class:M(["text-danger",e.phaseEdit?"fake-button-disable":""]),onClick:L(u=>e.unlockTask(n,u),["prevent"])},qa,10,Ca)),[[r,"unlock","left"]]),t("span",Oa,h(n),1)]))),128))])):m("",!0)])])]),e.showLocksInput?(a(),i("div",Aa,[t("div",Ua,[t("div",Qa,[$(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.lockTaskSelection=n),class:"form-select"},[(a(!0),i(w,null,B(e.remainingTasks,n=>(a(),i("option",{key:n,value:n},h(n),9,Ea))),128))],512),[[C,e.lockTaskSelection]]),$((a(),i("button",{id:"lockTask",class:"btn btn-outline-info",onClick:s[2]||(s[2]=n=>e.lockTask(n))},Va)),[[r,"prevent other mappers from claiming a difficulty","right"]])])])])):m("",!0)])}const Na=v(va,[["render",Da]]),Ga=y({name:"Points",props:{beatmap:{type:Object,required:!0}},data(){return{tasksPointsArray:null,usersPointsArrays:null,pointsInfo:null,totalPoints:null,bnPoints:null,isLoading:!1}},watch:{beatmap(){this.tasksPointsArray=null,this.usersPointsArrays=null,this.pointsInfo=null,this.totalPoints=null,this.bnPoints=null,this.isLoading=!1}},methods:{async findPoints(e){this.isLoading=!0;const s=await this.$http.executeGet(`/beatmaps/${this.beatmap.id}/findPoints`,e);this.$http.isError(s)||(this.tasksPointsArray=s.tasksPointsArray,this.usersPointsArrays=s.usersPointsArrays,this.pointsInfo=s.pointsInfo,this.totalPoints=s.totalPoints,this.bnPoints=s.bnPoints),this.isLoading=!1}}}),ja={class:"row"},Ha={class:"col-sm-12"},Ra={key:1,class:"small text-secondary ms-2"},Wa={key:2,class:"small text-secondary ms-2"},za={key:0,class:"col-sm-6"},Ka={class:"small text-secondary"},Ya=t("li",null,"Map host: 5",-1),Xa={class:"col-sm-6"},Ja={key:0,class:"small text-secondary"},Za={key:1,class:"col-sm-12"},xa={class:"small text-secondary ms-2"};function eo(e,s,o,l,p,c){const r=S("bs-tooltip");return a(),i("div",null,[t("div",ja,[t("div",Ha,[e.tasksPointsArray?m("",!0):$((a(),i("button",{key:0,class:"btn btn-sm btn-outline-info ms-1",onClick:s[0]||(s[0]=n=>e.findPoints(n))},[k(" Calculate points ")])),[[r,"calculate points for all difficulties"]]),e.isLoading?(a(),i("div",Ra," calculating... ")):e.pointsInfo?(a(),i("div",Wa,h(e.pointsInfo),1)):m("",!0)]),e.tasksPointsArray?(a(),i("div",za,[t("ul",Ka,[(a(!0),i(w,null,B(e.tasksPointsArray,(n,u)=>(a(),i("li",{key:u},h(n),1))),128)),t("li",null,"BN mod/nomination: "+h(e.bnPoints),1),Ya])])):m("",!0),t("div",Xa,[e.usersPointsArrays?(a(),i("ul",Ja,[(a(!0),i(w,null,B(e.usersPointsArrays,(n,u)=>(a(),i("li",{key:u},h(e.usersPointsArrays[u][0])+": "+h(e.usersPointsArrays[u][0]==e.beatmap.host.username?e.usersPointsArrays[u][1]+5:e.usersPointsArrays[u][1]),1))),128))])):m("",!0)]),e.totalPoints?(a(),i("div",Za,[t("span",xa," total: "+h(Math.round(e.totalPoints*10)/10+5),1)])):m("",!0)])])}const so=v(Ga,[["render",eo]]),to=y({name:"BeatmapInfo",components:{ModeChoice:bt,StatusChoice:Mt,TasksChoice:pe,QuestOrMissionChoice:Ht,ModdersList:Zt,NominatorsList:da,BeatmapLink:ya,LocksChoice:Na,Points:so},props:{beatmap:{type:Object,required:!0}},data(){return{userQuests:null}},computed:{...q(["loggedInUser"]),isHost(){return this.loggedInUser.id&&this.beatmap?this.loggedInUser.id===this.beatmap.host.id:!1},isRanked(){return this.beatmap.status===j.Ranked},isQualified(){return this.beatmap.status===j.Qualified}},methods:{async deleteMap(e){if(confirm("Are you sure you want to delete?")){e.target.disabled=!0;const o=await this.$http.executePost(`/beatmaps/${this.beatmap.id}/delete`,{},e);this.$http.isError(o)||(this.$bs.hideModal("editBeatmap"),this.$store.commit("beatmaps/deleteBeatmap",o)),e.target.disabled=!1}}}});const G=e=>(R("data-v-4727d833"),e=e(),W(),e),ao={key:0,class:"container"},oo={class:"row"},io={class:"row mb-2"},no={class:"col-sm-6"},lo={key:0,id:"bns",class:"col-sm-6"},ro=G(()=>t("hr",null,null,-1)),uo={class:"row"},po={class:"col-sm"},co={key:0,class:"col-lg-5 bm-col-separator-left"},mo={key:0,class:"row"},ho={class:"col-sm"},fo=G(()=>t("hr",null,null,-1)),bo={class:"row"},_o={class:"col-sm"},$o=G(()=>t("hr",null,null,-1)),ko={class:"row"},go={class:"col-sm-4 text-end"},yo={class:"small text-secondary"};function vo(e,s,o,l,p,c){const r=f("modders-list"),n=f("nominators-list"),u=f("tasks-choice"),g=f("status-choice"),d=f("mode-choice"),T=f("quest-or-mission-choice"),se=f("beatmap-link"),te=f("locks-choice"),ae=f("points");return e.beatmap?(a(),i("div",ao,[t("div",oo,[t("div",{class:M(e.isHost&&!e.isRanked?"col-lg-7":"col-sm-12")},[t("div",io,[t("div",no,[b(r,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])]),!e.isRanked||e.beatmap.bns?(a(),i("div",lo,[b(n,{beatmap:e.beatmap,"can-edit":!e.isHost&&!e.isRanked},null,8,["beatmap","can-edit"])])):m("",!0)]),ro,t("div",uo,[t("div",po,[b(u,{beatmap:e.beatmap,"is-host":e.isHost,"is-ranked":e.isRanked,"is-qualified":e.isQualified},null,8,["beatmap","is-host","is-ranked","is-qualified"])])])],2),e.isHost&&!e.isRanked?(a(),i("div",co,[e.isQualified?m("",!0):(a(),i("div",mo,[t("div",ho,[b(g,{beatmap:e.beatmap},null,8,["beatmap"]),fo])])),t("div",bo,[t("div",_o,[e.beatmap.status=="WIP"?(a(),I(d,{key:0,class:"mb-2",beatmap:e.beatmap},null,8,["beatmap"])):m("",!0)])]),b(T,{beatmap:e.beatmap},null,8,["beatmap"]),e.isQualified?m("",!0):(a(),I(se,{key:1,beatmap:e.beatmap},null,8,["beatmap"])),e.beatmap.status=="WIP"?(a(),I(te,{key:2,beatmap:e.beatmap,"beatmap-id":e.beatmap.id},null,8,["beatmap","beatmap-id"])):m("",!0)])):m("",!0)]),$o,t("div",ko,[b(ae,{class:"col-sm-8",beatmap:e.beatmap},null,8,["beatmap"]),t("div",go,[t("span",yo," Created: "+h(e.beatmap.createdAt.toString().slice(0,10)),1),e.isHost&&!e.isRanked?(a(),i("button",{key:0,id:"deleteButton",class:"btn btn-sm btn-outline-danger ms-2",onClick:s[0]||(s[0]=oe=>e.deleteMap(oe))}," Delete ")):m("",!0)])])])):m("",!0)}const ee=v(to,[["render",vo],["__scopeId","data-v-4727d833"]]),Bo=y({name:"BeatmapTableRow",components:{BeatmapInfo:ee,ProcessTasks:Z,QuestImg:N,ModesIcons:U},props:{beatmap:{type:Object,required:!0}},methods:{selectBeatmap(){this.$route.query.id!==this.beatmap.id&&this.$router.push(`/beatmaps?id=${this.beatmap.id}`)},formatMetadata(){const e=this.beatmap.song.artist+" - "+this.beatmap.song.title;return e.length>70?e.slice(0,70)+"...":e},statusBorder(){return this.beatmap.status?"card-status-"+this.beatmap.status.toLowerCase():""}}}),wo={class:"container"},Mo={class:"row"},Io={class:"col-sm-6"},Lo=["data-bs-target"],So=t("i",{class:"fas fa-angle-down"},null,-1),To={class:"col-sm-2 small d-flex justify-content-end align-items-center"},Co={class:"col-sm-3 small"},Po=t("span",{class:"text-secondary me-1"},"Hosted by",-1),qo={key:0,class:"text-secondary"},Oo={key:0,class:"col-sm-1 d-flex justify-content-end align-items-center"},Ao=["href"],Uo=t("i",{class:"fas fa-link"},null,-1),Qo=[Uo],Eo=["id"];function Fo(e,s,o,l,p,c){const r=f("quest-img"),n=f("process-tasks"),u=f("user-link"),g=f("modes-icons"),d=f("beatmap-info");return a(),i("div",null,[t("div",{class:M(["card card-body card-level-2 my-1 p-1",e.statusBorder()])},[t("div",wo,[t("div",Mo,[t("div",Io,[b(r,{beatmap:e.beatmap},null,8,["beatmap"]),t("a",{href:"#","data-bs-toggle":"collapse","data-bs-target":"#details"+e.beatmap.id,onClick:s[0]||(s[0]=T=>e.selectBeatmap())},[k(h(e.formatMetadata())+" ",1),So],8,Lo)]),t("div",To,[b(n,{tasks:e.beatmap.tasks,"tasks-locked":e.beatmap.tasksLocked,mode:e.beatmap.mode},null,8,["tasks","tasks-locked","mode"])]),t("div",Co,[Po,b(u,{class:"me-1",user:e.beatmap.host},null,8,["user"]),e.beatmap.mode!=="osu"?(a(),i("span",qo,[b(g,{modes:[e.beatmap.mode]},null,8,["modes"])])):m("",!0)]),e.beatmap.url?(a(),i("div",Oo,[t("a",{href:e.beatmap.url,target:"_blank"},Qo,8,Ao)])):m("",!0)])])],2),t("div",{id:"details"+e.beatmap.id,class:M(["collapse my-2 mx-4 row border-end border-start py-3","border-"+e.beatmap.status.toLowerCase()])},[b(d,{beatmap:e.beatmap},null,8,["beatmap"])],10,Eo)])}const Vo=v(Bo,[["render",Fo]]),Do=y({components:{BeatmapTableRow:Vo},computed:q("beatmaps",{otherBeatmaps:"allBeatmaps",isLoadingOtherBeatmaps:"isLoadingOtherBeatmaps",filterValue:"filterValue"}),methods:{async showMore(e){e.target.disabled=!0,this.$store.commit("beatmaps/increaseFetchLimit"),await this.$store.dispatch("beatmaps/loadOtherBeatmaps"),e.target.disabled=!1}}}),No={class:"container card card-body py-3"},Go={class:"ms-2"},jo={href:"#otherBeatmaps","data-bs-toggle":"collapse"},Ho=t("i",{class:"fas fa-angle-down"},null,-1),Ro={key:0,id:"otherBeatmaps",class:"collapse"},Wo={key:0,class:"ms-5 text-secondary"},zo={key:1,class:"text-center"},Ko=t("i",{class:"fas fa-angle-down me-1"},null,-1),Yo=t("i",{class:"fas fa-angle-down ms-1"},null,-1);function Xo(e,s,o,l,p,c){const r=f("beatmap-table-row");return a(),i("div",No,[t("h5",Go,[t("a",jo,[k(" Other beatmaps ("+h(e.otherBeatmaps&&!e.isLoadingOtherBeatmaps?e.otherBeatmaps.length:"...")+") ",1),Ho])]),e.otherBeatmaps?(a(),i("div",Ro,[t("div",{class:M({"loading-data":e.isLoadingOtherBeatmaps})},[!e.otherBeatmaps.length&&!e.isLoadingOtherBeatmaps?(a(),i("p",Wo," None... ")):m("",!0),(a(!0),i(w,null,B(e.otherBeatmaps,n=>(a(),I(r,{key:n.id,beatmap:n},null,8,["beatmap"]))),128)),e.filterValue?m("",!0):(a(),i("div",zo,[t("button",{class:"btn btn-sm btn-outline-info my-4",onClick:s[0]||(s[0]=L(n=>e.showMore(n),["prevent"]))},[Ko,k(" show more "),Yo])]))],2)])):m("",!0)])}const Jo=v(Do,[["render",Xo]]),Zo=y({components:{BeatmapInfo:ee,ModalDialog:X,QuestImg:N,ModesIcons:U},props:{selectedBeatmap:{type:Object,default:()=>({})}},watch:{selectedBeatmap(){this.selectedBeatmap&&this.$route.query.id!==this.selectedBeatmap.id&&this.$router.replace(`/beatmaps?id=${this.selectedBeatmap.id}`)}}}),xo=["href"],ei=t("i",{class:"fas fa-link"},null,-1),si={key:1};function ti(e,s,o,l,p,c){const r=f("quest-img"),n=f("user-link"),u=f("modes-icons"),g=f("beatmap-info"),d=f("modal-dialog");return a(),I(d,{id:"editBeatmap",loaded:Boolean(e.selectedBeatmap),"header-class":e.selectedBeatmap?"bg-"+e.selectedBeatmap.status.toLowerCase():""},{header:P(()=>[b(r,{beatmap:e.selectedBeatmap},null,8,["beatmap"]),e.selectedBeatmap.url?(a(),i("a",{key:0,href:e.selectedBeatmap.url,target:"_blank"},[ei,k(" "+h(e.selectedBeatmap.song.artist)+" - "+h(e.selectedBeatmap.song.title),1)],8,xo)):(a(),i("span",si,h(e.selectedBeatmap.song.artist)+" - "+h(e.selectedBeatmap.song.title),1)),k(" |"),b(n,{class:"mx-1",user:e.selectedBeatmap.host},null,8,["user"]),b(u,{modes:[e.selectedBeatmap.mode]},null,8,["modes"])]),default:P(()=>[b(g,{beatmap:e.selectedBeatmap},null,8,["beatmap"])]),_:1},8,["loaded","header-class"])}const ai=v(Zo,[["render",ti]]),oi={namespaced:!0,state:{allBeatmaps:[],userBeatmaps:[],filterValue:"",filterMode:H.any,filterStatus:"any",filterQuest:"any",selectedBeatmap:null,selectedBeatmapId:null,fetchLimit:30,isLoadingOtherBeatmaps:!0},mutations:{setAllBeatmaps(e,s){e.allBeatmaps=s},setUserBeatmaps(e,s){e.userBeatmaps=s},setFilterValue(e,s){e.filterValue=s},setFilterMode(e,s){e.filterMode=s},setFilterStatus(e,s){e.filterStatus=s},setFilterQuest(e,s){e.filterQuest=s},setIsLoadingOtherBeatmaps(e,s){e.isLoadingOtherBeatmaps=s},increaseFetchLimit(e){e.fetchLimit+=50},setSelectedBeatmap(e,s){const o=Object.values(J);s.tasks.sort(function(l,p){return o.indexOf(l.name)-o.indexOf(p.name)}),s.tasksLocked.sort(function(l,p){return o.indexOf(l)-o.indexOf(p)}),e.selectedBeatmap=s},addBeatmap(e,s){e.userBeatmaps.unshift(s)},updateBeatmap(e,s){let o=e.allBeatmaps.findIndex(l=>l.id===s.id);o!==-1&&(e.allBeatmaps[o]=s),o=e.userBeatmaps.findIndex(l=>l.id===s.id),o!==-1&&(e.userBeatmaps[o]=s)},deleteBeatmap(e,s){let o=e.allBeatmaps.findIndex(l=>l.id===s.id);o!==-1&&e.allBeatmaps.splice(o,1),o=e.userBeatmaps.findIndex(l=>l.id===s.id),o!==-1&&e.userBeatmaps.splice(o,1)}},getters:{filteredUserBeatmaps:e=>{let s=e.userBeatmaps;if(e.filterMode!==H.any){const o=e.filterMode;s=s.filter(l=>l.mode===o||l.mode===z.Hybrid)}if(e.filterStatus!=="any"&&(s=s.filter(o=>o.status===e.filterStatus)),e.filterQuest!=="any"&&(s=s.filter(o=>!o.quest)),e.filterValue){const o=e.filterValue.toLowerCase().trim().split(" ").filter(l=>l.length);s=s.filter(l=>{let p=l.song.artist+" "+l.song.title+" "+l.host.username;return l.tasks.forEach(c=>{c.mappers.forEach(r=>{p+=" "+r.username})}),p=p.toLowerCase(),o.some(c=>p.includes(c))})}return s},guestDifficultyBeatmaps:(e,s,o)=>s.filteredUserBeatmaps.filter(l=>{var p;return l.host.id!==((p=o.loggedInUser)==null?void 0:p.id)}),hostedBeatmaps:(e,s,o)=>s.filteredUserBeatmaps.filter(l=>{var p;return l.host.id===((p=o.loggedInUser)==null?void 0:p.id)})},actions:{updateBeatmap({commit:e,state:s},o){var l;e("updateBeatmap",o),((l=s.selectedBeatmap)==null?void 0:l.id)===o.id&&e("setSelectedBeatmap",o)},async updateFilterMode({commit:e,dispatch:s},o){e("setFilterMode",o),await s("loadOtherBeatmaps")},async updateFilterStatus({commit:e,dispatch:s},o){e("setFilterStatus",o),await s("loadOtherBeatmaps")},async updateFilterQuest({commit:e,dispatch:s},o){e("setFilterQuest",o),await s("loadOtherBeatmaps")},async updateFilterValue({commit:e,dispatch:s},o){e("setFilterValue",o),await s("loadOtherBeatmaps")},async loadOtherBeatmaps({commit:e,state:s}){var r;e("setIsLoadingOtherBeatmaps",!0);const o=s.filterStatus!=="any"?`&status=${s.filterStatus}`:"",l=s.filterQuest!=="any"?`&quest=${s.filterQuest}`:"",p=s.filterValue?`&search=${s.filterValue}`:"",c=await de.get(`/api/beatmaps/search?mode=${s.filterMode}&limit=${s.fetchLimit+o+l+p}`);(r=c.data)!=null&&r.allBeatmaps&&e("setAllBeatmaps",c.data.allBeatmaps),e("setIsLoadingOtherBeatmaps",!1)}}},ii=oi,ni=y({name:"BeatmapPage",components:{BeatmapPageFilters:Ps,HostedBeatmaps:Ys,GuestDifficulties:at,OtherBeatmaps:Jo,EditBeatmapModal:ai,CreateBeatmapModal:$s},data(){return{isLoadingGuestBeatmaps:!0}},computed:q("beatmaps",["selectedBeatmap"]),beforeCreate(){this.$store.hasModule("beatmaps")||this.$store.registerModule("beatmaps",ii)},async created(){const e=this.$route.query.id;let s,o;e?([s,o]=await Promise.all([this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.executeGet("/beatmaps/searchOnLoad/"+e)]),this.$http.isError(o)||(this.$store.commit("beatmaps/setSelectedBeatmap",o),this.$bs.showModal("editBeatmap"))):s=await this.$http.initialRequest("/beatmaps/relevantInfo"),this.$http.isError(s)||(this.$store.commit("beatmaps/setUserBeatmaps",s.beatmaps),this.$store.commit("beatmaps/setFilterMode",s.mainMode)),await Promise.all([this.loadGuestBeatmaps(),this.$store.dispatch("beatmaps/loadOtherBeatmaps")]),this.isLoadingGuestBeatmaps=!1},methods:{async loadGuestBeatmaps(){const e=await this.$http.executeGet("/beatmaps/guestBeatmaps");e&&this.$store.commit("beatmaps/setUserBeatmaps",e.userBeatmaps)}}}),li=t("div",{class:"radial-divisor"},null,-1),di=t("div",{class:"radial-divisor"},null,-1);function ri(e,s,o,l,p,c){const r=f("beatmap-page-filters"),n=f("hosted-beatmaps"),u=f("guest-difficulties"),g=f("other-beatmaps"),d=f("edit-beatmap-modal"),T=f("create-beatmap-modal");return a(),i("div",null,[b(r),b(n),li,b(u,{"is-loading-guest-beatmaps":e.isLoadingGuestBeatmaps},null,8,["is-loading-guest-beatmaps"]),di,b(g),b(d,{"selected-beatmap":e.selectedBeatmap},null,8,["selected-beatmap"]),b(T)])}const _i=v(ni,[["render",ri]]);export{_i as default};
