<div id="app">

<div class="row">
    <div class="col-md-12">
        <h2>Beatmaps</h2> 
        <table class="small table">
            <thead>
                <th scope="col" style="padding: 2px;">id</th>
                <th scope="col" style="padding: 2px;">artist - title</th>
                <th scope="col" style="padding: 2px;">host</th>
                <th scope="col" style="padding: 2px;">status</th>
                <th scope="col" style="padding: 2px;">edit</th>
            </thead>
            <tbody>
                <tr v-for="beatmap in beatmaps" :key="beatmap.id">
                    <td scope="row" style="padding: 1px;">\{{beatmap.id}}</td>
                    <td scope="row" style="padding: 1px;">\{{beatmap.song.artist}} - \{{beatmap.song.title}}</td>
                    <td scope="row" style="padding: 1px;"><a :href="'https://osu.ppy.sh/users/' + beatmap.host.osuId" target="_blank">\{{beatmap.host.username}}</a></td>
                    <td scope="row" style="padding: 1px;">\{{beatmap.status}}</td>
                    <td scope="row" style="padding: 1px;" data-toggle="modal" data-target="#editMap" :data-mapid="beatmap.id" @click.prevent="extendedMap(beatmap)"><a href="#">edit</a></td>
                </tr>
            </tbody>
        </table>

        <h2>Quests <button class="btn btn-mg btn-sm temp float-right" data-toggle="modal" data-target="#createQuest">new quest</button></h2> 
        <table class="small table">
            <thead>
                <th scope="col" style="padding: 2px;">id</th>
                <th scope="col" style="padding: 2px;">name</th>
                <th scope="col" style="padding: 2px;">status</th>
                <th scope="col" style="padding: 2px;">edit</th>
            </thead>
            <tbody>
                <tr v-for="quest in quests" :key="quest.id">
                    <td scope="row" style="padding: 1px;">\{{quest._id}}</td>
                    <td scope="row" style="padding: 1px;">\{{quest.name}}</td>
                    <td scope="row" style="padding: 1px;">\{{quest.status}}</td>
                    <td scope="row" style="padding: 1px;" data-toggle="modal" data-target="#editQuest" :data-questid="quest.id" @click.prevent="extendedQuest(quest)"><a href="#">edit</a></td>
                </tr>
            </tbody>
        </table>
        <h2>Parties <button class="btn btn-mg btn-sm temp float-right" @click="updatePartyRanks($event)">refresh party ranks</button></h2>
        <table class="small table">
            <thead>
                <th scope="col" style="padding: 2px;">id</th>
                <th scope="col" style="padding: 2px;">name</th>
                <th scope="col" style="padding: 2px;">leader</th>
                <th scope="col" style="padding: 2px;">edit</th>
            </thead>
            <tbody>
                <tr v-for="party in parties" :key="party.id">
                    <td scope="row" style="padding: 1px;">\{{party._id}}</td>
                    <td scope="row" style="padding: 1px;">\{{party.name}}</a></td>
                    <td scope="row" style="padding: 1px;"><a :href="'https://osu.ppy.sh/users/' + party.leader.osuId" target="_blank">\{{party.leader.username}}</a></td>
                    <td scope="row" style="padding: 1px;" data-toggle="modal" data-target="#editParty" :data-partyid="party.id" @click.prevent="extendedParty(party)"><a href="#">edit</a></td>
                </tr>
            </tbody>
        </table>
        <h2>Users 
            <button class="btn btn-mg btn-sm temp float-right" @click="updateUserPoints($event);">refresh user points</button>
        </h2>
        <table class="small table">
            <thead>
                <th scope="col" style="padding: 2px;">id</th>
                <th scope="col" style="padding: 2px;">name</th>
                <th scope="col" style="padding: 2px;">group</th>
                <th scope="col" style="padding: 2px;">edit</th>
            </thead>
            <tbody>
                <tr v-for="user in users" :key="user.id">
                    <td scope="row" style="padding: 1px;">\{{user._id}}</td>
                    <td scope="row" style="padding: 1px;"><a :href="'https://osu.ppy.sh/users/' + user.osuId" target="_blank">\{{user.username}}</a></td>
                    <td scope="row" style="padding: 1px;">\{{user.group}}</td>
                    <td scope="row" style="padding: 1px;" data-toggle="modal" data-target="#editUser" :data-userid="user.id" @click.prevent="extendedUser(user)"><a href="#">edit</a></td>
                </tr>
            </tbody>
        </table>
        <h2>Featured Artists <button class="btn btn-mg btn-sm temp float-right" data-toggle="modal" data-target="#newArtist">new artist</button></h2>
        <table class="small table">
            <thead>
                <th scope="col" style="padding: 2px;">id</th>
                <th scope="col" style="padding: 2px;">artist</th>
                <th scope="col" style="padding: 2px;">songs</th>
                <th scope="col" style="padding: 2px;">edit</th>
            </thead>
            <tbody>
                <tr v-for="featuredArtist in featuredArtists" :key="featuredArtist">
                    <td scope="row" style="padding: 1px;">\{{featuredArtist._id}}</td>
                    <td scope="row" style="padding: 1px;"><a :href="'https://osu.ppy.sh/beatmaps/artists/' + featuredArtist.osuId" target="_blank">\{{featuredArtist.label}}</a></td>
                    <td scope="row" style="padding: 1px;">\{{featuredArtist.songs.length}}</td>
                    <td scope="row" style="padding: 1px;" data-toggle="modal" data-target="#editSongs" :data-artistid="featuredArtist.id" @click.prevent="extendedArtist(featuredArtist)"><a href="#">edit</a></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!--edit things-->
<!--map-->

<div id="editMap" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content custom-bg-dark" v-if="selectedMap">
            <div class="modal-header text-dark" :class="'bg-' + selectedMap.status.toLowerCase()">
                <h5 class="modal-title">\{{selectedMap.song.artist}} - \{{selectedMap.song.title}} (\{{selectedMap.host.username}})</h5>
                <button type="button" class="close" data-dismiss="modal">
                <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div>
                        <div class="input-group input-group-sm mb-3">
                            <div class="input-group-prepend">
                                <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg" type="submit" @click="setStatus(selectedMap.id, $event)">save status</button>
                            </div>
                                <select class="custom-select select-arrow small" id="mapStatusSelect" style="filter: drop-shadow(1px 1px 1px #000000); border-radius: 0 100px 100px 0">
                                <option selected value="WIP">WIP</option>
                                <option value="Done">Done</option>
                                <option value="Ranked">Ranked</option>
                            </select>
                        </div>
                    </div>
                    
                    <hr>

                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg-used" @click="removeDiff(selectedMap.id, $event)">remove diff</button>
                        </div>
                        <select class="custom-select select-arrow small" id="removeDiffSelection" style="filter: drop-shadow(1px 1px 1px #000000); border-radius: 0 100px 100px 0">
                            <option v-for="task in selectedMap.tasks" :value="task.id">\{{task.name}} - <template v-for="(mapper, i) in task.mappers"><a :href="'https://osu.ppy.sh/users/' + mapper.osuId" target="_blank">\{{ mapper.username + (i < task.mappers.length - 1 ? ', ' : '') }}</a></template></option>
                        </select>
                    </div>

                    <hr>

                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg-used" @click="removeModder(selectedMap.id, $event)">remove modder</i></button>
                        </div>
                        <select class="custom-select select-arrow small" id="removeModderSelection" style="filter: drop-shadow(1px 1px 1px #000000); border-radius: 0 100px 100px 0">
                            <option v-for="modder in selectedMap.modders" :value="modder.id">\{{modder.username}}</option>
                        </select>
                    </div>

                    <hr>

                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg-used" @click="removeNominator(selectedMap.id, $event)">remove bn</i></button>
                        </div>
                        <select class="custom-select select-arrow small" id="removeNominatorSelection" style="filter: drop-shadow(1px 1px 1px #000000); border-radius: 0 100px 100px 0">
                            <option v-for="bn in selectedMap.bns" :value="bn.id">\{{bn.username}}</option>
                        </select>
                    </div>
                    <hr>
                    <div>
                        <a v-if="selectedMap.url" :href="selectedMap.url">\{{selectedMap.url}}</a>
                        <div class="input-group input-group-sm mb-3" id="setLink">
                            <div class="input-group-prepend">
                                <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg" type="submit" @click="updateMapUrl(selectedMap.id, $event)">save link</button>
                            </div>
                                <input class="form-control form-control-sm" type="text" placeholder="URL" id="newLink" style="border-radius: 0 100px 100px 0"></input>
                        </div>
                    </div>
                    <hr>
                    <div>
                        <button type="button" class="btn btn-mg-used btn-sm" @click="deleteMap(selectedMap.id, $event)">delete</button>
                    </div>
                    
                    <p id="errors"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!--quest-->

<div id="createQuest" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content custom-bg-dark">
            <div class="modal-header text-dark bg-rest">
                <h5 class="modal-title">Create quest</h5>
                <button type="button" class="close" data-dismiss="modal">
                <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="form-group row">
                        <label class="col-sm-4" for="questName"> Quest name:</label><input class="col-sm-8 form-control" type="text" id="questName">
                        <label class="col-sm-4" for="questReward"> Reward:</label><input class="col-sm-8 form-control" type="text" id="questReward">
                        <label class="col-sm-4" for="questDescriptionMain"> Objective:</label><input class="col-sm-8 form-control" type="text" id="questDescriptionMain">
                        <label class="col-sm-4" for="questDescriptionFluff"> Flavor text:</label><input class="col-sm-8 form-control" type="text" id="questDescriptionFluff">
                        <label class="col-sm-4" for="questTimeframe"> Timeframe:</label><input class="col-sm-8 form-control" type="text" id="questTimeframe">
                        <label class="col-sm-4" for="questMinParty"> Min Party:</label><input class="col-sm-8 form-control" type="text" id="questMinParty">
                        <label class="col-sm-4" for="questMaxParty"> Max Party:</label><input class="col-sm-8 form-control" type="text" id="questMaxParty">
                        <label class="col-sm-4" for="questMinRank"> Min Rank:</label><input class="col-sm-8 form-control" type="text" id="questMinRank">
                        <label class="col-sm-4" for="art"> FA id:</label><input class="col-sm-8 form-control" type="text" id="art">
                        <label class="col-sm-4" for="exclusive"> Exclusive?:</label><input class="col-sm-8 form-control" type="text" id="exclusive">
                        <label class="col-sm-4" for="medal"> Medal?:</label><input class="col-sm-8 form-control" type="text" id="medal">
                    </div>
                    <p id="errors"></p>
                </div>
                    
                <div class="modal-footer">
                    <button type="button" class="btn btn-mg" @click="createQuest($event)">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="editQuest" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content custom-bg-dark" v-if="selectedQuest">
            <div class="modal-header text-dark" :class="'bg-' + selectedQuest.status">
                <h5 class="modal-title">\{{selectedQuest.name}}</h5>
                <button type="button" class="close" data-dismiss="modal">
                <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div>
                        <button type="button" class="btn btn-mg btn-sm" @click="dropQuest(selectedQuest.id, $event)">force drop</button>
                    </div>
                    <hr>
                    <div>
                        <button type="button" class="btn btn-mg btn-sm" @click="completeQuest(selectedQuest.id, $event)">mark as complete (only wip quests)</button>
                    </div>
                    <hr>
                    <div>
                        <button type="button" class="btn btn-mg btn-sm" @click="hideQuest(selectedQuest.id, $event)">hide (for open quests)</button>
                    </div>
                    <hr>
                    <div>
                        <button type="button" class="btn btn-mg btn-sm" @click="unhideQuest(selectedQuest.id, $event)">unhide (for hidden quests)</button>
                    </div>
                    <hr>
                    <div>
                        <button type="button" class="btn btn-mg-used btn-sm" @click="deleteQuest(selectedQuest.id, $event)">delete (for open quests)</button>
                    </div>
                    <p id="errors"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!--party-->

<div id="editParty" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content custom-bg-dark" v-if="selectedParty">
            <div class="modal-header text-dark bg-rest">
                <h5 class="modal-title">\{{selectedParty.name}}</h5>
                <button type="button" class="close" data-dismiss="modal">
                <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg" type="submit" @click="renameParty(selectedParty.id, $event)">save name</button>
                        </div>
                            <input class="form-control form-control-sm" type="text" placeholder="new name" id="newName" style="border-radius: 0 100px 100px 0"></input>
                    </div>

                    <hr>

                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg-used" type="submit" @click="removeMember(selectedParty.id, $event)">remove member</button>
                        </div>
                            <select class="custom-select select-arrow small" id="removeMemberSelection" style="filter: drop-shadow(1px 1px 1px #000000); border-radius: 0 100px 100px 0">
                            <option v-for="member in selectedParty.members" :value="member.id">\{{member.username}}</option>
                        </select>
                    </div>

                    <hr>

                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg" type="submit" @click="transferLeader(selectedParty.id, $event)">transfer leader</button>
                        </div>
                            <select class="custom-select select-arrow small" id="transferLeaderSelection" style="filter: drop-shadow(1px 1px 1px #000000); border-radius: 0 100px 100px 0">
                            <option v-for="member in selectedParty.members" :value="member.id">\{{member.username}}</option>
                        </select>
                    </div>

                    <hr>

                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg" type="submit" @click="editBanner(selectedParty.id, $event)">edit banner</button>
                        </div>
                            <input class="form-control form-control-sm" type="text" placeholder="map id banner" id="bannerInput" style="border-radius: 0 100px 100px 0"></input>
                    </div>

                    <hr>

                    <div class="input-group input-group-sm mb-3">
                        <button class="rounded-circle-left btn btn-mg-used btn-sm" type="submit" @click="deleteParty(selectedParty.id, $event)">delete party</button>
                    </div>
                    
                    <p id="errors"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!--user-->

<div id="editUser" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content custom-bg-dark" v-if="selectedUser">
            <div class="modal-header text-dark" :class="'bg-rank-' + selectedUser.rank">
                <h5 class="modal-title">\{{selectedUser.username}} (\{{selectedUser.group}})</h5>
                <button type="button" class="close" data-dismiss="modal">
                <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg-used" type="submit" @click="updateUserGroup(selectedUser.id, $event)">update usergroup</button>
                        </div>
                        <select class="custom-select select-arrow small" id="userGroupSelect" style="filter: drop-shadow(1px 1px 1px #000000); border-radius: 0 100px 100px 0">
                            <option selected value="user">user</option>
                            <option value="hidden">hidden</option>
                            <option value="admin">admin</option>
                        </select>
                    </div>
                    <p id="errors"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!--artist-->

<div id="newArtist" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content custom-bg-dark">
            <div class="modal-header text-dark bg-rest">
                <h5 class="modal-title">New Artist</h5>
                <button type="button" class="close" data-dismiss="modal">
                <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="input-group input-group-sm mb-3">
                        <input class="form-control" id="newArtistInput" placeholder="new artist (as written on FA listing)...">
                    </div>
                    <div class="input-group input-group-sm mb-3">
                        <input class="form-control" id="artistId" placeholder="artist's osu id (leave blank if none)">
                    </div>
                    <p id="errors"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-mg" @click="addArtist($event)">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="editSongs" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content custom-bg-dark" v-if="selectedArtist">
            <div class="modal-header text-dark bg-rest">
                <h5 class="modal-title">\{{selectedArtist.label}} (\{{selectedArtist.songs.length}})</h5>
                <button type="button" class="close" data-dismiss="modal">
                <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div>
                    <div class="input-group input-group-sm mb-3">
                        <div class="input-group-prepend">
                            <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg" type="submit" @click="renameLabel(selectedArtist.id, $event)">rename</button>
                        </div>
                            <input class="form-control form-control-sm" type="text" placeholder="new name" id="newLabelName" style="border-radius: 0 100px 100px 0"></input>
                    </div>
                    </div>
                    <hr>
                    <div>
                        <div class="form-group row">
                        <label class="col-sm-3 text-shadow" for="artist"> Artist:</label><input class="col-sm-9 form-control" style="border-radius: 100px 100px 100px 100px" type="text" id="artist">
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-3 text-shadow" for="title"> Title:</label><input class="col-sm-9 form-control" style="border-radius: 100px 100px 100px 100px" type="text" id="title">
                        </div>
                        <button type="button" class="btn btn-mg btn-sm" @click="addSong(selectedArtist.id, $event)">add song</button>
                    </div>
                    <hr>
                    <div>
                        <p class="text-shadow">remove song:</p>
                        <div class="input-group input-group-sm mb-3" id="removeSongForm">
                            <div class="input-group-prepend">
                                <button style="border-radius: 100px 0 0 100px;" class="rounded-circle-left btn btn-mg-used"  @click="removeSong(selectedArtist.id, $event)">delete song</button>
                            </div>
                            <select class="custom-select select-arrow small" id="removeSongSelection" style="filter: drop-shadow(1px 1px 1px #000000); border-radius: 0 100px 100px 0">
                                <option v-for="song in selectedArtist.songs" :value="song.id">\{{song.artist}} - \{{song.title}}</option>
                            </select>
                        </div>
                    </div>
                    <hr>
                    <div>
                        <div class="mb-4">
                            <select class="custom-select select-arrow small" id="editSongSelection" style="filter: drop-shadow(1px 1px 1px #000000); border-radius: 100px 100px 100px 100px; width: 100%">
                                <option v-for="song in selectedArtist.songs" :value="song.id">\{{song.artist}} - \{{song.title}}</option>
                            </select>
                        </div>
                        
                        <div class="form-group row">
                        <label class="col-sm-3 text-shadow" for="editedArtist">edit artist:</label><input class="col-sm-9 form-control" style="border-radius: 100px 100px 100px 100px" type="text" id="editedArtist">
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-3 text-shadow" for="editedTitle">edit title:</label><input class="col-sm-9 form-control" style="border-radius: 100px 100px 100px 100px" type="text" id="editedTitle">
                        </div>
                        <button type="button" class="btn btn-mg btn-sm" @click="updateMetadata(selectedArtist.id, $event)">edit metadata</button>
                    </div>
                    <p id="errors">\{{info}}</p>
                </div>
            </div>
        </div>
    </div>
</div>

</div>